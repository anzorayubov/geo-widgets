// https://cdn.jsdelivr.net/npm/geotif
// https://unpkg.com/browse/geotiff@1.0.4/dist-browser/geotiff.js
// https://npmcdn.com/geotiff@0.3.6/dist/geotiff.js
// https://raw.githubusercontent.com/Allive/geoportal_tiffs/main/geotiff.js - our repo for 0.3.6

const PORT = '3000'
const BACKEND_PORT = '8081'

self.onInit = function () {
    const $injector = self.ctx.$scope.$injector;
    const assetService = $injector.get(self.ctx.servicesMap.get('assetService'));
    const attributeService = $injector.get(self.ctx.servicesMap.get('attributeService'));
    const map = L.map("map")
    googleHybrid = L.tileLayer('http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}', {
        maxZoom: 50, subdomains: ['mt0', 'mt1', 'mt2', 'mt3']
    }).addTo(map)

    self.ctx.$scope.info = []

    // добавление тулбара
    try {
        map.pm.addControls({
            position: 'topleft',
            drawCircle: false,
            drawCircleMarker: false,
            cutPolygon: true,
            drawPolyline: false,
            drawMarker: false
        })
        map.pm.setLang('ru')
    } catch (e) {
        console.log('TOOLBAR', e)
    }

    function addGeoTiffMaps(url, polygonsCoordinates) {
        const dataType = url?.includes('.asc') ? 'asc' : 'tiff'
        //ToDo remove replace
        url = url.replace('localhost', window.location.hostname).replace(':3000', ':' + BACKEND_PORT)

        switch (dataType) {
            case 'asc':
                fetch(url)
                    .then(r => r.text())
                    .then(text => {
                        drawLayer(text, dataType, polygonsCoordinates)
                    })
                break;

            case 'tiff':
                fetch(url)
                    .then(r => r.arrayBuffer())
                    .then(async (buffer) => {
                        try {
                            await drawLayer(buffer, dataType, polygonsCoordinates)
                        } catch (e) {
                            // console.log('drawLayer()', e)
                        }
                    })
                break
        }

        async function drawLayer(data, dataType) {

            let maskPolygonCoordinates = [];
            polygonsCoordinates.forEach((element) => {
                if (element.length) {
                    element.forEach(el => {
                        maskPolygonCoordinates.push([el.lng, el.lat])
                    })
                } else {
                    maskPolygonCoordinates.push([element.lng, element.lat])
                }
            })

            const mask = {
                "type": "Feature",
                "properties": {},
                "geometry": {
                    "type": "Polygon",
                    "coordinates": [maskPolygonCoordinates]
                }
            }
            let s

            try {
                if (dataType === 'asc')
                    s = L.ScalarField.fromASCIIGrid(data);
                else if (dataType === 'tiff')
                    s = await L.ScalarField.fromGeoTIFF(data)
            } catch (err) {
                //  console.log('error in L.ScalarField.from...()', err)
                return
            }

            s.setSpatialMask(mask)

            layer = L.canvasLayer.scalarField(s, {
                opacity: 0.8
            })

            // не добавлять geotiff фотки на экран со списком NDVI
            if (self.ctx.datasources[0].dataKeys.length > 2) {
                layer.addTo(map)
                // выпиливаем ненужные инструменты
                map.pm.addControls({
                    position: 'topleft',
                    drawCircle: false,
                    drawCircleMarker: false,
                    cutPolygon: true,
                    drawPolyline: false,
                    drawMarker: false,
                    drawPolygon: false,
                    drawRectangle: false
                })
            }

            // Dynamic styles
            const low = document.getElementById('lowColor')
            const high = document.getElementById('highColor')

            const updateGradient = function () {
                const scale = chroma.scale([low.value, high.value]).domain(s.range)
                layer.setColor(scale)
            }

            /* dynamic filtering */
            // ToDo возможно можно сократить зависание отфильтровав точки.
            // думаю в изображениях много точек

            self.ctx.$scope.sliderChanged = function (e) {
                let h = e.value
                let f = function (v) {
                    return v >= 0 && v <= h
                }
                layer.setFilter(f)
            }

            const minValue = +s.range[0].toFixed(2)
            const maxValue = +s.range[1].toFixed(2)

            let mid_1 = 33
            let mid_2 = 66

            // Создаём пустой массив, который будет одномерным
            const linearNdvi = []
            // Переводим двумерный grid в одномерный массив
            s.grid.forEach(x => {
                x.forEach(y => linearNdvi.push(y))
            })
            // Сортируем новый одномерный массив по возрастанию
            linearNdvi.sort()

            function getNeededPercentile(percentile = 0.33, linearNdvi) {
                const indexOfPercentile = parseInt((linearNdvi.length * percentile).toFixed(0))
                return linearNdvi[indexOfPercentile]
            }

            $('.minValue').text(minValue)
            $('.maxValue').text(maxValue)

            let rulerPercentage = sessionStorage.getItem('rulerPercentage')

            if (rulerPercentage) {
                try {
                    rulerPercentage = JSON.parse(rulerPercentage)
                    mid_1 = rulerPercentage[1]
                    mid_2 = rulerPercentage[2]
                } catch (e) {
                    console.log('try ruler', e, 'rulerPercentage', rulerPercentage)
                }
            }

            const colors = ["#fff7ec", "#fc8d59", "#7f0000"]
            const slider = document.getElementById('slider')

            noUiSlider.create(slider, {
                start: [0, mid_1, mid_2, 99.999],
                connect: true,
                range: {'min': 0, 'max': 99.999},
                tooltips: [true, true, true, true],
                format: {
                    to: function (value) {
                        return `${value.toFixed(1)}% | ${getNeededPercentile(value / 100, linearNdvi)?.toFixed(2)}`
                    },
                    from: function (value) {
                        return +value
                    }
                }
            })

            slider.noUiSlider.on('change.one', function (e) {
                const percentage = []
                const values = []

                e.forEach(num => {
                    values.push(+num.slice(num.indexOf('|') + 1, num.length))
                    percentage.push(parseInt(num.slice(0, num.indexOf('|'))))
                    sessionStorage.setItem('rulerPercentage', JSON.stringify(percentage))
                })
                const scale = chroma.scale('OrRd').classes(values)
                console.log('percentage', percentage)
                layer.setColor(scale)

                // сюда надо проценты

                setArea(percentage)

                ctx.detectChanges()
            })

            const IUconnects = document.getElementsByClassName("noUi-connects")
            IUconnects[0].childNodes.forEach((item, index) => {
                item.style.backgroundColor = colors[index]
            })
            let slide_toggle = sessionStorage.getItem('slide_toggle')

            if (slide_toggle) {
                try {
                    slide_toggle = JSON.parse(slide_toggle)
                    if (slide_toggle.sliderChanged) {
                        self.ctx.$scope.isSlide_toggleChecked = true

                        $('#slider').css('pointer-events', 'auto')

                        layer.setColor(chroma.scale('OrRd').classes([minValue,
                            getNeededPercentile(mid_1 / 100, linearNdvi), getNeededPercentile(mid_2 / 100, linearNdvi), maxValue]))

                        ctx.detectChanges()
                    }
                } catch (e) {
                    console.log('try slide_toggle', e)
                }
            } else {
                const scale = chroma.scale(["#000000", "#FFFFFF"]).domain(s.range)
                layer.setColor(scale)
            }

            self.ctx.$scope.changeMode = function (i, event) {
                if (event.checked) {
                    $('#slider').css('pointer-events', 'auto')

                    layer.setColor(chroma.scale('OrRd').classes([minValue,
                        getNeededPercentile(mid_1 / 100, linearNdvi), getNeededPercentile(mid_2 / 100, linearNdvi), maxValue]))

                    sessionStorage.setItem('slide_toggle', JSON.stringify({sliderChanged: true}))
                } else if (!event.checked) {
                    updateGradient()
                    $('#slider').css('pointer-events', 'none')
                    sessionStorage.setItem('slide_toggle', JSON.stringify({sliderChanged: false}))
                }
            }

            // Todo
            // отключить автоматичекое перерисовывание!! в нужный момент вызывать layer.needRedraw()

            low.addEventListener('input', updateGradient)
            high.addEventListener('input', updateGradient)

            layer.on("click", function (e) {
                if (e.value !== null) {
                    const v = e.value//.toFixed(3)
                    const html = `<span class="popupText">${v}</span>`
                    const popup = L.popup()
                        .setLatLng(e.latlng)
                        .setContent(html)
                        .openOn(map)
                }
            })

            layer.on("mousemove", function (e) {
                if (e.value !== null) {
                    const v = e.value.toFixed(3)
                    const html = `<span class="popupText">${v}</span>`
                    const popup = L.popup()
                        .setLatLng(e.latlng)
                        .setContent(html)
                        .openOn(map)
                }
            })

            hoverToFirstPolygon(layer)
        }
    }

    // try {
    //     exports.Emitter.Emitter.subscribe('updateMap', (data) => {
    //         addGeoTiffMaps(data.url)
    //     })
    // } catch (e) {
    // }

    function onRemovePolygon(polygon, polygonName) {
        polygon = typeof polygon.on == 'function' ? polygon : polygon.layer
        polygon.on('pm:remove', e => {
            polygonName = typeof e.target._popup != 'undefined' ? e.target._popup._content : polygonName

            assetService.findByName(polygonName).subscribe(asset => {
                assetService.deleteAsset(asset.id.id).subscribe(() => {
                        setTimeout(() => {
                            try { // имитим событие для обновления списка полигонов
                                exports.Emitter.Emitter.emit('updatePolygonsList', asset)
                            } catch (e) {
                            }
                        }, 1000);
                    }
                )
            })
        })
    }

    let accessCut = true

    function onUpdatePolygon(polygon, polygonName) {
        polygon = typeof polygon.on == 'function' ? polygon : polygon.layer

        function updateAsset(e) {
            if (!accessCut)
                return

            polygonName = e.target._popup ? e.target._popup._content : polygonName || e.target._tempPopupCopy._content

            let coords = e.target.getLatLngs()[0]

            // если вырезаем облатсь в полигоне
            if (e.type === 'pm:cut') {
                accessCut = false
                setTimeout(() => {
                    accessCut = true
                }, 2000)
                coords = e.layer._latlngs
            }

            // работа с активом
            let id = self.ctx.data[0].datasource.entityId
            let attributesArray = [{key: 'polygonsCoordinates', value: coords}]

            assetService.findByName(polygonName).subscribe(asset => {
                let assetForRequest = {
                    id: asset.id.id,
                    entityType: asset.id.entityType
                }
                attributeService.saveEntityAttributes(assetForRequest, 'SERVER_SCOPE', attributesArray)
                    .subscribe(attr => {
                        if (e.type === 'pm:update') {
                            self.ctx.updateAliases()
                        }
                    })
            })
        }

        polygon.on('pm:update', e => {
            updateAsset(e)
        })
        polygon.on('pm:edit', e => {
            updateAsset(e)
        })
        polygon.on('pm:cut', e => {
            updateAsset(e)
        })

    }

    function createPolygons(coordinates, popupText) {
        const options = {
            fillOpacity: 0,
            tooltips: true
        }
        const polygon = L.polygon(coordinates, options).addTo(map)
        polygon.bindPopup(popupText)
        onUpdatePolygon(polygon)
        onRemovePolygon(polygon)
    }

    function getData() {
        const coordsArray = map.pm.getGeomanDrawLayers()
        return JSON.stringify(coordsArray[0]._latlngs[0])
    }

    const popupStyles = `
        transition: border 500ms;
        border-radius: 8px;`

    const btnStyles = `
        background-color: #eee;
        color: #fff;
        border: 1px solid #eee;
        border-radius: 7px;
        font-size: 15px;
        padding: 6px;`

    const errorStyles = `
        display:none;
        font-size: 14px;
        margin: 0; 
        color: #d62b2b; 
        text-decoration: underline;
    `
    map.on('pm:create', polygon => {
        const latlngs = [polygon.layer._latlngs[0][0].lat, polygon.layer._latlngs[0][0].lng]

        polygon.target.openPopup(`
            <input style="${popupStyles}" type="text" id="popup"/>
            <button style="${btnStyles}" disabled id="savePolygon" type="submit">Сохранить</button>
            <p style="${errorStyles}" id="errorText">Такой полигон уже существует</p>
        `, latlngs)

        // валидация имени полигона
        $(document).off()
        $(document).on('input', '#popup', debounce(event => {
            searchDuplicate(event.target.value)
        }, 1000))

        $('#savePolygon').click(event => {
            event.target.classList.add('greenBorder')
            const polygonName = event.target.closest('.leaflet-popup-content').querySelector('input').value
            const asset = {name: polygonName, type: 'geoData'}

            onUpdatePolygon(polygon, asset.name)
            onRemovePolygon(polygon, asset.name)

            const attribute = [{
                key: 'polygonsCoordinates',
                value: getData()
            }]

            saveToAttribute(asset, attribute)

            setTimeout(() => {
                // имитим событие для обновления списка полигонов
                try {
                    exports.Emitter.Emitter.emit('updatePolygonsList', asset)
                } catch (e) {
                }
            }, 1000)

            polygon.target.closePopup()
            // polygon.bindPopup(polygonName)

        })
    })

    map.on("pm:cut", function (e) {
    })

    let polygonsCoordinates;

    getTBkeys()

    function getTBkeys() {
        self.ctx.data.forEach(data => {
            const keyName = data.dataKey.name
            const polygonName = data.datasource.name

            if (keyName === "polygonsCoordinates") {
                polygonsCoordinates = JSON.parse(data.data[0][1])
                createPolygons(JSON.parse(data.data[0][1]), polygonName)
            }

            if (keyName === "tiffMaps" && data.data[0][1] !== '') {
                JSON.parse(data.data[0][1]).forEach(url => {
                    addGeoTiffMaps(url, polygonsCoordinates)
                })
            }
        })
    }

    setTimeout(function () {
        self.ctx.data.forEach(item => {
            if (item.dataKey.name === 'additionalInfo') {
                try {
                    const data = JSON.parse(item.data[0][1])
                    self.ctx.$scope.info = data
                } catch (e) {
                    self.ctx.$scope.info = [
                        {
                            area: 0,
                            color: '#fff7ec',
                            value: {fertilizer: '', SZR: ''}
                        },
                        {
                            area: 0,
                            color: '#fc8d59',
                            value: {fertilizer: '', SZR: ''}
                        },
                        {
                            area: 0,
                            color: '#7f0000',
                            value: {fertilizer: '', SZR: ''}
                        }
                    ]
                }
                self.ctx.detectChanges()
            }

            if (item.dataKey.name === 'polygonArea') {
                const area = item.data[0][1]
                self.ctx.$scope.area = area

                let percentage = sessionStorage.getItem('rulerPercentage')
                if (percentage) {
                    try {percentage = JSON.parse(percentage)} catch (e) {}

                    setArea(percentage)

                } else {
                    self.ctx.$scope.info.forEach((item, index) => {
                        item.area = (area / 3).toFixed(1)
                    })
                }

                self.ctx.detectChanges()
            }
        })
        // тут логика при редактировании инпутов
        $('.infoTable input').change((event) => {
            const cardIndex = event.target.closest('mat-card').dataset.index
            const inputValue = event.target.value
            const inputType = event.target.dataset.type

            // работа с активом
            let id = self.ctx.data[0].datasource.entityId

            ctx.attributeService.getEntityAttributes({id: id, entityType: 'ASSET'}, 'SERVER_SCOPE', ['additionalInfo'])
                .subscribe(responce => {

                    let dataArray = []
                    if (responce?.length < 1 || responce[0].value == 'null') {
                        const IUconnects = document.getElementsByClassName("noUi-connects")
                        IUconnects[0].childNodes.forEach((item, index) => {
                            dataArray.push({
                                cardIndex: index,
                                value: {},
                                color: self.ctx.$scope.info[index].color,
                            })
                            dataArray[cardIndex].value[inputType] = inputValue
                        })

                        attributeService.saveEntityAttributes({id: id, entityType: 'ASSET'}, 'SERVER_SCOPE',
                            [{key: 'additionalInfo', value: dataArray}]).subscribe((answer) => {
                        })
                    } else {
                        dataArray = self.ctx.$scope.info
                        dataArray[cardIndex].value[inputType] = inputValue

                        attributeService.saveEntityAttributes({id: id, entityType: 'ASSET'}, 'SERVER_SCOPE',
                            [{key: 'additionalInfo', value: dataArray}]).subscribe(() => {
                        })
                    }
                    self.ctx.detectChanges()
                })
        })
    }, 1000)

    exportBtn()

    const progressbarStyles = {
        'background-color': 'gray',
        'border-radius': '13px',
        'position': 'absolute',
        'left': '0',
        'width': '100%',
        'z-index': '9'
    }

    function saveToAttribute(asset, attribute) {
        assetService.saveAsset(asset).subscribe((as) => {
            attributeService.getEntityAttributes(as.id, 'SERVER_SCOPE', ['loadSnapshotsStatus'])
                .subscribe(responce => {
                    //  { nowSnapshot: 0, allSnapshots: 100 }
                    let progressPercent

                    try {
                        progressPercent = +JSON.parse(responce[0]?.value).nowSnapshot
                    } catch (e) {
                        progressPercent = 1
                    }
                    const rows = Array.from($('tbody mat-row'))

                    const rowsInterval = setInterval(() => {
                        if (Array.from($('tbody mat-row')).length != rows.length) {
                            const rows = Array.from($('tbody mat-row'))
                            rows.forEach(item => {
                                if (item.firstChild.innerHTML === asset.name) {
                                    $(item).append(`
                                        <div id="progressbar">
                                          <div></div>
                                        </div>
                                    `)

                                    $('#progressbar').css(progressbarStyles)
                                    $('#progressbar div').css({
                                        'background-color': 'orange',
                                        'width': `${progressPercent}%`,
                                        'height': '3px',
                                        'border-radius': '10px'})
                                }
                            })
                            clearInterval(rowsInterval)
                        }

                    }, 1000)
                })

            const progressbarInterVal = setInterval(() => {
                attributeService.getEntityAttributes(as.id, 'SERVER_SCOPE', ['loadSnapshotsStatus'])
                    .subscribe(responce => {
                        console.log('responce', JSON.parse(responce[0]?.value))
                        const progressPercent = +JSON.parse(responce[0]?.value).nowSnapshot || 1
                        $('#progressbar div').css({
                            'background-color': 'orange',
                            'width': `${progressPercent}%`,
                            'height': '3px',
                            'border-radius': '10px'})
                        if (progressPercent == 100) {
                            $('#progressbar div').css({'background-color': 'green'})
                            clearInterval(progressbarInterVal)
                        }
                    })
            }, 5000)

            attributeService.saveEntityAttributes(as.id, 'SERVER_SCOPE', attribute)
                .subscribe(() => {
                    // ошибка вылетает...
                    // $.ajax({
                    //     url: `http://${window.location.hostname}:${PORT}/polygons/add`,
                    //     method: "POST",
                    //     data: {
                    //         id: as.id.id,
                    //         name: asset.name
                    //     }
                    // })
                })

        })
    }

    function searchDuplicate(name) {
        assetService.findByName(name).subscribe(asset => {
            $('#savePolygon').prop('disabled', true).css('background-color', '#eee')
            $('#popup').removeClass('greenBorder').addClass('invalidInput')
            $('#errorText').show(300)
        }, (err) => {
            // скрыть вылезающую ошибку
            $('.cdk-overlay-container').hide()
            $('#popup').addClass('greenBorder').removeClass('invalidInput')
            $('#savePolygon').prop('disabled', false).css('background-color', '#4b81e8')
            $('#errorText').hide(300)
        })
    }

    function hoverToFirstPolygon(layer) {
        const rows = Array.from($('tbody mat-row'))
        const firstLayer = rows[0]?.firstChild.innerHTML || null
        const layers = map._layers

        for (let key in layers) {
            if (layers[key]._popup?._content === firstLayer) {
                map.fitBounds(layers[key].getBounds())
            } else {
                map.fitBounds(layer.getBounds())
            }
        }
    }
}


function exportBtn() {
    $('.export').click(event => {
        const infoTable = Array.from($('.infoTable'))

        let percentage = sessionStorage.getItem('rulerPercentage')
        if (percentage) {
            try {percentage = JSON.parse(percentage)} catch (e) {}
        } else {
            percentage = [0, 33, 66, 100]
        }

        const array = []
        infoTable.forEach(card => {
            const matCards = Array.from(card.querySelectorAll('mat-card'))

            matCards.forEach((card, index) => {
                const inputs = Array.from(card.querySelectorAll('input'))
                const values = {}

                inputs.forEach(input => {
                    values[input.dataset.type] = +input.value
                })
                array.push({
                    ...values,
                    percentiles: {
                        min: percentage[index] || 0,
                        max: percentage[index+1]
                    }
                })
            })
        })

        let tiffId = ''
        self.ctx.data.forEach(data => {
            const keyName = data.dataKey.name
            if (keyName === "tiffMaps" && data.data[0][1] !== '') {
                const url = JSON.parse(data.data[0][1])[0]
                tiffId = url.slice( url.lastIndexOf('/')+1, url.length )
            }
        })

        fetch(`http://${window.location.hostname}:${PORT}/api/generateShape/${tiffId}`, {
            method: 'POST',
            body: array
        }).then(response => response.json())
            .then(result => console.log(JSON.stringify(result)))

        console.log(array)
    })
}

function debounce(fn, wait) {
    let timeout
    return function (...args) {
        const later = () => {
            clearTimeout(timeout)
            fn.apply(this, args)
        }
        clearTimeout(timeout)
        timeout = setTimeout(later, wait)
    }
}

function setArea(percentage) {
    const $scope = self.ctx.$scope
    $scope.info[0].area = ($scope.area * (percentage[1]-percentage[0])/100).toFixed(1)
    $scope.info[1].area = ($scope.area * (percentage[2]-percentage[1])/100).toFixed(1)
    $scope.info[2].area = ($scope.area * (percentage[3]-percentage[2])/100).toFixed(1)
}

self.onDataUpdated = function () {
}

self.onResize = function () {
}

self.onDestroy = function () {
}

// доки по работе с плагинами
// https://github.com/stuartmatthews/leaflet-geotiff
// https://github.com/IHCantabria/Leaflet.CanvasLayer.Field
// https://github.com/geoman-io/leaflet-geoman

// библотеки. 3 шт

// { https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.6.3/nouislider.min.js

/*! nouislider - 14.6.3 - 11/19/2020 */
!function(t){"function"==typeof define&&define.amd?define([],t):window.noUiSlider=t()}(function(){"use strict";var lt="14.6.3";function ut(t){t.parentElement.removeChild(t)}function a(t){return null!=t}function ct(t){t.preventDefault()}function o(t){return"number"==typeof t&&!isNaN(t)&&isFinite(t)}function pt(t,e,r){0<r&&(ht(t,e),setTimeout(function(){mt(t,e)},r))}function ft(t){return Math.max(Math.min(t,100),0)}function dt(t){return Array.isArray(t)?t:[t]}function e(t){var e=(t=String(t)).split(".");return 1<e.length?e[1].length:0}function ht(t,e){t.classList&&!/\s/.test(e)?t.classList.add(e):t.className+=" "+e}function mt(t,e){t.classList&&!/\s/.test(e)?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")}function gt(t){var e=void 0!==window.pageXOffset,r="CSS1Compat"===(t.compatMode||"");return{x:e?window.pageXOffset:r?t.documentElement.scrollLeft:t.body.scrollLeft,y:e?window.pageYOffset:r?t.documentElement.scrollTop:t.body.scrollTop}}function c(t,e){return 100/(e-t)}function p(t,e,r){return 100*e/(t[r+1]-t[r])}function f(t,e){for(var r=1;t>=e[r];)r+=1;return r}function r(t,e,r){if(r>=t.slice(-1)[0])return 100;var n,i,o=f(r,t),s=t[o-1],a=t[o],l=e[o-1],u=e[o];return l+(i=r,p(n=[s,a],n[0]<0?i+Math.abs(n[0]):i-n[0],0)/c(l,u))}function n(t,e,r,n){if(100===n)return n;var i,o,s=f(n,t),a=t[s-1],l=t[s];return r?(l-a)/2<n-a?l:a:e[s-1]?t[s-1]+(i=n-t[s-1],o=e[s-1],Math.round(i/o)*o):n}function s(t,e,r){var n;if("number"==typeof e&&(e=[e]),!Array.isArray(e))throw new Error("noUiSlider ("+lt+"): 'range' contains invalid value.");if(!o(n="min"===t?0:"max"===t?100:parseFloat(t))||!o(e[0]))throw new Error("noUiSlider ("+lt+"): 'range' value isn't numeric.");r.xPct.push(n),r.xVal.push(e[0]),n?r.xSteps.push(!isNaN(e[1])&&e[1]):isNaN(e[1])||(r.xSteps[0]=e[1]),r.xHighestCompleteStep.push(0)}function l(t,e,r){if(e)if(r.xVal[t]!==r.xVal[t+1]){r.xSteps[t]=p([r.xVal[t],r.xVal[t+1]],e,0)/c(r.xPct[t],r.xPct[t+1]);var n=(r.xVal[t+1]-r.xVal[t])/r.xNumSteps[t],i=Math.ceil(Number(n.toFixed(3))-1),o=r.xVal[t]+r.xNumSteps[t]*i;r.xHighestCompleteStep[t]=o}else r.xSteps[t]=r.xHighestCompleteStep[t]=r.xVal[t]}function i(t,e,r){var n;this.xPct=[],this.xVal=[],this.xSteps=[r||!1],this.xNumSteps=[!1],this.xHighestCompleteStep=[],this.snap=e;var i=[];for(n in t)t.hasOwnProperty(n)&&i.push([t[n],n]);for(i.length&&"object"==typeof i[0][0]?i.sort(function(t,e){return t[0][0]-e[0][0]}):i.sort(function(t,e){return t[0]-e[0]}),n=0;n<i.length;n++)s(i[n][1],i[n][0],this);for(this.xNumSteps=this.xSteps.slice(0),n=0;n<this.xNumSteps.length;n++)l(n,this.xNumSteps[n],this)}i.prototype.getDistance=function(t){var e,r=[];for(e=0;e<this.xNumSteps.length-1;e++){var n=this.xNumSteps[e];if(n&&t/n%1!=0)throw new Error("noUiSlider ("+lt+"): 'limit', 'margin' and 'padding' of "+this.xPct[e]+"% range must be divisible by step.");r[e]=p(this.xVal,t,e)}return r},i.prototype.getAbsoluteDistance=function(t,e,r){var n,i=0;if(t<this.xPct[this.xPct.length-1])for(;t>this.xPct[i+1];)i++;else t===this.xPct[this.xPct.length-1]&&(i=this.xPct.length-2);r||t!==this.xPct[i+1]||i++;var o=1,s=e[i],a=0,l=0,u=0,c=0;for(n=r?(t-this.xPct[i])/(this.xPct[i+1]-this.xPct[i]):(this.xPct[i+1]-t)/(this.xPct[i+1]-this.xPct[i]);0<s;)a=this.xPct[i+1+c]-this.xPct[i+c],100<e[i+c]*o+100-100*n?(l=a*n,o=(s-100*n)/e[i+c],n=1):(l=e[i+c]*a/100*o,o=0),r?(u-=l,1<=this.xPct.length+c&&c--):(u+=l,1<=this.xPct.length-c&&c++),s=e[i+c]*o;return t+u},i.prototype.toStepping=function(t){return t=r(this.xVal,this.xPct,t)},i.prototype.fromStepping=function(t){return function(t,e,r){if(100<=r)return t.slice(-1)[0];var n,i=f(r,e),o=t[i-1],s=t[i],a=e[i-1],l=e[i];return n=[o,s],(r-a)*c(a,l)*(n[1]-n[0])/100+n[0]}(this.xVal,this.xPct,t)},i.prototype.getStep=function(t){return t=n(this.xPct,this.xSteps,this.snap,t)},i.prototype.getDefaultStep=function(t,e,r){var n=f(t,this.xPct);return(100===t||e&&t===this.xPct[n-1])&&(n=Math.max(n-1,1)),(this.xVal[n]-this.xVal[n-1])/r},i.prototype.getNearbySteps=function(t){var e=f(t,this.xPct);return{stepBefore:{startValue:this.xVal[e-2],step:this.xNumSteps[e-2],highestStep:this.xHighestCompleteStep[e-2]},thisStep:{startValue:this.xVal[e-1],step:this.xNumSteps[e-1],highestStep:this.xHighestCompleteStep[e-1]},stepAfter:{startValue:this.xVal[e],step:this.xNumSteps[e],highestStep:this.xHighestCompleteStep[e]}}},i.prototype.countStepDecimals=function(){var t=this.xNumSteps.map(e);return Math.max.apply(null,t)},i.prototype.convert=function(t){return this.getStep(this.toStepping(t))};var u={to:function(t){return void 0!==t&&t.toFixed(2)},from:Number},d={target:"target",base:"base",origin:"origin",handle:"handle",handleLower:"handle-lower",handleUpper:"handle-upper",touchArea:"touch-area",horizontal:"horizontal",vertical:"vertical",background:"background",connect:"connect",connects:"connects",ltr:"ltr",rtl:"rtl",textDirectionLtr:"txt-dir-ltr",textDirectionRtl:"txt-dir-rtl",draggable:"draggable",drag:"state-drag",tap:"state-tap",active:"active",tooltip:"tooltip",pips:"pips",pipsHorizontal:"pips-horizontal",pipsVertical:"pips-vertical",marker:"marker",markerHorizontal:"marker-horizontal",markerVertical:"marker-vertical",markerNormal:"marker-normal",markerLarge:"marker-large",markerSub:"marker-sub",value:"value",valueHorizontal:"value-horizontal",valueVertical:"value-vertical",valueNormal:"value-normal",valueLarge:"value-large",valueSub:"value-sub"},vt={tooltips:".__tooltips",aria:".__aria"};function h(t){if("object"==typeof(e=t)&&"function"==typeof e.to&&"function"==typeof e.from)return!0;var e;throw new Error("noUiSlider ("+lt+"): 'format' requires 'to' and 'from' methods.")}function m(t,e){if(!o(e))throw new Error("noUiSlider ("+lt+"): 'step' is not numeric.");t.singleStep=e}function g(t,e){if(!o(e))throw new Error("noUiSlider ("+lt+"): 'keyboardPageMultiplier' is not numeric.");t.keyboardPageMultiplier=e}function v(t,e){if(!o(e))throw new Error("noUiSlider ("+lt+"): 'keyboardDefaultStep' is not numeric.");t.keyboardDefaultStep=e}function b(t,e){if("object"!=typeof e||Array.isArray(e))throw new Error("noUiSlider ("+lt+"): 'range' is not an object.");if(void 0===e.min||void 0===e.max)throw new Error("noUiSlider ("+lt+"): Missing 'min' or 'max' in 'range'.");if(e.min===e.max)throw new Error("noUiSlider ("+lt+"): 'range' 'min' and 'max' cannot be equal.");t.spectrum=new i(e,t.snap,t.singleStep)}function x(t,e){if(e=dt(e),!Array.isArray(e)||!e.length)throw new Error("noUiSlider ("+lt+"): 'start' option is incorrect.");t.handles=e.length,t.start=e}function S(t,e){if("boolean"!=typeof(t.snap=e))throw new Error("noUiSlider ("+lt+"): 'snap' option must be a boolean.")}function w(t,e){if("boolean"!=typeof(t.animate=e))throw new Error("noUiSlider ("+lt+"): 'animate' option must be a boolean.")}function y(t,e){if("number"!=typeof(t.animationDuration=e))throw new Error("noUiSlider ("+lt+"): 'animationDuration' option must be a number.")}function E(t,e){var r,n=[!1];if("lower"===e?e=[!0,!1]:"upper"===e&&(e=[!1,!0]),!0===e||!1===e){for(r=1;r<t.handles;r++)n.push(e);n.push(!1)}else{if(!Array.isArray(e)||!e.length||e.length!==t.handles+1)throw new Error("noUiSlider ("+lt+"): 'connect' option doesn't match handle count.");n=e}t.connect=n}function C(t,e){switch(e){case"horizontal":t.ort=0;break;case"vertical":t.ort=1;break;default:throw new Error("noUiSlider ("+lt+"): 'orientation' option is invalid.")}}function P(t,e){if(!o(e))throw new Error("noUiSlider ("+lt+"): 'margin' option must be numeric.");0!==e&&(t.margin=t.spectrum.getDistance(e))}function N(t,e){if(!o(e))throw new Error("noUiSlider ("+lt+"): 'limit' option must be numeric.");if(t.limit=t.spectrum.getDistance(e),!t.limit||t.handles<2)throw new Error("noUiSlider ("+lt+"): 'limit' option is only supported on linear sliders with 2 or more handles.")}function k(t,e){var r;if(!o(e)&&!Array.isArray(e))throw new Error("noUiSlider ("+lt+"): 'padding' option must be numeric or array of exactly 2 numbers.");if(Array.isArray(e)&&2!==e.length&&!o(e[0])&&!o(e[1]))throw new Error("noUiSlider ("+lt+"): 'padding' option must be numeric or array of exactly 2 numbers.");if(0!==e){for(Array.isArray(e)||(e=[e,e]),t.padding=[t.spectrum.getDistance(e[0]),t.spectrum.getDistance(e[1])],r=0;r<t.spectrum.xNumSteps.length-1;r++)if(t.padding[0][r]<0||t.padding[1][r]<0)throw new Error("noUiSlider ("+lt+"): 'padding' option must be a positive number(s).");var n=e[0]+e[1],i=t.spectrum.xVal[0];if(1<n/(t.spectrum.xVal[t.spectrum.xVal.length-1]-i))throw new Error("noUiSlider ("+lt+"): 'padding' option must not exceed 100% of the range.")}}function U(t,e){switch(e){case"ltr":t.dir=0;break;case"rtl":t.dir=1;break;default:throw new Error("noUiSlider ("+lt+"): 'direction' option was not recognized.")}}function A(t,e){if("string"!=typeof e)throw new Error("noUiSlider ("+lt+"): 'behaviour' must be a string containing options.");var r=0<=e.indexOf("tap"),n=0<=e.indexOf("drag"),i=0<=e.indexOf("fixed"),o=0<=e.indexOf("snap"),s=0<=e.indexOf("hover"),a=0<=e.indexOf("unconstrained");if(i){if(2!==t.handles)throw new Error("noUiSlider ("+lt+"): 'fixed' behaviour must be used with 2 handles");P(t,t.start[1]-t.start[0])}if(a&&(t.margin||t.limit))throw new Error("noUiSlider ("+lt+"): 'unconstrained' behaviour cannot be used with margin or limit");t.events={tap:r||o,drag:n,fixed:i,snap:o,hover:s,unconstrained:a}}function V(t,e){if(!1!==e)if(!0===e){t.tooltips=[];for(var r=0;r<t.handles;r++)t.tooltips.push(!0)}else{if(t.tooltips=dt(e),t.tooltips.length!==t.handles)throw new Error("noUiSlider ("+lt+"): must pass a formatter for all handles.");t.tooltips.forEach(function(t){if("boolean"!=typeof t&&("object"!=typeof t||"function"!=typeof t.to))throw new Error("noUiSlider ("+lt+"): 'tooltips' must be passed a formatter or 'false'.")})}}function D(t,e){h(t.ariaFormat=e)}function M(t,e){h(t.format=e)}function O(t,e){if("boolean"!=typeof(t.keyboardSupport=e))throw new Error("noUiSlider ("+lt+"): 'keyboardSupport' option must be a boolean.")}function L(t,e){t.documentElement=e}function z(t,e){if("string"!=typeof e&&!1!==e)throw new Error("noUiSlider ("+lt+"): 'cssPrefix' must be a string or `false`.");t.cssPrefix=e}function H(t,e){if("object"!=typeof e)throw new Error("noUiSlider ("+lt+"): 'cssClasses' must be an object.");if("string"==typeof t.cssPrefix)for(var r in t.cssClasses={},e)e.hasOwnProperty(r)&&(t.cssClasses[r]=t.cssPrefix+e[r]);else t.cssClasses=e}function bt(e){var r={margin:0,limit:0,padding:0,animate:!0,animationDuration:300,ariaFormat:u,format:u},n={step:{r:!1,t:m},keyboardPageMultiplier:{r:!1,t:g},keyboardDefaultStep:{r:!1,t:v},start:{r:!0,t:x},connect:{r:!0,t:E},direction:{r:!0,t:U},snap:{r:!1,t:S},animate:{r:!1,t:w},animationDuration:{r:!1,t:y},range:{r:!0,t:b},orientation:{r:!1,t:C},margin:{r:!1,t:P},limit:{r:!1,t:N},padding:{r:!1,t:k},behaviour:{r:!0,t:A},ariaFormat:{r:!1,t:D},format:{r:!1,t:M},tooltips:{r:!1,t:V},keyboardSupport:{r:!0,t:O},documentElement:{r:!1,t:L},cssPrefix:{r:!0,t:z},cssClasses:{r:!0,t:H}},i={connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal",keyboardSupport:!0,cssPrefix:"noUi-",cssClasses:d,keyboardPageMultiplier:5,keyboardDefaultStep:10};e.format&&!e.ariaFormat&&(e.ariaFormat=e.format),Object.keys(n).forEach(function(t){if(!a(e[t])&&void 0===i[t]){if(n[t].r)throw new Error("noUiSlider ("+lt+"): '"+t+"' is required.");return!0}n[t].t(r,a(e[t])?e[t]:i[t])}),r.pips=e.pips;var t=document.createElement("div"),o=void 0!==t.style.msTransform,s=void 0!==t.style.transform;r.transformRule=s?"transform":o?"msTransform":"webkitTransform";return r.style=[["left","top"],["right","bottom"]][r.dir][r.ort],r}function j(t,b,o){var l,u,s,c,i,a,e,p,f=window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"},d=window.CSS&&CSS.supports&&CSS.supports("touch-action","none")&&function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("test",null,e)}catch(t){}return t}(),h=t,y=b.spectrum,x=[],S=[],m=[],g=0,v={},w=t.ownerDocument,E=b.documentElement||w.documentElement,C=w.body,P=-1,N=0,k=1,U=2,A="rtl"===w.dir||1===b.ort?0:100;function V(t,e){var r=w.createElement("div");return e&&ht(r,e),t.appendChild(r),r}function D(t,e){var r=V(t,b.cssClasses.origin),n=V(r,b.cssClasses.handle);return V(n,b.cssClasses.touchArea),n.setAttribute("data-handle",e),b.keyboardSupport&&(n.setAttribute("tabindex","0"),n.addEventListener("keydown",function(t){return function(t,e){if(O()||L(e))return!1;var r=["Left","Right"],n=["Down","Up"],i=["PageDown","PageUp"],o=["Home","End"];b.dir&&!b.ort?r.reverse():b.ort&&!b.dir&&(n.reverse(),i.reverse());var s,a=t.key.replace("Arrow",""),l=a===i[0],u=a===i[1],c=a===n[0]||a===r[0]||l,p=a===n[1]||a===r[1]||u,f=a===o[0],d=a===o[1];if(!(c||p||f||d))return!0;if(t.preventDefault(),p||c){var h=b.keyboardPageMultiplier,m=c?0:1,g=at(e),v=g[m];if(null===v)return!1;!1===v&&(v=y.getDefaultStep(S[e],c,b.keyboardDefaultStep)),(u||l)&&(v*=h),v=Math.max(v,1e-7),v*=c?-1:1,s=x[e]+v}else s=d?b.spectrum.xVal[b.spectrum.xVal.length-1]:b.spectrum.xVal[0];return rt(e,y.toStepping(s),!0,!0),J("slide",e),J("update",e),J("change",e),J("set",e),!1}(t,e)})),n.setAttribute("role","slider"),n.setAttribute("aria-orientation",b.ort?"vertical":"horizontal"),0===e?ht(n,b.cssClasses.handleLower):e===b.handles-1&&ht(n,b.cssClasses.handleUpper),r}function M(t,e){return!!e&&V(t,b.cssClasses.connect)}function r(t,e){return!!b.tooltips[e]&&V(t.firstChild,b.cssClasses.tooltip)}function O(){return h.hasAttribute("disabled")}function L(t){return u[t].hasAttribute("disabled")}function z(){i&&(G("update"+vt.tooltips),i.forEach(function(t){t&&ut(t)}),i=null)}function H(){z(),i=u.map(r),$("update"+vt.tooltips,function(t,e,r){if(i[e]){var n=t[e];!0!==b.tooltips[e]&&(n=b.tooltips[e].to(r[e])),i[e].innerHTML=n}})}function j(e,i,o){var s=w.createElement("div"),a=[];a[N]=b.cssClasses.valueNormal,a[k]=b.cssClasses.valueLarge,a[U]=b.cssClasses.valueSub;var l=[];l[N]=b.cssClasses.markerNormal,l[k]=b.cssClasses.markerLarge,l[U]=b.cssClasses.markerSub;var u=[b.cssClasses.valueHorizontal,b.cssClasses.valueVertical],c=[b.cssClasses.markerHorizontal,b.cssClasses.markerVertical];function p(t,e){var r=e===b.cssClasses.value,n=r?a:l;return e+" "+(r?u:c)[b.ort]+" "+n[t]}return ht(s,b.cssClasses.pips),ht(s,0===b.ort?b.cssClasses.pipsHorizontal:b.cssClasses.pipsVertical),Object.keys(e).forEach(function(t){!function(t,e,r){if((r=i?i(e,r):r)!==P){var n=V(s,!1);n.className=p(r,b.cssClasses.marker),n.style[b.style]=t+"%",N<r&&((n=V(s,!1)).className=p(r,b.cssClasses.value),n.setAttribute("data-value",e),n.style[b.style]=t+"%",n.innerHTML=o.to(e))}}(t,e[t][0],e[t][1])}),s}function F(){c&&(ut(c),c=null)}function R(t){F();var m,g,v,b,e,r,x,S,w,n=t.mode,i=t.density||1,o=t.filter||!1,s=function(t,e,r){if("range"===t||"steps"===t)return y.xVal;if("count"===t){if(e<2)throw new Error("noUiSlider ("+lt+"): 'values' (>= 2) required for mode 'count'.");var n=e-1,i=100/n;for(e=[];n--;)e[n]=n*i;e.push(100),t="positions"}return"positions"===t?e.map(function(t){return y.fromStepping(r?y.getStep(t):t)}):"values"===t?r?e.map(function(t){return y.fromStepping(y.getStep(y.toStepping(t)))}):e:void 0}(n,t.values||!1,t.stepped||!1),a=(m=i,g=n,v=s,b={},e=y.xVal[0],r=y.xVal[y.xVal.length-1],S=x=!1,w=0,(v=v.slice().sort(function(t,e){return t-e}).filter(function(t){return!this[t]&&(this[t]=!0)},{}))[0]!==e&&(v.unshift(e),x=!0),v[v.length-1]!==r&&(v.push(r),S=!0),v.forEach(function(t,e){var r,n,i,o,s,a,l,u,c,p,f=t,d=v[e+1],h="steps"===g;if(h&&(r=y.xNumSteps[e]),r||(r=d-f),!1!==f)for(void 0===d&&(d=f),r=Math.max(r,1e-7),n=f;n<=d;n=(n+r).toFixed(7)/1){for(u=(s=(o=y.toStepping(n))-w)/m,p=s/(c=Math.round(u)),i=1;i<=c;i+=1)b[(a=w+i*p).toFixed(5)]=[y.fromStepping(a),0];l=-1<v.indexOf(n)?k:h?U:N,!e&&x&&n!==d&&(l=0),n===d&&S||(b[o.toFixed(5)]=[n,l]),w=o}}),b),l=t.format||{to:Math.round};return c=h.appendChild(j(a,o,l))}function T(){var t=l.getBoundingClientRect(),e="offset"+["Width","Height"][b.ort];return 0===b.ort?t.width||l[e]:t.height||l[e]}function _(n,i,o,s){var e=function(t){return!!(t=function(t,e,r){var n,i,o=0===t.type.indexOf("touch"),s=0===t.type.indexOf("mouse"),a=0===t.type.indexOf("pointer");0===t.type.indexOf("MSPointer")&&(a=!0);if("mousedown"===t.type&&!t.buttons&&!t.touches)return!1;if(o){var l=function(t){return t.target===r||r.contains(t.target)||t.target.shadowRoot&&t.target.shadowRoot.contains(r)};if("touchstart"===t.type){var u=Array.prototype.filter.call(t.touches,l);if(1<u.length)return!1;n=u[0].pageX,i=u[0].pageY}else{var c=Array.prototype.find.call(t.changedTouches,l);if(!c)return!1;n=c.pageX,i=c.pageY}}e=e||gt(w),(s||a)&&(n=t.clientX+e.x,i=t.clientY+e.y);return t.pageOffset=e,t.points=[n,i],t.cursor=s||a,t}(t,s.pageOffset,s.target||i))&&(!(O()&&!s.doNotReject)&&(e=h,r=b.cssClasses.tap,!((e.classList?e.classList.contains(r):new RegExp("\\b"+r+"\\b").test(e.className))&&!s.doNotReject)&&(!(n===f.start&&void 0!==t.buttons&&1<t.buttons)&&((!s.hover||!t.buttons)&&(d||t.preventDefault(),t.calcPoint=t.points[b.ort],void o(t,s))))));var e,r},r=[];return n.split(" ").forEach(function(t){i.addEventListener(t,e,!!d&&{passive:!0}),r.push([t,e])}),r}function B(t){var e,r,n,i,o,s,a=100*(t-(e=l,r=b.ort,n=e.getBoundingClientRect(),i=e.ownerDocument,o=i.documentElement,s=gt(i),/webkit.*Chrome.*Mobile/i.test(navigator.userAgent)&&(s.x=0),r?n.top+s.y-o.clientTop:n.left+s.x-o.clientLeft))/T();return a=ft(a),b.dir?100-a:a}function q(t,e){"mouseout"===t.type&&"HTML"===t.target.nodeName&&null===t.relatedTarget&&Y(t,e)}function X(t,e){if(-1===navigator.appVersion.indexOf("MSIE 9")&&0===t.buttons&&0!==e.buttonsProperty)return Y(t,e);var r=(b.dir?-1:1)*(t.calcPoint-e.startCalcPoint);Z(0<r,100*r/e.baseSize,e.locations,e.handleNumbers)}function Y(t,e){e.handle&&(mt(e.handle,b.cssClasses.active),g-=1),e.listeners.forEach(function(t){E.removeEventListener(t[0],t[1])}),0===g&&(mt(h,b.cssClasses.drag),et(),t.cursor&&(C.style.cursor="",C.removeEventListener("selectstart",ct))),e.handleNumbers.forEach(function(t){J("change",t),J("set",t),J("end",t)})}function I(t,e){if(e.handleNumbers.some(L))return!1;var r;1===e.handleNumbers.length&&(r=u[e.handleNumbers[0]].children[0],g+=1,ht(r,b.cssClasses.active));t.stopPropagation();var n=[],i=_(f.move,E,X,{target:t.target,handle:r,listeners:n,startCalcPoint:t.calcPoint,baseSize:T(),pageOffset:t.pageOffset,handleNumbers:e.handleNumbers,buttonsProperty:t.buttons,locations:S.slice()}),o=_(f.end,E,Y,{target:t.target,handle:r,listeners:n,doNotReject:!0,handleNumbers:e.handleNumbers}),s=_("mouseout",E,q,{target:t.target,handle:r,listeners:n,doNotReject:!0,handleNumbers:e.handleNumbers});n.push.apply(n,i.concat(o,s)),t.cursor&&(C.style.cursor=getComputedStyle(t.target).cursor,1<u.length&&ht(h,b.cssClasses.drag),C.addEventListener("selectstart",ct,!1)),e.handleNumbers.forEach(function(t){J("start",t)})}function n(t){t.stopPropagation();var i,o,s,e=B(t.calcPoint),r=(i=e,s=!(o=100),u.forEach(function(t,e){if(!L(e)){var r=S[e],n=Math.abs(r-i);(n<o||n<=o&&r<i||100===n&&100===o)&&(s=e,o=n)}}),s);if(!1===r)return!1;b.events.snap||pt(h,b.cssClasses.tap,b.animationDuration),rt(r,e,!0,!0),et(),J("slide",r,!0),J("update",r,!0),J("change",r,!0),J("set",r,!0),b.events.snap&&I(t,{handleNumbers:[r]})}function W(t){var e=B(t.calcPoint),r=y.getStep(e),n=y.fromStepping(r);Object.keys(v).forEach(function(t){"hover"===t.split(".")[0]&&v[t].forEach(function(t){t.call(a,n)})})}function $(t,e){v[t]=v[t]||[],v[t].push(e),"update"===t.split(".")[0]&&u.forEach(function(t,e){J("update",e)})}function G(t){var i=t&&t.split(".")[0],o=i?t.substring(i.length):t;Object.keys(v).forEach(function(t){var e,r=t.split(".")[0],n=t.substring(r.length);i&&i!==r||o&&o!==n||((e=n)!==vt.aria&&e!==vt.tooltips||o===n)&&delete v[t]})}function J(r,n,i){Object.keys(v).forEach(function(t){var e=t.split(".")[0];r===e&&v[t].forEach(function(t){t.call(a,x.map(b.format.to),n,x.slice(),i||!1,S.slice(),a)})})}function K(t,e,r,n,i,o){var s;return 1<u.length&&!b.events.unconstrained&&(n&&0<e&&(s=y.getAbsoluteDistance(t[e-1],b.margin,0),r=Math.max(r,s)),i&&e<u.length-1&&(s=y.getAbsoluteDistance(t[e+1],b.margin,1),r=Math.min(r,s))),1<u.length&&b.limit&&(n&&0<e&&(s=y.getAbsoluteDistance(t[e-1],b.limit,0),r=Math.min(r,s)),i&&e<u.length-1&&(s=y.getAbsoluteDistance(t[e+1],b.limit,1),r=Math.max(r,s))),b.padding&&(0===e&&(s=y.getAbsoluteDistance(0,b.padding[0],0),r=Math.max(r,s)),e===u.length-1&&(s=y.getAbsoluteDistance(100,b.padding[1],1),r=Math.min(r,s))),!((r=ft(r=y.getStep(r)))===t[e]&&!o)&&r}function Q(t,e){var r=b.ort;return(r?e:t)+", "+(r?t:e)}function Z(t,n,r,e){var i=r.slice(),o=[!t,t],s=[t,!t];e=e.slice(),t&&e.reverse(),1<e.length?e.forEach(function(t,e){var r=K(i,t,i[t]+n,o[e],s[e],!1);!1===r?n=0:(n=r-i[t],i[t]=r)}):o=s=[!0];var a=!1;e.forEach(function(t,e){a=rt(t,r[t]+n,o[e],s[e])||a}),a&&e.forEach(function(t){J("update",t),J("slide",t)})}function tt(t,e){return b.dir?100-t-e:t}function et(){m.forEach(function(t){var e=50<S[t]?-1:1,r=3+(u.length+e*t);u[t].style.zIndex=r})}function rt(t,e,r,n,i){return i||(e=K(S,t,e,r,n,!1)),!1!==e&&(function(t,e){S[t]=e,x[t]=y.fromStepping(e);var r="translate("+Q(10*(tt(e,0)-A)+"%","0")+")";u[t].style[b.transformRule]=r,nt(t),nt(t+1)}(t,e),!0)}function nt(t){if(s[t]){var e=0,r=100;0!==t&&(e=S[t-1]),t!==s.length-1&&(r=S[t]);var n=r-e,i="translate("+Q(tt(e,n)+"%","0")+")",o="scale("+Q(n/100,"1")+")";s[t].style[b.transformRule]=i+" "+o}}function it(t,e){return null===t||!1===t||void 0===t?S[e]:("number"==typeof t&&(t=String(t)),t=b.format.from(t),!1===(t=y.toStepping(t))||isNaN(t)?S[e]:t)}function ot(t,e,r){var n=dt(t),i=void 0===S[0];e=void 0===e||!!e,b.animate&&!i&&pt(h,b.cssClasses.tap,b.animationDuration),m.forEach(function(t){rt(t,it(n[t],t),!0,!1,r)});for(var o=1===m.length?0:1;o<m.length;++o)m.forEach(function(t){rt(t,S[t],!0,!0,r)});et(),m.forEach(function(t){J("update",t),null!==n[t]&&e&&J("set",t)})}function st(){var t=x.map(b.format.to);return 1===t.length?t[0]:t}function at(t){var e=S[t],r=y.getNearbySteps(e),n=x[t],i=r.thisStep.step,o=null;if(b.snap)return[n-r.stepBefore.startValue||null,r.stepAfter.startValue-n||null];!1!==i&&n+i>r.stepAfter.startValue&&(i=r.stepAfter.startValue-n),o=n>r.thisStep.startValue?r.thisStep.step:!1!==r.stepBefore.step&&n-r.stepBefore.highestStep,100===e?i=null:0===e&&(o=null);var s=y.countStepDecimals();return null!==i&&!1!==i&&(i=Number(i.toFixed(s))),null!==o&&!1!==o&&(o=Number(o.toFixed(s))),[o,i]}return ht(e=h,b.cssClasses.target),0===b.dir?ht(e,b.cssClasses.ltr):ht(e,b.cssClasses.rtl),0===b.ort?ht(e,b.cssClasses.horizontal):ht(e,b.cssClasses.vertical),ht(e,"rtl"===getComputedStyle(e).direction?b.cssClasses.textDirectionRtl:b.cssClasses.textDirectionLtr),l=V(e,b.cssClasses.base),function(t,e){var r=V(e,b.cssClasses.connects);u=[],(s=[]).push(M(r,t[0]));for(var n=0;n<b.handles;n++)u.push(D(e,n)),m[n]=n,s.push(M(r,t[n+1]))}(b.connect,l),(p=b.events).fixed||u.forEach(function(t,e){_(f.start,t.children[0],I,{handleNumbers:[e]})}),p.tap&&_(f.start,l,n,{}),p.hover&&_(f.move,l,W,{hover:!0}),p.drag&&s.forEach(function(t,e){if(!1!==t&&0!==e&&e!==s.length-1){var r=u[e-1],n=u[e],i=[t];ht(t,b.cssClasses.draggable),p.fixed&&(i.push(r.children[0]),i.push(n.children[0])),i.forEach(function(t){_(f.start,t,I,{handles:[r,n],handleNumbers:[e-1,e]})})}}),ot(b.start),b.pips&&R(b.pips),b.tooltips&&H(),G("update"+vt.aria),$("update"+vt.aria,function(t,e,s,r,a){m.forEach(function(t){var e=u[t],r=K(S,t,0,!0,!0,!0),n=K(S,t,100,!0,!0,!0),i=a[t],o=b.ariaFormat.to(s[t]);r=y.fromStepping(r).toFixed(1),n=y.fromStepping(n).toFixed(1),i=y.fromStepping(i).toFixed(1),e.children[0].setAttribute("aria-valuemin",r),e.children[0].setAttribute("aria-valuemax",n),e.children[0].setAttribute("aria-valuenow",i),e.children[0].setAttribute("aria-valuetext",o)})}),a={destroy:function(){for(var t in G(vt.aria),G(vt.tooltips),b.cssClasses)b.cssClasses.hasOwnProperty(t)&&mt(h,b.cssClasses[t]);for(;h.firstChild;)h.removeChild(h.firstChild);delete h.noUiSlider},steps:function(){return m.map(at)},on:$,off:G,get:st,set:ot,setHandle:function(t,e,r,n){if(!(0<=(t=Number(t))&&t<m.length))throw new Error("noUiSlider ("+lt+"): invalid handle number, got: "+t);rt(t,it(e,t),!0,!0,n),J("update",t),r&&J("set",t)},reset:function(t){ot(b.start,t)},__moveHandles:function(t,e,r){Z(t,e,S,r)},options:o,updateOptions:function(e,t){var r=st(),n=["margin","limit","padding","range","animate","snap","step","format","pips","tooltips"];n.forEach(function(t){void 0!==e[t]&&(o[t]=e[t])});var i=bt(o);n.forEach(function(t){void 0!==e[t]&&(b[t]=i[t])}),y=i.spectrum,b.margin=i.margin,b.limit=i.limit,b.padding=i.padding,b.pips?R(b.pips):F(),b.tooltips?H():z(),S=[],ot(e.start||r,t)},target:h,removePips:F,removeTooltips:z,getTooltips:function(){return i},getOrigins:function(){return u},pips:R}}return{__spectrum:i,version:lt,cssClasses:d,create:function(t,e){if(!t||!t.nodeName)throw new Error("noUiSlider ("+lt+"): create requires a single element, got: "+t);if(t.noUiSlider)throw new Error("noUiSlider ("+lt+"): Slider was already initialized.");var r=j(t,bt(e),e);return t.noUiSlider=r}}});
// }

// {
// https://unpkg.com/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.min.js

!function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=67)}([function(t,e,r){var i=r(135);t.exports=function(t,e,r){var n=null==t?void 0:i(t,e);return void 0===n?r:n}},function(t,e,r){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var n=r(6),a=r(9),o=i(r(145)),s=r(15),l=i(r(146));function h(t,e){var r=a.getCoords(t),i=a.getCoords(e);if(2!==r.length)throw new Error("<intersects> line1 must only contain 2 coordinates");if(2!==i.length)throw new Error("<intersects> line2 must only contain 2 coordinates");var o=r[0][0],s=r[0][1],l=r[1][0],h=r[1][1],u=i[0][0],c=i[0][1],p=i[1][0],f=i[1][1],d=(f-c)*(l-o)-(p-u)*(h-s);if(0==d)return null;var g=((p-u)*(s-c)-(f-c)*(o-u))/d,m=((l-o)*(s-c)-(h-s)*(o-u))/d;if(0<=g&&g<=1&&0<=m&&m<=1){var _=o+g*(l-o),y=s+g*(h-s);return n.point([_,y])}return null}e.default=function(t,e){var r={},i=[];if("LineString"===t.type&&(t=n.feature(t)),"LineString"===e.type&&(e=n.feature(e)),"Feature"===t.type&&"Feature"===e.type&&null!==t.geometry&&null!==e.geometry&&"LineString"===t.geometry.type&&"LineString"===e.geometry.type&&2===t.geometry.coordinates.length&&2===e.geometry.coordinates.length){var u=h(t,e);return u&&i.push(u),n.featureCollection(i)}var c=l.default();return c.load(o.default(e)),s.featureEach(o.default(t),(function(t){s.featureEach(c.search(t),(function(e){var n=h(t,e);if(n){var o=a.getCoords(n).join(",");r[o]||(r[o]=!0,i.push(n))}}))})),n.featureCollection(i)}},function(t,e){t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},function(t,e,r){var i=r(29),n="object"==typeof self&&self&&self.Object===Object&&self,a=i||n||Function("return this")();t.exports=a},function(t,e){t.exports=function(t){return null!=t&&"object"==typeof t}},function(t,e){var r=Array.isArray;t.exports=r},function(t,e,r){"use strict";function i(t,e,r){void 0===r&&(r={});var i={type:"Feature"};return 0!==r.id&&!r.id||(i.id=r.id),r.bbox&&(i.bbox=r.bbox),i.properties=e||{},i.geometry=t,i}function n(t,e,r){return void 0===r&&(r={}),i({type:"Point",coordinates:t},e,r)}function a(t,e,r){void 0===r&&(r={});for(var n=0,a=t;n<a.length;n++){var o=a[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<o[o.length-1].length;s++)if(o[o.length-1][s]!==o[0][s])throw new Error("First and last Position are not equivalent.")}return i({type:"Polygon",coordinates:t},e,r)}function o(t,e,r){if(void 0===r&&(r={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return i({type:"LineString",coordinates:t},e,r)}function s(t,e){void 0===e&&(e={});var r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}function l(t,e,r){return void 0===r&&(r={}),i({type:"MultiLineString",coordinates:t},e,r)}function h(t,e,r){return void 0===r&&(r={}),i({type:"MultiPoint",coordinates:t},e,r)}function u(t,e,r){return void 0===r&&(r={}),i({type:"MultiPolygon",coordinates:t},e,r)}function c(t,r){void 0===r&&(r="kilometers");var i=e.factors[r];if(!i)throw new Error(r+" units is invalid");return t*i}function p(t,r){void 0===r&&(r="kilometers");var i=e.factors[r];if(!i)throw new Error(r+" units is invalid");return t/i}function f(t){return t%(2*Math.PI)*180/Math.PI}function d(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)&&!/^\s*$/.test(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.earthRadius=6371008.8,e.factors={centimeters:100*e.earthRadius,centimetres:100*e.earthRadius,degrees:e.earthRadius/111325,feet:3.28084*e.earthRadius,inches:39.37*e.earthRadius,kilometers:e.earthRadius/1e3,kilometres:e.earthRadius/1e3,meters:e.earthRadius,metres:e.earthRadius,miles:e.earthRadius/1609.344,millimeters:1e3*e.earthRadius,millimetres:1e3*e.earthRadius,nauticalmiles:e.earthRadius/1852,radians:1,yards:e.earthRadius/1.0936},e.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/e.earthRadius,yards:1/1.0936},e.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},e.feature=i,e.geometry=function(t,e,r){switch(void 0===r&&(r={}),t){case"Point":return n(e).geometry;case"LineString":return o(e).geometry;case"Polygon":return a(e).geometry;case"MultiPoint":return h(e).geometry;case"MultiLineString":return l(e).geometry;case"MultiPolygon":return u(e).geometry;default:throw new Error(t+" is invalid")}},e.point=n,e.points=function(t,e,r){return void 0===r&&(r={}),s(t.map((function(t){return n(t,e)})),r)},e.polygon=a,e.polygons=function(t,e,r){return void 0===r&&(r={}),s(t.map((function(t){return a(t,e)})),r)},e.lineString=o,e.lineStrings=function(t,e,r){return void 0===r&&(r={}),s(t.map((function(t){return o(t,e)})),r)},e.featureCollection=s,e.multiLineString=l,e.multiPoint=h,e.multiPolygon=u,e.geometryCollection=function(t,e,r){return void 0===r&&(r={}),i({type:"GeometryCollection",geometries:t},e,r)},e.round=function(t,e){if(void 0===e&&(e=0),e&&!(0<=e))throw new Error("precision must be a positive number");var r=Math.pow(10,e||0);return Math.round(t*r)/r},e.radiansToLength=c,e.lengthToRadians=p,e.lengthToDegrees=function(t,e){return f(p(t,e))},e.bearingToAzimuth=function(t){var e=t%360;return e<0&&(e+=360),e},e.radiansToDegrees=f,e.degreesToRadians=function(t){return t%360*Math.PI/180},e.convertLength=function(t,e,r){if(void 0===e&&(e="kilometers"),void 0===r&&(r="kilometers"),!(0<=t))throw new Error("length must be a positive number");return c(p(t,e),r)},e.convertArea=function(t,r,i){if(void 0===r&&(r="meters"),void 0===i&&(i="kilometers"),!(0<=t))throw new Error("area must be a positive number");var n=e.areaFactors[r];if(!n)throw new Error("invalid original units");var a=e.areaFactors[i];if(!a)throw new Error("invalid final units");return t/n*a},e.isNumber=d,e.isObject=function(t){return!!t&&t.constructor===Object},e.validateBBox=function(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach((function(t){if(!d(t))throw new Error("bbox must only contain numbers")}))},e.validateId=function(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof t))throw new Error("id must be a number or a string")},e.radians2degrees=function(){throw new Error("method has been renamed to `radiansToDegrees`")},e.degrees2radians=function(){throw new Error("method has been renamed to `degreesToRadians`")},e.distanceToDegrees=function(){throw new Error("method has been renamed to `lengthToDegrees`")},e.distanceToRadians=function(){throw new Error("method has been renamed to `lengthToRadians`")},e.radiansToDistance=function(){throw new Error("method has been renamed to `radiansToLength`")},e.bearingToAngle=function(){throw new Error("method has been renamed to `bearingToAzimuth`")},e.convertDistance=function(){throw new Error("method has been renamed to `convertLength`")}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(6);function n(t,e,r,i,n,a,o,s){var l,h,u,c,p={x:null,y:null,onLine1:!1,onLine2:!1};return 0==(l=(s-a)*(r-t)-(o-n)*(i-e))?null!==p.x&&null!==p.y&&p:(c=(r-t)*(h=e-a)-(i-e)*(u=t-n),h=((o-n)*h-(s-a)*u)/l,u=c/l,p.x=t+h*(r-t),p.y=e+h*(i-e),0<=h&&h<=1&&(p.onLine1=!0),0<=u&&u<=1&&(p.onLine2=!0),!(!p.onLine1||!p.onLine2)&&[p.x,p.y])}e.default=function(t){var e,r,a={type:"FeatureCollection",features:[]};if("LineString"===(r="Feature"===t.type?t.geometry:t).type)e=[r.coordinates];else if("MultiLineString"===r.type)e=r.coordinates;else if("MultiPolygon"===r.type)e=[].concat.apply([],r.coordinates);else{if("Polygon"!==r.type)throw new Error("Input must be a LineString, MultiLineString, Polygon, or MultiPolygon Feature or Geometry");e=r.coordinates}return e.forEach((function(t){e.forEach((function(e){for(var r=0;r<t.length-1;r++)for(var o=r;o<e.length-1;o++){if(t===e){if(1===Math.abs(r-o))continue;if(0===r&&o===t.length-2&&t[r][0]===t[t.length-1][0]&&t[r][1]===t[t.length-1][1])continue}var s=n(t[r][0],t[r][1],t[r+1][0],t[r+1][1],e[o][0],e[o][1],e[o+1][0],e[o+1][1]);s&&a.features.push(i.point([s[0],s[1]]))}}))})),a}},function(t,e,r){var i=r(18),n=r(83),a=r(84),o=i?i.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":o&&o in Object(t)?n(t):a(t)}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(6);e.getCoord=function(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates}if(Array.isArray(t)&&2<=t.length&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")},e.getCoords=function(t){if(Array.isArray(t))return t;if("Feature"===t.type){if(null!==t.geometry)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")},e.containsNumber=function t(e){if(1<e.length&&i.isNumber(e[0])&&i.isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return t(e[0]);throw new Error("coordinates must only contain numbers")},e.geojsonType=function(t,e,r){if(!e||!r)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.type)},e.featureOf=function(t,e,r){if(!t)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!t||"Feature"!==t.type||!t.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.geometry.type)},e.collectionOf=function(t,e,r){if(!t)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!t||"FeatureCollection"!==t.type)throw new Error("Invalid input to "+r+", FeatureCollection required");for(var i=0,n=t.features;i<n.length;i++){var a=n[i];if(!a||"Feature"!==a.type||!a.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!a.geometry||a.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+a.geometry.type)}},e.getGeom=function(t){return"Feature"===t.type?t.geometry:t},e.getType=function(t,e){return"FeatureCollection"===t.type?"FeatureCollection":"GeometryCollection"===t.type?"GeometryCollection":"Feature"===t.type&&null!==t.geometry?t.geometry.type:t.type}},function(t,e,r){var i=r(71),n=r(72),a=r(73),o=r(74),s=r(75);function l(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}l.prototype.clear=i,l.prototype.delete=n,l.prototype.get=a,l.prototype.has=o,l.prototype.set=s,t.exports=l},function(t,e,r){var i=r(12);t.exports=function(t,e){for(var r=t.length;r--;)if(i(t[r][0],e))return r;return-1}},function(t,e){t.exports=function(t,e){return t===e||t!=t&&e!=e}},function(t,e,r){var i=r(16)(Object,"create");t.exports=i},function(t,e,r){var i=r(97);t.exports=function(t,e){var r=t.__data__;return i(e)?r["string"==typeof e?"string":"hash"]:r.map}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(6);function n(t,e,r){if(null!==t)for(var i,a,o,s,l,h,u,c,p=0,f=0,d=t.type,g="FeatureCollection"===d,m="Feature"===d,_=g?t.features.length:1,y=0;y<_;y++){l=(c=!!(u=g?t.features[y].geometry:m?t.geometry:t)&&"GeometryCollection"===u.type)?u.geometries.length:1;for(var v=0;v<l;v++){var b=0,L=0;if(null!==(s=c?u.geometries[v]:u)){h=s.coordinates;var k=s.type;switch(p=!r||"Polygon"!==k&&"MultiPolygon"!==k?0:1,k){case null:break;case"Point":if(!1===e(h,f,y,b,L))return!1;f++,b++;break;case"LineString":case"MultiPoint":for(i=0;i<h.length;i++){if(!1===e(h[i],f,y,b,L))return!1;f++,"MultiPoint"===k&&b++}"LineString"===k&&b++;break;case"Polygon":case"MultiLineString":for(i=0;i<h.length;i++){for(a=0;a<h[i].length-p;a++){if(!1===e(h[i][a],f,y,b,L))return!1;f++}"MultiLineString"===k&&b++,"Polygon"===k&&L++}"Polygon"===k&&b++;break;case"MultiPolygon":for(i=0;i<h.length;i++){for(a=L=0;a<h[i].length;a++){for(o=0;o<h[i][a].length-p;o++){if(!1===e(h[i][a][o],f,y,b,L))return!1;f++}L++}b++}break;case"GeometryCollection":for(i=0;i<s.geometries.length;i++)if(!1===n(s.geometries[i],e,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function a(t,e){var r;switch(t.type){case"FeatureCollection":for(r=0;r<t.features.length&&!1!==e(t.features[r].properties,r);r++);break;case"Feature":e(t.properties,0)}}function o(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var r=0;r<t.features.length&&!1!==e(t.features[r],r);r++);}function s(t,e){var r,i,n,a,o,s,l,h,u,c,p=0,f="FeatureCollection"===t.type,d="Feature"===t.type,g=f?t.features.length:1;for(r=0;r<g;r++){for(s=f?t.features[r].geometry:d?t.geometry:t,h=f?t.features[r].properties:d?t.properties:{},u=f?t.features[r].bbox:d?t.bbox:void 0,c=f?t.features[r].id:d?t.id:void 0,o=(l=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,n=0;n<o;n++)if(null!==(a=l?s.geometries[n]:s))switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(a,p,h,u,c))return!1;break;case"GeometryCollection":for(i=0;i<a.geometries.length;i++)if(!1===e(a.geometries[i],p,h,u,c))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,p,h,u,c))return!1;p++}}function l(t,e){s(t,(function(t,r,n,a,o){var s,l=null===t?null:t.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return!1!==e(i.feature(t,n,{bbox:a,id:o}),r,0)&&void 0}switch(l){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var h=0;h<t.coordinates.length;h++){var u={type:s,coordinates:t.coordinates[h]};if(!1===e(i.feature(u,n),r,h))return!1}}))}function h(t,e){l(t,(function(t,r,a){var o=0;if(t.geometry){var s=t.geometry.type;if("Point"!==s&&"MultiPoint"!==s){var l,h=0,u=0,c=0;return!1!==n(t,(function(n,s,p,f,d){if(void 0===l||h<r||u<f||c<d)return l=n,h=r,u=f,c=d,void(o=0);var g=i.lineString([l,n],t.properties);if(!1===e(g,r,a,d,o))return!1;o++,l=n}))&&void 0}}}))}function u(t,e){if(!t)throw new Error("geojson is required");l(t,(function(t,r,n){if(null!==t.geometry){var a=t.geometry.type,o=t.geometry.coordinates;switch(a){case"LineString":if(!1===e(t,r,n,0,0))return!1;break;case"Polygon":for(var s=0;s<o.length;s++)if(!1===e(i.lineString(o[s],t.properties),r,n,s))return!1}}}))}e.coordEach=n,e.coordReduce=function(t,e,r,i){var a=r;return n(t,(function(t,i,n,o,s){a=0===i&&void 0===r?t:e(a,t,i,n,o,s)}),i),a},e.propEach=a,e.propReduce=function(t,e,r){var i=r;return a(t,(function(t,n){i=0===n&&void 0===r?t:e(i,t,n)})),i},e.featureEach=o,e.featureReduce=function(t,e,r){var i=r;return o(t,(function(t,n){i=0===n&&void 0===r?t:e(i,t,n)})),i},e.coordAll=function(t){var e=[];return n(t,(function(t){e.push(t)})),e},e.geomEach=s,e.geomReduce=function(t,e,r){var i=r;return s(t,(function(t,n,a,o,s){i=0===n&&void 0===r?t:e(i,t,n,a,o,s)})),i},e.flattenEach=l,e.flattenReduce=function(t,e,r){var i=r;return l(t,(function(t,n,a){i=0===n&&0===a&&void 0===r?t:e(i,t,n,a)})),i},e.segmentEach=h,e.segmentReduce=function(t,e,r){var i=r,n=!1;return h(t,(function(t,a,o,s,l){i=!1===n&&void 0===r?t:e(i,t,a,o,s,l),n=!0})),i},e.lineEach=u,e.lineReduce=function(t,e,r){var i=r;return u(t,(function(t,n,a,o){i=0===n&&void 0===r?t:e(i,t,n,a,o)})),i},e.findSegment=function(t,e){if(e=e||{},!i.isObject(e))throw new Error("options is invalid");var r,n=e.featureIndex||0,a=e.multiFeatureIndex||0,o=e.geometryIndex||0,s=e.segmentIndex||0,l=e.properties;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),l=l||t.features[n].properties,r=t.features[n].geometry;break;case"Feature":l=l||t.properties,r=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=t;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var h=r.coordinates;switch(r.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=h.length+s-1),i.lineString([h[s],h[s+1]],l,e);case"Polygon":return o<0&&(o=h.length+o),s<0&&(s=h[o].length+s-1),i.lineString([h[o][s],h[o][s+1]],l,e);case"MultiLineString":return a<0&&(a=h.length+a),s<0&&(s=h[a].length+s-1),i.lineString([h[a][s],h[a][s+1]],l,e);case"MultiPolygon":return a<0&&(a=h.length+a),o<0&&(o=h[a].length+o),s<0&&(s=h[a][o].length-s-1),i.lineString([h[a][o][s],h[a][o][s+1]],l,e)}throw new Error("geojson is invalid")},e.findPoint=function(t,e){if(e=e||{},!i.isObject(e))throw new Error("options is invalid");var r,n=e.featureIndex||0,a=e.multiFeatureIndex||0,o=e.geometryIndex||0,s=e.coordIndex||0,l=e.properties;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),l=l||t.features[n].properties,r=t.features[n].geometry;break;case"Feature":l=l||t.properties,r=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=t;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var h=r.coordinates;switch(r.type){case"Point":return i.point(h,l,e);case"MultiPoint":return a<0&&(a=h.length+a),i.point(h[a],l,e);case"LineString":return s<0&&(s=h.length+s),i.point(h[s],l,e);case"Polygon":return o<0&&(o=h.length+o),s<0&&(s=h[o].length+s),i.point(h[o][s],l,e);case"MultiLineString":return a<0&&(a=h.length+a),s<0&&(s=h[a].length+s),i.point(h[a][s],l,e);case"MultiPolygon":return a<0&&(a=h.length+a),o<0&&(o=h[a].length+o),s<0&&(s=h[a][o].length-s),i.point(h[a][o][s],l,e)}throw new Error("geojson is invalid")}},function(t,e,r){var i=r(81),n=r(88);t.exports=function(t,e){var r=n(t,e);return i(r)?r:void 0}},function(t,e,r){var i=r(8),n=r(2);t.exports=function(t){if(!n(t))return!1;var e=i(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}},function(t,e,r){var i=r(3).Symbol;t.exports=i},function(t,e,r){var i=r(32);t.exports=function(t,e,r){"__proto__"==e&&i?i(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,r){var i=r(112),n=r(4),a=Object.prototype,o=a.hasOwnProperty,s=a.propertyIsEnumerable,l=i(function(){return arguments}())?i:function(t){return n(t)&&o.call(t,"callee")&&!s.call(t,"callee")};t.exports=l},function(t,e,r){var i=r(17),n=r(23);t.exports=function(t){return null!=t&&n(t.length)&&!i(t)}},function(t,e){t.exports=function(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=9007199254740991}},function(t,e){var r=/^(?:0|[1-9]\d*)$/;t.exports=function(t,e){var i=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==i||"symbol"!=i&&r.test(t))&&-1<t&&t%1==0&&t<e}},function(t,e,r){var i=r(8),n=r(4);t.exports=function(t){return"symbol"==typeof t||n(t)&&"[object Symbol]"==i(t)}},function(t,e,r){var i=r(69),n=r(126)((function(t,e,r){i(t,e,r)}));t.exports=n},function(t,e,r){(function(e){t.exports=function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function i(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t}var n=function e(r,i){t(this,e),this.next=null,this.key=r,this.data=i,this.left=null,this.right=null};function a(t,e){return e<t?1:t<e?-1:0}function o(t,e,r){for(var i=new n(null,null),a=i,o=i;;){var s=r(t,e.key);if(s<0){if(null===e.left)break;if(r(t,e.left.key)<0){var l=e.left;if(e.left=l.right,l.right=e,null===(e=l).left)break}o.left=e,e=(o=e).left}else{if(!(0<s))break;if(null===e.right)break;if(0<r(t,e.right.key)){var h=e.right;if(e.right=h.left,h.left=e,null===(e=h).right)break}a.right=e,e=(a=e).right}}return a.right=e.left,o.left=e.right,e.left=i.right,e.right=i.left,e}function s(t,e,r,i){var a=new n(t,e);if(null===r)return a.left=a.right=null,a;var s=i(t,(r=o(t,r,i)).key);return s<0?(a.left=r.left,(a.right=r).left=null):0<=s&&(a.right=r.right,(a.left=r).right=null),a}function l(t,e,r){var i=null,n=null;if(e){var a=r((e=o(t,e,r)).key,t);0===a?(i=e.left,n=e.right):a<0?(n=e.right,e.right=null,i=e):(i=e.left,e.left=null,n=e)}return{left:i,right:n}}var h=function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:a;t(this,e),this._root=null,this._size=0,this._comparator=r}return i(e,[{key:"insert",value:function(t,e){return this._size++,this._root=s(t,e,this._root,this._comparator)}},{key:"add",value:function(t,e){var r=new n(t,e);null===this._root&&(r.left=r.right=null,this._size++,this._root=r);var i=this._comparator,a=o(t,this._root,i),s=i(t,a.key);return 0===s?this._root=a:(s<0?(r.left=a.left,(r.right=a).left=null):0<s&&(r.right=a.right,(r.left=a).right=null),this._size++,this._root=r),this._root}},{key:"remove",value:function(t){this._root=this._remove(t,this._root,this._comparator)}},{key:"_remove",value:function(t,e,r){var i;return null===e?null:0===r(t,(e=o(t,e,r)).key)?(null===e.left?i=e.right:(i=o(t,e.left,r)).right=e.right,this._size--,i):e}},{key:"pop",value:function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=o(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null}},{key:"findStatic",value:function(t){for(var e=this._root,r=this._comparator;e;){var i=r(t,e.key);if(0===i)return e;e=i<0?e.left:e.right}return null}},{key:"find",value:function(t){return this._root&&(this._root=o(t,this._root,this._comparator),0!==this._comparator(t,this._root.key))?null:this._root}},{key:"contains",value:function(t){for(var e=this._root,r=this._comparator;e;){var i=r(t,e.key);if(0===i)return!0;e=i<0?e.left:e.right}return!1}},{key:"forEach",value:function(t,e){for(var r=this._root,i=[],n=!1;!n;)null!==r?(i.push(r),r=r.left):0!==i.length?(r=i.pop(),t.call(e,r),r=r.right):n=!0;return this}},{key:"range",value:function(t,e,r,i){for(var n=[],a=this._comparator,o=this._root;0!==n.length||o;)if(o)n.push(o),o=o.left;else{if(0<a((o=n.pop()).key,e))break;if(0<=a(o.key,t)&&r.call(i,o))return this;o=o.right}return this}},{key:"keys",value:function(){var t=[];return this.forEach((function(e){var r=e.key;return t.push(r)})),t}},{key:"values",value:function(){var t=[];return this.forEach((function(e){var r=e.data;return t.push(r)})),t}},{key:"min",value:function(){return this._root?this.minNode(this._root).key:null}},{key:"max",value:function(){return this._root?this.maxNode(this._root).key:null}},{key:"minNode",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._root;if(t)for(;t.left;)t=t.left;return t}},{key:"maxNode",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._root;if(t)for(;t.right;)t=t.right;return t}},{key:"at",value:function(t){for(var e=this._root,r=!1,i=0,n=[];!r;)if(e)n.push(e),e=e.left;else if(0<n.length){if(e=n.pop(),i===t)return e;i++,e=e.right}else r=!0;return null}},{key:"next",value:function(t){var e=this._root,r=null;if(t.right){for(r=t.right;r.left;)r=r.left;return r}for(var i=this._comparator;e;){var n=i(t.key,e.key);if(0===n)break;e=n<0?(r=e).left:e.right}return r}},{key:"prev",value:function(t){var e=this._root,r=null;if(null!==t.left){for(r=t.left;r.right;)r=r.right;return r}for(var i=this._comparator;e;){var n=i(t.key,e.key);if(0===n)break;e=n<0?e.left:(r=e).right}return r}},{key:"clear",value:function(){return this._root=null,this._size=0,this}},{key:"toList",value:function(){return function(t){for(var e=t,r=[],i=!1,a=new n(null,null),o=a;!i;)e?(r.push(e),e=e.left):0<r.length?e=(e=o=o.next=r.pop()).right:i=!0;return o.next=null,a.next}(this._root)}},{key:"load",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],r=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=t.length,a=this._comparator;if(r&&function t(e,r,i,n,a){if(!(n<=i)){for(var o=e[i+n>>1],s=i-1,l=n+1;;){for(;a(e[++s],o)<0;);for(;0<a(e[--l],o););if(l<=s)break;var h=e[s];e[s]=e[l],e[l]=h,h=r[s],r[s]=r[l],r[l]=h}t(e,r,i,l,a),t(e,r,l+1,n,a)}}(t,e,0,i-1,a),null===this._root)this._root=function t(e,r,i,a){var o=a-i;if(0<o){var s=i+Math.floor(o/2),l=e[s],h=r[s],u=new n(l,h);return u.left=t(e,r,i,s),u.right=t(e,r,s+1,a),u}return null}(t,e,0,i),this._size=i;else{var o=function(t,e,r){for(var i=new n(null,null),a=i,o=t,s=e;null!==o&&null!==s;)r(o.key,s.key)<0?o=(a.next=o).next:s=(a.next=s).next,a=a.next;return null!==o?a.next=o:null!==s&&(a.next=s),i.next}(this.toList(),function(t,e){for(var r=new n(null,null),i=r,a=0;a<t.length;a++)i=i.next=new n(t[a],e[a]);return i.next=null,r.next}(t,e),a);i=this._size+i,this._root=function t(e,r,i){var n=i-r;if(0<n){var a=r+Math.floor(n/2),o=t(e,r,a),s=e.head;return s.left=o,e.head=e.head.next,s.right=t(e,a+1,i),s}return null}({head:o},0,i)}return this}},{key:"isEmpty",value:function(){return null===this._root}},{key:"toString",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(t){return String(t.key)},e=[];return function t(e,r,i,n,a){if(e){n("".concat(r).concat(i?"└── ":"├── ").concat(a(e),"\n"));var o=r+(i?"    ":"│   ");e.left&&t(e.left,o,!1,n,a),e.right&&t(e.right,o,!0,n,a)}}(this._root,"",!0,(function(t){return e.push(t)}),t),e.join("")}},{key:"update",value:function(t,e,r){var i=this._comparator,n=l(t,this._root,i),a=n.left,h=n.right;i(t,e)<0?h=s(e,r,h,i):a=s(e,r,a,i),this._root=function(t,e,r){return null===e?t:(null===t||((e=o(t.key,e,r)).left=t),e)}(a,h,i)}},{key:"split",value:function(t){return l(t,this._root,this._comparator)}},{key:"size",get:function(){return this._size}},{key:"root",get:function(){return this._root}}]),e}(),u=function(t,e){return t.ll.x<=e.x&&e.x<=t.ur.x&&t.ll.y<=e.y&&e.y<=t.ur.y},c=function(t,e){if(e.ur.x<t.ll.x||t.ur.x<e.ll.x||e.ur.y<t.ll.y||t.ur.y<e.ll.y)return null;var r=t.ll.x<e.ll.x?e.ll.x:t.ll.x,i=t.ur.x<e.ur.x?t.ur.x:e.ur.x;return{ll:{x:r,y:t.ll.y<e.ll.y?e.ll.y:t.ll.y},ur:{x:i,y:t.ur.y<e.ur.y?t.ur.y:e.ur.y}}},p=Number.EPSILON;void 0===p&&(p=Math.pow(2,-52));var f=p*p,d=function(t,e){if(-p<t&&t<p&&-p<e&&e<p)return 0;var r=t-e;return r*r<f*t*e?0:t<e?-1:1},g=function(){function e(){t(this,e),this.reset()}return i(e,[{key:"reset",value:function(){this.xRounder=new m,this.yRounder=new m}},{key:"round",value:function(t,e){return{x:this.xRounder.round(t),y:this.yRounder.round(e)}}}]),e}(),m=function(){function e(){t(this,e),this.tree=new h,this.round(0)}return i(e,[{key:"round",value:function(t){var e=this.tree.add(t),r=this.tree.prev(e);if(null!==r&&0===d(e.key,r.key))return this.tree.remove(t),r.key;var i=this.tree.next(e);return null!==i&&0===d(e.key,i.key)?(this.tree.remove(t),i.key):t}}]),e}(),_=new g,y=function(t,e){return t.x*e.y-t.y*e.x},v=function(t,e){return t.x*e.x+t.y*e.y},b=function(t,e,r){var i={x:e.x-t.x,y:e.y-t.y},n={x:r.x-t.x,y:r.y-t.y},a=y(i,n);return d(a,0)},L=function(t){return Math.sqrt(v(t,t))},k=function(t,e,r){var i={x:e.x-t.x,y:e.y-t.y},n={x:r.x-t.x,y:r.y-t.y};return y(n,i)/L(n)/L(i)},M=function(t,e,r){var i={x:e.x-t.x,y:e.y-t.y},n={x:r.x-t.x,y:r.y-t.y};return v(n,i)/L(n)/L(i)},x=function(t,e,r){return 0===e.y?null:{x:t.x+e.x/e.y*(r-t.y),y:r}},w=function(t,e,r){return 0===e.x?null:{x:r,y:t.y+e.y/e.x*(r-t.x)}},P=function(){function e(r,i){t(this,e),void 0===r.events?r.events=[this]:r.events.push(this),this.point=r,this.isLeft=i}return i(e,null,[{key:"compare",value:function(t,r){var i=e.comparePoints(t.point,r.point);return 0!==i?i:(t.point!==r.point&&t.link(r),t.isLeft!==r.isLeft?t.isLeft?1:-1:E.compare(t.segment,r.segment))}},{key:"comparePoints",value:function(t,e){return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}}]),i(e,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var e=t.point.events,r=0,i=e.length;r<i;r++){var n=e[r];this.point.events.push(n),n.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,e=0;e<t;e++){var r=this.point.events[e];if(void 0===r.segment.consumedBy)for(var i=e+1;i<t;i++){var n=this.point.events[i];void 0===n.consumedBy&&r.otherSE.point.events===n.otherSE.point.events&&r.segment.consume(n.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],e=0,r=this.point.events.length;e<r;e++){var i=this.point.events[e];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&t.push(i)}return t}},{key:"getLeftmostComparator",value:function(t){var e=this,r=new Map,i=function(i){var n=i.otherSE;r.set(i,{sine:k(e.point,t.point,n.point),cosine:M(e.point,t.point,n.point)})};return function(t,e){r.has(t)||i(t),r.has(e)||i(e);var n=r.get(t),a=n.sine,o=n.cosine,s=r.get(e),l=s.sine,h=s.cosine;return 0<=a&&0<=l?o<h?1:h<o?-1:0:a<0&&l<0?o<h?-1:h<o?1:0:l<a?-1:a<l?1:0}}}]),e}(),C=0,E=function(){function e(r,i,n,a){t(this,e),this.id=++C,(this.leftSE=r).segment=this,r.otherSE=i,(this.rightSE=i).segment=this,i.otherSE=r,this.rings=n,this.windings=a}return i(e,null,[{key:"compare",value:function(t,e){var r=t.leftSE.point.x,i=e.leftSE.point.x,n=t.rightSE.point.x,a=e.rightSE.point.x;if(a<r)return 1;if(n<i)return-1;var o=t.leftSE.point.y,s=e.leftSE.point.y,l=t.rightSE.point.y,h=e.rightSE.point.y;if(r<i){if(s<o&&s<l)return 1;if(o<s&&l<s)return-1;var u=t.comparePoint(e.leftSE.point);if(u<0)return 1;if(0<u)return-1;var c=e.comparePoint(t.rightSE.point);return 0!==c?c:-1}if(i<r){if(o<s&&o<h)return-1;if(s<o&&h<o)return 1;var p=e.comparePoint(t.leftSE.point);if(0!==p)return p;var f=t.comparePoint(e.rightSE.point);return f<0?1:0<f?-1:1}if(o<s)return-1;if(s<o)return 1;if(n<a){var d=e.comparePoint(t.rightSE.point);if(0!==d)return d}if(a<n){var g=t.comparePoint(e.rightSE.point);if(g<0)return 1;if(0<g)return-1}if(n!==a){var m=l-o,_=n-r,y=h-s,v=a-i;if(_<m&&y<v)return 1;if(m<_&&v<y)return-1}return a<n?1:n<a||l<h?-1:h<l?1:t.id<e.id?-1:t.id>e.id?1:0}}]),i(e,[{key:"replaceRightSE",value:function(t){this.rightSE=t,(this.rightSE.segment=this).rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<e?t:e},ur:{x:this.rightSE.point.x,y:e<t?t:e}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var e=this.leftSE.point,r=this.rightSE.point,i=this.vector();if(e.x===r.x)return t.x===e.x?0:t.x<e.x?1:-1;var n=(t.y-e.y)/i.y,a=e.x+n*i.x;if(t.x===a)return 0;var o=(t.x-e.x)/i.x,s=e.y+o*i.y;return t.y===s?0:t.y<s?-1:1}},{key:"getIntersection",value:function(t){var e=this.bbox(),r=t.bbox(),i=c(e,r);if(null===i)return null;var n=this.leftSE.point,a=this.rightSE.point,o=t.leftSE.point,s=t.rightSE.point,l=u(e,o)&&0===this.comparePoint(o),h=u(r,n)&&0===t.comparePoint(n),p=u(e,s)&&0===this.comparePoint(s),f=u(r,a)&&0===t.comparePoint(a);if(h&&l)return f&&!p?a:!f&&p?s:null;if(h)return p&&n.x===s.x&&n.y===s.y?null:n;if(l)return f&&a.x===o.x&&a.y===o.y?null:o;if(f&&p)return null;if(f)return a;if(p)return s;var d=function(t,e,r,i){if(0===e.x)return w(r,i,t.x);if(0===i.x)return w(t,e,r.x);if(0===e.y)return x(r,i,t.y);if(0===i.y)return x(t,e,r.y);var n=y(e,i);if(0==n)return null;var a={x:r.x-t.x,y:r.y-t.y},o=y(a,e)/n,s=y(a,i)/n;return{x:(t.x+s*e.x+(r.x+o*i.x))/2,y:(t.y+s*e.y+(r.y+o*i.y))/2}}(n,this.vector(),o,t.vector());return null===d?null:u(i,d)?_.round(d.x,d.y):null}},{key:"split",value:function(t){var r=[],i=void 0!==t.events,n=new P(t,!0),a=new P(t,!1),o=this.rightSE;this.replaceRightSE(a),r.push(a),r.push(n);var s=new e(n,o,this.rings.slice(),this.windings.slice());return 0<P.comparePoints(s.leftSE.point,s.rightSE.point)&&s.swapEvents(),0<P.comparePoints(this.leftSE.point,this.rightSE.point)&&this.swapEvents(),i&&(n.checkForConsuming(),a.checkForConsuming()),r}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var e=0,r=this.windings.length;e<r;e++)this.windings[e]*=-1}},{key:"consume",value:function(t){for(var r=this,i=t;r.consumedBy;)r=r.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var n=e.compare(r,i);if(0!==n){if(0<n){var a=r;r=i,i=a}if(r.prev===i){var o=r;r=i,i=o}for(var s=0,l=i.rings.length;s<l;s++){var h=i.rings[s],u=i.windings[s],c=r.rings.indexOf(h);-1===c?(r.rings.push(h),r.windings.push(u)):r.windings[c]+=u}i.rings=null,i.windings=null,i.consumedBy=r,i.leftSE.consumedBy=r.leftSE,i.rightSE.consumedBy=r.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}},{key:"beforeState",value:function(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var e=this._afterState.rings,r=this._afterState.windings,i=this._afterState.multiPolys,n=0,a=this.rings.length;n<a;n++){var o=this.rings[n],s=this.windings[n],l=e.indexOf(o);-1===l?(e.push(o),r.push(s)):r[l]+=s}for(var h=[],u=[],c=0,p=e.length;c<p;c++)if(0!==r[c]){var f=e[c],d=f.poly;if(-1===u.indexOf(d))if(f.isExterior)h.push(d);else{-1===u.indexOf(d)&&u.push(d);var g=h.indexOf(f.poly);-1!==g&&h.splice(g,1)}}for(var m=0,_=h.length;m<_;m++){var y=h[m].multiPoly;-1===i.indexOf(y)&&i.push(y)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(G.type){case"union":var r=0===t.length,i=0===e.length;this._isInResult=r!=i;break;case"intersection":var n,a;a=t.length<e.length?(n=t.length,e.length):(n=e.length,t.length),this._isInResult=a===G.numMultiPolys&&n<a;break;case"xor":var o=Math.abs(t.length-e.length);this._isInResult=o%2==1;break;case"difference":var s=function(t){return 1===t.length&&t[0].isSubject};this._isInResult=s(t)!==s(e);break;default:throw new Error("Unrecognized operation type found ".concat(G.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,r,i){var n,a,o,s=P.comparePoints(t,r);if(s<0)n=t,a=r,o=1;else{if(!(0<s))throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));n=r,a=t,o=-1}return new e(new P(n,!0),new P(a,!1),[i],[o])}}]),e}(),S=function(){function e(r,i,n){if(t(this,e),!Array.isArray(r)||0===r.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=i,this.isExterior=n,this.segments=[],"number"!=typeof r[0][0]||"number"!=typeof r[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var a=_.round(r[0][0],r[0][1]);this.bbox={ll:{x:a.x,y:a.y},ur:{x:a.x,y:a.y}};for(var o=a,s=1,l=r.length;s<l;s++){if("number"!=typeof r[s][0]||"number"!=typeof r[s][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var h=_.round(r[s][0],r[s][1]);h.x===o.x&&h.y===o.y||(this.segments.push(E.fromRing(o,h,this)),h.x<this.bbox.ll.x&&(this.bbox.ll.x=h.x),h.y<this.bbox.ll.y&&(this.bbox.ll.y=h.y),h.x>this.bbox.ur.x&&(this.bbox.ur.x=h.x),h.y>this.bbox.ur.y&&(this.bbox.ur.y=h.y),o=h)}a.x===o.x&&a.y===o.y||this.segments.push(E.fromRing(o,a,this))}return i(e,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,r=this.segments.length;e<r;e++){var i=this.segments[e];t.push(i.leftSE),t.push(i.rightSE)}return t}}]),e}(),B=function(){function e(r,i){if(t(this,e),!Array.isArray(r))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new S(r[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,a=r.length;n<a;n++){var o=new S(r[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=i}return i(e,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),e=0,r=this.interiorRings.length;e<r;e++)for(var i=this.interiorRings[e].getSweepEvents(),n=0,a=i.length;n<a;n++)t.push(i[n]);return t}}]),e}(),O=function(){function e(r,i){if(t(this,e),!Array.isArray(r))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof r[0][0][0]&&(r=[r])}catch(t){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,a=r.length;n<a;n++){var o=new B(r[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=i}return i(e,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,r=this.polys.length;e<r;e++)for(var i=this.polys[e].getSweepEvents(),n=0,a=i.length;n<a;n++)t.push(i[n]);return t}}]),e}(),R=function(){function e(r){t(this,e),this.events=r;for(var i=0,n=r.length;i<n;i++)r[i].segment.ringOut=this;this.poly=null}return i(e,null,[{key:"factory",value:function(t){for(var r=[],i=0,n=t.length;i<n;i++){var a=t[i];if(a.isInResult()&&!a.ringOut){for(var o=null,s=a.leftSE,l=a.rightSE,h=[s],u=s.point,c=[];o=s,s=l,h.push(s),s.point!==u;)for(;;){var p=s.getAvailableLinkedEvents();if(0===p.length){var f=h[0].point,d=h[h.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(f.x,",")+" ".concat(f.y,"]. Last matching segment found ends at")+" [".concat(d.x,", ").concat(d.y,"]."))}if(1===p.length){l=p[0].otherSE;break}for(var g=null,m=0,_=c.length;m<_;m++)if(c[m].point===s.point){g=m;break}if(null===g){c.push({index:h.length,point:s.point});var y=s.getLeftmostComparator(o);l=p.sort(y)[0].otherSE;break}var v=c.splice(g)[0],b=h.splice(v.index);b.unshift(b[0].otherSE),r.push(new e(b.reverse()))}r.push(new e(h))}}return r}}]),i(e,[{key:"getGeom",value:function(){for(var t=this.events[0].point,e=[t],r=1,i=this.events.length-1;r<i;r++){var n=this.events[r].point,a=this.events[r+1].point;0!==b(n,t,a)&&(e.push(n),t=n)}if(1===e.length)return null;var o=e[0],s=e[1];0===b(o,t,s)&&e.shift(),e.push(e[0]);for(var l=this.isExteriorRing()?1:-1,h=this.isExteriorRing()?0:e.length-1,u=this.isExteriorRing()?e.length:-1,c=[],p=h;p!=u;p+=l)c.push([e[p].x,e[p].y]);return c}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var t=this.enclosingRing();this._isExteriorRing=!t||!t.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],e=1,r=this.events.length;e<r;e++){var i=this.events[e];0<P.compare(t,i)&&(t=i)}for(var n=t.segment.prevInResult(),a=n?n.prevInResult():null;;){if(!n)return null;if(!a)return n.ringOut;if(a.ringOut!==n.ringOut)return a.ringOut.enclosingRing()!==n.ringOut?n.ringOut:n.ringOut.enclosingRing();a=(n=a.prevInResult())?n.prevInResult():null}}}]),e}(),D=function(){function e(r){t(this,e),((this.exteriorRing=r).poly=this).interiorRings=[]}return i(e,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(null===t[0])return null;for(var e=0,r=this.interiorRings.length;e<r;e++){var i=this.interiorRings[e].getGeom();null!==i&&t.push(i)}return t}}]),e}(),T=function(){function e(r){t(this,e),this.rings=r,this.polys=this._composePolys(r)}return i(e,[{key:"getGeom",value:function(){for(var t=[],e=0,r=this.polys.length;e<r;e++){var i=this.polys[e].getGeom();null!==i&&t.push(i)}return t}},{key:"_composePolys",value:function(t){for(var e=[],r=0,i=t.length;r<i;r++){var n=t[r];if(!n.poly)if(n.isExteriorRing())e.push(new D(n));else{var a=n.enclosingRing();a.poly||e.push(new D(a)),a.poly.addInterior(n)}}return e}}]),e}(),I=function(){function e(r){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:E.compare;t(this,e),this.queue=r,this.tree=new h(i),this.segments=[]}return i(e,[{key:"process",value:function(t){var e=t.segment,r=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(e),r;var i=t.isLeft?this.tree.insert(e):this.tree.find(e);if(!i)throw new Error("Unable to find segment #".concat(e.id," ")+"[".concat(e.leftSE.point.x,", ").concat(e.leftSE.point.y,"] -> ")+"[".concat(e.rightSE.point.x,", ").concat(e.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var n=i,a=i,o=void 0,s=void 0;void 0===o;)null===(n=this.tree.prev(n))?o=null:void 0===n.key.consumedBy&&(o=n.key);for(;void 0===s;)null===(a=this.tree.next(a))?s=null:void 0===a.key.consumedBy&&(s=a.key);if(t.isLeft){var l=null;if(o){var h=o.getIntersection(e);if(null!==h&&(e.isAnEndpoint(h)||(l=h),!o.isAnEndpoint(h)))for(var u=this._splitSafely(o,h),c=0,p=u.length;c<p;c++)r.push(u[c])}var f=null;if(s){var d=s.getIntersection(e);if(null!==d&&(e.isAnEndpoint(d)||(f=d),!s.isAnEndpoint(d)))for(var g=this._splitSafely(s,d),m=0,_=g.length;m<_;m++)r.push(g[m])}if(null!==l||null!==f){var y=null;if(null===l)y=f;else if(null===f)y=l;else{y=P.comparePoints(l,f)<=0?l:f}this.queue.remove(e.rightSE),r.push(e.rightSE);for(var v=e.split(y),b=0,L=v.length;b<L;b++)r.push(v[b])}0<r.length?(this.tree.remove(e),r.push(t)):(this.segments.push(e),e.prev=o)}else{if(o&&s){var k=o.getIntersection(s);if(null!==k){if(!o.isAnEndpoint(k))for(var M=this._splitSafely(o,k),x=0,w=M.length;x<w;x++)r.push(M[x]);if(!s.isAnEndpoint(k))for(var C=this._splitSafely(s,k),E=0,S=C.length;E<S;E++)r.push(C[E])}}this.tree.remove(e)}return r}},{key:"_splitSafely",value:function(t,e){this.tree.remove(t);var r=t.rightSE;this.queue.remove(r);var i=t.split(e);return i.push(r),void 0===t.consumedBy&&this.tree.insert(t),i}}]),e}(),j=void 0!==e&&e.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,A=void 0!==e&&e.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,G=new(function(){function e(){t(this,e)}return i(e,[{key:"run",value:function(t,e,r){G.type=t,_.reset();for(var i=[new O(e,!0)],n=0,a=r.length;n<a;n++)i.push(new O(r[n],!1));if(G.numMultiPolys=i.length,"difference"===G.type)for(var o=i[0],s=1;s<i.length;)null!==c(i[s].bbox,o.bbox)?s++:i.splice(s,1);if("intersection"===G.type)for(var l=0,u=i.length;l<u;l++)for(var p=i[l],f=l+1,d=i.length;f<d;f++)if(null===c(p.bbox,i[f].bbox))return[];for(var g=new h(P.compare),m=0,y=i.length;m<y;m++)for(var v=i[m].getSweepEvents(),b=0,L=v.length;b<L;b++)if(g.insert(v[b]),g.size>j)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var k=new I(g),M=g.size,x=g.pop();x;){var w=x.key;if(g.size===M){var C=w.segment;throw new Error("Unable to pop() ".concat(w.isLeft?"left":"right"," SweepEvent ")+"[".concat(w.point.x,", ").concat(w.point.y,"] from segment #").concat(C.id," ")+"[".concat(C.leftSE.point.x,", ").concat(C.leftSE.point.y,"] -> ")+"[".concat(C.rightSE.point.x,", ").concat(C.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(g.size>j)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(k.segments.length>A)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var E=k.process(w),S=0,B=E.length;S<B;S++){var D=E[S];void 0===D.consumedBy&&g.insert(D)}M=g.size,x=g.pop()}_.reset();var N=R.factory(k.segments);return new T(N).getGeom()}}]),e}());return{union:function(t){for(var e=arguments.length,r=new Array(1<e?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];return G.run("union",t,r)},intersection:function(t){for(var e=arguments.length,r=new Array(1<e?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];return G.run("intersection",t,r)},xor:function(t){for(var e=arguments.length,r=new Array(1<e?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];return G.run("xor",t,r)},difference:function(t){for(var e=arguments.length,r=new Array(1<e?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];return G.run("difference",t,r)}}}()}).call(this,r(151))},function(t,e,r){var i=r(16)(r(3),"Map");t.exports=i},function(t,e,r){(function(e){var r="object"==typeof e&&e&&e.Object===Object&&e;t.exports=r}).call(this,r(82))},function(t,e,r){var i=r(89),n=r(96),a=r(98),o=r(99),s=r(100);function l(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}l.prototype.clear=i,l.prototype.delete=n,l.prototype.get=a,l.prototype.has=o,l.prototype.set=s,t.exports=l},function(t,e,r){var i=r(19),n=r(12);t.exports=function(t,e,r){(void 0===r||n(t[e],r))&&(void 0!==r||e in t)||i(t,e,r)}},function(t,e,r){var i=r(16),n=function(){try{var t=i(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();t.exports=n},function(t,e,r){var i=r(111)(Object.getPrototypeOf,Object);t.exports=i},function(t,e){var r=Object.prototype;t.exports=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||r)}},function(t,e,r){(function(t){var i=r(3),n=r(114),a=e&&!e.nodeType&&e,o=a&&"object"==typeof t&&t&&!t.nodeType&&t,s=o&&o.exports===a?i.Buffer:void 0,l=(s?s.isBuffer:void 0)||n;t.exports=l}).call(this,r(20)(t))},function(t,e,r){var i=r(116),n=r(117),a=r(118),o=a&&a.isTypedArray,s=o?n(o):i;t.exports=s},function(t,e){t.exports=function(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}},function(t,e,r){var i=r(122),n=r(124),a=r(22);t.exports=function(t){return a(t)?i(t,!0):n(t)}},function(t,e){t.exports=function(t){return t}},function(t,e,r){var i=r(5),n=r(136),a=r(137),o=r(140);t.exports=function(t,e){return i(t)?t:n(t,e)?[t]:a(o(t))}},function(t,e,r){var i=r(25);t.exports=function(t){if("string"==typeof t||i(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(15);e.default=function(t){var e=[1/0,1/0,-1/0,-1/0];return i.coordEach(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}},function(t){t.exports=JSON.parse('{"a":"2.10.0"}')},function(t){t.exports=JSON.parse('{"tooltips":{"placeMarker":"Click to place marker","firstVertex":"Click to place first vertex","continueLine":"Click to continue drawing","finishLine":"Click any existing marker to finish","finishPoly":"Click first marker to finish","finishRect":"Click to finish","startCircle":"Click to place circle center","finishCircle":"Click to finish circle","placeCircleMarker":"Click to place circle marker"},"actions":{"finish":"Finish","cancel":"Cancel","removeLastVertex":"Remove Last Vertex"},"buttonTitles":{"drawMarkerButton":"Draw Marker","drawPolyButton":"Draw Polygons","drawLineButton":"Draw Polyline","drawCircleButton":"Draw Circle","drawRectButton":"Draw Rectangle","editButton":"Edit Layers","dragButton":"Drag Layers","cutButton":"Cut Layers","deleteButton":"Remove Layers","drawCircleMarkerButton":"Draw Circle Marker","snappingButton":"Snap dragged marker to other layers and vertices","pinningButton":"Pin shared vertices together"}}')},function(t){t.exports=JSON.parse('{"tooltips":{"placeMarker":"Platziere den Marker mit Klick","firstVertex":"Platziere den ersten Marker mit Klick","continueLine":"Klicke, um weiter zu zeichnen","finishLine":"Beende mit Klick auf existierenden Marker","finishPoly":"Beende mit Klick auf ersten Marker","finishRect":"Beende mit Klick","startCircle":"Platziere das Kreiszentrum mit Klick","finishCircle":"Beende den Kreis mit Klick","placeCircleMarker":"Platziere den Kreismarker mit Klick"},"actions":{"finish":"Beenden","cancel":"Abbrechen","removeLastVertex":"Letzten Vertex löschen"},"buttonTitles":{"drawMarkerButton":"Marker zeichnen","drawPolyButton":"Polygon zeichnen","drawLineButton":"Polyline zeichnen","drawCircleButton":"Kreis zeichnen","drawRectButton":"Rechteck zeichnen","editButton":"Layer editieren","dragButton":"Layer bewegen","cutButton":"Layer schneiden","deleteButton":"Layer löschen","drawCircleMarkerButton":"Kreismarker zeichnen","snappingButton":"Bewegter Layer an andere Layer oder Vertexe einhacken","pinningButton":"Vertexe an der gleichen Position verknüpfen"}}')},function(t){t.exports=JSON.parse('{"tooltips":{"placeMarker":"Clicca per posizionare un Marker","firstVertex":"Clicca per posizionare il primo vertice","continueLine":"Clicca per continuare a disegnare","finishLine":"Clicca qualsiasi marker esistente per terminare","finishPoly":"Clicca il primo marker per terminare","finishRect":"Clicca per terminare","startCircle":"Clicca per posizionare il punto centrale del cerchio","finishCircle":"Clicca per terminare il cerchio","placeCircleMarker":"Clicca per posizionare un Marker del cherchio"},"actions":{"finish":"Termina","cancel":"Annulla","removeLastVertex":"Rimuovi l\'ultimo vertice"},"buttonTitles":{"drawMarkerButton":"Disegna Marker","drawPolyButton":"Disegna Poligoni","drawLineButton":"Disegna Polilinea","drawCircleButton":"Disegna Cerchio","drawRectButton":"Disegna Rettangolo","editButton":"Modifica Livelli","dragButton":"Sposta Livelli","cutButton":"Ritaglia Livelli","deleteButton":"Elimina Livelli","drawCircleMarkerButton":"Disegna Marker del Cerchio","snappingButton":"Snap ha trascinato il pennarello su altri strati e vertici","pinningButton":"Pin condiviso vertici insieme"}}')},function(t){t.exports=JSON.parse('{"tooltips":{"placeMarker":"Klik untuk menempatkan marker","firstVertex":"Klik untuk menempatkan vertex pertama","continueLine":"Klik untuk meneruskan digitasi","finishLine":"Klik pada sembarang marker yang ada untuk mengakhiri","finishPoly":"Klik marker pertama untuk mengakhiri","finishRect":"Klik untuk mengakhiri","startCircle":"Klik untuk menempatkan titik pusat lingkaran","finishCircle":"Klik untuk mengakhiri lingkaran","placeCircleMarker":"Klik untuk menempatkan penanda lingkarann"},"actions":{"finish":"Selesai","cancel":"Batal","removeLastVertex":"Hilangkan Vertex Terakhir"},"buttonTitles":{"drawMarkerButton":"Digitasi Marker","drawPolyButton":"Digitasi Polygon","drawLineButton":"Digitasi Polyline","drawCircleButton":"Digitasi Lingkaran","drawRectButton":"Digitasi Segi Empat","editButton":"Edit Layer","dragButton":"Geser Layer","cutButton":"Potong Layer","deleteButton":"Hilangkan Layer","drawCircleMarkerButton":"Digitasi Penanda Lingkaran","snappingButton":"Jepretkan penanda yang ditarik ke lapisan dan simpul lain","pinningButton":"Sematkan simpul bersama bersama"}}')},function(t){t.exports=JSON.parse('{"tooltips":{"placeMarker":"Adaugă un punct","firstVertex":"Apasă aici pentru a adăuga primul Vertex","continueLine":"Apasă aici pentru a continua desenul","finishLine":"Apasă pe orice obiect pentru a finisa desenul","finishPoly":"Apasă pe primul obiect pentru a finisa","finishRect":"Apasă pentru a finisa","startCircle":"Apasă pentru a desena un cerc","finishCircle":"Apasă pentru a finisa un cerc","placeCircleMarker":"Adaugă un punct"},"actions":{"finish":"Termină","cancel":"Anulează","removeLastVertex":"Șterge ultimul Vertex"},"buttonTitles":{"drawMarkerButton":"Adaugă o bulină","drawPolyButton":"Desenează un poligon","drawLineButton":"Desenează o linie","drawCircleButton":"Desenează un cerc","drawRectButton":"Desenează un dreptunghi","editButton":"Editează straturile","dragButton":"Mută straturile","cutButton":"Taie straturile","deleteButton":"Șterge straturile","drawCircleMarkerButton":"Desenează marcatorul cercului","snappingButton":"Fixați marcatorul glisat pe alte straturi și vârfuri","pinningButton":"Fixați vârfurile partajate împreună"}}')},function(t){t.exports=JSON.parse('{"tooltips":{"placeMarker":"Нажмите, чтобы нанести маркер","firstVertex":"Нажмите, чтобы нанести первый объект","continueLine":"Нажмите, чтобы продолжить рисование","finishLine":"Нажмите любой существующий маркер для завершения","finishPoly":"Выберите первую точку, чтобы закончить","finishRect":"Нажмите, чтобы закончить","startCircle":"Нажмите, чтобы добавить центр круга","finishCircle":"Нажмите, чтобы задать радиус","placeCircleMarker":"Нажмите, чтобы нанести круговой маркер"},"actions":{"finish":"Завершить","cancel":"Отменить","removeLastVertex":"Отменить последнее действие"},"buttonTitles":{"drawMarkerButton":"Добавить маркер","drawPolyButton":"Рисовать полигон","drawLineButton":"Рисовать кривую","drawCircleButton":"Рисовать круг","drawRectButton":"Рисовать прямоугольник","editButton":"Редактировать слой","dragButton":"Перенести слой","cutButton":"Вырезать слой","deleteButton":"Удалить слой","drawCircleMarkerButton":"Добавить круговой маркер","snappingButton":"Привязать перетаскиваемый маркер к другим слоям и вершинам","pinningButton":"Связать общие точки вместе"}}')},function(t){t.exports=JSON.parse('{"tooltips":{"placeMarker":"Presiona para colocar un marcador","firstVertex":"Presiona para colocar el primer vértice","continueLine":"Presiona para continuar dibujando","finishLine":"Presiona cualquier marcador existente para finalizar","finishPoly":"Presiona el primer marcador para finalizar","finishRect":"Presiona para finalizar","startCircle":"Presiona para colocar el centro del circulo","finishCircle":"Presiona para finalizar el circulo","placeCircleMarker":"Presiona para colocar un marcador de circulo"},"actions":{"finish":"Finalizar","cancel":"Cancelar","removeLastVertex":"Remover ultimo vértice"},"buttonTitles":{"drawMarkerButton":"Dibujar Marcador","drawPolyButton":"Dibujar Polígono","drawLineButton":"Dibujar Línea","drawCircleButton":"Dibujar Circulo","drawRectButton":"Dibujar Rectángulo","editButton":"Editar Capas","dragButton":"Arrastrar Capas","cutButton":"Cortar Capas","deleteButton":"Remover Capas","drawCircleMarkerButton":"Dibujar Marcador de Circulo","snappingButton":"El marcador de Snap arrastrado a otras capas y vértices","pinningButton":"Fijar juntos los vértices compartidos"}}')},function(t){t.exports=JSON.parse('{"tooltips":{"placeMarker":"Klik om een marker te plaatsen","firstVertex":"Klik om het eerste punt te plaatsen","continueLine":"Klik om te blijven tekenen","finishLine":"Klik op een bestaand punt om te beëindigen","finishPoly":"Klik op het eerst punt om te beëindigen","finishRect":"Klik om te beëindigen","startCircle":"Klik om het middelpunt te plaatsen","finishCircle":"Klik om de cirkel te beëindigen","placeCircleMarker":"Klik om een marker te plaatsen"},"actions":{"finish":"Bewaar","cancel":"Annuleer","removeLastVertex":"Verwijder laatste punt"},"buttonTitles":{"drawMarkerButton":"Plaats Marker","drawPolyButton":"Teken een vlak","drawLineButton":"Teken een lijn","drawCircleButton":"Teken een cirkel","drawRectButton":"Teken een vierkant","editButton":"Bewerk","dragButton":"Verplaats","cutButton":"Knip","deleteButton":"Verwijder","drawCircleMarkerButton":"Plaats Marker","snappingButton":"Snap gesleepte marker naar andere lagen en hoekpunten","pinningButton":"Speld gedeelde hoekpunten samen"}}')},function(t){t.exports=JSON.parse('{"tooltips":{"placeMarker":"Cliquez pour placer un marqueur","firstVertex":"Cliquez pour placer le premier sommet","continueLine":"Cliquez pour continuer à dessiner","finishLine":"Cliquez sur n\'importe quel marqueur pour terminer","finishPoly":"Cliquez sur le premier marqueur pour terminer","finishRect":"Cliquez pour terminer","startCircle":"Cliquez pour placer le centre du cercle","finishCircle":"Cliquez pour finir le cercle","placeCircleMarker":"Cliquez pour placer le marqueur circulaire"},"actions":{"finish":"Terminer","cancel":"Annuler","removeLastVertex":"Retirer le dernier sommet"},"buttonTitles":{"drawMarkerButton":"Placer des marqueurs","drawPolyButton":"Dessiner des polygones","drawLineButton":"Dessiner des polylignes","drawCircleButton":"Dessiner un cercle","drawRectButton":"Dessiner un rectangle","editButton":"Éditer des calques","dragButton":"Déplacer des calques","cutButton":"Couper des calques","deleteButton":"Supprimer des calques","drawCircleMarkerButton":"Dessiner un marqueur circulaire","snappingButton":"Glisser le marqueur vers d\'autres couches et sommets","pinningButton":"Épingler ensemble les sommets partagés"}}')},function(t){t.exports=JSON.parse('{"tooltips":{"placeMarker":"单击放置标记","firstVertex":"单击放置首个顶点","continueLine":"单击继续绘制","finishLine":"单击任何存在的标记以完成","finishPoly":"单击第一个标记以完成","finishRect":"单击完成","startCircle":"单击放置圆心","finishCircle":"单击完成圆形","placeCircleMarker":"点击放置圆形标记"},"actions":{"finish":"完成","cancel":"取消","removeLastVertex":"移除最后的顶点"},"buttonTitles":{"drawMarkerButton":"绘制标记","drawPolyButton":"绘制多边形","drawLineButton":"绘制线段","drawCircleButton":"绘制圆形","drawRectButton":"绘制长方形","editButton":"编辑图层","dragButton":"拖拽图层","cutButton":"剪切图层","deleteButton":"删除图层","drawCircleMarkerButton":"画圆圈标记","snappingButton":"将拖动的标记捕捉到其他图层和顶点","pinningButton":"将共享顶点固定在一起"}}')},function(t){t.exports=JSON.parse('{"tooltips":{"placeMarker":"單擊放置標記","firstVertex":"單擊放置第一個頂點","continueLine":"單擊繼續繪製","finishLine":"單擊任何存在的標記以完成","finishPoly":"單擊第一個標記以完成","finishRect":"單擊完成","startCircle":"單擊放置圓心","finishCircle":"單擊完成圓形","placeCircleMarker":"點擊放置圓形標記"},"actions":{"finish":"完成","cancel":"取消","removeLastVertex":"移除最後一個頂點"},"buttonTitles":{"drawMarkerButton":"放置標記","drawPolyButton":"繪製多邊形","drawLineButton":"繪製線段","drawCircleButton":"繪製圓形","drawRectButton":"繪製方形","editButton":"編輯圖形","dragButton":"移動圖形","cutButton":"裁切圖形","deleteButton":"刪除圖形","drawCircleMarkerButton":"畫圓圈標記","snappingButton":"將拖動的標記對齊到其他圖層和頂點","pinningButton":"將共享頂點固定在一起"}}')},function(t){t.exports=JSON.parse('{"tooltips":{"placeMarker":"Clique para posicionar o marcador","firstVertex":"Clique para posicionar o primeiro vértice","continueLine":"Clique para continuar desenhando","finishLine":"Clique em qualquer marcador existente para finalizar","finishPoly":"Clique no primeiro ponto para fechar o polígono","finishRect":"Clique para finalizar","startCircle":"Clique para posicionar o centro do círculo","finishCircle":"Clique para fechar o círculo","placeCircleMarker":"Clique para posicionar o marcador circular"},"actions":{"finish":"Finalizar","cancel":"Cancelar","removeLastVertex":"Remover último vértice"},"buttonTitles":{"drawMarkerButton":"Desenhar um marcador","drawPolyButton":"Desenhar um polígono","drawLineButton":"Desenhar uma polilinha","drawCircleButton":"Desenhar um círculo","drawRectButton":"Desenhar um retângulo","editButton":"Editar camada(s)","dragButton":"Mover camada(s)","cutButton":"Recortar camada(s)","deleteButton":"Remover camada(s)","drawCircleMarkerButton":"Marcador de círculos de desenho","snappingButton":"Marcador arrastado para outras camadas e vértices","pinningButton":"Vértices compartilhados de pinos juntos"}}')},function(t){t.exports=JSON.parse('{"tooltips":{"placeMarker":"Kliknij, aby ustawić znacznik","firstVertex":"Kliknij, aby ustawić pierwszy punkt","continueLine":"Kliknij, aby kontynuować rysowanie","finishLine":"Kliknij dowolny punkt, aby zakończyć","finishPoly":"Kliknij pierwszy punkt, aby zakończyć","finishRect":"Kliknij, aby zakończyć","startCircle":"Kliknij, aby ustawić środek koła","finishCircle":"Kliknij, aby zakończyć rysowanie koła","placeCircleMarker":"Kliknij, aby ustawić okrągły znacznik"},"actions":{"finish":"Zakończ","cancel":"Anuluj","removeLastVertex":"Usuń ostatni punkt"},"buttonTitles":{"drawMarkerButton":"Narysuj znacznik","drawPolyButton":"Narysuj wielokąt","drawLineButton":"Narysuj ścieżkę","drawCircleButton":"Narysuj koło","drawRectButton":"Narysuj prostokąt","editButton":"Edytuj","dragButton":"Przesuń","cutButton":"Wytnij","deleteButton":"Usuń","drawCircleMarkerButton":"Narysuj okrągły znacznik","snappingButton":"Snap przeciągnięty marker na inne warstwy i wierzchołki","pinningButton":"Sworzeń wspólne wierzchołki razem"}}')},function(t){t.exports=JSON.parse('{"tooltips":{"placeMarker":"Klicka för att placera markör","firstVertex":"Klicka för att placera första hörnet","continueLine":"Klicka för att fortsätta rita","finishLine":"Klicka på en existerande punkt för att slutföra","finishPoly":"Klicka på den första punkten för att slutföra","finishRect":"Klicka för att slutföra","startCircle":"Klicka för att placera cirkelns centrum","finishCircle":"Klicka för att slutföra cirkeln","placeCircleMarker":"Klicka för att placera cirkelmarkör"},"actions":{"finish":"Slutför","cancel":"Avbryt","removeLastVertex":"Ta bort sista hörnet"},"buttonTitles":{"drawMarkerButton":"Rita Markör","drawPolyButton":"Rita Polygoner","drawLineButton":"Rita Linje","drawCircleButton":"Rita Cirkel","drawRectButton":"Rita Rektangel","editButton":"Redigera Lager","dragButton":"Dra Lager","cutButton":"Klipp i Lager","deleteButton":"Ta bort Lager","drawCircleMarkerButton":"Rita Cirkelmarkör","snappingButton":"Snäpp dra markören till andra lager och hörn","pinningButton":"Fäst delade hörn tillsammans"}}')},function(t){t.exports=JSON.parse('{"tooltips":{"placeMarker":"Κάντε κλικ για να τοποθετήσετε Δείκτη","firstVertex":"Κάντε κλικ για να τοποθετήσετε το πρώτο σημείο","continueLine":"Κάντε κλικ για να συνεχίσετε να σχεδιάζετε","finishLine":"Κάντε κλικ σε οποιονδήποτε υπάρχον σημείο για να ολοκληρωθεί","finishPoly":"Κάντε κλικ στο πρώτο σημείο για να τελειώσετε","finishRect":"Κάντε κλικ για να τελειώσετε","startCircle":"Κάντε κλικ για να τοποθετήσετε κέντρο Κύκλου","finishCircle":"Κάντε κλικ για να ολοκληρώσετε τον Κύκλο","placeCircleMarker":"Κάντε κλικ για να τοποθετήσετε Κυκλικό Δείκτη"},"actions":{"finish":"Τέλος","cancel":"Ακύρωση","removeLastVertex":"Κατάργηση τελευταίου σημείου"},"buttonTitles":{"drawMarkerButton":"Σχεδίαση Δείκτη","drawPolyButton":"Σχεδίαση Πολυγώνου","drawLineButton":"Σχεδίαση Γραμμής","drawCircleButton":"Σχεδίαση Κύκλου","drawRectButton":"Σχεδίαση Ορθογωνίου","editButton":"Επεξεργασία Επιπέδων","dragButton":"Μεταφορά Επιπέδων","cutButton":"Αποκοπή Επιπέδων","deleteButton":"Κατάργηση Επιπέδων","drawCircleMarkerButton":"Σχεδίαση Κυκλικού Δείκτη","snappingButton":"Προσκόλληση του Δείκτη μεταφοράς σε άλλα Επίπεδα και Κορυφές","pinningButton":"Περικοπή κοινών κορυφών μαζί"}}')},function(t){t.exports=JSON.parse('{"tooltips":{"placeMarker":"Kattintson a jelölő elhelyezéséhez","firstVertex":"Kattintson az első pont elhelyezéséhez","continueLine":"Kattintson a következő pont elhelyezéséhez","finishLine":"A befejezéshez kattintson egy meglévő pontra","finishPoly":"A befejezéshez kattintson az első pontra","finishRect":"Kattintson a befejezéshez","startCircle":"Kattintson a kör középpontjának elhelyezéséhez","finishCircle":"Kattintson a kör befejezéséhez","placeCircleMarker":"Kattintson a körjelölő elhelyezéséhez"},"actions":{"finish":"Befejezés","cancel":"Mégse","removeLastVertex":"Utolsó pont eltávolítása"},"buttonTitles":{"drawMarkerButton":"Jelölő rajzolása","drawPolyButton":"Poligon rajzolása","drawLineButton":"Vonal rajzolása","drawCircleButton":"Kör rajzolása","drawRectButton":"Négyzet rajzolása","editButton":"Elemek szerkesztése","dragButton":"Elemek mozgatása","cutButton":"Elemek vágása","deleteButton":"Elemek törlése","drawCircleMarkerButton":"Kör jelölő rajzolása","snappingButton":"Kapcsolja a jelöltőt másik elemhez vagy ponthoz","pinningButton":"Közös pontok összekötése"}}')},function(t){t.exports=JSON.parse('{"tooltips":{"placeMarker":"Tryk for at placere en markør","firstVertex":"Tryk for at placere det første punkt","continueLine":"Tryk for at fortsætte linjen","finishLine":"Tryk på et eksisterende punkt for at afslutte","finishPoly":"Tryk på det første punkt for at afslutte","finishRect":"Tryk for at afslutte","startCircle":"Tryk for at placere cirklens center","finishCircle":"Tryk for at afslutte cirklen","placeCircleMarker":"Tryk for at placere en cirkelmarkør"},"actions":{"finish":"Afslut","cancel":"Afbryd","removeLastVertex":"Fjern sidste punkt"},"buttonTitles":{"drawMarkerButton":"Placer markør","drawPolyButton":"Tegn polygon","drawLineButton":"Tegn linje","drawCircleButton":"Tegn cirkel","drawRectButton":"Tegn firkant","editButton":"Rediger","dragButton":"Træk","cutButton":"Klip","deleteButton":"Fjern","drawCircleMarkerButton":"Tegn cirkelmarkør","snappingButton":"Fastgør trukket markør til andre elementer","pinningButton":"Sammenlæg delte elementer"}}')},function(t){t.exports=JSON.parse('{"tooltips":{"placeMarker":"Klikk for å plassere punkt","firstVertex":"Klikk for å plassere første punkt","continueLine":"Klikk for å tegne videre","finishLine":"Klikk på et eksisterende punkt for å fullføre","finishPoly":"Klikk første punkt for å fullføre","finishRect":"Klikk for å fullføre","startCircle":"Klikk for å sette sirkel midtpunkt","finishCircle":"Klikk for å fullføre sirkel","placeCircleMarker":"Klikk for å plassere sirkel"},"actions":{"finish":"Fullfør","cancel":"Kanseller","removeLastVertex":"Fjern forrige punkt"},"buttonTitles":{"drawMarkerButton":"Tegn Punkt","drawPolyButton":"Tegn Flate","drawLineButton":"Tegn Linje","drawCircleButton":"Tegn Sirkel","drawRectButton":"Tegn rektangel","editButton":"Rediger Objekter","dragButton":"Dra Objekter","cutButton":"Kutt Objekter","deleteButton":"Fjern Objekter","drawCircleMarkerButton":"Tegn sirkel-punkt","snappingButton":"Fest dratt punkt til andre objekter og punkt","pinningButton":"Pin delte punkt sammen"}}')},function(t){t.exports=JSON.parse('{"tooltips":{"placeMarker":"کلیک برای جانمایی نشان","firstVertex":"کلیک برای رسم اولین رأس","continueLine":"کلیک برای ادامه رسم","finishLine":"کلیک روی هر نشان موجود برای پایان","finishPoly":"کلیک روی اولین نشان برای پایان","finishRect":"کلیک برای پایان","startCircle":"کلیک برای رسم مرکز دایره","finishCircle":"کلیک برای پایان رسم دایره","placeCircleMarker":"کلیک برای رسم نشان دایره"},"actions":{"finish":"پایان","cancel":"لفو","removeLastVertex":"حذف آخرین رأس"},"buttonTitles":{"drawMarkerButton":"درج نشان","drawPolyButton":"رسم چندضلعی","drawLineButton":"رسم خط","drawCircleButton":"رسم دایره","drawRectButton":"رسم چهارضلعی","editButton":"ویرایش لایه‌ها","dragButton":"جابجایی لایه‌ها","cutButton":"برش لایه‌ها","deleteButton":"حذف لایه‌ها","drawCircleMarkerButton":"رسم نشان دایره","snappingButton":"نشانگر را به لایه‌ها و رئوس دیگر بکشید","pinningButton":"رئوس مشترک را با هم پین کنید"}}')},function(t){t.exports=JSON.parse('{"tooltips":{"placeMarker":"Натисніть, щоб нанести маркер","firstVertex":"Натисніть, щоб нанести першу вершину","continueLine":"Натисніть, щоб продовжити малювати","finishLine":"Натисніть будь-який існуючий маркер для завершення","finishPoly":"Виберіть перший маркер, щоб завершити","finishRect":"Натисніть, щоб завершити","startCircle":"Натисніть, щоб додати центр кола","finishCircle":"Натисніть, щоб завершити коло","placeCircleMarker":"Натисніть, щоб нанести круговий маркер"},"actions":{"finish":"Завершити","cancel":"Відмінити","removeLastVertex":"Видалити попередню вершину"},"buttonTitles":{"drawMarkerButton":"Малювати маркер","drawPolyButton":"Малювати полігон","drawLineButton":"Малювати криву","drawCircleButton":"Малювати коло","drawRectButton":"Малювати прямокутник","editButton":"Редагувати шари","dragButton":"Перенести шари","cutButton":"Вирізати шари","deleteButton":"Видалити шари","drawCircleMarkerButton":"Малювати круговий маркер","snappingButton":"Прив’язати перетягнутий маркер до інших шарів та вершин","pinningButton":"Зв\'язати спільні вершини разом"}}')},function(t){t.exports=JSON.parse('{"tooltips":{"placeMarker":"İşaretçi yerleştirmek için tıklayın","firstVertex":"İlk tepe noktasını yerleştirmek için tıklayın","continueLine":"Çizime devam etmek için tıklayın","finishLine":"Bitirmek için mevcut herhangi bir işaretçiyi tıklayın","finishPoly":"Bitirmek için ilk işaretçiyi tıklayın","finishRect":"Bitirmek için tıklayın","startCircle":"Daire merkezine yerleştirmek için tıklayın","finishCircle":"Daireyi bitirmek için tıklayın","placeCircleMarker":"Daire işaretçisi yerleştirmek için tıklayın"},"actions":{"finish":"Bitir","cancel":"İptal","removeLastVertex":"Son köşeyi kaldır"},"buttonTitles":{"drawMarkerButton":"Çizim İşaretçisi","drawPolyButton":"Çokgenler çiz","drawLineButton":"Çoklu çizgi çiz","drawCircleButton":"Çember çiz","drawRectButton":"Dikdörtgen çiz","editButton":"Katmanları düzenle","dragButton":"Katmanları sürükle","cutButton":"Katmanları kes","deleteButton":"Katmanları kaldır","drawCircleMarkerButton":"Daire işaretçisi çiz","snappingButton":"Sürüklenen işaretçiyi diğer katmanlara ve köşelere yapıştır","pinningButton":"Paylaşılan köşeleri birbirine sabitle"}}')},function(t,e,r){var i=r(143),n=r(144);t.exports=function(t,e){return null!=t&&n(t,e,i)}},function(t,e,r){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var n=i(r(42)),a=i(r(149)),o=i(r(150)),s=r(9);function l(t,e){var r,i=!1;for(r=0;r<t.coordinates.length;r++)if(m(t.coordinates[r],e.coordinates)){i=!0;break}return i}function h(t,e){for(var r=0,i=e.coordinates;r<i.length;r++){for(var n=i[r],a=!1,o=0,s=t.coordinates;o<s.length;o++)if(m(n,s[o])){a=!0;break}if(!a)return!1}return!0}function u(t,e){for(var r=!1,i=0,n=e.coordinates;i<n.length;i++){var a=n[i];if(o.default(a,t,{ignoreEndVertices:!0})&&(r=!0),!o.default(a,t))return!1}return!!r}function c(t,e){for(var r=0,i=e.coordinates;r<i.length;r++){var n=i[r];if(!a.default(n,t,{ignoreBoundary:!0}))return!1}return!0}function p(t,e){for(var r=!1,i=0,n=e.coordinates;i<n.length;i++){var a=n[i];if(o.default({type:"Point",coordinates:a},t,{ignoreEndVertices:!0})&&(r=!0),!o.default({type:"Point",coordinates:a},t,{ignoreEndVertices:!1}))return!1}return r}function f(t,e){var r=!1,i=0;if(!g(n.default(t),n.default(e)))return!1;for(;i<e.coordinates.length-1;i++){var o=_(e.coordinates[i],e.coordinates[i+1]);if(a.default({type:"Point",coordinates:o},t,{ignoreBoundary:!0})){r=!0;break}}return r}function d(t,e){if("Feature"===t.type&&null===t.geometry)return!1;if("Feature"===e.type&&null===e.geometry)return!1;if(!g(n.default(t),n.default(e)))return!1;for(var r=0,i=s.getGeom(e).coordinates;r<i.length;r++)for(var o=0,l=i[r];o<l.length;o++){var h=l[o];if(!a.default(h,t))return!1}return!0}function g(t,e){return!(t[0]>e[0]||t[2]<e[2]||t[1]>e[1]||t[3]<e[3])}function m(t,e){return t[0]===e[0]&&t[1]===e[1]}function _(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}e.default=function(t,e){var r=s.getGeom(t),i=s.getGeom(e),n=s.getType(t),g=s.getType(e),_=s.getCoords(t),y=s.getCoords(e);switch(n){case"Point":switch(g){case"Point":return m(_,y);default:throw new Error("feature2 "+g+" geometry not supported")}case"MultiPoint":switch(g){case"Point":return l(r,i);case"MultiPoint":return h(r,i);default:throw new Error("feature2 "+g+" geometry not supported")}case"LineString":switch(g){case"Point":return o.default(i,r,{ignoreEndVertices:!0});case"LineString":return p(r,i);case"MultiPoint":return u(r,i);default:throw new Error("feature2 "+g+" geometry not supported")}case"Polygon":switch(g){case"Point":return a.default(i,r,{ignoreBoundary:!0});case"LineString":return f(r,i);case"Polygon":return d(r,i);case"MultiPoint":return c(r,i);default:throw new Error("feature2 "+g+" geometry not supported")}default:throw new Error("feature1 "+n+" geometry not supported")}},e.isPointInMultiPoint=l,e.isMultiPointInMultiPoint=h,e.isMultiPointOnLine=u,e.isMultiPointInPoly=c,e.isLineOnLine=p,e.isLineInPoly=f,e.isPolyInPoly=d,e.doBBoxOverlap=g,e.compareCoords=m,e.getMidpoint=_},function(t,e,r){t.exports=r(154)},function(t,e){Array.prototype.findIndex=Array.prototype.findIndex||function(t){if(null===this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof t)throw new TypeError("callback must be a function");for(var e=Object(this),r=e.length>>>0,i=arguments[1],n=0;n<r;n++)if(t.call(i,e[n],n,e))return n;return-1},Array.prototype.find=Array.prototype.find||function(t){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof t)throw new TypeError("callback must be a function");for(var e=Object(this),r=e.length>>>0,i=arguments[1],n=0;n<r;n++){var a=e[n];if(t.call(i,a,n,e))return a}},"function"!=typeof Object.assign&&(Object.assign=function(t){"use strict";if(null==t)throw new TypeError("Cannot convert undefined or null to object");t=Object(t);for(var e=1;e<arguments.length;e++){var r=arguments[e];if(null!=r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t}),[Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach((function(t){t.hasOwnProperty("remove")||Object.defineProperty(t,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode.removeChild(this)}})})),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(t,e){if(null==this)throw new TypeError('"this" is null or not defined');var r=Object(this),i=r.length>>>0;if(0==i)return!1;for(var n,a,o=0|e,s=Math.max(0<=o?o:i-Math.abs(o),0);s<i;){if((n=r[s])===(a=t)||"number"==typeof n&&"number"==typeof a&&isNaN(n)&&isNaN(a))return!0;s++}return!1}})},function(t,e,r){var i=r(70),n=r(31),a=r(101),o=r(103),s=r(2),l=r(38),h=r(37);t.exports=function t(e,r,u,c,p){e!==r&&a(r,(function(a,l){if(p=p||new i,s(a))o(e,r,l,u,t,c,p);else{var f=c?c(h(e,l),a,l+"",e,r,p):void 0;void 0===f&&(f=a),n(e,l,f)}}),l)}},function(t,e,r){var i=r(10),n=r(76),a=r(77),o=r(78),s=r(79),l=r(80);function h(t){var e=this.__data__=new i(t);this.size=e.size}h.prototype.clear=n,h.prototype.delete=a,h.prototype.get=o,h.prototype.has=s,h.prototype.set=l,t.exports=h},function(t,e){t.exports=function(){this.__data__=[],this.size=0}},function(t,e,r){var i=r(11),n=Array.prototype.splice;t.exports=function(t){var e=this.__data__,r=i(e,t);return!(r<0||(r==e.length-1?e.pop():n.call(e,r,1),--this.size,0))}},function(t,e,r){var i=r(11);t.exports=function(t){var e=this.__data__,r=i(e,t);return r<0?void 0:e[r][1]}},function(t,e,r){var i=r(11);t.exports=function(t){return-1<i(this.__data__,t)}},function(t,e,r){var i=r(11);t.exports=function(t,e){var r=this.__data__,n=i(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}},function(t,e,r){var i=r(10);t.exports=function(){this.__data__=new i,this.size=0}},function(t,e){t.exports=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}},function(t,e){t.exports=function(t){return this.__data__.get(t)}},function(t,e){t.exports=function(t){return this.__data__.has(t)}},function(t,e,r){var i=r(10),n=r(28),a=r(30);t.exports=function(t,e){var r=this.__data__;if(r instanceof i){var o=r.__data__;if(!n||o.length<199)return o.push([t,e]),this.size=++r.size,this;r=this.__data__=new a(o)}return r.set(t,e),this.size=r.size,this}},function(t,e,r){var i=r(17),n=r(85),a=r(2),o=r(87),s=/^\[object .+?Constructor\]$/,l=Function.prototype,h=Object.prototype,u=l.toString,c=h.hasOwnProperty,p=RegExp("^"+u.call(c).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=function(t){return!(!a(t)||n(t))&&(i(t)?p:s).test(o(t))}},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){var i=r(18),n=Object.prototype,a=n.hasOwnProperty,o=n.toString,s=i?i.toStringTag:void 0;t.exports=function(t){var e=a.call(t,s),r=t[s];try{t[s]=void 0;var i=!0}catch(t){}var n=o.call(t);return i&&(e?t[s]=r:delete t[s]),n}},function(t,e){var r=Object.prototype.toString;t.exports=function(t){return r.call(t)}},function(t,e,r){var i,n=r(86),a=(i=/[^.]+$/.exec(n&&n.keys&&n.keys.IE_PROTO||""))?"Symbol(src)_1."+i:"";t.exports=function(t){return!!a&&a in t}},function(t,e,r){var i=r(3)["__core-js_shared__"];t.exports=i},function(t,e){var r=Function.prototype.toString;t.exports=function(t){if(null!=t){try{return r.call(t)}catch(t){}try{return t+""}catch(t){}}return""}},function(t,e){t.exports=function(t,e){return null==t?void 0:t[e]}},function(t,e,r){var i=r(90),n=r(10),a=r(28);t.exports=function(){this.size=0,this.__data__={hash:new i,map:new(a||n),string:new i}}},function(t,e,r){var i=r(91),n=r(92),a=r(93),o=r(94),s=r(95);function l(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}l.prototype.clear=i,l.prototype.delete=n,l.prototype.get=a,l.prototype.has=o,l.prototype.set=s,t.exports=l},function(t,e,r){var i=r(13);t.exports=function(){this.__data__=i?i(null):{},this.size=0}},function(t,e){t.exports=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}},function(t,e,r){var i=r(13),n=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;if(i){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return n.call(e,t)?e[t]:void 0}},function(t,e,r){var i=r(13),n=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;return i?void 0!==e[t]:n.call(e,t)}},function(t,e,r){var i=r(13);t.exports=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=i&&void 0===e?"__lodash_hash_undefined__":e,this}},function(t,e,r){var i=r(14);t.exports=function(t){var e=i(this,t).delete(t);return this.size-=e?1:0,e}},function(t,e){t.exports=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}},function(t,e,r){var i=r(14);t.exports=function(t){return i(this,t).get(t)}},function(t,e,r){var i=r(14);t.exports=function(t){return i(this,t).has(t)}},function(t,e,r){var i=r(14);t.exports=function(t,e){var r=i(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}},function(t,e,r){var i=r(102)();t.exports=i},function(t,e){t.exports=function(t){return function(e,r,i){for(var n=-1,a=Object(e),o=i(e),s=o.length;s--;){var l=o[t?s:++n];if(!1===r(a[l],l,a))break}return e}}},function(t,e,r){var i=r(31),n=r(104),a=r(105),o=r(108),s=r(109),l=r(21),h=r(5),u=r(113),c=r(35),p=r(17),f=r(2),d=r(115),g=r(36),m=r(37),_=r(119);t.exports=function(t,e,r,y,v,b,L){var k=m(t,r),M=m(e,r),x=L.get(M);if(x)i(t,r,x);else{var w=b?b(k,M,r+"",t,e,L):void 0,P=void 0===w;if(P){var C=h(M),E=!C&&c(M),S=!C&&!E&&g(M);w=M,C||E||S?w=h(k)?k:u(k)?o(k):E?n(M,!(P=!1)):S?a(M,!(P=!1)):[]:d(M)||l(M)?l(w=k)?w=_(k):f(k)&&!p(k)||(w=s(M)):P=!1}P&&(L.set(M,w),v(w,M,y,b,L),L.delete(M)),i(t,r,w)}}},function(t,e,r){(function(t){var i=r(3),n=e&&!e.nodeType&&e,a=n&&"object"==typeof t&&t&&!t.nodeType&&t,o=a&&a.exports===n?i.Buffer:void 0,s=o?o.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var r=t.length,i=s?s(r):new t.constructor(r);return t.copy(i),i}}).call(this,r(20)(t))},function(t,e,r){var i=r(106);t.exports=function(t,e){var r=e?i(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}},function(t,e,r){var i=r(107);t.exports=function(t){var e=new t.constructor(t.byteLength);return new i(e).set(new i(t)),e}},function(t,e,r){var i=r(3).Uint8Array;t.exports=i},function(t,e){t.exports=function(t,e){var r=-1,i=t.length;for(e=e||Array(i);++r<i;)e[r]=t[r];return e}},function(t,e,r){var i=r(110),n=r(33),a=r(34);t.exports=function(t){return"function"!=typeof t.constructor||a(t)?{}:i(n(t))}},function(t,e,r){var i=r(2),n=Object.create;function a(){}t.exports=function(t){if(!i(t))return{};if(n)return n(t);a.prototype=t;var e=new a;return a.prototype=void 0,e}},function(t,e){t.exports=function(t,e){return function(r){return t(e(r))}}},function(t,e,r){var i=r(8),n=r(4);t.exports=function(t){return n(t)&&"[object Arguments]"==i(t)}},function(t,e,r){var i=r(22),n=r(4);t.exports=function(t){return n(t)&&i(t)}},function(t,e){t.exports=function(){return!1}},function(t,e,r){var i=r(8),n=r(33),a=r(4),o=Function.prototype,s=Object.prototype,l=o.toString,h=s.hasOwnProperty,u=l.call(Object);t.exports=function(t){if(!a(t)||"[object Object]"!=i(t))return!1;var e=n(t);if(null===e)return!0;var r=h.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&l.call(r)==u}},function(t,e,r){var i=r(8),n=r(23),a=r(4),o={};o["[object Float32Array]"]=o["[object Float64Array]"]=o["[object Int8Array]"]=o["[object Int16Array]"]=o["[object Int32Array]"]=o["[object Uint8Array]"]=o["[object Uint8ClampedArray]"]=o["[object Uint16Array]"]=o["[object Uint32Array]"]=!0,o["[object Arguments]"]=o["[object Array]"]=o["[object ArrayBuffer]"]=o["[object Boolean]"]=o["[object DataView]"]=o["[object Date]"]=o["[object Error]"]=o["[object Function]"]=o["[object Map]"]=o["[object Number]"]=o["[object Object]"]=o["[object RegExp]"]=o["[object Set]"]=o["[object String]"]=o["[object WeakMap]"]=!1,t.exports=function(t){return a(t)&&n(t.length)&&!!o[i(t)]}},function(t,e){t.exports=function(t){return function(e){return t(e)}}},function(t,e,r){(function(t){var i=r(29),n=e&&!e.nodeType&&e,a=n&&"object"==typeof t&&t&&!t.nodeType&&t,o=a&&a.exports===n&&i.process,s=function(){try{return a&&a.require&&a.require("util").types||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=s}).call(this,r(20)(t))},function(t,e,r){var i=r(120),n=r(38);t.exports=function(t){return i(t,n(t))}},function(t,e,r){var i=r(121),n=r(19);t.exports=function(t,e,r,a){var o=!r;r=r||{};for(var s=-1,l=e.length;++s<l;){var h=e[s],u=a?a(r[h],t[h],h,r,t):void 0;void 0===u&&(u=t[h]),o?n(r,h,u):i(r,h,u)}return r}},function(t,e,r){var i=r(19),n=r(12),a=Object.prototype.hasOwnProperty;t.exports=function(t,e,r){var o=t[e];a.call(t,e)&&n(o,r)&&(void 0!==r||e in t)||i(t,e,r)}},function(t,e,r){var i=r(123),n=r(21),a=r(5),o=r(35),s=r(24),l=r(36),h=Object.prototype.hasOwnProperty;t.exports=function(t,e){var r=a(t),u=!r&&n(t),c=!r&&!u&&o(t),p=!r&&!u&&!c&&l(t),f=r||u||c||p,d=f?i(t.length,String):[],g=d.length;for(var m in t)!e&&!h.call(t,m)||f&&("length"==m||c&&("offset"==m||"parent"==m)||p&&("buffer"==m||"byteLength"==m||"byteOffset"==m)||s(m,g))||d.push(m);return d}},function(t,e){t.exports=function(t,e){for(var r=-1,i=Array(t);++r<t;)i[r]=e(r);return i}},function(t,e,r){var i=r(2),n=r(34),a=r(125),o=Object.prototype.hasOwnProperty;t.exports=function(t){if(!i(t))return a(t);var e=n(t),r=[];for(var s in t)("constructor"!=s||!e&&o.call(t,s))&&r.push(s);return r}},function(t,e){t.exports=function(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e}},function(t,e,r){var i=r(127),n=r(134);t.exports=function(t){return i((function(e,r){var i=-1,a=r.length,o=1<a?r[a-1]:void 0,s=2<a?r[2]:void 0;for(o=3<t.length&&"function"==typeof o?(a--,o):void 0,s&&n(r[0],r[1],s)&&(o=a<3?void 0:o,a=1),e=Object(e);++i<a;){var l=r[i];l&&t(e,l,i,o)}return e}))}},function(t,e,r){var i=r(39),n=r(128),a=r(130);t.exports=function(t,e){return a(n(t,e,i),t+"")}},function(t,e,r){var i=r(129),n=Math.max;t.exports=function(t,e,r){return e=n(void 0===e?t.length-1:e,0),function(){for(var a=arguments,o=-1,s=n(a.length-e,0),l=Array(s);++o<s;)l[o]=a[e+o];o=-1;for(var h=Array(e+1);++o<e;)h[o]=a[o];return h[e]=r(l),i(t,this,h)}}},function(t,e){t.exports=function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}},function(t,e,r){var i=r(131),n=r(133)(i);t.exports=n},function(t,e,r){var i=r(132),n=r(32),a=r(39),o=n?function(t,e){return n(t,"toString",{configurable:!0,enumerable:!1,value:i(e),writable:!0})}:a;t.exports=o},function(t,e){t.exports=function(t){return function(){return t}}},function(t,e){var r=Date.now;t.exports=function(t){var e=0,i=0;return function(){var n=r(),a=16-(n-i);if(i=n,0<a){if(800<=++e)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}},function(t,e,r){var i=r(12),n=r(22),a=r(24),o=r(2);t.exports=function(t,e,r){if(!o(r))return!1;var s=typeof e;return!!("number"==s?n(r)&&a(e,r.length):"string"==s&&e in r)&&i(r[e],t)}},function(t,e,r){var i=r(40),n=r(41);t.exports=function(t,e){for(var r=0,a=(e=i(e,t)).length;null!=t&&r<a;)t=t[n(e[r++])];return r&&r==a?t:void 0}},function(t,e,r){var i=r(5),n=r(25),a=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,o=/^\w*$/;t.exports=function(t,e){if(i(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!n(t))||o.test(t)||!a.test(t)||null!=e&&t in Object(e)}},function(t,e,r){var i=r(138),n=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,a=/\\(\\)?/g,o=i((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(n,(function(t,r,i,n){e.push(i?n.replace(a,"$1"):r||t)})),e}));t.exports=o},function(t,e,r){var i=r(139);t.exports=function(t){var e=i(t,(function(t){return 500===r.size&&r.clear(),t})),r=e.cache;return e}},function(t,e,r){var i=r(30);function n(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var r=function(){var i=arguments,n=e?e.apply(this,i):i[0],a=r.cache;if(a.has(n))return a.get(n);var o=t.apply(this,i);return r.cache=a.set(n,o)||a,o};return r.cache=new(n.Cache||i),r}n.Cache=i,t.exports=n},function(t,e,r){var i=r(141);t.exports=function(t){return null==t?"":i(t)}},function(t,e,r){var i=r(18),n=r(142),a=r(5),o=r(25),s=i?i.prototype:void 0,l=s?s.toString:void 0;t.exports=function t(e){if("string"==typeof e)return e;if(a(e))return n(e,t)+"";if(o(e))return l?l.call(e):"";var r=e+"";return"0"==r&&1/e==-1/0?"-0":r}},function(t,e){t.exports=function(t,e){for(var r=-1,i=null==t?0:t.length,n=Array(i);++r<i;)n[r]=e(t[r],r,t);return n}},function(t,e){var r=Object.prototype.hasOwnProperty;t.exports=function(t,e){return null!=t&&r.call(t,e)}},function(t,e,r){var i=r(40),n=r(21),a=r(5),o=r(24),s=r(23),l=r(41);t.exports=function(t,e,r){for(var h=-1,u=(e=i(e,t)).length,c=!1;++h<u;){var p=l(e[h]);if(!(c=null!=t&&r(t,p)))break;t=t[p]}return c||++h!=u?c:!!(u=null==t?0:t.length)&&s(u)&&o(p,u)&&(a(t)||n(t))}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(6),n=r(9),a=r(15);e.default=function(t){if(!t)throw new Error("geojson is required");var e=[];return a.flattenEach(t,(function(t){!function(t,e){var r=[],a=t.geometry;if(null!==a){switch(a.type){case"Polygon":r=n.getCoords(a);break;case"LineString":r=[n.getCoords(a)]}r.forEach((function(r){(function(t,e){var r=[];return t.reduce((function(t,n){var a=i.lineString([t,n],e);return a.bbox=function(t,e){var r=t[0],i=t[1],n=e[0],a=e[1];return[r<n?r:n,i<a?i:a,n<r?r:n,a<i?i:a]}(t,n),r.push(a),n})),r})(r,t.properties).forEach((function(t){t.id=e.length,e.push(t)}))}))}}(t,e)})),i.featureCollection(e)}},function(t,e,r){var i=r(147),n=r(6),a=r(15),o=r(42).default,s=a.featureEach,l=(a.coordEach,n.polygon,n.featureCollection);function h(t){var e=i(t);return e.insert=function(t){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:o(t),i.prototype.insert.call(this,t)},e.load=function(t){var e=[];return Array.isArray(t)?t.forEach((function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox?t.bbox:o(t),e.push(t)})):s(t,(function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox?t.bbox:o(t),e.push(t)})),i.prototype.load.call(this,e)},e.remove=function(t,e){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:o(t),i.prototype.remove.call(this,t,e)},e.clear=function(){return i.prototype.clear.call(this)},e.search=function(t){var e=i.prototype.search.call(this,this.toBBox(t));return l(e)},e.collides=function(t){return i.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=i.prototype.all.call(this);return l(t)},e.toJSON=function(){return i.prototype.toJSON.call(this)},e.fromJSON=function(t){return i.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var e;if(t.bbox)e=t.bbox;else if(Array.isArray(t)&&4===t.length)e=t;else if(Array.isArray(t)&&6===t.length)e=[t[0],t[1],t[3],t[4]];else if("Feature"===t.type)e=o(t);else{if("FeatureCollection"!==t.type)throw new Error("invalid geojson");e=o(t)}return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}},e}t.exports=h,t.exports.default=h},function(t,e,r){"use strict";t.exports=n,t.exports.default=n;var i=r(148);function n(t,e){if(!(this instanceof n))return new n(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function a(t,e,r){if(!r)return e.indexOf(t);for(var i=0;i<e.length;i++)if(r(t,e[i]))return i;return-1}function o(t,e){s(t,0,t.children.length,e,t)}function s(t,e,r,i,n){(n=n||g(null)).minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var a,o=e;o<r;o++)a=t.children[o],l(n,t.leaf?i(a):a);return n}function l(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function h(t,e){return t.minX-e.minX}function u(t,e){return t.minY-e.minY}function c(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function p(t){return t.maxX-t.minX+(t.maxY-t.minY)}function f(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function d(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function g(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function m(t,e,r,n,a){for(var o,s=[e,r];s.length;)(r=s.pop())-(e=s.pop())<=n||(o=e+Math.ceil((r-e)/n/2)*n,i(t,o,e,r,a),s.push(e,o,o,r))}n.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,r=[],i=this.toBBox;if(!d(t,e))return r;for(var n,a,o,s,l=[];e;){for(n=0,a=e.children.length;n<a;n++)o=e.children[n],d(t,s=e.leaf?i(o):o)&&(e.leaf?r.push(o):f(t,s)?this._all(o,r):l.push(o));e=l.pop()}return r},collides:function(t){var e=this.data,r=this.toBBox;if(!d(t,e))return!1;for(var i,n,a,o,s=[];e;){for(i=0,n=e.children.length;i<n;i++)if(a=e.children[i],d(t,o=e.leaf?r(a):a)){if(e.leaf||f(t,o))return!0;s.push(a)}e=s.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,r=t.length;e<r;e++)this.insert(t[e]);return this}var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var n=this.data;this.data=i,i=n}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=g([]),this},remove:function(t,e){if(!t)return this;for(var r,i,n,o,s=this.data,l=this.toBBox(t),h=[],u=[];s||h.length;){if(s||(s=h.pop(),i=h[h.length-1],r=u.pop(),o=!0),s.leaf&&-1!==(n=a(t,s.children,e)))return s.children.splice(n,1),h.push(s),this._condense(h),this;o||s.leaf||!f(s,l)?i?(r++,s=i.children[r],o=!1):s=null:(h.push(s),u.push(r),r=0,s=(i=s).children[0])}return this},toBBox:function(t){return t},compareMinX:h,compareMinY:u,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var r=[];t;)t.leaf?e.push.apply(e,t.children):r.push.apply(r,t.children),t=r.pop();return e},_build:function(t,e,r,i){var n,a=r-e+1,s=this._maxEntries;if(a<=s)return o(n=g(t.slice(e,r+1)),this.toBBox),n;i||(i=Math.ceil(Math.log(a)/Math.log(s)),s=Math.ceil(a/Math.pow(s,i-1))),(n=g([])).leaf=!1,n.height=i;var l,h,u,c,p=Math.ceil(a/s),f=p*Math.ceil(Math.sqrt(s));for(m(t,e,r,f,this.compareMinX),l=e;l<=r;l+=f)for(m(t,l,u=Math.min(l+f-1,r),p,this.compareMinY),h=l;h<=u;h+=p)c=Math.min(h+p-1,u),n.children.push(this._build(t,h,c,i-1));return o(n,this.toBBox),n},_chooseSubtree:function(t,e,r,i){for(var n,a,o,s,l,h,u,p,f,d;i.push(e),!e.leaf&&i.length-1!==r;){for(u=p=1/0,n=0,a=e.children.length;n<a;n++)l=c(o=e.children[n]),f=t,d=o,(h=(Math.max(d.maxX,f.maxX)-Math.min(d.minX,f.minX))*(Math.max(d.maxY,f.maxY)-Math.min(d.minY,f.minY))-l)<p?(p=h,u=l<u?l:u,s=o):h===p&&l<u&&(u=l,s=o);e=s||e.children[0]}return e},_insert:function(t,e,r){var i=this.toBBox,n=r?t:i(t),a=[],o=this._chooseSubtree(n,this.data,e,a);for(o.children.push(t),l(o,n);0<=e&&a[e].children.length>this._maxEntries;)this._split(a,e),e--;this._adjustParentBBoxes(n,a,e)},_split:function(t,e){var r=t[e],i=r.children.length,n=this._minEntries;this._chooseSplitAxis(r,n,i);var a=this._chooseSplitIndex(r,n,i),s=g(r.children.splice(a,r.children.length-a));s.height=r.height,s.leaf=r.leaf,o(r,this.toBBox),o(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(r,s)},_splitRoot:function(t,e){this.data=g([t,e]),this.data.height=t.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,r){var i,n,a,o,l,h,u,p,f,d,g,m,_,y;for(h=u=1/0,i=e;i<=r-e;i++)f=n=s(t,0,i,this.toBBox),d=a=s(t,i,r,this.toBBox),g=Math.max(f.minX,d.minX),m=Math.max(f.minY,d.minY),_=Math.min(f.maxX,d.maxX),y=Math.min(f.maxY,d.maxY),o=Math.max(0,_-g)*Math.max(0,y-m),l=c(n)+c(a),o<h?(h=o,p=i,u=l<u?l:u):o===h&&l<u&&(u=l,p=i);return p},_chooseSplitAxis:function(t,e,r){var i=t.leaf?this.compareMinX:h,n=t.leaf?this.compareMinY:u;this._allDistMargin(t,e,r,i)<this._allDistMargin(t,e,r,n)&&t.children.sort(i)},_allDistMargin:function(t,e,r,i){t.children.sort(i);var n,a,o=this.toBBox,h=s(t,0,e,o),u=s(t,r-e,r,o),c=p(h)+p(u);for(n=e;n<r-e;n++)a=t.children[n],l(h,t.leaf?o(a):a),c+=p(h);for(n=r-e-1;e<=n;n--)a=t.children[n],l(u,t.leaf?o(a):a),c+=p(u);return c},_adjustParentBBoxes:function(t,e,r){for(var i=r;0<=i;i--)l(e[i],t)},_condense:function(t){for(var e,r=t.length-1;0<=r;r--)0===t[r].children.length?0<r?(e=t[r-1].children).splice(e.indexOf(t[r]),1):this.clear():o(t[r],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}},function(t,e,r){t.exports=function(){"use strict";function t(t,e,r){var i=t[e];t[e]=t[r],t[r]=i}function e(t,e){return t<e?-1:e<t?1:0}return function(r,i,n,a,o){!function e(r,i,n,a,o){for(;n<a;){if(600<a-n){var s=a-n+1,l=i-n+1,h=Math.log(s),u=.5*Math.exp(2*h/3),c=.5*Math.sqrt(h*u*(s-u)/s)*(l-s/2<0?-1:1);e(r,i,Math.max(n,Math.floor(i-l*u/s+c)),Math.min(a,Math.floor(i+(s-l)*u/s+c)),o)}var p=r[i],f=n,d=a;for(t(r,n,i),0<o(r[a],p)&&t(r,n,a);f<d;){for(t(r,f,d),f++,d--;o(r[f],p)<0;)f++;for(;0<o(r[d],p);)d--}0===o(r[n],p)?t(r,n,d):t(r,++d,a),d<=i&&(n=d+1),i<=d&&(a=d-1)}}(r,i,n||0,a||r.length-1,o||e)}}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(9);function n(t,e,r){var i=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var n=0,a=e.length-1;n<e.length;a=n++){var o=e[n][0],s=e[n][1],l=e[a][0],h=e[a][1];if(t[1]*(o-l)+s*(l-t[0])+h*(t[0]-o)==0&&(o-t[0])*(l-t[0])<=0&&(s-t[1])*(h-t[1])<=0)return!r;s>t[1]!=h>t[1]&&t[0]<(l-o)*(t[1]-s)/(h-s)+o&&(i=!i)}return i}e.default=function(t,e,r){if(void 0===r&&(r={}),!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var a=i.getCoord(t),o=i.getGeom(e),s=o.type,l=e.bbox,h=o.coordinates;if(l&&!1===function(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}(a,l))return!1;"Polygon"===s&&(h=[h]);for(var u=!1,c=0;c<h.length&&!u;c++)if(n(a,h[c][0],r.ignoreBoundary)){for(var p=!1,f=1;f<h[c].length&&!p;)n(a,h[c][f],!r.ignoreBoundary)&&(p=!0),f++;p||(u=!0)}return u}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(9);function n(t,e,r,i){var n=r[0],a=r[1],o=t[0],s=t[1],l=e[0],h=e[1],u=l-o,c=h-s;return 0==(r[0]-o)*c-(r[1]-s)*u&&(i?"start"===i?Math.abs(u)>=Math.abs(c)?0<u?o<n&&n<=l:l<=n&&n<o:0<c?s<a&&a<=h:h<=a&&a<s:"end"===i?Math.abs(u)>=Math.abs(c)?0<u?o<=n&&n<l:l<n&&n<=o:0<c?s<=a&&a<h:h<a&&a<=s:"both"===i&&(Math.abs(u)>=Math.abs(c)?0<u?o<n&&n<l:l<n&&n<o:0<c?s<a&&a<h:h<a&&a<s):Math.abs(u)>=Math.abs(c)?0<u?o<=n&&n<=l:l<=n&&n<=o:0<c?s<=a&&a<=h:h<=a&&a<=s)}e.default=function(t,e,r){void 0===r&&(r={});for(var a=i.getCoord(t),o=i.getCoords(e),s=0;s<o.length-1;s++){var l=!1;if(r.ignoreEndVertices&&(0===s&&(l="start"),s===o.length-2&&(l="end"),0===s&&s+1===o.length-1&&(l="both")),n(o[s],o[s+1],a,l))return!0}return!1}},function(t,e){var r,i,n=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(t){if(r===setTimeout)return setTimeout(t,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(t){r=a}try{i="function"==typeof clearTimeout?clearTimeout:o}catch(t){i=o}}();var l,h=[],u=!1,c=-1;function p(){u&&l&&(u=!1,l.length?h=l.concat(h):c=-1,h.length&&f())}function f(){if(!u){var t=s(p);u=!0;for(var e=h.length;e;){for(l=h,h=[];++c<e;)l&&l[c].run();c=-1,e=h.length}l=null,u=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===o||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function g(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];h.push(new d(t,e)),1!==h.length||u||s(f)},d.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=g,n.addListener=g,n.once=g,n.off=g,n.removeListener=g,n.removeAllListeners=g,n.emit=g,n.prependListener=g,n.prependOnceListener=g,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(t,e,r){},function(t,e,r){},function(t,e,r){"use strict";r.r(e),r(68);var i=r(43),n=r(26),a=r.n(n),o=r(44),s=r(45),l=r(46),h=r(47),u=r(48),c=r(49),p=r(50),f=r(51),d=r(52),g=r(53),m=r(54),_={en:o,de:s,it:l,id:h,ro:u,ru:c,es:p,nl:f,fr:d,pt_br:r(55),zh:g,zh_tw:m,pl:r(56),sv:r(57),el:r(58),hu:r(59),da:r(60),no:r(61),fa:r(62),ua:r(63),tr:r(64)};function y(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function v(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?y(Object(r),!0).forEach((function(e){b(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function b(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var k={_globalEditMode:!1,enableGlobalEditMode:function(t){var e=v({snappable:this._globalSnappingEnabled},t);this.Toolbar.toggleButton("editMode",!0),L.PM.Utils.findLayers(this.map).forEach((function(t){t.pm.enable(e)})),this.throttledReInitEdit||(this.throttledReInitEdit=L.Util.throttle(this.handleLayerAdditionInGlobalEditMode,100,this)),this._addedLayers=[],this.map.on("layeradd",this._layerAdded,this),this.map.on("layeradd",this.throttledReInitEdit,this),this.setGlobalEditStatus(!0)},disableGlobalEditMode:function(){L.PM.Utils.findLayers(this.map).forEach((function(t){t.pm.disable()})),this.map.off("layeradd",this.throttledReInitEdit,this),this.Toolbar.toggleButton("editMode",!1),this.setGlobalEditStatus(!1)},globalEditEnabled:function(){return this.globalEditModeEnabled()},globalEditModeEnabled:function(){return this._globalEditMode},setGlobalEditStatus:function(t){this._globalEditMode=t,this._fireEditModeEvent(this._globalEditMode)},toggleGlobalEditMode:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.globalOptions;this.globalEditModeEnabled()?this.disableGlobalEditMode():this.enableGlobalEditMode(t)},handleLayerAdditionInGlobalEditMode:function(){var t=this,e=this._addedLayers;this._addedLayers=[],e.forEach((function(e){!e.pm||e._pmTempLayer||!t.globalEditModeEnabled()||e.pm.enable(v({},t.globalOptions))}))},_layerAdded:function(t){var e=t.layer;this._addedLayers.push(e)},_fireEditModeEvent:function(t){L.PM.Utils._fireEvent(this.map,"pm:globaleditmodetoggled",{enabled:t,map:this.map})}},M={enableGlobalDragMode:function(){var t=L.PM.Utils.findLayers(this.map);this._globalDragMode=!0,t.forEach((function(t){t.pm.enableLayerDrag()})),this.throttledReInitDrag||(this.throttledReInitDrag=L.Util.throttle(this.reinitGlobalDragMode,100,this)),this.map.on("layeradd",this.throttledReInitDrag,this),this.Toolbar.toggleButton("dragMode",this._globalDragMode),this._fireDragModeEvent(!0)},disableGlobalDragMode:function(){var t=L.PM.Utils.findLayers(this.map);this._globalDragMode=!1,t.forEach((function(t){t.pm.disableLayerDrag()})),this.map.off("layeradd",this.throttledReInitDrag,this),this.Toolbar.toggleButton("dragMode",this._globalDragMode),this._fireDragModeEvent(!1)},globalDragModeEnabled:function(){return!!this._globalDragMode},toggleGlobalDragMode:function(){this.globalDragModeEnabled()?this.disableGlobalDragMode():this.enableGlobalDragMode()},reinitGlobalDragMode:function(t){var e=t.layer;!e.pm||e._pmTempLayer||!this.globalDragModeEnabled()||(this.disableGlobalDragMode(),this.enableGlobalDragMode())},_fireDragModeEvent:function(t){L.PM.Utils._fireEvent(this.map,"pm:globaldragmodetoggled",{enabled:t,map:this.map})}},x={enableGlobalRemovalMode:function(){var t=this;this._globalRemovalMode=!0,this.map.eachLayer((function(e){t._isRelevant(e)&&(e.pm.disable(),e.on("click",t.removeLayer,t))})),this.throttledReInitRemoval||(this.throttledReInitRemoval=L.Util.throttle(this.reinitGlobalRemovalMode,100,this)),this.map.on("layeradd",this.throttledReInitRemoval,this),this.Toolbar.toggleButton("deleteLayer",this._globalRemovalMode),this._fireRemovalModeEvent(!0)},disableGlobalRemovalMode:function(){var t=this;this._globalRemovalMode=!1,this.map.eachLayer((function(e){e.off("click",t.removeLayer,t)})),this.map.off("layeradd",this.throttledReInitRemoval,this),this.Toolbar.toggleButton("deleteLayer",this._globalRemovalMode),this._fireRemovalModeEvent(!1)},globalRemovalEnabled:function(){return this.globalRemovalModeEnabled()},globalRemovalModeEnabled:function(){return!!this._globalRemovalMode},toggleGlobalRemovalMode:function(){this.globalRemovalModeEnabled()?this.disableGlobalRemovalMode():this.enableGlobalRemovalMode()},reinitGlobalRemovalMode:function(t){var e=t.layer;this._isRelevant(e)&&this.globalRemovalModeEnabled()&&(this.disableGlobalRemovalMode(),this.enableGlobalRemovalMode())},_fireRemovalModeEvent:function(t){L.PM.Utils._fireEvent(this.map,"pm:globalremovalmodetoggled",{enabled:t,map:this.map})},removeLayer:function(t){var e=t.target;this._isRelevant(e)&&!e.pm.dragging()&&(e.removeFrom(this.map.pm._getContainingLayer()),e.remove(),e instanceof L.LayerGroup?(L.PM.Utils._fireEvent(e,"pm:remove",{layer:e,shape:void 0}),L.PM.Utils._fireEvent(this.map,"pm:remove",{layer:e,shape:void 0})):(L.PM.Utils._fireEvent(e,"pm:remove",{layer:e,shape:e.pm.getShape()}),L.PM.Utils._fireEvent(this.map,"pm:remove",{layer:e,shape:e.pm.getShape()})))},_isRelevant:function(t){return t.pm&&!(t instanceof L.LayerGroup)&&(!L.PM.optIn&&!t.options.pmIgnore||L.PM.optIn&&!1===t.options.pmIgnore)&&!t._pmTempLayer}},w=L.Class.extend({includes:[k,M,x],initialize:function(t){this.map=t,this.Draw=new L.PM.Draw(t),this.Toolbar=new L.PM.Toolbar(t),this._globalRemovalMode=!1,this.globalOptions={snappable:!0,layerGroup:void 0,snappingOrder:["Marker","CircleMarker","Circle","Line","Polygon","Rectangle"],panes:{vertexPane:"markerPane",layerPane:"overlayPane",markerPane:"markerPane"}}},setLang:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"en",e=1<arguments.length?arguments[1]:void 0,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"en",i=L.PM.activeLang;e&&(_[t]=a()(_[r],e)),L.PM.activeLang=t,this.map.pm.Toolbar.reinit(),L.PM.Utils._fireEvent(this.map,"pm:langchange",{oldLang:i,activeLang:t,fallback:r,translations:_[t]})},addControls:function(t){this.Toolbar.addControls(t)},removeControls:function(){this.Toolbar.removeControls()},toggleControls:function(){this.Toolbar.toggleControls()},controlsVisible:function(){return this.Toolbar.isVisible},enableDraw:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"Polygon",e=1<arguments.length?arguments[1]:void 0;"Poly"===t&&(t="Polygon"),this.Draw.enable(t,e)},disableDraw:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"Polygon";"Poly"===t&&(t="Polygon"),this.Draw.disable(t)},setPathOptions:function(t){var e=this,r=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).ignoreShapes||[];this.map.pm.Draw.shapes.forEach((function(i){-1===r.indexOf(i)&&e.map.pm.Draw[i].setPathOptions(t)}))},getGlobalOptions:function(){return this.globalOptions},setGlobalOptions:function(t){var e=this,r=a()(this.globalOptions,t),i=!1;this.map.pm.Draw.CircleMarker.enabled()&&this.map.pm.Draw.CircleMarker.options.editable!==r.editable&&(this.map.pm.Draw.CircleMarker.disable(),i=!0),this.map.pm.Draw.shapes.forEach((function(t){e.map.pm.Draw[t].setOptions(r)})),i&&this.map.pm.Draw.CircleMarker.enable(),L.PM.Utils.findLayers(this.map).forEach((function(t){t.pm.setOptions(r)})),this.applyGlobalOptions(),this.globalOptions=r},applyGlobalOptions:function(){L.PM.Utils.findLayers(this.map).forEach((function(t){t.pm.enabled()&&t.pm.applyOptions()}))},globalDrawModeEnabled:function(){return!!this.Draw.getActiveShape()},globalCutModeEnabled:function(){return!!this.Draw.Cut.enabled()},enableGlobalCutMode:function(t){return this.Draw.Cut.enable(t)},toggleGlobalCutMode:function(t){return this.Draw.Cut.toggle(t)},disableGlobalCutMode:function(){return this.Draw.Cut.disable()},getGeomanLayers:function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],e=L.PM.Utils.findLayers(this.map);if(!t)return e;var r=L.featureGroup();return r._pmTempLayer=!0,e.forEach((function(t){r.addLayer(t)})),r},getGeomanDrawLayers:function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],e=L.PM.Utils.findLayers(this.map).filter((function(t){return!0===t._drawnByGeoman}));if(!t)return e;var r=L.featureGroup();return r._pmTempLayer=!0,e.forEach((function(t){r.addLayer(t)})),r},_getContainingLayer:function(){return this.globalOptions.layerGroup&&this.globalOptions.layerGroup instanceof L.LayerGroup?this.globalOptions.layerGroup:this.map}}),P=r(0),C=r.n(P),E=r(65),S=r.n(E);function B(t){var e=L.PM.activeLang;return S()(_,e)||(e="en"),C()(_[e],t)}function O(t){return!function t(e){return e.filter((function(t){return![null,"",void 0].includes(t)})).reduce((function(e,r){return e.concat(Array.isArray(r)?t(r):r)}),[])}(t).length}function R(t){return t.reduce((function(t,e){return 0!==e.length&&t.push(Array.isArray(e)?R(e):e),t}),[])}function D(t,e,r){for(var i,n,a,o=6378137,s=6356752.3142,l=1/298.257223563,h=t.lng,u=t.lat,c=r,p=Math.PI,f=e*p/180,d=Math.sin(f),g=Math.cos(f),m=(1-l)*Math.tan(u*p/180),_=1/Math.sqrt(1+m*m),y=m*_,v=Math.atan2(m,g),b=_*d,k=1-b*b,M=k*(o*o-s*s)/(s*s),x=1+M/16384*(4096+M*(M*(320-175*M)-768)),w=M/1024*(256+M*(M*(74-47*M)-128)),P=c/(s*x),C=2*Math.PI;1e-12<Math.abs(P-C);)i=Math.cos(2*v+P),C=P,P=c/(s*x)+w*(n=Math.sin(P))*(i+w/4*((a=Math.cos(P))*(2*i*i-1)-w/6*i*(4*n*n-3)*(4*i*i-3)));var E=y*n-_*a*g,S=Math.atan2(y*a+_*n*g,(1-l)*Math.sqrt(b*b+E*E)),B=l/16*k*(4+l*(4-3*k)),O=h+180*(Math.atan2(n*d,_*a-y*n*g)-(1-B)*l*b*(P+B*n*(i+B*a*(2*i*i-1))))/p,R=180*S/p;return L.latLng(O,R)}function T(t,e,r,i){for(var n,a,o=[],s=0;s<r;s+=1)n=D(t,360*s/r+i,e),a=L.latLng(n.lng,n.lat),o.push(a);return o}function I(t,e,r,i){return function(t,e,r){e=(e+360)%360;var i=Math.PI/180,n=180/Math.PI,a=t.lng*i,o=t.lat*i,s=e*i,l=Math.sin(o),h=Math.cos(o),u=Math.cos(r/6378137),c=Math.sin(r/6378137),p=Math.asin(l*u+h*c*Math.cos(s)),f=a+Math.atan2(Math.sin(s)*c*h,u-l*Math.sin(p));return f=180<(f*=n)?f-360:f<-180?f+360:f,L.latLng([p*n,f])}(e,function(t,e,r){var i=t.latLngToContainerPoint(e),n=t.latLngToContainerPoint(r),a=180*Math.atan2(n.y-i.y,n.x-i.x)/Math.PI+90;return a+(a<0?360:0)}(t,e,r),i)}var j=L.Control.extend({options:{position:"topleft"},initialize:function(t){this._button=Object.assign({},this.options,t)},onAdd:function(t){return this._map=t,this._map.pm.Toolbar.options.oneBlock?this._container=this._map.pm.Toolbar._createContainer(this.options.position):"edit"===this._button.tool?this._container=this._map.pm.Toolbar.editContainer:"options"===this._button.tool?this._container=this._map.pm.Toolbar.optionsContainer:"custom"===this._button.tool?this._container=this._map.pm.Toolbar.customContainer:this._container=this._map.pm.Toolbar.drawContainer,this.buttonsDomNode=this._makeButton(this._button),this._container.appendChild(this.buttonsDomNode),this._container},onRemove:function(){return this.buttonsDomNode.remove(),this._container},getText:function(){return this._button.text},getIconUrl:function(){return this._button.iconUrl},destroy:function(){this._button={},this._update()},toggle:function(t){return this._button.toggleStatus="boolean"==typeof t?t:!this._button.toggleStatus,this._applyStyleClasses(),this._button.toggleStatus},toggled:function(){return this._button.toggleStatus},onCreate:function(){this.toggle(!1)},_triggerClick:function(t){t&&t.preventDefault(),this._button.onClick(t,{button:this,event:t}),this._clicked(t),this._button.afterClick(t,{button:this,event:t})},_makeButton:function(t){var e=this,r=-1<this.options.position.indexOf("right")?"pos-right":"",i=L.DomUtil.create("div","button-container  ".concat(r),this._container),n=L.DomUtil.create("a","leaflet-buttons-control-button",i);n.setAttribute("role","button"),n.setAttribute("tabindex","0"),n.href="#";var a=L.DomUtil.create("div","leaflet-pm-actions-container ".concat(r),i),o=t.actions,s={cancel:{text:B("actions.cancel"),onClick:function(){this._triggerClick()}},finishMode:{text:B("actions.finish"),onClick:function(){this._triggerClick()}},removeLastVertex:{text:B("actions.removeLastVertex"),onClick:function(){this._map.pm.Draw[t.jsClass]._removeLastVertex()}},finish:{text:B("actions.finish"),onClick:function(e){this._map.pm.Draw[t.jsClass]._finishShape(e)}}};o.forEach((function(i){var n,o="string"==typeof i?i:i.name;if(s[o])n=s[o];else{if(!i.text)return;n=i}var l=L.DomUtil.create("a","leaflet-pm-action ".concat(r," action-").concat(o),a);if(l.setAttribute("role","button"),l.setAttribute("tabindex","0"),l.href="#",l.innerHTML=n.text,!t.disabled&&n.onClick){L.DomEvent.addListener(l,"click",(function(r){r.preventDefault();var i="",a=e._map.pm.Toolbar.buttons;for(var o in a)if(a[o]._button===t){i=o;break}L.PM.Utils._fireEvent(e._map,"pm:actionclick",{text:n.text,action:n,btnName:i,button:t})}),e),L.DomEvent.addListener(l,"click",n.onClick,e)}L.DomEvent.disableClickPropagation(l)})),t.toggleStatus&&L.DomUtil.addClass(i,"active");var l=L.DomUtil.create("div","control-icon",n);return t.title&&l.setAttribute("title",t.title),t.iconUrl&&l.setAttribute("src",t.iconUrl),t.className&&L.DomUtil.addClass(l,t.className),t.disabled||(L.DomEvent.addListener(n,"click",(function(){e._button.disableOtherButtons&&e._map.pm.Toolbar.triggerClickOnToggledButtons(e);var r="",i=e._map.pm.Toolbar.buttons;for(var n in i)if(i[n]._button===t){r=n;break}L.PM.Utils._fireEvent(e._map,"pm:buttonclick",{btnName:r,button:t})})),L.DomEvent.addListener(n,"click",this._triggerClick,this)),t.disabled&&(L.DomUtil.addClass(n,"pm-disabled"),L.DomUtil.addClass(l,"pm-disabled")),L.DomEvent.disableClickPropagation(n),i},_applyStyleClasses:function(){this._container&&(this._button.toggleStatus&&!1!==this._button.cssToggle?(L.DomUtil.addClass(this.buttonsDomNode,"active"),L.DomUtil.addClass(this._container,"activeChild")):(L.DomUtil.removeClass(this.buttonsDomNode,"active"),L.DomUtil.removeClass(this._container,"activeChild")))},_clicked:function(){this._button.doToggle&&this.toggle()}});function A(t){return(A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}L.Control.PMButton=j;var G=L.Class.extend({options:{drawMarker:!0,drawRectangle:!0,drawPolyline:!0,drawPolygon:!0,drawCircle:!0,drawCircleMarker:!0,editMode:!0,dragMode:!0,cutPolygon:!0,removalMode:!0,snappingOption:!0,drawControls:!0,editControls:!0,optionsControls:!0,customControls:!0,oneBlock:!1,position:"topleft",positions:{draw:"",edit:"",options:"",custom:""}},customButtons:[],initialize:function(t){this.init(t)},reinit:function(){var t=this.isVisible;this.removeControls(),this._defineButtons(),t&&this.addControls()},init:function(t){this.map=t,this.buttons={},this.isVisible=!1,this.drawContainer=L.DomUtil.create("div","leaflet-pm-toolbar leaflet-pm-draw leaflet-bar leaflet-control"),this.editContainer=L.DomUtil.create("div","leaflet-pm-toolbar leaflet-pm-edit leaflet-bar leaflet-control"),this.optionsContainer=L.DomUtil.create("div","leaflet-pm-toolbar leaflet-pm-options leaflet-bar leaflet-control"),this.customContainer=L.DomUtil.create("div","leaflet-pm-toolbar leaflet-pm-custom leaflet-bar leaflet-control"),this._defineButtons()},_createContainer:function(t){var e="".concat(t,"Container");return this[e]||(this[e]=L.DomUtil.create("div","leaflet-pm-toolbar leaflet-pm-".concat(t," leaflet-bar leaflet-control"))),this[e]},getButtons:function(){return this.buttons},addControls:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options;void 0!==t.editPolygon&&(t.editMode=t.editPolygon),void 0!==t.deleteLayer&&(t.removalMode=t.deleteLayer),L.Util.setOptions(this,t),this.applyIconStyle(),this._showHideButtons(),this.isVisible=!0},applyIconStyle:function(){var t=this.getButtons(),e={geomanIcons:{drawMarker:"control-icon leaflet-pm-icon-marker",drawPolyline:"control-icon leaflet-pm-icon-polyline",drawRectangle:"control-icon leaflet-pm-icon-rectangle",drawPolygon:"control-icon leaflet-pm-icon-polygon",drawCircle:"control-icon leaflet-pm-icon-circle",drawCircleMarker:"control-icon leaflet-pm-icon-circle-marker",editMode:"control-icon leaflet-pm-icon-edit",dragMode:"control-icon leaflet-pm-icon-drag",cutPolygon:"control-icon leaflet-pm-icon-cut",removalMode:"control-icon leaflet-pm-icon-delete"}};for(var r in t){var i=t[r];L.Util.setOptions(i,{className:e.geomanIcons[r]})}},removeControls:function(){var t=this.getButtons();for(var e in t)t[e].remove();this.isVisible=!1},toggleControls:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options;this.isVisible?this.removeControls():this.addControls(t)},_addButton:function(t,e){return this.buttons[t]=e,this.options[t]=this.options[t]||!1,this.buttons[t]},triggerClickOnToggledButtons:function(t){var e=["snappingOption"];for(var r in this.buttons)!e.includes(r)&&this.buttons[r]!==t&&this.buttons[r].toggled()&&this.buttons[r]._triggerClick()},toggleButton:function(t,e){return"editPolygon"===t&&(t="editMode"),"deleteLayer"===t&&(t="removalMode"),(!(2<arguments.length&&void 0!==arguments[2])||arguments[2])&&this.triggerClickOnToggledButtons(this.buttons[t]),!!this.buttons[t]&&this.buttons[t].toggle(e)},_defineButtons:function(){var t=this,e={className:"control-icon leaflet-pm-icon-marker",title:B("buttonTitles.drawMarkerButton"),jsClass:"Marker",onClick:function(){},afterClick:function(e,r){t.map.pm.Draw[r.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["cancel"]},r={title:B("buttonTitles.drawPolyButton"),className:"control-icon leaflet-pm-icon-polygon",jsClass:"Polygon",onClick:function(){},afterClick:function(e,r){t.map.pm.Draw[r.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["finish","removeLastVertex","cancel"]},i={className:"control-icon leaflet-pm-icon-polyline",title:B("buttonTitles.drawLineButton"),jsClass:"Line",onClick:function(){},afterClick:function(e,r){t.map.pm.Draw[r.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["finish","removeLastVertex","cancel"]},n={title:B("buttonTitles.drawCircleButton"),className:"control-icon leaflet-pm-icon-circle",jsClass:"Circle",onClick:function(){},afterClick:function(e,r){t.map.pm.Draw[r.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["cancel"]},a={title:B("buttonTitles.drawCircleMarkerButton"),className:"control-icon leaflet-pm-icon-circle-marker",jsClass:"CircleMarker",onClick:function(){},afterClick:function(e,r){t.map.pm.Draw[r.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["cancel"]},o={title:B("buttonTitles.drawRectButton"),className:"control-icon leaflet-pm-icon-rectangle",jsClass:"Rectangle",onClick:function(){},afterClick:function(e,r){t.map.pm.Draw[r.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["cancel"]},s={title:B("buttonTitles.editButton"),className:"control-icon leaflet-pm-icon-edit",onClick:function(){},afterClick:function(){t.map.pm.toggleGlobalEditMode()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,tool:"edit",actions:["finishMode"]},l={title:B("buttonTitles.dragButton"),className:"control-icon leaflet-pm-icon-drag",onClick:function(){},afterClick:function(){t.map.pm.toggleGlobalDragMode()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,tool:"edit",actions:["finishMode"]},h={title:B("buttonTitles.cutButton"),className:"control-icon leaflet-pm-icon-cut",jsClass:"Cut",onClick:function(){},afterClick:function(e,r){t.map.pm.Draw[r.button._button.jsClass].toggle({snappable:!0,cursorMarker:!0,allowSelfIntersection:!1})},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,tool:"edit",actions:["finish","removeLastVertex","cancel"]},u={title:B("buttonTitles.deleteButton"),className:"control-icon leaflet-pm-icon-delete",onClick:function(){},afterClick:function(){t.map.pm.toggleGlobalRemovalMode()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,tool:"edit",actions:["finishMode"]};this._addButton("drawMarker",new L.Control.PMButton(e)),this._addButton("drawPolyline",new L.Control.PMButton(i)),this._addButton("drawRectangle",new L.Control.PMButton(o)),this._addButton("drawPolygon",new L.Control.PMButton(r)),this._addButton("drawCircle",new L.Control.PMButton(n)),this._addButton("drawCircleMarker",new L.Control.PMButton(a)),this._addButton("editMode",new L.Control.PMButton(s)),this._addButton("dragMode",new L.Control.PMButton(l)),this._addButton("cutPolygon",new L.Control.PMButton(h)),this._addButton("removalMode",new L.Control.PMButton(u))},_showHideButtons:function(){this.removeControls();var t=this.getButtons(),e=[];for(var r in!1===this.options.drawControls&&(e=e.concat(Object.keys(t).filter((function(e){return!t[e]._button.tool})))),!1===this.options.editControls&&(e=e.concat(Object.keys(t).filter((function(e){return"edit"===t[e]._button.tool})))),!1===this.options.optionsControls&&(e=e.concat(Object.keys(t).filter((function(e){return"options"===t[e]._button.tool})))),!1===this.options.customControls&&(e=e.concat(Object.keys(t).filter((function(e){return"custom"===t[e]._button.tool})))),t)if(this.options[r]&&-1===e.indexOf(r)){var i=t[r]._button.tool;i=i||"draw",t[r].setPosition(this._getBtnPosition(i)),t[r].addTo(this.map)}},_getBtnPosition:function(t){return this.options.positions&&this.options.positions[t]?this.options.positions[t]:this.options.position},setBlockPosition:function(t,e){this.options.positions[t]=e,this._showHideButtons(),this.changeControlOrder()},getBlockPositions:function(){return this.options.positions},copyDrawControl:function(t,e){if(!e)throw new TypeError("Button has no name");"object"!==A(e)&&(e={name:e});var r=this._btnNameMapping(t);if(!e.name)throw new TypeError("Button has no name");if(this.buttons[e.name])throw new TypeError("Button with this name already exists");var i=this.map.pm.Draw.createNewDrawInstance(e.name,r),n=this.buttons[r]._button;return e=Object.assign({},n,e),{drawInstance:i,control:this.createCustomControl(e)}},createCustomControl:function(t){if(!t.name)throw new TypeError("Button has no name");if(this.buttons[t.name])throw new TypeError("Button with this name already exists");t.onClick||(t.onClick=function(){}),t.afterClick||(t.afterClick=function(){}),!1!==t.toggle&&(t.toggle=!0),t.block&&(t.block=t.block.toLowerCase()),t.block&&"draw"!==t.block||(t.block=""),t.className?-1===t.className.indexOf("control-icon")&&(t.className="control-icon ".concat(t.className)):t.className="control-icon";var e={tool:t.block,className:t.className,title:t.title||"",jsClass:t.name,onClick:t.onClick,afterClick:t.afterClick,doToggle:t.toggle,toggleStatus:!1,disableOtherButtons:!0,cssToggle:t.toggle,position:this.options.position,actions:t.actions||[],disabled:!!t.disabled};!1!==this.options[t.name]&&(this.options[t.name]=!0);var r=this._addButton(t.name,new L.Control.PMButton(e));return this.changeControlOrder(),r},changeControlOrder:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=this._shapeMapping(),r=[];t.forEach((function(t){e[t]?r.push(e[t]):r.push(t)}));var i=this.getButtons(),n={};r.forEach((function(t){i[t]&&(n[t]=i[t])})),Object.keys(i).filter((function(t){return!i[t]._button.tool})).forEach((function(t){-1===r.indexOf(t)&&(n[t]=i[t])})),Object.keys(i).filter((function(t){return"edit"===i[t]._button.tool})).forEach((function(t){-1===r.indexOf(t)&&(n[t]=i[t])})),Object.keys(i).filter((function(t){return"options"===i[t]._button.tool})).forEach((function(t){-1===r.indexOf(t)&&(n[t]=i[t])})),Object.keys(i).filter((function(t){return"custom"===i[t]._button.tool})).forEach((function(t){-1===r.indexOf(t)&&(n[t]=i[t])})),Object.keys(i).forEach((function(t){-1===r.indexOf(t)&&(n[t]=i[t])})),this.map.pm.Toolbar.buttons=n,this._showHideButtons()},getControlOrder:function(){var t=this.getButtons(),e=[];for(var r in t)e.push(r);return e},changeActionsOfControl:function(t,e){var r=this._btnNameMapping(t);if(!r)throw new TypeError("No name passed");if(!e)throw new TypeError("No actions passed");if(!this.buttons[r])throw new TypeError("Button with this name not exists");this.buttons[r]._button.actions=e,this.changeControlOrder()},setButtonDisabled:function(t,e){var r=this._btnNameMapping(t);this.buttons[r]._button.disabled=!!e,this._showHideButtons()},_shapeMapping:function(){return{Marker:"drawMarker",Circle:"drawCircle",Polygon:"drawPolygon",Rectangle:"drawRectangle",Polyline:"drawPolyline",Line:"drawPolyline",CircleMarker:"drawCircleMarker",Edit:"editMode",Drag:"dragMode",Cut:"cutPolygon",Removal:"removalMode"}},_btnNameMapping:function(t){var e=this._shapeMapping();return e[t]?e[t]:t}}),N={_initSnappableMarkers:function(){this.options.snapDistance=this.options.snapDistance||30,this.options.snapSegment=void 0===this.options.snapSegment||this.options.snapSegment,this._assignEvents(this._markers),this._layer.off("pm:dragstart",this._unsnap,this),this._layer.on("pm:dragstart",this._unsnap,this)},_disableSnapping:function(){this._layer.off("pm:dragstart",this._unsnap,this)},_assignEvents:function(t){var e=this;t.forEach((function(t){Array.isArray(t)?e._assignEvents(t):(t.off("drag",e._handleSnapping,e),t.on("drag",e._handleSnapping,e),t.off("dragend",e._cleanupSnapping,e),t.on("dragend",e._cleanupSnapping,e))}))},_cleanupSnapping:function(){delete this._snapList,this.throttledList&&(this._map.off("layeradd",this.throttledList,this),this.throttledList=void 0),this._map.off("pm:remove",this._handleSnapLayerRemoval,this),this.debugIndicatorLines&&this.debugIndicatorLines.forEach((function(t){t.remove()}))},_handleThrottleSnapping:function(){this.throttledList&&this._createSnapList()},_handleSnapping:function(t){var e=this,r=t.target;if(r._snapped=!1,this.throttledList||(this.throttledList=L.Util.throttle(this._handleThrottleSnapping,100,this)),t.originalEvent.altKey)return!1;if(void 0===this._snapList&&(this._createSnapList(),this._map.off("layeradd",this.throttledList,this),this._map.on("layeradd",this.throttledList,this)),this._snapList.length<=0)return!1;var i=this._calcClosestLayer(r.getLatLng(),this._snapList);if(0===Object.keys(i).length)return!1;var n,a=i.layer instanceof L.Marker||i.layer instanceof L.CircleMarker||!this.options.snapSegment;n=a?i.latlng:this._checkPrioritiySnapping(i);var o=this.options.snapDistance,s={marker:r,shape:this._shape,snapLatLng:n,segment:i.segment,layer:this._layer,workingLayer:this._layer,layerInteractedWith:i.layer,distance:i.distance};if(L.PM.Utils._fireEvent(s.marker,"pm:snapdrag",s),L.PM.Utils._fireEvent(this._layer,"pm:snapdrag",s),i.distance<o){r._orgLatLng=r.getLatLng(),r.setLatLng(n),r._snapped=!0,r._snapInfo=s;var l=this._snapLatLng||{},h=n||{};l.lat===h.lat&&l.lng===h.lng||(e._snapLatLng=n,L.PM.Utils._fireEvent(r,"pm:snap",s),L.PM.Utils._fireEvent(e._layer,"pm:snap",s))}else this._snapLatLng&&(this._unsnap(s),r._snapped=!1,L.PM.Utils._fireEvent(s.marker,"pm:unsnap",s),L.PM.Utils._fireEvent(this._layer,"pm:unsnap",s));return!0},_createSnapList:function(){var t=this,e=[],r=[],i=this._map;i.off("pm:remove",this._handleSnapLayerRemoval,this),i.on("pm:remove",this._handleSnapLayerRemoval,this),i.eachLayer((function(t){if((t instanceof L.Polyline||t instanceof L.Marker||t instanceof L.CircleMarker||t instanceof L.ImageOverlay)&&!0!==t.options.snapIgnore){if(void 0===t.options.snapIgnore&&(!L.PM.optIn&&!0===t.options.pmIgnore||L.PM.optIn&&!1!==t.options.pmIgnore))return;(t instanceof L.Circle||t instanceof L.CircleMarker)&&t.pm&&t.pm._hiddenPolyCircle?e.push(t.pm._hiddenPolyCircle):t instanceof L.ImageOverlay&&(t=L.rectangle(t.getBounds())),e.push(t);var i=L.polyline([],{color:"red",pmIgnore:!0});i._pmTempLayer=!0,r.push(i),(t instanceof L.Circle||t instanceof L.CircleMarker)&&r.push(i)}})),e=(e=(e=e.filter((function(e){return t._layer!==e}))).filter((function(t){return t._latlng||t._latlngs&&!O(t._latlngs)}))).filter((function(t){return!t._pmTempLayer})),this._otherSnapLayers?(this._otherSnapLayers.forEach((function(){var t=L.polyline([],{color:"red",pmIgnore:!0});t._pmTempLayer=!0,r.push(t)})),this._snapList=e.concat(this._otherSnapLayers)):this._snapList=e,this.debugIndicatorLines=r},_handleSnapLayerRemoval:function(t){var e=t.layer,r=this._snapList.findIndex((function(t){return t._leaflet_id===e._leaflet_id}));this._snapList.splice(r,1)},_calcClosestLayer:function(t,e){var r=this,i=[],n={};return e.forEach((function(e,a){if(!e._parentCopy||e._parentCopy!==r._layer){var o=r._calcLayerDistances(t,e);r.debugIndicatorLines[a]&&r.debugIndicatorLines[a].setLatLngs([t,o.latlng]),(void 0===n.distance||o.distance<=n.distance)&&(o.distance<n.distance&&(i=[]),(n=o).layer=e,i.push(n))}})),this._getClosestLayerByPriority(i)},_calcLayerDistances:function(t,e){var r,i,n,a=this,o=this._map,s=e instanceof L.Marker||e instanceof L.CircleMarker,l=e instanceof L.Polygon,h=t,u=s?e.getLatLng():e.getLatLngs();if(s)return{latlng:Object.assign({},u),distance:this._getDistance(o,u,h)};if(function t(e){e.forEach((function(s,u){if(Array.isArray(s))t(s);else if(a.options.snapSegment){var c,p=s;c=l?u+1===e.length?0:u+1:u+1===e.length?void 0:u+1;var f=e[c];if(f){var d=a._getDistanceToSegment(o,h,p,f);(void 0===i||d<i)&&(i=d,n=[p,f])}}else{var g=a._getDistance(o,h,s);(void 0===i||g<i)&&(i=g,r=s)}}))}(u),this.options.snapSegment){var c=this._getClosestPointOnSegment(o,t,n[0],n[1]);return{latlng:Object.assign({},c),segment:n,distance:i}}return{latlng:r,distance:i}},_getClosestLayerByPriority:function(t){t=t.sort((function(t,e){return t._leaflet_id-e._leaflet_id}));var e=this._map.pm.globalOptions.snappingOrder||[],r=0,i={};return e.concat(["Marker","CircleMarker","Circle","Line","Polygon","Rectangle"]).forEach((function(t){i[t]||(r+=1,i[t]=r)})),t.sort(function(t,e,r){var i=2<arguments.length&&void 0!==r?r:"asc";if(!e||0===Object.keys(e).length)return function(t,e){return t-e};for(var n,a=Object.keys(e),o=a.length,s={};o--;)n=a[o],s[n.toLowerCase()]=e[n];function l(t){return t instanceof L.Marker?"Marker":t instanceof L.Circle?"Circle":t instanceof L.CircleMarker?"CircleMarker":t instanceof L.Rectangle?"Rectangle":t instanceof L.Polygon?"Polygon":t instanceof L.Polyline?"Line":void 0}return function(e,r){var n,a;if("instanceofShape"===t){if(n=l(e.layer).toLowerCase(),a=l(r.layer).toLowerCase(),!n||!a)return 0}else{if(!e.hasOwnProperty(t)||!r.hasOwnProperty(t))return 0;n=e[t].toLowerCase(),a=r[t].toLowerCase()}var o=n in s?s[n]:Number.MAX_SAFE_INTEGER,h=a in s?s[a]:Number.MAX_SAFE_INTEGER,u=0;return o<h?u=-1:h<o&&(u=1),"desc"===i?-1*u:u}}("instanceofShape",i)),t[0]||{}},_checkPrioritiySnapping:function(t){var e,r=this._map,i=t.segment[0],n=t.segment[1],a=t.latlng,o=this._getDistance(r,i,a),s=this._getDistance(r,n,a),l=o<s?i:n,h=o<s?o:s;if(this.options.snapMiddle){var u=L.PM.Utils.calcMiddleLatLng(r,i,n),c=this._getDistance(r,u,a);c<o&&c<s&&(l=u,h=c)}return e=h<this.options.snapDistance?l:a,Object.assign({},e)},_unsnap:function(){delete this._snapLatLng},_getClosestPointOnSegment:function(t,e,r,i){var n=t.getMaxZoom();n===1/0&&(n=t.getZoom());var a=t.project(e,n),o=t.project(r,n),s=t.project(i,n),l=L.LineUtil.closestPointOnSegment(a,o,s);return t.unproject(l,n)},_getDistanceToSegment:function(t,e,r,i){var n=t.latLngToLayerPoint(e),a=t.latLngToLayerPoint(r),o=t.latLngToLayerPoint(i);return L.LineUtil.pointToSegmentDistance(n,a,o)},_getDistance:function(t,e,r){return t.latLngToLayerPoint(e).distanceTo(t.latLngToLayerPoint(r))}},U=L.Class.extend({includes:[N],options:{snappable:!0,snapDistance:20,snapMiddle:!1,allowSelfIntersection:!0,tooltips:!0,templineStyle:{},hintlineStyle:{color:"#3388ff",dashArray:"5,5"},pathOptions:null,cursorMarker:!0,finishOn:null,markerStyle:{draggable:!0,icon:L.icon()},hideMiddleMarkers:!1,minRadiusCircle:null,maxRadiusCircle:null,minRadiusCircleMarker:null,maxRadiusCircleMarker:null,editable:!1,markerEditable:!0,continueDrawing:!1},setOptions:function(t){L.Util.setOptions(this,t)},initialize:function(t){var e=this,r=new L.Icon.Default;r.options.tooltipAnchor=[0,0],this.options.markerStyle.icon=r,this._map=t,this.shapes=["Marker","CircleMarker","Line","Polygon","Rectangle","Circle","Cut"],this.shapes.forEach((function(t){e[t]=new L.PM.Draw[t](e._map)})),this.Marker.setOptions({continueDrawing:!0}),this.CircleMarker.setOptions({continueDrawing:!0})},setPathOptions:function(t){this.options.pathOptions=t},getShapes:function(){return this.shapes},enable:function(t,e){if(!t)throw new Error("Error: Please pass a shape as a parameter. Possible shapes are: ".concat(this.getShapes().join(",")));this.disable(),this[t].enable(e)},disable:function(){var t=this;this.shapes.forEach((function(e){t[e].disable()}))},addControls:function(){var t=this;this.shapes.forEach((function(e){t[e].addButton()}))},getActiveShape:function(){var t,e=this;return this.shapes.forEach((function(r){e[r]._enabled&&(t=r)})),t},_setGlobalDrawMode:function(){"Cut"===this._shape?L.PM.Utils._fireEvent(this._map,"pm:globalcutmodetoggled",{enabled:!!this._enabled,map:this._map}):L.PM.Utils._fireEvent(this._map,"pm:globaldrawmodetoggled",{enabled:this._enabled,shape:this._shape,map:this._map});var t=L.PM.Utils.findLayers(this._map);this._enabled?t.forEach((function(t){L.PM.Utils.disablePopup(t)})):t.forEach((function(t){L.PM.Utils.enablePopup(t)}))},createNewDrawInstance:function(t,e){var r=this._getShapeFromBtnName(e);if(this[t])throw new TypeError("Draw Type already exists");if(!L.PM.Draw[r])throw new TypeError("There is no class L.PM.Draw.".concat(r));return this[t]=new L.PM.Draw[r](this._map),this[t].toolbarButtonName=t,this[t]._shape=t,this.shapes.push(t),this[e]&&this[t].setOptions(this[e].options),this[t].setOptions(this[t].options),this[t]},_getShapeFromBtnName:function(t){var e={drawMarker:"Marker",drawCircle:"Circle",drawPolygon:"Polygon",drawPolyline:"Line",drawRectangle:"Rectangle",drawCircleMarker:"CircleMarker",editMode:"Edit",dragMode:"Drag",cutPolygon:"Cut",removalMode:"Removal"};return e[t]?e[t]:this[t]?this[t]._shape:t},_finishLayer:function(t){t.pm&&(t.pm.setOptions(this.options),t.pm._shape=this._shape),this._addDrawnLayerProp(t)},_addDrawnLayerProp:function(t){t._drawnByGeoman=!0},_setPane:function(t,e){"layerPane"===e?t.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.layerPane||"overlayPane":"vertexPane"===e?t.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.vertexPane||"markerPane":"markerPane"===e&&(t.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.markerPane||"markerPane")},_isFirstLayer:function(){return 0===(this._map||this._layer._map).pm.getGeomanLayers().length}});U.Marker=U.extend({initialize:function(t){this._map=t,this._shape="Marker",this.toolbarButtonName="drawMarker"},enable:function(t){var e=this;L.Util.setOptions(this,t),this._enabled=!0,this._map.on("click",this._createMarker,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!0),this._hintMarker=L.marker([0,0],this.options.markerStyle),this._setPane(this._hintMarker,"markerPane"),this._hintMarker._pmTempLayer=!0,this._hintMarker.addTo(this._map),this.options.tooltips&&this._hintMarker.bindTooltip(B("tooltips.placeMarker"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip(),this._layer=this._hintMarker,this._map.on("mousemove",this._syncHintMarker,this),this.options.markerEditable&&this._map.eachLayer((function(t){e.isRelevantMarker(t)&&t.pm.enable()})),L.PM.Utils._fireEvent(this._map,"pm:drawstart",{shape:this._shape,workingLayer:this._layer}),this._setGlobalDrawMode()},disable:function(){var t=this;this._enabled&&(this._enabled=!1,this._map.off("click",this._createMarker,this),this._hintMarker.remove(),this._map.off("mousemove",this._syncHintMarker,this),this._map.eachLayer((function(e){t.isRelevantMarker(e)&&e.pm.disable()})),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!1),this.options.snappable&&this._cleanupSnapping(),L.PM.Utils._fireEvent(this._map,"pm:drawend",{shape:this._shape}),this._setGlobalDrawMode())},enabled:function(){return this._enabled},toggle:function(t){this.enabled()?this.disable():this.enable(t)},isRelevantMarker:function(t){return t instanceof L.Marker&&t.pm&&!t._pmTempLayer},_syncHintMarker:function(t){if(this._hintMarker.setLatLng(t.latlng),this.options.snappable){var e=t;e.target=this._hintMarker,this._handleSnapping(e)}},_createMarker:function(t){if(t.latlng&&(!this.options.requireSnapToFinish||this._hintMarker._snapped||this._isFirstLayer())){this._hintMarker._snapped||this._hintMarker.setLatLng(t.latlng);var e=this._hintMarker.getLatLng(),r=new L.Marker(e,this.options.markerStyle);this._setPane(r,"markerPane"),this._finishLayer(r),r.addTo(this._map.pm._getContainingLayer()),r.pm||(r.options.draggable=!1),r.addTo(this._map.pm._getContainingLayer()),r.pm&&this.options.markerEditable?r.pm.enable():r.dragging&&r.dragging.disable(),L.PM.Utils._fireEvent(this._map,"pm:create",{shape:this._shape,marker:r,layer:r}),this._cleanupSnapping(),this.options.continueDrawing||this.disable()}}});var z=r(7),F=r.n(z);U.Line=U.extend({initialize:function(t){this._map=t,this._shape="Line",this.toolbarButtonName="drawPolyline",this._doesSelfIntersect=!1},enable:function(t){L.Util.setOptions(this,t),this._enabled=!0,this._layerGroup=new L.LayerGroup,this._layerGroup._pmTempLayer=!0,this._layerGroup.addTo(this._map),this._layer=L.polyline([],this.options.templineStyle),this._setPane(this._layer,"layerPane"),this._layer._pmTempLayer=!0,this._layerGroup.addLayer(this._layer),this._hintline=L.polyline([],this.options.hintlineStyle),this._setPane(this._hintline,"layerPane"),this._hintline._pmTempLayer=!0,this._layerGroup.addLayer(this._hintline),this._hintMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"marker-icon cursor-marker"})}),this._setPane(this._hintMarker,"vertexPane"),this._hintMarker._pmTempLayer=!0,this._layerGroup.addLayer(this._hintMarker),this.options.cursorMarker&&L.DomUtil.addClass(this._hintMarker._icon,"visible"),this.options.tooltips&&this._hintMarker.bindTooltip(B("tooltips.firstVertex"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip(),this._map._container.style.cursor="crosshair",this._map.on("click",this._createVertex,this),this.options.finishOn&&"snap"!==this.options.finishOn&&this._map.on(this.options.finishOn,this._finishShape,this),"dblclick"===this.options.finishOn&&(this.tempMapDoubleClickZoomState=this._map.doubleClickZoom._enabled,this.tempMapDoubleClickZoomState&&this._map.doubleClickZoom.disable()),this._map.on("mousemove",this._syncHintMarker,this),this._hintMarker.on("move",this._syncHintLine,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!0),this._otherSnapLayers=[],L.PM.Utils._fireEvent(this._map,"pm:drawstart",{shape:this._shape,workingLayer:this._layer}),this._setGlobalDrawMode()},disable:function(){this._enabled&&(this._enabled=!1,this._map._container.style.cursor="",this._map.off("click",this._createVertex,this),this._map.off("mousemove",this._syncHintMarker,this),this.options.finishOn&&"snap"!==this.options.finishOn&&this._map.off(this.options.finishOn,this._finishShape,this),this.tempMapDoubleClickZoomState&&this._map.doubleClickZoom.enable(),this._map.removeLayer(this._layerGroup),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!1),this.options.snappable&&this._cleanupSnapping(),L.PM.Utils._fireEvent(this._map,"pm:drawend",{shape:this._shape}),this._setGlobalDrawMode())},enabled:function(){return this._enabled},toggle:function(t){this.enabled()?this.disable():this.enable(t)},_syncHintLine:function(){var t=this._layer.getLatLngs();if(0<t.length){var e=t[t.length-1];this._hintline.setLatLngs([e,this._hintMarker.getLatLng()])}},_syncHintMarker:function(t){if(this._hintMarker.setLatLng(t.latlng),this.options.snappable){var e=t;e.target=this._hintMarker,this._handleSnapping(e)}this.options.allowSelfIntersection||this._handleSelfIntersection(!0,t.latlng)},hasSelfIntersection:function(){return 0<F()(this._layer.toGeoJSON(15)).features.length},_handleSelfIntersection:function(t,e){var r=L.polyline(this._layer.getLatLngs());t&&(e=e||this._hintMarker.getLatLng(),r.addLatLng(e));var i=F()(r.toGeoJSON(15));this._doesSelfIntersect=0<i.features.length,this._doesSelfIntersect?this._hintline.setStyle({color:"#f00000ff"}):this._hintline.isEmpty()||this._hintline.setStyle(this.options.hintlineStyle)},_createVertex:function(t){if(this.options.allowSelfIntersection||(this._handleSelfIntersection(!0,t.latlng),!this._doesSelfIntersect)){this._hintMarker._snapped||this._hintMarker.setLatLng(t.latlng);var e=this._hintMarker.getLatLng();if(e.equals(this._layer.getLatLngs()[0]))this._finishShape(t);else{this._layer._latlngInfo=this._layer._latlngInfo||[],this._layer._latlngInfo.push({latlng:e,snapInfo:this._hintMarker._snapInfo}),this._layer.addLatLng(e);var r=this._createMarker(e);this._setTooltipText(),this._hintline.setLatLngs([e,e]),L.PM.Utils._fireEvent(this._layer,"pm:vertexadded",{shape:this._shape,workingLayer:this._layer,marker:r,latlng:e}),"snap"===this.options.finishOn&&this._hintMarker._snapped&&this._finishShape(t)}}},_removeLastVertex:function(){var t=this._layer.getLatLngs(),e=t.pop();if(t.length<1)this.disable();else{var r=this._layerGroup.getLayers().filter((function(t){return t instanceof L.Marker})).filter((function(t){return!L.DomUtil.hasClass(t._icon,"cursor-marker")})).find((function(t){return t.getLatLng()===e}));this._layerGroup.removeLayer(r),this._layer.setLatLngs(t),this._syncHintLine(),this._setTooltipText()}},_finishShape:function(){if((this.options.allowSelfIntersection||(this._handleSelfIntersection(!1),!this._doesSelfIntersect))&&(!this.options.requireSnapToFinish||this._hintMarker._snapped||this._isFirstLayer())){var t=this._layer.getLatLngs();if(!(t.length<=1)){var e=L.polyline(t,this.options.pathOptions);this._setPane(e,"layerPane"),this._finishLayer(e),e.addTo(this._map.pm._getContainingLayer()),L.PM.Utils._fireEvent(this._map,"pm:create",{shape:this._shape,layer:e}),this.options.snappable&&this._cleanupSnapping(),this.disable(),this.options.continueDrawing&&this.enable()}}},_createMarker:function(t){var e=new L.Marker(t,{draggable:!1,icon:L.divIcon({className:"marker-icon"})});return this._setPane(e,"vertexPane"),e._pmTempLayer=!0,this._layerGroup.addLayer(e),e.on("click",this._finishShape,this),e},_setTooltipText:function(){var t;t=B(this._layer.getLatLngs().flat().length<=1?"tooltips.continueLine":"tooltips.finishLine"),this._hintMarker.setTooltipContent(t)}}),U.Polygon=U.Line.extend({initialize:function(t){this._map=t,this._shape="Polygon",this.toolbarButtonName="drawPolygon"},_createMarker:function(t){var e=new L.Marker(t,{draggable:!1,icon:L.divIcon({className:"marker-icon"})});return this._setPane(e,"vertexPane"),e._pmTempLayer=!0,this._layerGroup.addLayer(e),1===this._layer.getLatLngs().flat().length?(e.on("click",this._finishShape,this),this._tempSnapLayerIndex=this._otherSnapLayers.push(e)-1,this.options.snappable&&this._cleanupSnapping()):e.on("click",(function(){return 1})),e},_setTooltipText:function(){var t;t=B(this._layer.getLatLngs().flat().length<=2?"tooltips.continueLine":"tooltips.finishPoly"),this._hintMarker.setTooltipContent(t)},_finishShape:function(t){if((this.options.allowSelfIntersection||(this._handleSelfIntersection(!0,this._layer.getLatLngs()[0]),!this._doesSelfIntersect))&&(!this.options.requireSnapToFinish||this._hintMarker._snapped||this._isFirstLayer())){var e=this._layer.getLatLngs();if(!(e.length<=2)){var r=L.polygon(e,this.options.pathOptions);this._setPane(r,"layerPane"),this._finishLayer(r),r.addTo(this._map.pm._getContainingLayer()),L.PM.Utils._fireEvent(this._map,"pm:create",{shape:this._shape,layer:r}),this._cleanupSnapping(),this._otherSnapLayers.splice(this._tempSnapLayerIndex,1),delete this._tempSnapLayerIndex,this.disable(),this.options.continueDrawing&&this.enable()}}}}),U.Rectangle=U.extend({initialize:function(t){this._map=t,this._shape="Rectangle",this.toolbarButtonName="drawRectangle"},enable:function(t){if(L.Util.setOptions(this,t),this._enabled=!0,this._layerGroup=new L.LayerGroup,this._layerGroup._pmTempLayer=!0,this._layerGroup.addTo(this._map),this._layer=L.rectangle([[0,0],[0,0]],this.options.pathOptions),this._setPane(this._layer,"layerPane"),this._layer._pmTempLayer=!0,this._startMarker=L.marker([0,0],{icon:L.divIcon({className:"marker-icon rect-start-marker"}),draggable:!1,zIndexOffset:100,opacity:this.options.cursorMarker?1:0}),this._setPane(this._startMarker,"vertexPane"),this._startMarker._pmTempLayer=!0,this._layerGroup.addLayer(this._startMarker),this._hintMarker=L.marker([0,0],{icon:L.divIcon({className:"marker-icon cursor-marker"})}),this._setPane(this._hintMarker,"vertexPane"),this._hintMarker._pmTempLayer=!0,this._layerGroup.addLayer(this._hintMarker),this.options.tooltips&&this._hintMarker.bindTooltip(B("tooltips.firstVertex"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip(),this.options.cursorMarker){L.DomUtil.addClass(this._hintMarker._icon,"visible"),this._styleMarkers=[];for(var e=0;e<2;e+=1){var r=L.marker([0,0],{icon:L.divIcon({className:"marker-icon rect-style-marker"}),draggable:!1,zIndexOffset:100});this._setPane(r,"vertexPane"),r._pmTempLayer=!0,this._layerGroup.addLayer(r),this._styleMarkers.push(r)}}this._map._container.style.cursor="crosshair",this._map.on("click",this._placeStartingMarkers,this),this._map.on("mousemove",this._syncHintMarker,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!0),this._otherSnapLayers=[],L.PM.Utils._fireEvent(this._map,"pm:drawstart",{shape:this._shape,workingLayer:this._layer}),this._setGlobalDrawMode()},disable:function(){this._enabled&&(this._enabled=!1,this._map._container.style.cursor="",this._map.off("click",this._finishShape,this),this._map.off("click",this._placeStartingMarkers,this),this._map.off("mousemove",this._syncHintMarker,this),this._map.removeLayer(this._layerGroup),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!1),this.options.snappable&&this._cleanupSnapping(),L.PM.Utils._fireEvent(this._map,"pm:drawend",{shape:this._shape}),this._setGlobalDrawMode())},enabled:function(){return this._enabled},toggle:function(t){this.enabled()?this.disable():this.enable(t)},_placeStartingMarkers:function(t){this._hintMarker._snapped||this._hintMarker.setLatLng(t.latlng);var e=this._hintMarker.getLatLng();L.DomUtil.addClass(this._startMarker._icon,"visible"),this._startMarker.setLatLng(e),this.options.cursorMarker&&this._styleMarkers&&this._styleMarkers.forEach((function(t){L.DomUtil.addClass(t._icon,"visible"),t.setLatLng(e)})),this._map.off("click",this._placeStartingMarkers,this),this._map.on("click",this._finishShape,this),this._hintMarker.setTooltipContent(B("tooltips.finishRect")),this._setRectangleOrigin()},_setRectangleOrigin:function(){var t=this._startMarker.getLatLng();t&&(this._layerGroup.addLayer(this._layer),this._layer.setLatLngs([t,t]),this._hintMarker.on("move",this._syncRectangleSize,this))},_syncHintMarker:function(t){if(this._hintMarker.setLatLng(t.latlng),this.options.snappable){var e=t;e.target=this._hintMarker,this._handleSnapping(e)}},_syncRectangleSize:function(){var t=this,e=this._startMarker.getLatLng(),r=this._hintMarker.getLatLng();if(this._layer.setBounds([e,r]),this.options.cursorMarker&&this._styleMarkers){var i=this._findCorners(),n=[];i.forEach((function(e){e.equals(t._startMarker.getLatLng())||e.equals(t._hintMarker.getLatLng())||n.push(e)})),n.forEach((function(e,r){t._styleMarkers[r].setLatLng(e)}))}},_findCorners:function(){var t=this._layer.getBounds();return[t.getNorthWest(),t.getNorthEast(),t.getSouthEast(),t.getSouthWest()]},_finishShape:function(t){this._hintMarker._snapped||this._hintMarker.setLatLng(t.latlng);var e=this._hintMarker.getLatLng(),r=this._startMarker.getLatLng();if(!this.options.requireSnapToFinish||this._hintMarker._snapped||this._isFirstLayer()){var i=L.rectangle([r,e],this.options.pathOptions);this._setPane(i,"layerPane"),this._finishLayer(i),i.addTo(this._map.pm._getContainingLayer()),L.PM.Utils._fireEvent(this._map,"pm:create",{shape:this._shape,layer:i}),this.disable(),this.options.continueDrawing&&this.enable()}}}),U.Circle=U.extend({initialize:function(t){this._map=t,this._shape="Circle",this.toolbarButtonName="drawCircle"},enable:function(t){L.Util.setOptions(this,t),this.options.radius=0,this._enabled=!0,this._layerGroup=new L.LayerGroup,this._layerGroup._pmTempLayer=!0,this._layerGroup.addTo(this._map),this._layer=L.circle([0,0],this.options.templineStyle),this._setPane(this._layer,"layerPane"),this._layer._pmTempLayer=!0,this._layerGroup.addLayer(this._layer),this._centerMarker=L.marker([0,0],{icon:L.divIcon({className:"marker-icon"}),draggable:!1,zIndexOffset:100}),this._setPane(this._centerMarker,"vertexPane"),this._centerMarker._pmTempLayer=!0,this._layerGroup.addLayer(this._centerMarker),this._hintMarker=L.marker([0,0],{icon:L.divIcon({className:"marker-icon cursor-marker"})}),this._setPane(this._hintMarker,"vertexPane"),this._hintMarker._pmTempLayer=!0,this._layerGroup.addLayer(this._hintMarker),this.options.cursorMarker&&L.DomUtil.addClass(this._hintMarker._icon,"visible"),this.options.tooltips&&this._hintMarker.bindTooltip(B("tooltips.startCircle"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip(),this._hintline=L.polyline([],this.options.hintlineStyle),this._setPane(this._hintline,"layerPane"),this._hintline._pmTempLayer=!0,this._layerGroup.addLayer(this._hintline),this._map._container.style.cursor="crosshair",this._map.on("click",this._placeCenterMarker,this),this._map.on("mousemove",this._syncHintMarker,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!0),this._otherSnapLayers=[],L.PM.Utils._fireEvent(this._map,"pm:drawstart",{shape:this._shape,workingLayer:this._layer}),this._setGlobalDrawMode()},disable:function(){this._enabled&&(this._enabled=!1,this._map._container.style.cursor="",this._map.off("click",this._finishShape,this),this._map.off("click",this._placeCenterMarker,this),this._map.off("mousemove",this._syncHintMarker,this),this._map.removeLayer(this._layerGroup),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!1),this.options.snappable&&this._cleanupSnapping(),L.PM.Utils._fireEvent(this._map,"pm:drawend",{shape:this._shape}),this._setGlobalDrawMode())},enabled:function(){return this._enabled},toggle:function(t){this.enabled()?this.disable():this.enable(t)},_syncHintLine:function(){var t=this._centerMarker.getLatLng(),e=this._getNewDestinationOfHintMarker();this._hintline.setLatLngs([t,e])},_syncCircleRadius:function(){var t,e=this._centerMarker.getLatLng(),r=this._hintMarker.getLatLng();t=this._map.options.crs===L.CRS.Simple?this._map.distance(e,r):e.distanceTo(r),this.options.minRadiusCircle&&t<this.options.minRadiusCircle?this._layer.setRadius(this.options.minRadiusCircle):this.options.maxRadiusCircle&&t>this.options.maxRadiusCircle?this._layer.setRadius(this.options.maxRadiusCircle):this._layer.setRadius(t)},_syncHintMarker:function(t){if(this._hintMarker.setLatLng(t.latlng),this._hintMarker.setLatLng(this._getNewDestinationOfHintMarker()),this.options.snappable){var e=t;e.target=this._hintMarker,this._handleSnapping(e)}this._handleHintMarkerSnapping()},_placeCenterMarker:function(t){this._hintMarker._snapped||this._hintMarker.setLatLng(t.latlng);var e=this._hintMarker.getLatLng();this._centerMarker.setLatLng(e),this._map.off("click",this._placeCenterMarker,this),this._map.on("click",this._finishShape,this),this._placeCircleCenter()},_placeCircleCenter:function(){var t=this._centerMarker.getLatLng();t&&(this._layer.setLatLng(t),this._hintMarker.on("move",this._syncHintLine,this),this._hintMarker.on("move",this._syncCircleRadius,this),this._hintMarker.setTooltipContent(B("tooltips.finishCircle")),L.PM.Utils._fireEvent(this._layer,"pm:centerplaced",{workingLayer:this._layer,latlng:t,shape:this._shape}))},_finishShape:function(t){if(!this.options.requireSnapToFinish||this._hintMarker._snapped||this._isFirstLayer()){this._hintMarker._snapped||this._hintMarker.setLatLng(t.latlng);var e,r=this._centerMarker.getLatLng(),i=this._hintMarker.getLatLng();e=this._map.options.crs===L.CRS.Simple?this._map.distance(r,i):r.distanceTo(i),this.options.minRadiusCircle&&e<this.options.minRadiusCircle?e=this.options.minRadiusCircle:this.options.maxRadiusCircle&&e>this.options.maxRadiusCircle&&(e=this.options.maxRadiusCircle);var n=Object.assign({},this.options.pathOptions,{radius:e}),a=L.circle(r,n);this._setPane(a,"layerPane"),this._finishLayer(a),a.addTo(this._map.pm._getContainingLayer()),a.pm&&a.pm._updateHiddenPolyCircle(),L.PM.Utils._fireEvent(this._map,"pm:create",{shape:this._shape,layer:a}),this.disable(),this.options.continueDrawing&&this.enable()}},_getNewDestinationOfHintMarker:function(){var t=this._centerMarker.getLatLng(),e=this._hintMarker.getLatLng(),r=t.distanceTo(e);return this.options.minRadiusCircle&&r<this.options.minRadiusCircle?e=I(this._map,t,e,this.options.minRadiusCircle):this.options.maxRadiusCircle&&r>this.options.maxRadiusCircle&&(e=I(this._map,t,e,this.options.maxRadiusCircle)),e},_handleHintMarkerSnapping:function(){if(this._hintMarker._snapped){var t=this._centerMarker.getLatLng(),e=this._hintMarker.getLatLng(),r=t.distanceTo(e);(this.options.minRadiusCircle&&r<this.options.minRadiusCircle||this.options.maxRadiusCircle&&r>this.options.maxRadiusCircle)&&this._hintMarker.setLatLng(this._hintMarker._orgLatLng)}this._hintMarker.setLatLng(this._getNewDestinationOfHintMarker())}}),U.CircleMarker=U.Marker.extend({initialize:function(t){this._map=t,this._shape="CircleMarker",this.toolbarButtonName="drawCircleMarker",this._layerIsDragging=!1},enable:function(t){var e=this;L.Util.setOptions(this,t),this._enabled=!0,this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!0),this.options.editable?(this._layerGroup=new L.LayerGroup,this._layerGroup._pmTempLayer=!0,this._layerGroup.addTo(this._map),this._layer=L.circleMarker([0,0],this.options.templineStyle),this._setPane(this._layer,"layerPane"),this._layer._pmTempLayer=!0,this._layerGroup.addLayer(this._layer),this._centerMarker=L.marker([0,0],{icon:L.divIcon({className:"marker-icon"}),draggable:!1,zIndexOffset:100}),this._setPane(this._centerMarker,"vertexPane"),this._centerMarker._pmTempLayer=!0,this._layerGroup.addLayer(this._centerMarker),this._hintMarker=L.marker([0,0],{icon:L.divIcon({className:"marker-icon cursor-marker"})}),this._setPane(this._hintMarker,"vertexPane"),this._hintMarker._pmTempLayer=!0,this._layerGroup.addLayer(this._hintMarker),this.options.cursorMarker&&L.DomUtil.addClass(this._hintMarker._icon,"visible"),this.options.tooltips&&this._hintMarker.bindTooltip(B("tooltips.startCircle"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip(),this._hintline=L.polyline([],this.options.hintlineStyle),this._setPane(this._hintline,"layerPane"),this._hintline._pmTempLayer=!0,this._layerGroup.addLayer(this._hintline),this._map.on("click",this._placeCenterMarker,this),this._map._container.style.cursor="crosshair"):(this._map.on("click",this._createMarker,this),this._hintMarker=L.circleMarker([0,0],this.options.templineStyle),this._setPane(this._hintMarker,"layerPane"),this._hintMarker._pmTempLayer=!0,this._hintMarker.addTo(this._map),this._layer=this._hintMarker,this.options.tooltips&&this._hintMarker.bindTooltip(B("tooltips.placeCircleMarker"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip()),this._map.on("mousemove",this._syncHintMarker,this),!this.options.editable&&this.options.markerEditable&&this._map.eachLayer((function(t){e.isRelevantMarker(t)&&t.pm.enable()})),this._layer.bringToBack(),L.PM.Utils._fireEvent(this._map,"pm:drawstart",{shape:this._shape,workingLayer:this._layer}),this._setGlobalDrawMode()},disable:function(){var t=this;this._enabled&&(this._enabled=!1,this.options.editable?(this._map._container.style.cursor="",this._map.off("click",this._finishShape,this),this._map.off("click",this._placeCenterMarker,this),this._map.removeLayer(this._layerGroup)):(this._map.off("click",this._createMarker,this),this._map.eachLayer((function(e){t.isRelevantMarker(e)&&e.pm.disable()})),this._hintMarker.remove()),this._map.off("mousemove",this._syncHintMarker,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!1),this.options.snappable&&this._cleanupSnapping(),L.PM.Utils._fireEvent(this._map,"pm:drawend",{shape:this._shape}),this._setGlobalDrawMode())},_placeCenterMarker:function(t){this._hintMarker._snapped||this._hintMarker.setLatLng(t.latlng);var e=this._hintMarker.getLatLng();this._centerMarker.setLatLng(e),this._map.off("click",this._placeCenterMarker,this),this._map.on("click",this._finishShape,this),this._placeCircleCenter()},_placeCircleCenter:function(){var t=this._centerMarker.getLatLng();t&&(this._layer.setLatLng(t),this._hintMarker.on("move",this._syncHintLine,this),this._hintMarker.on("move",this._syncCircleRadius,this),this._hintMarker.setTooltipContent(B("tooltips.finishCircle")),L.PM.Utils._fireEvent(this._layer,"pm:centerplaced",{shape:this._shape,workingLayer:this._layer,latlng:t}))},_syncHintLine:function(){var t=this._centerMarker.getLatLng(),e=this._getNewDestinationOfHintMarker();this._hintline.setLatLngs([t,e])},_syncCircleRadius:function(){var t=this._centerMarker.getLatLng(),e=this._hintMarker.getLatLng(),r=this._map.project(t).distanceTo(this._map.project(e));this.options.minRadiusCircleMarker&&r<this.options.minRadiusCircleMarker?this._layer.setRadius(this.options.minRadiusCircleMarker):this.options.maxRadiusCircleMarker&&r>this.options.maxRadiusCircleMarker?this._layer.setRadius(this.options.maxRadiusCircleMarker):this._layer.setRadius(r)},_syncHintMarker:function(t){if(this._hintMarker.setLatLng(t.latlng),this._hintMarker.setLatLng(this._getNewDestinationOfHintMarker()),this.options.snappable){var e=t;e.target=this._hintMarker,this._handleSnapping(e)}this._handleHintMarkerSnapping()},isRelevantMarker:function(t){return t instanceof L.CircleMarker&&!(t instanceof L.Circle)&&t.pm&&!t._pmTempLayer},_createMarker:function(t){if((!this.options.requireSnapToFinish||this._hintMarker._snapped||this._isFirstLayer())&&t.latlng&&!this._layerIsDragging){this._hintMarker._snapped||this._hintMarker.setLatLng(t.latlng);var e=this._hintMarker.getLatLng(),r=L.circleMarker(e,this.options.pathOptions);this._setPane(r,"layerPane"),this._finishLayer(r),r.addTo(this._map.pm._getContainingLayer()),r.pm&&this.options.markerEditable&&r.pm.enable(),L.PM.Utils._fireEvent(this._map,"pm:create",{shape:this._shape,marker:r,layer:r}),this._cleanupSnapping(),this.options.continueDrawing||this.disable()}},_finishShape:function(t){if(!this.options.requireSnapToFinish||this._hintMarker._snapped||this._isFirstLayer()){this._hintMarker._snapped||this._hintMarker.setLatLng(t.latlng);var e=this._centerMarker.getLatLng(),r=this._hintMarker.getLatLng(),i=this._map.project(e).distanceTo(this._map.project(r));this.options.editable&&(this.options.minRadiusCircleMarker&&i<this.options.minRadiusCircleMarker?i=this.options.minRadiusCircleMarker:this.options.maxRadiusCircleMarker&&i>this.options.maxRadiusCircleMarker&&(i=this.options.maxRadiusCircleMarker));var n=Object.assign({},this.options.pathOptions,{radius:i}),a=L.circleMarker(e,n);this._setPane(a,"layerPane"),this._finishLayer(a),a.addTo(this._map.pm._getContainingLayer()),a.pm&&a.pm._updateHiddenPolyCircle(),L.PM.Utils._fireEvent(this._map,"pm:create",{shape:this._shape,layer:a}),this.disable(),this.options.continueDrawing&&this.enable()}},_getNewDestinationOfHintMarker:function(){var t=this._hintMarker.getLatLng();if(this.options.editable){var e=this._centerMarker.getLatLng(),r=this._map.project(e).distanceTo(this._map.project(t));this.options.minRadiusCircleMarker&&r<this.options.minRadiusCircleMarker?t=I(this._map,e,t,this._pxRadiusToMeter(this.options.minRadiusCircleMarker)):this.options.maxRadiusCircleMarker&&r>this.options.maxRadiusCircleMarker&&(t=I(this._map,e,t,this._pxRadiusToMeter(this.options.maxRadiusCircleMarker)))}return t},_handleHintMarkerSnapping:function(){if(this.options.editable){if(this._hintMarker._snapped){var t=this._centerMarker.getLatLng(),e=this._hintMarker.getLatLng(),r=this._map.project(t).distanceTo(this._map.project(e));(this.options.minRadiusCircleMarker&&r<this.options.minRadiusCircleMarker||this.options.maxRadiusCircleMarker&&r>this.options.maxRadiusCircleMarker)&&this._hintMarker.setLatLng(this._hintMarker._orgLatLng)}this._hintMarker.setLatLng(this._getNewDestinationOfHintMarker())}},_pxRadiusToMeter:function(t){var e=this._centerMarker.getLatLng(),r=this._map.project(e),i=L.point(r.x+t,r.y);return this._map.unproject(i).distanceTo(e)}});var Y=r(1),X=r.n(Y);function q(t,e,r){var i=t[e];t[e]=t[r],t[r]=i}function V(t,e){return t<e?-1:e<t?1:0}var H=function(t,e,r,i,n){!function t(e,r,i,n,a){for(;i<n;){if(600<n-i){var o=n-i+1,s=r-i+1,l=Math.log(o),h=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*h*(o-h)/o)*(s-o/2<0?-1:1);t(e,r,Math.max(i,Math.floor(r-s*h/o+u)),Math.min(n,Math.floor(r+(o-s)*h/o+u)),a)}var c=e[r],p=i,f=n;for(q(e,i,r),0<a(e[n],c)&&q(e,i,n);p<f;){for(q(e,p,f),p++,f--;a(e[p],c)<0;)p++;for(;0<a(e[f],c);)f--}0===a(e[i],c)?q(e,i,f):q(e,++f,n),f<=r&&(i=f+1),r<=f&&(n=f-1)}}(t,e,r||0,i||t.length-1,n||V)};function J(t,e){if(!(this instanceof J))return new J(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function K(t,e,r){if(!r)return e.indexOf(t);for(var i=0;i<e.length;i++)if(r(t,e[i]))return i;return-1}function $(t,e){Z(t,0,t.children.length,e,t)}function Z(t,e,r,i,n){(n=n||at(null)).minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var a,o=e;o<r;o++)a=t.children[o],W(n,t.leaf?i(a):a);return n}function W(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function Q(t,e){return t.minX-e.minX}function tt(t,e){return t.minY-e.minY}function et(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function rt(t){return t.maxX-t.minX+(t.maxY-t.minY)}function it(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function nt(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function at(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function ot(t,e,r,i,n){for(var a,o=[e,r];o.length;)(r=o.pop())-(e=o.pop())<=i||(a=e+Math.ceil((r-e)/i/2)*i,H(t,a,e,r,n),o.push(e,a,a,r))}J.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,r=[],i=this.toBBox;if(!nt(t,e))return r;for(var n,a,o,s,l=[];e;){for(n=0,a=e.children.length;n<a;n++)o=e.children[n],nt(t,s=e.leaf?i(o):o)&&(e.leaf?r.push(o):it(t,s)?this._all(o,r):l.push(o));e=l.pop()}return r},collides:function(t){var e=this.data,r=this.toBBox;if(!nt(t,e))return!1;for(var i,n,a,o,s=[];e;){for(i=0,n=e.children.length;i<n;i++)if(a=e.children[i],nt(t,o=e.leaf?r(a):a)){if(e.leaf||it(t,o))return!0;s.push(a)}e=s.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,r=t.length;e<r;e++)this.insert(t[e]);return this}var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var n=this.data;this.data=i,i=n}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=at([]),this},remove:function(t,e){if(!t)return this;for(var r,i,n,a,o=this.data,s=this.toBBox(t),l=[],h=[];o||l.length;){if(o||(o=l.pop(),i=l[l.length-1],r=h.pop(),a=!0),o.leaf&&-1!==(n=K(t,o.children,e)))return o.children.splice(n,1),l.push(o),this._condense(l),this;a||o.leaf||!it(o,s)?i?(r++,o=i.children[r],a=!1):o=null:(l.push(o),h.push(r),r=0,o=(i=o).children[0])}return this},toBBox:function(t){return t},compareMinX:Q,compareMinY:tt,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var r=[];t;)t.leaf?e.push.apply(e,t.children):r.push.apply(r,t.children),t=r.pop();return e},_build:function(t,e,r,i){var n,a=r-e+1,o=this._maxEntries;if(a<=o)return $(n=at(t.slice(e,r+1)),this.toBBox),n;i||(i=Math.ceil(Math.log(a)/Math.log(o)),o=Math.ceil(a/Math.pow(o,i-1))),(n=at([])).leaf=!1,n.height=i;var s,l,h,u,c=Math.ceil(a/o),p=c*Math.ceil(Math.sqrt(o));for(ot(t,e,r,p,this.compareMinX),s=e;s<=r;s+=p)for(ot(t,s,h=Math.min(s+p-1,r),c,this.compareMinY),l=s;l<=h;l+=c)u=Math.min(l+c-1,h),n.children.push(this._build(t,l,u,i-1));return $(n,this.toBBox),n},_chooseSubtree:function(t,e,r,i){for(var n,a,o,s,l,h,u,c,p,f;i.push(e),!e.leaf&&i.length-1!==r;){for(u=c=1/0,n=0,a=e.children.length;n<a;n++)l=et(o=e.children[n]),p=t,f=o,(h=(Math.max(f.maxX,p.maxX)-Math.min(f.minX,p.minX))*(Math.max(f.maxY,p.maxY)-Math.min(f.minY,p.minY))-l)<c?(c=h,u=l<u?l:u,s=o):h===c&&l<u&&(u=l,s=o);e=s||e.children[0]}return e},_insert:function(t,e,r){var i=this.toBBox,n=r?t:i(t),a=[],o=this._chooseSubtree(n,this.data,e,a);for(o.children.push(t),W(o,n);0<=e&&a[e].children.length>this._maxEntries;)this._split(a,e),e--;this._adjustParentBBoxes(n,a,e)},_split:function(t,e){var r=t[e],i=r.children.length,n=this._minEntries;this._chooseSplitAxis(r,n,i);var a=this._chooseSplitIndex(r,n,i),o=at(r.children.splice(a,r.children.length-a));o.height=r.height,o.leaf=r.leaf,$(r,this.toBBox),$(o,this.toBBox),e?t[e-1].children.push(o):this._splitRoot(r,o)},_splitRoot:function(t,e){this.data=at([t,e]),this.data.height=t.height+1,this.data.leaf=!1,$(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,r){var i,n,a,o,s,l,h,u,c,p,f,d,g,m;for(l=h=1/0,i=e;i<=r-e;i++)c=n=Z(t,0,i,this.toBBox),p=a=Z(t,i,r,this.toBBox),f=Math.max(c.minX,p.minX),d=Math.max(c.minY,p.minY),g=Math.min(c.maxX,p.maxX),m=Math.min(c.maxY,p.maxY),o=Math.max(0,g-f)*Math.max(0,m-d),s=et(n)+et(a),o<l?(l=o,u=i,h=s<h?s:h):o===l&&s<h&&(h=s,u=i);return u},_chooseSplitAxis:function(t,e,r){var i=t.leaf?this.compareMinX:Q,n=t.leaf?this.compareMinY:tt;this._allDistMargin(t,e,r,i)<this._allDistMargin(t,e,r,n)&&t.children.sort(i)},_allDistMargin:function(t,e,r,i){t.children.sort(i);var n,a,o=this.toBBox,s=Z(t,0,e,o),l=Z(t,r-e,r,o),h=rt(s)+rt(l);for(n=e;n<r-e;n++)a=t.children[n],W(s,t.leaf?o(a):a),h+=rt(s);for(n=r-e-1;e<=n;n--)a=t.children[n],W(l,t.leaf?o(a):a),h+=rt(l);return h},_adjustParentBBoxes:function(t,e,r){for(var i=r;0<=i;i--)W(e[i],t)},_condense:function(t){for(var e,r=t.length-1;0<=r;r--)0===t[r].children.length?0<r?(e=t[r-1].children).splice(e.indexOf(t[r]),1):this.clear():$(t[r],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}};var st=J;function lt(t,e,r){if(!pt(r=r||{}))throw new Error("options is invalid");var i=r.bbox,n=r.id;if(void 0===t)throw new Error("geometry is required");if(e&&e.constructor!==Object)throw new Error("properties must be an Object");i&&ft(i),n&&dt(n);var a={type:"Feature"};return n&&(a.id=n),i&&(a.bbox=i),a.properties=e||{},a.geometry=t,a}function ht(t,e,r){if(!t)throw new Error("coordinates is required");if(t.length<2)throw new Error("coordinates must be an array of two or more positions");if(!ct(t[0][1])||!ct(t[0][1]))throw new Error("coordinates must contain numbers");return lt({type:"LineString",coordinates:t},e,r)}function ut(t,e){if(!pt(e=e||{}))throw new Error("options is invalid");var r=e.bbox,i=e.id;if(!t)throw new Error("No features passed");if(!Array.isArray(t))throw new Error("features must be an Array");r&&ft(r),i&&dt(i);var n={type:"FeatureCollection"};return i&&(n.id=i),r&&(n.bbox=r),n.features=t,n}function ct(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function pt(t){return!!t&&t.constructor===Object}function ft(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach((function(t){if(!ct(t))throw new Error("bbox must only contain numbers")}))}function dt(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof t))throw new Error("id must be a number or a string")}function gt(t,e,r){if(null!==t)for(var i,n,a,o,s,l,h,u,c=0,p=0,f=t.type,d="FeatureCollection"===f,g="Feature"===f,m=d?t.features.length:1,_=0;_<m;_++){s=(u=!!(h=d?t.features[_].geometry:g?t.geometry:t)&&"GeometryCollection"===h.type)?h.geometries.length:1;for(var y=0;y<s;y++){var v=0,b=0;if(null!==(o=u?h.geometries[y]:h)){l=o.coordinates;var L=o.type;switch(c=!r||"Polygon"!==L&&"MultiPolygon"!==L?0:1,L){case null:break;case"Point":if(!1===e(l,p,_,v,b))return!1;p++,v++;break;case"LineString":case"MultiPoint":for(i=0;i<l.length;i++){if(!1===e(l[i],p,_,v,b))return!1;p++,"MultiPoint"===L&&v++}"LineString"===L&&v++;break;case"Polygon":case"MultiLineString":for(i=0;i<l.length;i++){for(n=0;n<l[i].length-c;n++){if(!1===e(l[i][n],p,_,v,b))return!1;p++}"MultiLineString"===L&&v++,"Polygon"===L&&b++}"Polygon"===L&&v++;break;case"MultiPolygon":for(i=0;i<l.length;i++){for("MultiPolygon"===L&&(b=0),n=0;n<l[i].length;n++){for(a=0;a<l[i][n].length-c;a++){if(!1===e(l[i][n][a],p,_,v,b))return!1;p++}b++}v++}break;case"GeometryCollection":for(i=0;i<o.geometries.length;i++)if(!1===gt(o.geometries[i],e,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function mt(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var r=0;r<t.features.length&&!1!==e(t.features[r],r);r++);}function _t(t,e){!function(t,e){var r,i,n,a,o,s,l,h,u,c,p=0,f="FeatureCollection"===t.type,d="Feature"===t.type,g=f?t.features.length:1;for(r=0;r<g;r++){for(s=f?t.features[r].geometry:d?t.geometry:t,h=f?t.features[r].properties:d?t.properties:{},u=f?t.features[r].bbox:d?t.bbox:void 0,c=f?t.features[r].id:d?t.id:void 0,o=(l=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,n=0;n<o;n++)if(null!==(a=l?s.geometries[n]:s))switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(a,p,h,u,c))return!1;break;case"GeometryCollection":for(i=0;i<a.geometries.length;i++)if(!1===e(a.geometries[i],p,h,u,c))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,p,h,u,c))return!1;p++}}(t,(function(t,r,i,n,a){var o,s=null===t?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return!1!==e(lt(t,i,{bbox:n,id:a}),r,0)&&void 0}switch(s){case"MultiPoint":o="Point";break;case"MultiLineString":o="LineString";break;case"MultiPolygon":o="Polygon"}for(var l=0;l<t.coordinates.length;l++){var h=t.coordinates[l];if(!1===e(lt({type:o,coordinates:h},i),r,l))return!1}}))}function yt(t){var e=[t[0],t[1]],r=[t[0],t[3]],i=[t[2],t[3]];return{type:"Feature",bbox:t,properties:{},geometry:{type:"Polygon",coordinates:[[e,[t[2],t[1]],i,r,e]]}}}function vt(t){var e=[1/0,1/0,-1/0,-1/0];return gt(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}var bt=function(t){var e=st(t);return e.insert=function(t){if(Array.isArray(t)){var e=t;(t=yt(e)).bbox=e}else t.bbox=t.bbox?t.bbox:vt(t);return st.prototype.insert.call(this,t)},e.load=function(t){var e=[];return Array.isArray(t)?t.forEach((function(t){var r=yt(t);r.bbox=t,e.push(r)})):mt(t,(function(t){t.bbox=t.bbox?t.bbox:vt(t),e.push(t)})),st.prototype.load.call(this,e)},e.remove=function(t){if(Array.isArray(t)){var e=t;(t=yt(e)).bbox=e}return st.prototype.remove.call(this,t)},e.clear=function(){return st.prototype.clear.call(this)},e.search=function(t){return{type:"FeatureCollection",features:st.prototype.search.call(this,this.toBBox(t))}},e.collides=function(t){return st.prototype.collides.call(this,this.toBBox(t))},e.all=function(){return{type:"FeatureCollection",features:st.prototype.all.call(this)}},e.toJSON=function(){return st.prototype.toJSON.call(this)},e.fromJSON=function(t){return st.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var e;return{minX:(e=t.bbox?t.bbox:Array.isArray(t)&&4===t.length?t:vt(t))[0],minY:e[1],maxX:e[2],maxY:e[3]}},e},Lt=6371008.8,kt={meters:Lt,metres:Lt,millimeters:1e3*Lt,millimetres:1e3*Lt,centimeters:100*Lt,centimetres:100*Lt,kilometers:Lt/1e3,kilometres:Lt/1e3,miles:Lt/1609.344,nauticalmiles:Lt/1852,inches:39.37*Lt,yards:Lt/1.0936,feet:3.28084*Lt,radians:1,degrees:Lt/111325};function Mt(t){if(null==t)throw new Error("degrees is required");return t%360*Math.PI/180}function xt(t){if(!t)throw new Error("coord is required");if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates;if(Array.isArray(t)&&2<=t.length&&void 0===t[0].length&&void 0===t[1].length)return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}var wt=function(t,e,r){if(!function(t){return!!t&&t.constructor===Object}(r=r||{}))throw new Error("options is invalid");var i=r.units,n=xt(t),a=xt(e),o=Mt(a[1]-n[1]),s=Mt(a[0]-n[0]),l=Mt(n[1]),h=Mt(a[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(l)*Math.cos(h);return function(t,e){if(null==t)throw new Error("radians is required");if(e&&"string"!=typeof e)throw new Error("units must be a string");var r=kt[e||"kilometers"];if(!r)throw new Error(e+" units is invalid");return t*r}(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),i)};var Pt=function(t,e){if(!function(t){return!!t&&t.constructor===Object}(e=e||{}))throw new Error("options is invalid");var r=e.precision,i=e.coordinates,n=e.mutate;if(r=null==r||isNaN(r)?6:r,i=null==i||isNaN(i)?3:i,!t)throw new Error("<geojson> is required");if("number"!=typeof r)throw new Error("<precision> must be a number");if("number"!=typeof i)throw new Error("<coordinates> must be a number");!1!==n&&void 0!==n||(t=JSON.parse(JSON.stringify(t)));var a=Math.pow(10,r);return function t(e,r,i){if(null!==e)for(var n,a,o,s,l,h,u,c,p=0,f=0,d=e.type,g="FeatureCollection"===d,m="Feature"===d,_=g?e.features.length:1,y=0;y<_;y++){l=(c=!!(u=g?e.features[y].geometry:m?e.geometry:e)&&"GeometryCollection"===u.type)?u.geometries.length:1;for(var v=0;v<l;v++){var b=0,L=0;if(null!==(s=c?u.geometries[v]:u)){h=s.coordinates;var k=s.type;switch(p=!i||"Polygon"!==k&&"MultiPolygon"!==k?0:1,k){case null:break;case"Point":if(!1===r(h,f,y,b,L))return!1;f++,b++;break;case"LineString":case"MultiPoint":for(n=0;n<h.length;n++){if(!1===r(h[n],f,y,b,L))return!1;f++,"MultiPoint"===k&&b++}"LineString"===k&&b++;break;case"Polygon":case"MultiLineString":for(n=0;n<h.length;n++){for(a=0;a<h[n].length-p;a++){if(!1===r(h[n][a],f,y,b,L))return!1;f++}"MultiLineString"===k&&b++,"Polygon"===k&&L++}"Polygon"===k&&b++;break;case"MultiPolygon":for(n=0;n<h.length;n++){for("MultiPolygon"===k&&(L=0),a=0;a<h[n].length;a++){for(o=0;o<h[n][a].length-p;o++){if(!1===r(h[n][a][o],f,y,b,L))return!1;f++}L++}b++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(!1===t(s.geometries[n],r,i))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}(t,(function(t){!function(t,e,r){t.length>r&&t.splice(r,t.length);for(var i=0;i<t.length;i++)t[i]=Math.round(t[i]*e)/e}(t,a,i)})),t};function Ct(t){if(!t)throw new Error("coord is required");if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates;if(Array.isArray(t)&&2<=t.length&&void 0===t[0].length&&void 0===t[1].length)return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Et(t){if(!t)throw new Error("coords is required");if("Feature"===t.type&&null!==t.geometry)return t.geometry.coordinates;if(t.coordinates)return t.coordinates;if(Array.isArray(t))return t;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function St(t,e){if(!t)throw new Error((e||"geojson")+" is required");if(t.geometry&&t.geometry.type)return t.geometry.type;if(t.type)return t.type;throw new Error((e||"geojson")+" is invalid")}var Bt=function(t){if(!t)throw new Error("geojson is required");var e=[];return _t(t,(function(t){!function(t,e){var r=[],i=t.geometry;switch(i.type){case"Polygon":r=Et(i);break;case"LineString":r=[Et(i)]}r.forEach((function(r){(function(t,e){var r=[];return t.reduce((function(t,i){var n=ht([t,i],e);return n.bbox=function(t,e){var r=t[0],i=t[1],n=e[0],a=e[1];return[r<n?r:n,i<a?i:a,n<r?r:n,a<i?i:a]}(t,i),r.push(n),i})),r})(r,t.properties).forEach((function(t){t.id=e.length,e.push(t)}))}))}(t,e)})),ut(e)};function Ot(t,e){var r=Et(t),i=Et(e);if(2!==r.length)throw new Error("<intersects> line1 must only contain 2 coordinates");if(2!==i.length)throw new Error("<intersects> line2 must only contain 2 coordinates");var n=r[0][0],a=r[0][1],o=r[1][0],s=r[1][1],l=i[0][0],h=i[0][1],u=i[1][0],c=i[1][1],p=(c-h)*(o-n)-(u-l)*(s-a);if(0==p)return null;var f=((u-l)*(a-h)-(c-h)*(n-l))/p,d=((o-n)*(a-h)-(s-a)*(n-l))/p;return 0<=f&&f<=1&&0<=d&&d<=1?function(t,e,r){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ct(t[0])||!ct(t[1]))throw new Error("coordinates must contain numbers");return lt({type:"Point",coordinates:t},e,r)}([n+f*(o-n),a+f*(s-a)]):null}function Rt(t){if(null==t)throw new Error("degrees is required");return t%360*Math.PI/180}function Dt(t){if(!t)throw new Error("coord is required");if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates;if(Array.isArray(t)&&2<=t.length&&void 0===t[0].length&&void 0===t[1].length)return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}var Tt=function t(e,r,i){if(!function(t){return!!t&&t.constructor===Object}(i=i||{}))throw new Error("options is invalid");if(!0===i.final)return function(e,r){var i=t(r,e);return(i+180)%360}(e,r);var n=Dt(e),a=Dt(r),o=Rt(n[0]),s=Rt(a[0]),l=Rt(n[1]),h=Rt(a[1]),u=Math.sin(s-o)*Math.cos(h),c=Math.cos(l)*Math.sin(h)-Math.sin(l)*Math.cos(h)*Math.cos(s-o);return function(t){if(null==t)throw new Error("radians is required");return t%(2*Math.PI)*180/Math.PI}(Math.atan2(u,c))},It=6371008.8,jt={meters:It,metres:It,millimeters:1e3*It,millimetres:1e3*It,centimeters:100*It,centimetres:100*It,kilometers:It/1e3,kilometres:It/1e3,miles:It/1609.344,nauticalmiles:It/1852,inches:39.37*It,yards:It/1.0936,feet:3.28084*It,radians:1,degrees:It/111325};function At(t,e,r){if(!zt(r=r||{}))throw new Error("options is invalid");var i=r.bbox,n=r.id;if(void 0===t)throw new Error("geometry is required");if(e&&e.constructor!==Object)throw new Error("properties must be an Object");i&&function(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach((function(t){if(!Ut(t))throw new Error("bbox must only contain numbers")}))}(i),n&&function(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof t))throw new Error("id must be a number or a string")}(n);var a={type:"Feature"};return n&&(a.id=n),i&&(a.bbox=i),a.properties=e||{},a.geometry=t,a}function Gt(t){if(null==t)throw new Error("radians is required");return t%(2*Math.PI)*180/Math.PI}function Nt(t){if(null==t)throw new Error("degrees is required");return t%360*Math.PI/180}function Ut(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function zt(t){return!!t&&t.constructor===Object}var Ft=function(t,e,r,i){if(!zt(i=i||{}))throw new Error("options is invalid");var n=i.units,a=i.properties,o=function(t){if(!t)throw new Error("coord is required");if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates;if(Array.isArray(t)&&2<=t.length&&void 0===t[0].length&&void 0===t[1].length)return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}(t),s=Nt(o[0]),l=Nt(o[1]),h=Nt(r),u=function(t,e){if(null==t)throw new Error("distance is required");if(e&&"string"!=typeof e)throw new Error("units must be a string");var r=jt[e||"kilometers"];if(!r)throw new Error(e+" units is invalid");return t/r}(e,n),c=Math.asin(Math.sin(l)*Math.cos(u)+Math.cos(l)*Math.sin(u)*Math.cos(h));return function(t,e,r){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ut(t[0])||!Ut(t[1]))throw new Error("coordinates must contain numbers");return At({type:"Point",coordinates:t},e,r)}([Gt(s+Math.atan2(Math.sin(h)*Math.sin(u)*Math.cos(l),Math.cos(u)-Math.sin(l)*Math.sin(c))),Gt(c)],a)};function Yt(t,e,r){var i=t[e];t[e]=t[r],t[r]=i}function Xt(t,e){return t<e?-1:e<t?1:0}var qt=function(t,e,r,i,n){!function t(e,r,i,n,a){for(;i<n;){if(600<n-i){var o=n-i+1,s=r-i+1,l=Math.log(o),h=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*h*(o-h)/o)*(s-o/2<0?-1:1);t(e,r,Math.max(i,Math.floor(r-s*h/o+u)),Math.min(n,Math.floor(r+(o-s)*h/o+u)),a)}var c=e[r],p=i,f=n;for(Yt(e,i,r),0<a(e[n],c)&&Yt(e,i,n);p<f;){for(Yt(e,p,f),p++,f--;a(e[p],c)<0;)p++;for(;0<a(e[f],c);)f--}0===a(e[i],c)?Yt(e,i,f):Yt(e,++f,n),f<=r&&(i=f+1),r<=f&&(n=f-1)}}(t,e,r||0,i||t.length-1,n||Xt)};function Vt(t,e){if(!(this instanceof Vt))return new Vt(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function Ht(t,e,r){if(!r)return e.indexOf(t);for(var i=0;i<e.length;i++)if(r(t,e[i]))return i;return-1}function Jt(t,e){Kt(t,0,t.children.length,e,t)}function Kt(t,e,r,i,n){(n=n||ie(null)).minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var a,o=e;o<r;o++)a=t.children[o],$t(n,t.leaf?i(a):a);return n}function $t(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function Zt(t,e){return t.minX-e.minX}function Wt(t,e){return t.minY-e.minY}function Qt(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function te(t){return t.maxX-t.minX+(t.maxY-t.minY)}function ee(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function re(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function ie(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function ne(t,e,r,i,n){for(var a,o=[e,r];o.length;)(r=o.pop())-(e=o.pop())<=i||(a=e+Math.ceil((r-e)/i/2)*i,qt(t,a,e,r,n),o.push(e,a,a,r))}Vt.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,r=[],i=this.toBBox;if(!re(t,e))return r;for(var n,a,o,s,l=[];e;){for(n=0,a=e.children.length;n<a;n++)o=e.children[n],re(t,s=e.leaf?i(o):o)&&(e.leaf?r.push(o):ee(t,s)?this._all(o,r):l.push(o));e=l.pop()}return r},collides:function(t){var e=this.data,r=this.toBBox;if(!re(t,e))return!1;for(var i,n,a,o,s=[];e;){for(i=0,n=e.children.length;i<n;i++)if(a=e.children[i],re(t,o=e.leaf?r(a):a)){if(e.leaf||ee(t,o))return!0;s.push(a)}e=s.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,r=t.length;e<r;e++)this.insert(t[e]);return this}var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var n=this.data;this.data=i,i=n}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=ie([]),this},remove:function(t,e){if(!t)return this;for(var r,i,n,a,o=this.data,s=this.toBBox(t),l=[],h=[];o||l.length;){if(o||(o=l.pop(),i=l[l.length-1],r=h.pop(),a=!0),o.leaf&&-1!==(n=Ht(t,o.children,e)))return o.children.splice(n,1),l.push(o),this._condense(l),this;a||o.leaf||!ee(o,s)?i?(r++,o=i.children[r],a=!1):o=null:(l.push(o),h.push(r),r=0,o=(i=o).children[0])}return this},toBBox:function(t){return t},compareMinX:Zt,compareMinY:Wt,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var r=[];t;)t.leaf?e.push.apply(e,t.children):r.push.apply(r,t.children),t=r.pop();return e},_build:function(t,e,r,i){var n,a=r-e+1,o=this._maxEntries;if(a<=o)return Jt(n=ie(t.slice(e,r+1)),this.toBBox),n;i||(i=Math.ceil(Math.log(a)/Math.log(o)),o=Math.ceil(a/Math.pow(o,i-1))),(n=ie([])).leaf=!1,n.height=i;var s,l,h,u,c=Math.ceil(a/o),p=c*Math.ceil(Math.sqrt(o));for(ne(t,e,r,p,this.compareMinX),s=e;s<=r;s+=p)for(ne(t,s,h=Math.min(s+p-1,r),c,this.compareMinY),l=s;l<=h;l+=c)u=Math.min(l+c-1,h),n.children.push(this._build(t,l,u,i-1));return Jt(n,this.toBBox),n},_chooseSubtree:function(t,e,r,i){for(var n,a,o,s,l,h,u,c,p,f;i.push(e),!e.leaf&&i.length-1!==r;){for(u=c=1/0,n=0,a=e.children.length;n<a;n++)l=Qt(o=e.children[n]),p=t,f=o,(h=(Math.max(f.maxX,p.maxX)-Math.min(f.minX,p.minX))*(Math.max(f.maxY,p.maxY)-Math.min(f.minY,p.minY))-l)<c?(c=h,u=l<u?l:u,s=o):h===c&&l<u&&(u=l,s=o);e=s||e.children[0]}return e},_insert:function(t,e,r){var i=this.toBBox,n=r?t:i(t),a=[],o=this._chooseSubtree(n,this.data,e,a);for(o.children.push(t),$t(o,n);0<=e&&a[e].children.length>this._maxEntries;)this._split(a,e),e--;this._adjustParentBBoxes(n,a,e)},_split:function(t,e){var r=t[e],i=r.children.length,n=this._minEntries;this._chooseSplitAxis(r,n,i);var a=this._chooseSplitIndex(r,n,i),o=ie(r.children.splice(a,r.children.length-a));o.height=r.height,o.leaf=r.leaf,Jt(r,this.toBBox),Jt(o,this.toBBox),e?t[e-1].children.push(o):this._splitRoot(r,o)},_splitRoot:function(t,e){this.data=ie([t,e]),this.data.height=t.height+1,this.data.leaf=!1,Jt(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,r){var i,n,a,o,s,l,h,u,c,p,f,d,g,m;for(l=h=1/0,i=e;i<=r-e;i++)c=n=Kt(t,0,i,this.toBBox),p=a=Kt(t,i,r,this.toBBox),f=Math.max(c.minX,p.minX),d=Math.max(c.minY,p.minY),g=Math.min(c.maxX,p.maxX),m=Math.min(c.maxY,p.maxY),o=Math.max(0,g-f)*Math.max(0,m-d),s=Qt(n)+Qt(a),o<l?(l=o,u=i,h=s<h?s:h):o===l&&s<h&&(h=s,u=i);return u},_chooseSplitAxis:function(t,e,r){var i=t.leaf?this.compareMinX:Zt,n=t.leaf?this.compareMinY:Wt;this._allDistMargin(t,e,r,i)<this._allDistMargin(t,e,r,n)&&t.children.sort(i)},_allDistMargin:function(t,e,r,i){t.children.sort(i);var n,a,o=this.toBBox,s=Kt(t,0,e,o),l=Kt(t,r-e,r,o),h=te(s)+te(l);for(n=e;n<r-e;n++)a=t.children[n],$t(s,t.leaf?o(a):a),h+=te(s);for(n=r-e-1;e<=n;n--)a=t.children[n],$t(l,t.leaf?o(a):a),h+=te(l);return h},_adjustParentBBoxes:function(t,e,r){for(var i=r;0<=i;i--)$t(e[i],t)},_condense:function(t){for(var e,r=t.length-1;0<=r;r--)0===t[r].children.length?0<r?(e=t[r-1].children).splice(e.indexOf(t[r]),1):this.clear():Jt(t[r],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}};var ae=Vt;function oe(t,e,r){if(!ce(r=r||{}))throw new Error("options is invalid");var i=r.bbox,n=r.id;if(void 0===t)throw new Error("geometry is required");if(e&&e.constructor!==Object)throw new Error("properties must be an Object");i&&pe(i),n&&fe(n);var a={type:"Feature"};return n&&(a.id=n),i&&(a.bbox=i),a.properties=e||{},a.geometry=t,a}function se(t,e,r){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ue(t[0])||!ue(t[1]))throw new Error("coordinates must contain numbers");return oe({type:"Point",coordinates:t},e,r)}function le(t,e,r){if(!t)throw new Error("coordinates is required");if(t.length<2)throw new Error("coordinates must be an array of two or more positions");if(!ue(t[0][1])||!ue(t[0][1]))throw new Error("coordinates must contain numbers");return oe({type:"LineString",coordinates:t},e,r)}function he(t,e){if(!ce(e=e||{}))throw new Error("options is invalid");var r=e.bbox,i=e.id;if(!t)throw new Error("No features passed");if(!Array.isArray(t))throw new Error("features must be an Array");r&&pe(r),i&&fe(i);var n={type:"FeatureCollection"};return i&&(n.id=i),r&&(n.bbox=r),n.features=t,n}function ue(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function ce(t){return!!t&&t.constructor===Object}function pe(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach((function(t){if(!ue(t))throw new Error("bbox must only contain numbers")}))}function fe(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof t))throw new Error("id must be a number or a string")}function de(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var r=0;r<t.features.length&&!1!==e(t.features[r],r);r++);}function ge(t,e){!function(t,e){var r,i,n,a,o,s,l,h,u,c,p=0,f="FeatureCollection"===t.type,d="Feature"===t.type,g=f?t.features.length:1;for(r=0;r<g;r++){for(s=f?t.features[r].geometry:d?t.geometry:t,h=f?t.features[r].properties:d?t.properties:{},u=f?t.features[r].bbox:d?t.bbox:void 0,c=f?t.features[r].id:d?t.id:void 0,o=(l=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,n=0;n<o;n++)if(null!==(a=l?s.geometries[n]:s))switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(a,p,h,u,c))return!1;break;case"GeometryCollection":for(i=0;i<a.geometries.length;i++)if(!1===e(a.geometries[i],p,h,u,c))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,p,h,u,c))return!1;p++}}(t,(function(t,r,i,n,a){var o,s=null===t?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return!1!==e(oe(t,i,{bbox:n,id:a}),r,0)&&void 0}switch(s){case"MultiPoint":o="Point";break;case"MultiLineString":o="LineString";break;case"MultiPolygon":o="Polygon"}for(var l=0;l<t.coordinates.length;l++){var h=t.coordinates[l];if(!1===e(oe({type:o,coordinates:h},i),r,l))return!1}}))}function me(t){var e=[t[0],t[1]],r=[t[0],t[3]],i=[t[2],t[3]];return{type:"Feature",bbox:t,properties:{},geometry:{type:"Polygon",coordinates:[[e,[t[2],t[1]],i,r,e]]}}}function _e(t){var e=[1/0,1/0,-1/0,-1/0];return function t(e,r,i){if(null!==e)for(var n,a,o,s,l,h,u,c,p=0,f=0,d=e.type,g="FeatureCollection"===d,m="Feature"===d,_=g?e.features.length:1,y=0;y<_;y++){l=(c=!!(u=g?e.features[y].geometry:m?e.geometry:e)&&"GeometryCollection"===u.type)?u.geometries.length:1;for(var v=0;v<l;v++){var b=0,L=0;if(null!==(s=c?u.geometries[v]:u)){h=s.coordinates;var k=s.type;switch(p=!i||"Polygon"!==k&&"MultiPolygon"!==k?0:1,k){case null:break;case"Point":if(!1===r(h,f,y,b,L))return!1;f++,b++;break;case"LineString":case"MultiPoint":for(n=0;n<h.length;n++){if(!1===r(h[n],f,y,b,L))return!1;f++,"MultiPoint"===k&&b++}"LineString"===k&&b++;break;case"Polygon":case"MultiLineString":for(n=0;n<h.length;n++){for(a=0;a<h[n].length-p;a++){if(!1===r(h[n][a],f,y,b,L))return!1;f++}"MultiLineString"===k&&b++,"Polygon"===k&&L++}"Polygon"===k&&b++;break;case"MultiPolygon":for(n=0;n<h.length;n++){for("MultiPolygon"===k&&(L=0),a=0;a<h[n].length;a++){for(o=0;o<h[n][a].length-p;o++){if(!1===r(h[n][a][o],f,y,b,L))return!1;f++}L++}b++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(!1===t(s.geometries[n],r,i))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}function ye(t){if(!t)throw new Error("coords is required");if("Feature"===t.type&&null!==t.geometry)return t.geometry.coordinates;if(t.coordinates)return t.coordinates;if(Array.isArray(t))return t;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}var ve=function(t){if(!t)throw new Error("geojson is required");var e=[];return ge(t,(function(t){!function(t,e){var r=[],i=t.geometry;switch(i.type){case"Polygon":r=ye(i);break;case"LineString":r=[ye(i)]}r.forEach((function(r){(function(t,e){var r=[];return t.reduce((function(t,i){var n=le([t,i],e);return n.bbox=function(t,e){var r=t[0],i=t[1],n=e[0],a=e[1];return[r<n?r:n,i<a?i:a,n<r?r:n,a<i?i:a]}(t,i),r.push(n),i})),r})(r,t.properties).forEach((function(t){t.id=e.length,e.push(t)}))}))}(t,e)})),he(e)};function be(t,e){var r=ye(t),i=ye(e);if(2!==r.length)throw new Error("<intersects> line1 must only contain 2 coordinates");if(2!==i.length)throw new Error("<intersects> line2 must only contain 2 coordinates");var n=r[0][0],a=r[0][1],o=r[1][0],s=r[1][1],l=i[0][0],h=i[0][1],u=i[1][0],c=i[1][1],p=(c-h)*(o-n)-(u-l)*(s-a);if(0==p)return null;var f=((u-l)*(a-h)-(c-h)*(n-l))/p,d=((o-n)*(a-h)-(s-a)*(n-l))/p;return 0<=f&&f<=1&&0<=d&&d<=1?se([n+f*(o-n),a+f*(s-a)]):null}var Le=function(t,e){var r={},i=[];if("LineString"===t.type&&(t=oe(t)),"LineString"===e.type&&(e=oe(e)),"Feature"===t.type&&"Feature"===e.type&&"LineString"===t.geometry.type&&"LineString"===e.geometry.type&&2===t.geometry.coordinates.length&&2===e.geometry.coordinates.length){var n=be(t,e);return n&&i.push(n),he(i)}var a=function(t){var e=ae(t);return e.insert=function(t){if(Array.isArray(t)){var e=t;(t=me(e)).bbox=e}else t.bbox=t.bbox?t.bbox:_e(t);return ae.prototype.insert.call(this,t)},e.load=function(t){var e=[];return Array.isArray(t)?t.forEach((function(t){var r=me(t);r.bbox=t,e.push(r)})):de(t,(function(t){t.bbox=t.bbox?t.bbox:_e(t),e.push(t)})),ae.prototype.load.call(this,e)},e.remove=function(t){if(Array.isArray(t)){var e=t;(t=me(e)).bbox=e}return ae.prototype.remove.call(this,t)},e.clear=function(){return ae.prototype.clear.call(this)},e.search=function(t){return{type:"FeatureCollection",features:ae.prototype.search.call(this,this.toBBox(t))}},e.collides=function(t){return ae.prototype.collides.call(this,this.toBBox(t))},e.all=function(){return{type:"FeatureCollection",features:ae.prototype.all.call(this)}},e.toJSON=function(){return ae.prototype.toJSON.call(this)},e.fromJSON=function(t){return ae.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var e;return{minX:(e=t.bbox?t.bbox:Array.isArray(t)&&4===t.length?t:_e(t))[0],minY:e[1],maxX:e[2],maxY:e[3]}},e}();return a.load(ve(e)),de(ve(t),(function(t){de(a.search(t),(function(e){var n=be(t,e);if(n){var a=ye(n).join(",");r[a]||(r[a]=!0,i.push(n))}}))})),he(i)};function ke(t,e){var r=[],i=bt();return _t(e,(function(e){if(r.forEach((function(t,e){t.id=e})),r.length){var n=i.search(e);if(n.features.length){var a=xe(e,n);r=r.filter((function(t){return t.id!==a.id})),i.remove(a),mt(Me(a,e),(function(t){r.push(t),i.insert(t)}))}}else(r=Me(t,e).features).forEach((function(t){t.bbox||(t.bbox=function(t){var e=t[0],r=t[1],i=t[2],n=t[3],a=wt(t.slice(0,2),[i,r]);if(wt(t.slice(0,2),[e,n])<=a){var o=(r+n)/2;return[e,o-(i-e)/2,i,o+(i-e)/2]}var s=(e+i)/2;return[s-(n-r)/2,r,s+(n-r)/2,n]}(function(t){var e=[1/0,1/0,-1/0,-1/0];return gt(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}(t)))})),i.load(ut(r))})),ut(r)}function Me(t,e){var r=[],i=Et(t)[0],n=Et(t)[t.geometry.coordinates.length-1];if(we(i,Ct(e))||we(n,Ct(e)))return ut([t]);var a=bt(),o=Bt(t);a.load(o);var s=a.search(e);if(!s.features.length)return ut([t]);var l=xe(e,s),h=function(t,e,r){var i=r;return mt(t,(function(t,n){i=0===n&&void 0===r?t:e(i,t,n)})),i}(o,(function(t,i,n){var a=Et(i)[1],o=Ct(e);return n===l.id?(t.push(o),r.push(ht(t)),we(o,a)?[o]:[o,a]):(t.push(a),t)}),[i]);return 1<h.length&&r.push(ht(h)),ut(r)}function xe(t,e){if(!e.features.length)throw new Error("lines must contain features");if(1===e.features.length)return e.features[0];var r,i=1/0;return mt(e,(function(e){var n=function(t,e,r){if(!ce(r=r||{}))throw new Error("options is invalid");var i=t.geometry?t.geometry.type:t.type;if("LineString"!==i&&"MultiLineString"!==i)throw new Error("lines must be LineString or MultiLineString");var n=se([1/0,1/0],{dist:1/0}),a=0;return ge(t,(function(t){for(var i=ye(t),o=0;o<i.length-1;o++){var s=se(i[o]);s.properties.dist=wt(e,s,r);var l=se(i[o+1]);l.properties.dist=wt(e,l,r);var h=wt(s,l,r),u=Math.max(s.properties.dist,l.properties.dist),c=Tt(s,l),p=Ft(e,u,c+90,r),f=Ft(e,u,c-90,r),d=Le(le([p.geometry.coordinates,f.geometry.coordinates]),le([s.geometry.coordinates,l.geometry.coordinates])),g=null;0<d.features.length&&((g=d.features[0]).properties.dist=wt(e,g,r),g.properties.location=a+wt(s,g,r)),s.properties.dist<n.properties.dist&&((n=s).properties.index=o,n.properties.location=a),l.properties.dist<n.properties.dist&&((n=l).properties.index=o+1,n.properties.location=a+h),g&&g.properties.dist<n.properties.dist&&((n=g).properties.index=o),a+=h}})),n}(e,t).properties.dist;n<i&&(r=e,i=n)})),r}function we(t,e){return t[0]===e[0]&&t[1]===e[1]}var Pe=function(t,e){if(!t)throw new Error("line is required");if(!e)throw new Error("splitter is required");var r=St(t),i=St(e);if("LineString"!==r)throw new Error("line must be LineString");if("FeatureCollection"===i)throw new Error("splitter cannot be a FeatureCollection");if("GeometryCollection"===i)throw new Error("splitter cannot be a GeometryCollection");var n=Pt(e,{precision:7});switch(i){case"Point":return Me(t,n);case"MultiPoint":return ke(t,n);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return ke(t,function(t,e){var r={},i=[];if("LineString"===t.type&&(t=lt(t)),"LineString"===e.type&&(e=lt(e)),"Feature"===t.type&&"Feature"===e.type&&"LineString"===t.geometry.type&&"LineString"===e.geometry.type&&2===t.geometry.coordinates.length&&2===e.geometry.coordinates.length){var n=Ot(t,e);return n&&i.push(n),ut(i)}var a=bt();return a.load(Bt(e)),mt(Bt(t),(function(t){mt(a.search(t),(function(e){var n=Ot(t,e);if(n){var a=Et(n).join(",");r[a]||(r[a]=!0,i.push(n))}}))})),ut(i)}(t,n))}},Ce=r(66),Ee=r.n(Ce),Se=r(27),Be=r.n(Se);function Oe(t){var e={type:"Feature"};return e.geometry=t,e}function Re(t){return"Feature"===t.type?t.geometry:t}function De(t){return t.geometry.coordinates}function Te(t){return Oe({type:"Polygon",coordinates:t})}function Ie(t){return Oe({type:"MultiPolygon",coordinates:t})}function je(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}U.Cut=U.Polygon.extend({initialize:function(t){this._map=t,this._shape="Cut",this.toolbarButtonName="cutPolygon"},_finishShape:function(){var t=this;if(this._editedLayers=[],this.options.allowSelfIntersection||(this._handleSelfIntersection(!0,this._layer.getLatLngs()[0]),!this._doesSelfIntersect)){var e=this._layer.getLatLngs(),r=L.polygon(e,this.options.pathOptions);r._latlngInfos=this._layer._latlngInfo,this.cut(r),this._cleanupSnapping(),this._otherSnapLayers.splice(this._tempSnapLayerIndex,1),delete this._tempSnapLayerIndex,this._editedLayers.forEach((function(e){var r=e.layer,i=e.originalLayer;L.PM.Utils._fireEvent(i,"pm:cut",{shape:t._shape,layer:r,originalLayer:i}),L.PM.Utils._fireEvent(t._map,"pm:cut",{shape:t._shape,layer:r,originalLayer:i}),L.PM.Utils._fireEvent(i,"pm:edit",{layer:i,shape:i.pm.getShape()})})),this._editedLayers=[],this.disable(),this.options.continueDrawing&&this.enable()}},cut:function(t){var e=this,r=this._map._layers,i=t._latlngInfos||[];Object.keys(r).map((function(t){return r[t]})).filter((function(t){return t.pm})).filter((function(t){return!t._pmTempLayer})).filter((function(t){return!L.PM.optIn&&!t.options.pmIgnore||L.PM.optIn&&!1===t.options.pmIgnore})).filter((function(t){return t instanceof L.Polyline})).filter((function(e){return e!==t})).filter((function(t){return!e._layerGroup.hasLayer(t)})).filter((function(e){try{var r=0<!!X()(t.toGeoJSON(15),e.toGeoJSON(15)).features.length;return r||e instanceof L.Polyline&&!(e instanceof L.Polygon)?r:!!function(t,e){var r=Re(t),i=Re(e),n=Be.a.intersection(r.coordinates,i.coordinates);return 0===n.length?null:1===n.length?Te(n[0]):Ie(n)}(t.toGeoJSON(15),e.toGeoJSON(15))}catch(t){return e instanceof L.Polygon&&console.error("You can't cut polygons with self-intersections"),!1}})).forEach((function(r){var n;if(r instanceof L.Polygon){var a=(n=L.polygon(r.getLatLngs())).getLatLngs();i.forEach((function(t){if(t&&t.snapInfo){var r=t.latlng,i=e._calcClosestLayer(r,[n]);if(i&&i.segment&&i.distance<e.options.snapDistance){var o=i.segment;if(o&&2===o.length){var s=L.PM.Utils._getIndexFromSegment(a,o),l=s.indexPath,h=s.parentPath,u=s.newIndex;(1<l.length?C()(a,h):a).splice(u,0,r)}}}}))}else n=r;var o=e._cutLayer(t,n),s=L.geoJSON(o,r.options);1===s.getLayers().length&&(s=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],i=!0,n=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);i=!0);}catch(t){n=!0,a=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw a}}return r}}(t,e)||function(t,e){if(t){if("string"==typeof t)return je(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?je(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(s.getLayers(),1)[0]),e._setPane(s,"layerPane");var l=s.addTo(e._map.pm._getContainingLayer());l.pm.enable(r.pm.options),l.pm.disable(),r._pmTempLayer=!0,t._pmTempLayer=!0,r.remove(),r.removeFrom(e._map.pm._getContainingLayer()),t.remove(),t.removeFrom(e._map.pm._getContainingLayer()),l.getLayers&&0===l.getLayers().length&&e._map.pm.removeLayer({target:l}),e._addDrawnLayerProp(l),e._editedLayers.push({layer:l,originalLayer:r})}))},_cutLayer:function(t,e){var r,i=L.geoJSON();if(e instanceof L.Polygon)r=function(t,e){var r=Re(t),i=Re(e),n=Be.a.difference(r.coordinates,i.coordinates);return 0===n.length?null:1===n.length?Te(n[0]):Ie(n)}(e.toGeoJSON(15),t.toGeoJSON(15));else{var n=function(t){t instanceof L.Polyline&&(t=t.toGeoJSON(15));var e=De(t),r=function t(e){return Array.isArray(e)?1+t(e[0]):-1}(e),i=[];return 1<r?e.forEach((function(t){i.push(function(t){return Oe({type:"LineString",coordinates:t})}(t))})):i.push(t),i}(e);n.forEach((function(e){var r=Pe(e,t.toGeoJSON(15));(r&&0<r.features.length?L.geoJSON(r):L.geoJSON(e)).getLayers().forEach((function(e){Ee()(t.toGeoJSON(15),e.toGeoJSON(15))||e.addTo(i)}))})),r=1<n.length?function(t){var e=[];return t.eachLayer((function(t){e.push(De(t.toGeoJSON(15)))})),function(t){return Oe({type:"MultiLineString",coordinates:t})}(e)}(i):i.toGeoJSON(15)}return r}});var Ae={enableLayerDrag:function(){if(this.disable(),this._map||(this._map=this._layer._map),this._layer instanceof L.Marker)return this._layer.on("dragstart",this._fireDragStart,this),this._layer.on("drag",this._fireDrag,this),this._layer.on("dragend",this._fireDragEnd,this),this.options.snappable?this._initSnappableMarkers():this._disableSnapping(),void(this._layer.dragging&&this._layer.dragging.enable());this._layer instanceof L.ImageOverlay&&(this._getDOMElem().ondragstart=function(){return!1}),this._tempDragCoord=null,this._layer._map.options.preferCanvas?(this._layer.on("mouseout",this.removeDraggingClass,this),this._layer.on("mouseover",this.addDraggingClass,this)):this.addDraggingClass(),this._originalMapDragState=this._layer._map.dragging._enabled,this._safeToCacheDragState=!0,this._layer.on("mousedown",this._dragMixinOnMouseDown,this)},disableLayerDrag:function(){if(this._layer instanceof L.Marker)return this._layer.off("dragstart",this._fireDragStart,this),this._layer.off("drag",this._fireDrag,this),this._layer.off("dragend",this._fireDragEnd,this),void(this._layer.dragging&&this._layer.dragging.disable());this._layer._map.options.preferCanvas?(this._layer.off("mouseout",this.removeDraggingClass,this),this._layer.off("mouseover",this.addDraggingClass,this)):this.removeDraggingClass(),this._safeToCacheDragState=!1,this._layer.off("mousedown",this._dragMixinOnMouseDown,this)},dragging:function(){return this._dragging},_dragMixinOnMouseDown:function(t){0<t.originalEvent.button||(this._safeToCacheDragState&&(this._originalMapDragState=this._layer._map.dragging._enabled,this._safeToCacheDragState=!1),this._tempDragCoord=t.latlng,this._layer._map.on("mouseup",this._dragMixinOnMouseUp,this),this._layer._map.on("mousemove",this._dragMixinOnMouseMove,this))},_dragMixinOnMouseMove:function(t){var e=this._getDOMElem();this._dragging||(this._dragging=!0,L.DomUtil.addClass(e,"leaflet-pm-dragging"),this._layer.bringToFront(),this._originalMapDragState&&this._layer._map.dragging.disable(),this._fireDragStart()),this._onLayerDrag(t)},_dragMixinOnMouseUp:function(){var t=this,e=this._getDOMElem();return this._originalMapDragState&&this._layer._map.dragging.enable(),this._safeToCacheDragState=!0,this._layer._map.off("mousemove",this._dragMixinOnMouseMove,this),this._layer._map.off("mouseup",this._dragMixinOnMouseUp,this),!!this._dragging&&(this._layer instanceof L.CircleMarker&&this._layer.pm._updateHiddenPolyCircle(),window.setTimeout((function(){t._dragging=!1,L.DomUtil.removeClass(e,"leaflet-pm-dragging"),t._fireDragEnd(),t._fireEdit()}),10),!0)},_onLayerDrag:function(t){var e=t.latlng,r=e.lat-this._tempDragCoord.lat,i=e.lng-this._tempDragCoord.lng,n=function t(e){return e.map((function(e){return Array.isArray(e)?t(e):{lat:e.lat+r,lng:e.lng+i}}))};if(this._layer instanceof L.Circle||this._layer instanceof L.CircleMarker&&this._layer.options.editable){var a=n([this._layer.getLatLng()]);this._layer.setLatLng(a[0])}else if(this._layer instanceof L.CircleMarker){var o=this._layer.getLatLng();this._layer._snapped&&(o=this._layer._orgLatLng);var s=n([o]);this._layer.setLatLng(s[0])}else if(this._layer instanceof L.ImageOverlay){var l=n([this._layer.getBounds().getNorthWest(),this._layer.getBounds().getSouthEast()]);this._layer.setBounds(l)}else{var h=n(this._layer.getLatLngs());this._layer.setLatLngs(h)}this._tempDragCoord=e,t.layer=this._layer,this._fireDrag(t)},_fireDragStart:function(){L.PM.Utils._fireEvent(this._layer,"pm:dragstart",{layer:this._layer,shape:this.getShape()})},_fireDrag:function(t){L.PM.Utils._fireEvent(this._layer,"pm:drag",Object.assign({},t,{shape:this.getShape()}))},_fireDragEnd:function(){L.PM.Utils._fireEvent(this._layer,"pm:dragend",{layer:this._layer,shape:this.getShape()})},addDraggingClass:function(){var t=this._getDOMElem();t&&L.DomUtil.addClass(t,"leaflet-pm-draggable")},removeDraggingClass:function(){var t=this._getDOMElem();t&&L.DomUtil.removeClass(t,"leaflet-pm-draggable")},_getDOMElem:function(){var t=null;return this._layer._path?t=this._layer._path:this._layer._renderer&&this._layer._renderer._container?t=this._layer._renderer._container:this._layer._image&&(t=this._layer._image),t}},Ge=L.Class.extend({includes:[Ae,N],options:{snappable:!0,snapDistance:20,allowSelfIntersection:!0,allowSelfIntersectionEdit:!1,preventMarkerRemoval:!1,removeLayerBelowMinVertexCount:!0,limitMarkersToCount:-1,hideMiddleMarkers:!1,draggable:!0},setOptions:function(t){L.Util.setOptions(this,t)},applyOptions:function(){},isPolygon:function(){return this._layer instanceof L.Polygon},getShape:function(){return this._shape},_setPane:function(t,e){"layerPane"===e?t.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.layerPane||"overlayPane":"vertexPane"===e?t.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.vertexPane||"markerPane":"markerPane"===e&&(t.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.markerPane||"markerPane")}});function Ne(t){return function(t){if(Array.isArray(t))return Ue(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Ue(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ue(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ue(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}Ge.LayerGroup=L.Class.extend({initialize:function(t){var e=this;this._layerGroup=t,this._layers=this.findLayers(),this._getMap(),this._layers.forEach((function(t){return e._initLayer(t)}));this._layerGroup.on("layeradd",L.Util.throttle((function(t){if(!t.target._pmTempLayer){e._layers=e.findLayers();var r=e._layers.filter((function(t){return!(t.pm._parentLayerGroup&&e._layerGroup._leaflet_id in t.pm._parentLayerGroup)}));r.forEach((function(t){e._initLayer(t)})),0<r.length&&e._getMap()&&e._getMap().pm.globalEditModeEnabled()&&e.enabled()&&e.enable(e.getOptions())}}),100,this),this),this._layerGroup.on("layerremove",(function(t){e._removeLayerFromGroup(t.target)}),this);this._layerGroup.on("layerremove",L.Util.throttle((function(t){t.target._pmTempLayer||(e._layers=e.findLayers())}),100,this),this)},enable:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];this._options=t,this._layers.forEach((function(r){r instanceof L.LayerGroup?-1===e.indexOf(r._leaflet_id)&&(e.push(r._leaflet_id),r.pm.enable(t,e)):r.pm.enable(t)}))},disable:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];this._layers.forEach((function(e){e instanceof L.LayerGroup?-1===t.indexOf(e._leaflet_id)&&(t.push(e._leaflet_id),e.pm.disable(t)):e.pm.disable()}))},enabled:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=this._layers.find((function(e){return e instanceof L.LayerGroup?-1===t.indexOf(e._leaflet_id)&&(t.push(e._leaflet_id),e.pm.enabled(t)):e.pm.enabled()}));return!!e},toggleEdit:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];this._options=t,this._layers.forEach((function(r){r instanceof L.LayerGroup?-1===e.indexOf(r._leaflet_id)&&(e.push(r._leaflet_id),r.pm.toggleEdit(t,e)):r.pm.toggleEdit(t)}))},_initLayer:function(t){var e=L.Util.stamp(this._layerGroup);t.pm._parentLayerGroup||(t.pm._parentLayerGroup={}),t.pm._parentLayerGroup[e]=this._layerGroup},_removeLayerFromGroup:function(t){if(t.pm&&t.pm._layerGroup){var e=L.Util.stamp(this._layerGroup);delete t.pm._layerGroup[e]}},findLayers:function(){var t=this._layerGroup.getLayers();return(t=t.filter((function(t){return!!t.pm}))).filter((function(t){return!t._pmTempLayer}))},dragging:function(){if(this._layers){var t=this._layers.find((function(t){return t.pm.dragging()}));return!!t}return!1},getOptions:function(){return this._options},_getMap:function(){var t;return this._map||(null===(t=this._layers.find((function(t){return!!t._map})))||void 0===t?void 0:t._map)||null}}),Ge.Marker=Ge.extend({_shape:"Marker",initialize:function(t){this._layer=t,this._enabled=!1,this._layer.on("dragend",this._onDragEnd,this)},enable:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{draggable:!0};L.Util.setOptions(this,t),this._map=this._layer._map,this.enabled()||(this.applyOptions(),this._enabled=!0,L.PM.Utils._fireEvent(this._layer,"pm:enable",{layer:this._layer,shape:this.getShape()}))},disable:function(){this._enabled=!1,this.disableLayerDrag(),this._layer.off("contextmenu",this._removeMarker,this),L.PM.Utils._fireEvent(this._layer,"pm:disable",{layer:this._layer,shape:this.getShape()}),this._layerEdited&&L.PM.Utils._fireEvent(this._layer,"pm:update",{layer:this._layer,shape:this.getShape()}),this._layerEdited=!1},enabled:function(){return this._enabled},toggleEdit:function(t){this.enabled()?this.disable():this.enable(t)},applyOptions:function(){this.options.snappable?this._initSnappableMarkers():this._disableSnapping(),this.options.draggable?this.enableLayerDrag():this.disableLayerDrag(),this.options.preventMarkerRemoval||this._layer.on("contextmenu",this._removeMarker,this)},_removeMarker:function(t){var e=t.target;e.remove(),L.PM.Utils._fireEvent(e,"pm:remove",{layer:e,shape:this.getShape()}),L.PM.Utils._fireEvent(this._map,"pm:remove",{layer:e,shape:this.getShape()})},_onDragEnd:function(t){var e=t.target;L.PM.Utils._fireEvent(e,"pm:edit",{layer:this._layer,shape:this.getShape()}),this._layerEdited=!0},_initSnappableMarkers:function(){var t=this._layer;this.options.snapDistance=this.options.snapDistance||30,t.off("drag",this._handleSnapping,this),t.on("drag",this._handleSnapping,this),t.off("dragend",this._cleanupSnapping,this),t.on("dragend",this._cleanupSnapping,this),t.off("pm:dragstart",this._unsnap,this),t.on("pm:dragstart",this._unsnap,this)},_disableSnapping:function(){var t=this._layer;t.off("drag",this._handleSnapping,this),t.off("dragend",this._cleanupSnapping,this),t.off("pm:dragstart",this._unsnap,this)}});var ze={filterMarkerGroup:function(){this.markerCache=[],this.createCache(),this._layer.on("pm:edit",this.createCache,this),this.applyLimitFilters({}),this._layer.on("pm:disable",this._removeMarkerLimitEvents,this),-1<this.options.limitMarkersToCount&&(this._layer.on("pm:vertexremoved",this._initMarkers,this),this._map.on("mousemove",this.applyLimitFilters,this))},_removeMarkerLimitEvents:function(){this._map.off("mousemove",this.applyLimitFilters,this),this._layer.off("pm:edit",this.createCache,this),this._layer.off("pm:disable",this._removeMarkerLimitEvents,this),this._layer.off("pm:vertexremoved",this._initMarkers,this)},createCache:function(){var t=[].concat(Ne(this._markerGroup.getLayers()),Ne(this.markerCache));this.markerCache=t.filter((function(t,e,r){return r.indexOf(t)===e}))},renderLimits:function(t){var e=this;this.markerCache.forEach((function(r){t.includes(r)?e._markerGroup.addLayer(r):e._markerGroup.removeLayer(r)}))},applyLimitFilters:function(t){var e=t.latlng,r=void 0===e?{lat:0,lng:0}:e,i=Ne(this._filterClosestMarkers(r));this.renderLimits(i)},_filterClosestMarkers:function(t){var e=Ne(this.markerCache),r=this.options.limitMarkersToCount;return e.sort((function(e,r){return e._latlng.distanceTo(t)-r._latlng.distanceTo(t)})),e.filter((function(t,e){return!(-1<r)||e<r}))}};function Fe(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}Ge.Line=Ge.extend({includes:[ze],_shape:"Line",initialize:function(t){this._layer=t,this._enabled=!1},enable:function(t){L.Util.setOptions(this,t),this._map=this._layer._map,this._map&&(this.enabled()||this.disable(),this._enabled=!0,this._initMarkers(),this.applyOptions(),this._layer.on("remove",this._onLayerRemove,this),this.options.allowSelfIntersection||this._layer.on("pm:vertexremoved",this._handleSelfIntersectionOnVertexRemoval,this),this.options.allowSelfIntersection?this.cachedColor=void 0:("#f00000ff"!==this._layer.options.color?(this.cachedColor=this._layer.options.color,this.isRed=!1):this.isRed=!0,this._handleLayerStyle()),L.PM.Utils._fireEvent(this._layer,"pm:enable",{layer:this._layer,shape:this.getShape()}))},disable:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._layer;if(!this.enabled())return!1;if(t.pm._dragging)return!1;t.pm._enabled=!1,t.pm._markerGroup.clearLayers(),t.pm._markerGroup.removeFrom(this._map),this._layer.off("remove",this._onLayerRemove,this),this.options.allowSelfIntersection||this._layer.off("pm:vertexremoved",this._handleSelfIntersectionOnVertexRemoval,this);var e=t._path?t._path:this._layer._renderer._container;return L.DomUtil.removeClass(e,"leaflet-pm-draggable"),this.hasSelfIntersection()&&L.DomUtil.removeClass(e,"leaflet-pm-invalid"),this._layerEdited&&L.PM.Utils._fireEvent(this._layer,"pm:update",{layer:this._layer,shape:this.getShape()}),this._layerEdited=!1,L.PM.Utils._fireEvent(this._layer,"pm:disable",{layer:this._layer,shape:this.getShape()}),!0},enabled:function(){return this._enabled},toggleEdit:function(t){return this.enabled()?this.disable():this.enable(t),this.enabled()},applyOptions:function(){this.options.snappable?this._initSnappableMarkers():this._disableSnapping()},_onLayerRemove:function(t){this.disable(t.target)},_initMarkers:function(){var t=this,e=this._map,r=this._layer.getLatLngs();this._markerGroup&&this._markerGroup.clearLayers(),this._markerGroup=new L.LayerGroup,this._markerGroup._pmTempLayer=!0;this._markers=function e(r){if(Array.isArray(r[0]))return r.map(e,t);var i=r.map(t._createMarker,t);return!0!==t.options.hideMiddleMarkers&&r.map((function(e,n){var a=t.isPolygon()?(n+1)%r.length:n+1;return t._createMiddleMarker(i[n],i[a])})),i}(r),this.filterMarkerGroup(),e.addLayer(this._markerGroup)},_createMarker:function(t){var e=new L.Marker(t,{draggable:!0,icon:L.divIcon({className:"marker-icon"})});return this._setPane(e,"vertexPane"),e._pmTempLayer=!0,e.on("click",this._onVertexClick,this),e.on("dragstart",this._onMarkerDragStart,this),e.on("move",this._onMarkerDrag,this),e.on("dragend",this._onMarkerDragEnd,this),this.options.preventMarkerRemoval||e.on("contextmenu",this._removeMarker,this),this._markerGroup.addLayer(e),e},_createMiddleMarker:function(t,e){if(!t||!e)return!1;var r=L.PM.Utils.calcMiddleLatLng(this._map,t.getLatLng(),e.getLatLng()),i=this._createMarker(r),n=L.divIcon({className:"marker-icon marker-icon-middle"});return i.setIcon(n),i.leftM=t,i.rightM=e,t._middleMarkerNext=i,(e._middleMarkerPrev=i).on("click",this._onMiddleMarkerClick,this),i.on("movestart",this._onMiddleMarkerMoveStart,this),i},_onMiddleMarkerClick:function(t){var e=t.target,r=L.divIcon({className:"marker-icon"});e.setIcon(r),this._addMarker(e,e.leftM,e.rightM)},_onMiddleMarkerMoveStart:function(t){var e=t.target;e._dragging=!0,e.on("moveend",this._onMiddleMarkerMoveEnd,this),this._addMarker(e,e.leftM,e.rightM)},_onMiddleMarkerMoveEnd:function(t){var e=t.target,r=L.divIcon({className:"marker-icon"});e.setIcon(r),e.off("moveend",this._onMiddleMarkerMoveEnd,this),setTimeout((function(){delete e._dragging}),100)},_addMarker:function(t,e,r){t.off("movestart",this._onMiddleMarkerMoveStart,this),t.off("click",this._onMiddleMarkerClick,this);var i=t.getLatLng(),n=this._layer._latlngs;delete t.leftM,delete t.rightM;var a=this.findDeepMarkerIndex(this._markers,e),o=a.indexPath,s=a.index,l=a.parentPath,h=1<o.length?C()(n,l):n,u=1<o.length?C()(this._markers,l):this._markers;h.splice(s+1,0,i),u.splice(s+1,0,t),this._layer.setLatLngs(n),!0!==this.options.hideMiddleMarkers&&(this._createMiddleMarker(e,t),this._createMiddleMarker(t,r)),this._fireEdit(),L.PM.Utils._fireEvent(this._layer,"pm:vertexadded",{layer:this._layer,marker:t,indexPath:this.findDeepMarkerIndex(this._markers,t).indexPath,latlng:i,shape:this.getShape()}),this.options.snappable&&this._initSnappableMarkers()},hasSelfIntersection:function(){return 0<F()(this._layer.toGeoJSON(15)).features.length},_handleSelfIntersectionOnVertexRemoval:function(){this._handleLayerStyle(!0),this.hasSelfIntersection()&&(this._layer.setLatLngs(this._coordsBeforeEdit),this._coordsBeforeEdit=null,this._initMarkers())},_handleLayerStyle:function(t){var e=this._layer;if(this.hasSelfIntersection()){if(!this.options.allowSelfIntersection&&this.options.allowSelfIntersectionEdit&&this._updateDisabledMarkerStyle(this._markers,!0),this.isRed)return;t?this._flashLayer():(e.setStyle({color:"#f00000ff"}),this.isRed=!0),L.PM.Utils._fireEvent(this._layer,"pm:intersect",{layer:this._layer,intersection:F()(this._layer.toGeoJSON(15)),shape:this.getShape()})}else e.setStyle({color:this.cachedColor}),this.isRed=!1,!this.options.allowSelfIntersection&&this.options.allowSelfIntersectionEdit&&this._updateDisabledMarkerStyle(this._markers,!1)},_flashLayer:function(){var t=this;this.cachedColor||(this.cachedColor=this._layer.options.color),this._layer.setStyle({color:"#f00000ff"}),this.isRed=!0,window.setTimeout((function(){t._layer.setStyle({color:t.cachedColor}),t.isRed=!1}),200)},_updateDisabledMarkerStyle:function(t,e){var r=this;t.forEach((function(t){if(Array.isArray(t))return r._updateDisabledMarkerStyle(t,e);t._icon&&(e&&!r._checkMarkerAllowedToDrag(t)?L.DomUtil.addClass(t._icon,"vertexmarker-disabled"):L.DomUtil.removeClass(t._icon,"vertexmarker-disabled"))}))},_removeMarker:function(t){if(!this.options.allowSelfIntersection){var e=this._layer.getLatLngs();this._coordsBeforeEdit=JSON.parse(JSON.stringify(e))}var r=t.target,i=this._layer.getLatLngs(),n=this.findDeepMarkerIndex(this._markers,r),a=n.indexPath,o=n.index,s=n.parentPath;if(a){var l=1<a.length?C()(i,s):i,h=1<a.length?C()(this._markers,s):this._markers;if(this.options.removeLayerBelowMinVertexCount||!(l.length<=2||this.isPolygon()&&l.length<=3)){l.splice(o,1),this._layer.setLatLngs(i),this.isPolygon()&&l.length<=2&&l.splice(0,l.length);var u=!1;if(l.length<=1&&(l.splice(0,l.length),this._layer.setLatLngs(i),this.disable(),this.enable(this.options),u=!0),O(i)&&this._layer.remove(),i=R(i),this._layer.setLatLngs(i),this._markers=R(this._markers),!u&&(h=1<a.length?C()(this._markers,s):this._markers,r._middleMarkerPrev&&this._markerGroup.removeLayer(r._middleMarkerPrev),r._middleMarkerNext&&this._markerGroup.removeLayer(r._middleMarkerNext),this._markerGroup.removeLayer(r),h)){var c,p;if(this.isPolygon()?(c=(o+1)%h.length,p=(o+(h.length-1))%h.length):(p=o-1<0?void 0:o-1,c=o+1>=h.length?void 0:o+1),c!==p){var f=h[p],d=h[c];!0!==this.options.hideMiddleMarkers&&this._createMiddleMarker(f,d)}h.splice(o,1)}this._fireEdit(),L.PM.Utils._fireEvent(this._layer,"pm:vertexremoved",{layer:this._layer,marker:r,indexPath:a,shape:this.getShape()})}else this._flashLayer()}},findDeepMarkerIndex:function(t,e){var r;t.some(function t(i){return function(n,a){var o=i.concat(a);return n._leaflet_id===e._leaflet_id?(r=o,!0):Array.isArray(n)&&n.some(t(o))}}([]));var i={};return r&&(i={indexPath:r,index:r[r.length-1],parentPath:r.slice(0,r.length-1)}),i},updatePolygonCoordsFromMarkerDrag:function(t){var e=this._layer.getLatLngs(),r=t.getLatLng(),i=this.findDeepMarkerIndex(this._markers,t),n=i.indexPath,a=i.index,o=i.parentPath;(1<n.length?C()(e,o):e).splice(a,1,r),this._layer.setLatLngs(e)},_getNeighborMarkers:function(t){var e=this.findDeepMarkerIndex(this._markers,t),r=e.indexPath,i=e.index,n=e.parentPath,a=1<r.length?C()(this._markers,n):this._markers,o=(i+1)%a.length;return{prevMarker:a[(i+(a.length-1))%a.length],nextMarker:a[o]}},_checkMarkerAllowedToDrag:function(t){var e=this._getNeighborMarkers(t),r=e.prevMarker,i=e.nextMarker,n=L.polyline([r.getLatLng(),t.getLatLng()]),a=L.polyline([t.getLatLng(),i.getLatLng()]),o=X()(this._layer.toGeoJSON(15),n.toGeoJSON(15)).features.length,s=X()(this._layer.toGeoJSON(15),a.toGeoJSON(15)).features.length;return t.getLatLng()===this._markers[0][0].getLatLng()?s+=1:t.getLatLng()===this._markers[0][this._markers[0].length-1].getLatLng()&&(o+=1),!(o<=2&&s<=2)},_onMarkerDragStart:function(t){var e=t.target,r=this.findDeepMarkerIndex(this._markers,e).indexPath;L.PM.Utils._fireEvent(this._layer,"pm:markerdragstart",{layer:this._layer,markerEvent:t,indexPath:r,shape:this.getShape()}),this.options.allowSelfIntersection||(this._coordsBeforeEdit=this._layer.getLatLngs()),this.cachedColor||(this.cachedColor=this._layer.options.color),!this.options.allowSelfIntersection&&this.options.allowSelfIntersectionEdit&&this.hasSelfIntersection()?this._markerAllowedToDrag=this._checkMarkerAllowedToDrag(e):this._markerAllowedToDrag=null},_onMarkerDrag:function(t){var e=t.target,r=this.findDeepMarkerIndex(this._markers,e),i=r.indexPath,n=r.index,a=r.parentPath;if(i){if(!this.options.allowSelfIntersection&&this.options.allowSelfIntersectionEdit&&this.hasSelfIntersection()&&!1===this._markerAllowedToDrag)return this._layer.setLatLngs(this._coordsBeforeEdit),this._initMarkers(),void this._handleLayerStyle();this.updatePolygonCoordsFromMarkerDrag(e);var o=1<i.length?C()(this._markers,a):this._markers,s=(n+1)%o.length,l=(n+(o.length-1))%o.length,h=e.getLatLng(),u=o[l].getLatLng(),c=o[s].getLatLng();if(e._middleMarkerNext){var p=L.PM.Utils.calcMiddleLatLng(this._map,h,c);e._middleMarkerNext.setLatLng(p)}if(e._middleMarkerPrev){var f=L.PM.Utils.calcMiddleLatLng(this._map,h,u);e._middleMarkerPrev.setLatLng(f)}this.options.allowSelfIntersection||this._handleLayerStyle(),L.PM.Utils._fireEvent(this._layer,"pm:markerdrag",{layer:this._layer,markerEvent:t,shape:this.getShape(),indexPath:i})}},_onMarkerDragEnd:function(t){var e=t.target,r=this.findDeepMarkerIndex(this._markers,e).indexPath,i=this.hasSelfIntersection();i&&this.options.allowSelfIntersectionEdit&&this._markerAllowedToDrag&&(i=!1);var n=!this.options.allowSelfIntersection&&i;if(L.PM.Utils._fireEvent(this._layer,"pm:markerdragend",{layer:this._layer,markerEvent:t,indexPath:r,shape:this.getShape(),intersectionReset:n}),n)return this._layer.setLatLngs(this._coordsBeforeEdit),this._coordsBeforeEdit=null,this._initMarkers(),this.options.snappable&&this._initSnappableMarkers(),this._handleLayerStyle(),void L.PM.Utils._fireEvent(this._layer,"pm:layerreset",{layer:this._layer,markerEvent:t,indexPath:r,shape:this.getShape()});!this.options.allowSelfIntersection&&this.options.allowSelfIntersectionEdit&&this._handleLayerStyle(),this._fireEdit()},_onVertexClick:function(t){var e=t.target;if(!e._dragging){var r=this.findDeepMarkerIndex(this._markers,e).indexPath;L.PM.Utils._fireEvent(this._layer,"pm:vertexclick",{layer:this._layer,markerEvent:t,indexPath:r,shape:this.getShape()})}},_fireEdit:function(){this._layerEdited=!0,L.PM.Utils._fireEvent(this._layer,"pm:edit",{layer:this._layer,shape:this.getShape()})}}),Ge.Polygon=Ge.Line.extend({_shape:"Polygon",_checkMarkerAllowedToDrag:function(t){var e=this._getNeighborMarkers(t),r=e.prevMarker,i=e.nextMarker,n=L.polyline([r.getLatLng(),t.getLatLng()]),a=L.polyline([t.getLatLng(),i.getLatLng()]),o=X()(this._layer.toGeoJSON(15),n.toGeoJSON(15)).features.length,s=X()(this._layer.toGeoJSON(15),a.toGeoJSON(15)).features.length;return!(o<=2&&s<=2)}}),Ge.Rectangle=Ge.Polygon.extend({_shape:"Rectangle",_initMarkers:function(){var t=this._map,e=this._findCorners();this._markerGroup&&this._markerGroup.clearLayers(),this._markerGroup=new L.LayerGroup,this._markerGroup._pmTempLayer=!0,t.addLayer(this._markerGroup),this._markers=[],this._markers[0]=e.map(this._createMarker,this);var r=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],i=!0,n=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);i=!0);}catch(t){n=!0,a=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw a}}return r}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Fe(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Fe(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(this._markers,1);this._cornerMarkers=r[0]},applyOptions:function(){this.options.snappable?this._initSnappableMarkers():this._disableSnapping(),this._addMarkerEvents()},_createMarker:function(t,e){var r=new L.Marker(t,{draggable:!0,icon:L.divIcon({className:"marker-icon"})});return this._setPane(r,"vertexPane"),r._origLatLng=t,r._index=e,r._pmTempLayer=!0,this._markerGroup.addLayer(r),r},_addMarkerEvents:function(){var t=this;this._markers[0].forEach((function(e){e.on("dragstart",t._onMarkerDragStart,t),e.on("drag",t._onMarkerDrag,t),e.on("dragend",t._onMarkerDragEnd,t),e.on("pm:snap",t._adjustRectangleForMarkerSnap,t),t.options.preventMarkerRemoval||e.on("contextmenu",t._removeMarker,t)}))},_removeMarker:function(){return null},_onMarkerDragStart:function(t){var e=t.target,r=this._findCorners();e._oppositeCornerLatLng=r[(e._index+2)%4],e._snapped=!1,L.PM.Utils._fireEvent(this._layer,"pm:markerdragstart",{layer:this._layer,markerEvent:t,shape:this.getShape(),indexPath:void 0})},_onMarkerDrag:function(t){var e=t.target;void 0!==e._index&&(e._snapped||this._adjustRectangleForMarkerMove(e),L.PM.Utils._fireEvent(this._layer,"pm:markerdrag",{layer:this._layer,markerEvent:t,shape:this.getShape(),indexPath:void 0}))},_onMarkerDragEnd:function(t){var e=this._findCorners();this._adjustAllMarkers(e),this._cornerMarkers.forEach((function(t){delete t._oppositeCornerLatLng})),this._layer.setLatLngs(e),L.PM.Utils._fireEvent(this._layer,"pm:markerdragend",{layer:this._layer,markerEvent:t,shape:this.getShape(),indexPath:void 0}),this._fireEdit()},_adjustRectangleForMarkerMove:function(t){L.extend(t._origLatLng,t._latlng);var e=t.getLatLng();this._layer.setBounds(L.latLngBounds(e,t._oppositeCornerLatLng)),this._adjustAdjacentMarkers(t),this._layer.redraw()},_adjustRectangleForMarkerSnap:function(t){if(this.options.snappable){var e=t.target;this._adjustRectangleForMarkerMove(e)}},_adjustAllMarkers:function(t){t.length&&4===t.length?this._cornerMarkers.forEach((function(e,r){e.setLatLng(t[r])})):console.error("_adjustAllMarkers() requires an array of EXACTLY 4 LatLng coordinates")},_adjustAdjacentMarkers:function(t){if(t&&t.getLatLng&&t._oppositeCornerLatLng){var e=t.getLatLng(),r=t._oppositeCornerLatLng,i=[];this._findCorners().forEach((function(t){t.equals(e)||t.equals(r)||i.push(t)}));var n=0;2===i.length&&this._cornerMarkers.forEach((function(t){var a=t.getLatLng();a.equals(e)||a.equals(r)||(t.setLatLng(i[n]),n+=1)}))}else console.error("_adjustAdjacentMarkers() requires a valid Marker object")},_findCorners:function(){var t=this._layer.getBounds();return[t.getNorthWest(),t.getNorthEast(),t.getSouthEast(),t.getSouthWest()]}}),Ge.Circle=Ge.extend({_shape:"Circle",initialize:function(t){this._layer=t,this._enabled=!1,this._updateHiddenPolyCircle()},enable:function(t){var e=this;L.Util.setOptions(this,t),this._map=this._layer._map,this.enabled()||this.disable(),this._enabled=!0,this._initMarkers(),this.applyOptions(),this._layer.on("remove",(function(t){e.disable(t.target)})),this._updateHiddenPolyCircle(),L.PM.Utils._fireEvent(this._layer,"pm:enable",{layer:this._layer,shape:this.getShape()})},disable:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._layer;if(!this.enabled())return!1;if(t.pm._dragging)return!1;this._centerMarker.off("dragstart",this._fireDragStart,this),this._centerMarker.off("drag",this._fireDrag,this),this._centerMarker.off("dragend",this._fireDragEnd,this),this._outerMarker.off("drag",this._handleOuterMarkerSnapping,this),t.pm._enabled=!1,t.pm._helperLayers.clearLayers();var e=t._path?t._path:this._layer._renderer._container;return L.DomUtil.removeClass(e,"leaflet-pm-draggable"),this._layerEdited&&L.PM.Utils._fireEvent(this._layer,"pm:update",{layer:this._layer,shape:this.getShape()}),this._layerEdited=!1,L.PM.Utils._fireEvent(this._layer,"pm:disable",{layer:this._layer,shape:this.getShape()}),!0},enabled:function(){return this._enabled},toggleEdit:function(t){this.enabled()?this.disable():this.enable(t)},_initMarkers:function(){var t=this._map;this._helperLayers&&this._helperLayers.clearLayers(),this._helperLayers=new L.LayerGroup,this._helperLayers._pmTempLayer=!0,this._helperLayers.addTo(t);var e=this._layer.getLatLng(),r=this._layer._radius,i=this._getLatLngOnCircle(e,r);this._centerMarker=this._createCenterMarker(e),this._outerMarker=this._createOuterMarker(i),this._markers=[this._centerMarker,this._outerMarker],this._createHintLine(this._centerMarker,this._outerMarker)},applyOptions:function(){this.options.snappable?(this._initSnappableMarkers(),this._outerMarker.on("drag",this._handleOuterMarkerSnapping,this),this._outerMarker.on("move",this._syncHintLine,this),this._outerMarker.on("move",this._syncCircleRadius,this),this._centerMarker.on("move",this._moveCircle,this)):this._disableSnapping()},_createHintLine:function(t,e){var r=t.getLatLng(),i=e.getLatLng();this._hintline=L.polyline([r,i],this.options.hintlineStyle),this._setPane(this._hintline,"layerPane"),this._hintline._pmTempLayer=!0,this._helperLayers.addLayer(this._hintline)},_createCenterMarker:function(t){var e=this._createMarker(t);return L.DomUtil.addClass(e._icon,"leaflet-pm-draggable"),e.on("drag",this._moveCircle,this),e.on("dragstart",this._fireDragStart,this),e.on("drag",this._fireDrag,this),e.on("dragend",this._fireDragEnd,this),e},_createOuterMarker:function(t){var e=this._createMarker(t);return e.on("drag",this._resizeCircle,this),e},_createMarker:function(t){var e=new L.Marker(t,{draggable:!0,icon:L.divIcon({className:"marker-icon"})});return this._setPane(e,"vertexPane"),e._origLatLng=t,e._pmTempLayer=!0,e.on("dragstart",this._onMarkerDragStart,this),e.on("drag",this._onMarkerDrag,this),e.on("dragend",this._onMarkerDragEnd,this),this._helperLayers.addLayer(e),e},_resizeCircle:function(){this._outerMarker.setLatLng(this._getNewDestinationOfOuterMarker()),this._syncHintLine(),this._syncCircleRadius()},_moveCircle:function(t){var e=t.latlng;this._layer.setLatLng(e);var r=this._layer._radius,i=this._getLatLngOnCircle(e,r);this._outerMarker.setLatLng(i),this._syncHintLine(),this._updateHiddenPolyCircle(),L.PM.Utils._fireEvent(this._layer,"pm:centerplaced",{layer:this._layer,latlng:e,shape:this.getShape()})},_syncCircleRadius:function(){var t=this._centerMarker.getLatLng(),e=this._outerMarker.getLatLng(),r=t.distanceTo(e);this.options.minRadiusCircle&&r<this.options.minRadiusCircle?this._layer.setRadius(this.options.minRadiusCircle):this.options.maxRadiusCircle&&r>this.options.maxRadiusCircle?this._layer.setRadius(this.options.maxRadiusCircle):this._layer.setRadius(r),this._updateHiddenPolyCircle()},_syncHintLine:function(){var t=this._centerMarker.getLatLng(),e=this._outerMarker.getLatLng();this._hintline.setLatLngs([t,e])},_disableSnapping:function(){var t=this;this._markers.forEach((function(e){e.off("move",t._syncHintLine,t),e.off("move",t._syncCircleRadius,t),e.off("drag",t._handleSnapping,t),e.off("dragend",t._cleanupSnapping,t)})),this._layer.off("pm:dragstart",this._unsnap,this)},_onMarkerDragStart:function(t){L.PM.Utils._fireEvent(this._layer,"pm:markerdragstart",{layer:this._layer,markerEvent:t,shape:this.getShape(),indexPath:void 0})},_onMarkerDrag:function(t){L.PM.Utils._fireEvent(this._layer,"pm:markerdrag",{layer:this._layer,markerEvent:t,shape:this.getShape(),indexPath:void 0})},_onMarkerDragEnd:function(t){this._fireEdit(),L.PM.Utils._fireEvent(this._layer,"pm:markerdragend",{layer:this._layer,markerEvent:t,shape:this.getShape(),indexPath:void 0})},_fireEdit:function(){L.PM.Utils._fireEvent(this._layer,"pm:edit",{layer:this._layer,shape:this.getShape()}),this._layerEdited=!0},_fireDragStart:function(){L.PM.Utils._fireEvent(this._layer,"pm:dragstart",{layer:this._layer,shape:this.getShape()})},_fireDrag:function(t){L.PM.Utils._fireEvent(this._layer,"pm:drag",Object.assign({},t,{shape:this.getShape()}))},_fireDragEnd:function(){L.PM.Utils._fireEvent(this._layer,"pm:dragend",{layer:this._layer,shape:this.getShape()})},_updateHiddenPolyCircle:function(){this._hiddenPolyCircle?this._hiddenPolyCircle.setLatLngs(L.PM.Utils.circleToPolygon(this._layer,200).getLatLngs()):this._hiddenPolyCircle=L.PM.Utils.circleToPolygon(this._layer,200),this._hiddenPolyCircle._parentCopy||(this._hiddenPolyCircle._parentCopy=this._layer)},_getLatLngOnCircle:function(t,e){var r=this._map.project(t),i=L.point(r.x+e,r.y);return this._map.unproject(i)},_getNewDestinationOfOuterMarker:function(){var t=this._centerMarker.getLatLng(),e=this._outerMarker.getLatLng(),r=t.distanceTo(e);return this.options.minRadiusCircle&&r<this.options.minRadiusCircle?e=I(this._map,t,e,this.options.minRadiusCircle):this.options.maxRadiusCircle&&r>this.options.maxRadiusCircle&&(e=I(this._map,t,e,this.options.maxRadiusCircle)),e},_handleOuterMarkerSnapping:function(){if(this._outerMarker._snapped){var t=this._centerMarker.getLatLng(),e=this._outerMarker.getLatLng(),r=t.distanceTo(e);(this.options.minRadiusCircle&&r<this.options.minRadiusCircle||this.options.maxRadiusCircle&&r>this.options.maxRadiusCircle)&&this._outerMarker.setLatLng(this._outerMarker._orgLatLng)}this._outerMarker.setLatLng(this._getNewDestinationOfOuterMarker())}}),Ge.CircleMarker=Ge.extend({_shape:"CircleMarker",initialize:function(t){this._layer=t,this._enabled=!1,this._updateHiddenPolyCircle()},enable:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{draggable:!0,snappable:!0};L.Util.setOptions(this,t),this._map=this._layer._map,this._map&&(this.enabled()&&this.disable(),this.applyOptions(),this._enabled=!0,this._layer.on("pm:dragstart",this._onDragStart,this),this._layer.on("pm:dragend",this._onMarkerDragEnd,this),this._updateHiddenPolyCircle(),L.PM.Utils._fireEvent(this._layer,"pm:enable",{layer:this._layer,shape:this.getShape()}))},disable:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._layer;return!(t.pm._dragging||(t.pm._helperLayers&&t.pm._helperLayers.clearLayers(),this._map||(this._map=this._layer._map),this.options.editable?(this._map.off("move",this._syncMarkers,this),this._outerMarker&&this._outerMarker.on("drag",this._handleOuterMarkerSnapping,this)):this._map.off("move",this._updateHiddenPolyCircle,this),this.disableLayerDrag(),this._layer.off("contextmenu",this._removeMarker,this),this.enabled()&&(this._layerEdited&&L.PM.Utils._fireEvent(this._layer,"pm:update",{layer:this._layer,shape:this.getShape()}),this._layerEdited=!1,L.PM.Utils._fireEvent(this._layer,"pm:disable",{layer:this._layer,shape:this.getShape()})),t.pm._enabled=!1))},enabled:function(){return this._enabled},toggleEdit:function(t){this.enabled()?this.disable():this.enable(t)},applyOptions:function(){!this.options.editable&&this.options.draggable?this.enableLayerDrag():this.disableLayerDrag(),this.options.editable?(this._initMarkers(),this._map.on("move",this._syncMarkers,this)):this._map.on("move",this._updateHiddenPolyCircle,this),this.options.snappable?this.options.editable?(this._initSnappableMarkers(),this._centerMarker.on("drag",this._moveCircle,this),this.options.editable&&this._outerMarker.on("drag",this._handleOuterMarkerSnapping,this),this._outerMarker.on("move",this._syncHintLine,this),this._outerMarker.on("move",this._syncCircleRadius,this)):this._initSnappableMarkersDrag():this.options.editable?this._disableSnapping():this._disableSnappingDrag(),this.options.preventMarkerRemoval||this._layer.on("contextmenu",this._removeMarker,this)},_initMarkers:function(){var t=this._map;this._helperLayers&&this._helperLayers.clearLayers(),this._helperLayers=new L.LayerGroup,this._helperLayers._pmTempLayer=!0,this._helperLayers.addTo(t);var e=this._layer.getLatLng(),r=this._layer._radius,i=this._getLatLngOnCircle(e,r);this._centerMarker=this._createCenterMarker(e),this._outerMarker=this._createOuterMarker(i),this._markers=[this._centerMarker,this._outerMarker],this._createHintLine(this._centerMarker,this._outerMarker)},_getLatLngOnCircle:function(t,e){var r=this._map.project(t),i=L.point(r.x+e,r.y);return this._map.unproject(i)},_createHintLine:function(t,e){var r=t.getLatLng(),i=e.getLatLng();this._hintline=L.polyline([r,i],this.options.hintlineStyle),this._setPane(this._hintline,"layerPane"),this._hintline._pmTempLayer=!0,this._helperLayers.addLayer(this._hintline)},_createCenterMarker:function(t){var e=this._createMarker(t);return this.options.draggable?L.DomUtil.addClass(e._icon,"leaflet-pm-draggable"):e.dragging.disable(),e},_createOuterMarker:function(t){var e=this._createMarker(t);return e.on("drag",this._resizeCircle,this),e},_createMarker:function(t){var e=new L.Marker(t,{draggable:!0,icon:L.divIcon({className:"marker-icon"})});return this._setPane(e,"vertexPane"),e._origLatLng=t,e._pmTempLayer=!0,e.on("dragstart",this._onMarkerDragStart,this),e.on("drag",this._onMarkerDrag,this),e.on("dragend",this._onMarkerDragEnd,this),this._helperLayers.addLayer(e),e},_moveCircle:function(){var t=this._centerMarker.getLatLng();this._layer.setLatLng(t);var e=this._layer._radius,r=this._getLatLngOnCircle(t,e);this._outerMarker.setLatLng(r),this._syncHintLine(),this._updateHiddenPolyCircle(),L.PM.Utils._fireEvent(this._layer,"pm:centerplaced",{layer:this._layer,latlng:t,shape:this.getShape()})},_syncMarkers:function(){var t=this._layer.getLatLng(),e=this._layer._radius,r=this._getLatLngOnCircle(t,e);this._outerMarker.setLatLng(r),this._centerMarker.setLatLng(t),this._syncHintLine(),this._updateHiddenPolyCircle()},_resizeCircle:function(){this._outerMarker.setLatLng(this._getNewDestinationOfOuterMarker()),this._syncHintLine(),this._syncCircleRadius()},_syncCircleRadius:function(){var t=this._centerMarker.getLatLng(),e=this._outerMarker.getLatLng(),r=this._map.project(t).distanceTo(this._map.project(e));this.options.minRadiusCircleMarker&&r<this.options.minRadiusCircleMarker?this._layer.setRadius(this.options.minRadiusCircleMarker):this.options.maxRadiusCircleMarker&&r>this.options.maxRadiusCircleMarker?this._layer.setRadius(this.options.maxRadiusCircleMarker):this._layer.setRadius(r),this._updateHiddenPolyCircle()},_syncHintLine:function(){var t=this._centerMarker.getLatLng(),e=this._outerMarker.getLatLng();this._hintline.setLatLngs([t,e])},_removeMarker:function(){this.options.editable&&this.disable(),this._layer.remove(),L.PM.Utils._fireEvent(this._layer,"pm:remove",{layer:this._layer,shape:this.getShape()}),L.PM.Utils._fireEvent(this._map,"pm:remove",{layer:this._layer,shape:this.getShape()})},_onDragStart:function(){this._map.pm.Draw.CircleMarker._layerIsDragging=!0},_onMarkerDragStart:function(t){L.PM.Utils._fireEvent(this._layer,"pm:markerdragstart",{markerEvent:t,layer:this._layer,shape:this.getShape(),indexPath:void 0})},_onMarkerDrag:function(t){L.PM.Utils._fireEvent(this._layer,"pm:markerdrag",{layer:this._layer,markerEvent:t,shape:this.getShape(),indexPath:void 0})},_onMarkerDragEnd:function(t){this._map.pm.Draw.CircleMarker._layerIsDragging=!1,L.PM.Utils._fireEvent(this._layer,"pm:markerdragend",{layer:this._layer,markerEvent:t,shape:this.getShape(),indexPath:void 0})},_fireEdit:function(){L.PM.Utils._fireEvent(this._layer,"pm:edit",{layer:this._layer,shape:this.getShape()}),this._layerEdited=!0},_initSnappableMarkersDrag:function(){var t=this._layer;this.options.snapDistance=this.options.snapDistance||30,t.off("pm:drag",this._handleSnapping,this),t.on("pm:drag",this._handleSnapping,this),t.off("pm:dragend",this._cleanupSnapping,this),t.on("pm:dragend",this._cleanupSnapping,this),t.off("pm:dragstart",this._unsnap,this),t.on("pm:dragstart",this._unsnap,this)},_disableSnappingDrag:function(){var t=this._layer;t.off("pm:drag",this._handleSnapping,this),t.off("pm:dragend",this._cleanupSnapping,this),t.off("pm:dragstart",this._unsnap,this)},_updateHiddenPolyCircle:function(){var t=this._layer._map||this._map;if(t){var e=t.project(this._layer.getLatLng()),r=L.point(e.x+this._layer.getRadius(),e.y),i=this._layer.getLatLng().distanceTo(t.unproject(r)),n=L.circle(this._layer.getLatLng(),this._layer.options);n.setRadius(i),this._hiddenPolyCircle?this._hiddenPolyCircle.setLatLngs(L.PM.Utils.circleToPolygon(n,200).getLatLngs()):this._hiddenPolyCircle=L.PM.Utils.circleToPolygon(n,200),this._hiddenPolyCircle._parentCopy||(this._hiddenPolyCircle._parentCopy=this._layer)}},_getNewDestinationOfOuterMarker:function(){var t=this._centerMarker.getLatLng(),e=this._outerMarker.getLatLng(),r=this._map.project(t).distanceTo(this._map.project(e));return this.options.minRadiusCircleMarker&&r<this.options.minRadiusCircleMarker?e=I(this._map,t,e,this._pxRadiusToMeter(this.options.minRadiusCircleMarker)):this.options.maxRadiusCircleMarker&&r>this.options.maxRadiusCircleMarker&&(e=I(this._map,t,e,this._pxRadiusToMeter(this.options.maxRadiusCircleMarker))),e},_handleOuterMarkerSnapping:function(){if(this._outerMarker._snapped){var t=this._centerMarker.getLatLng(),e=this._outerMarker.getLatLng(),r=this._map.project(t).distanceTo(this._map.project(e));(this.options.minRadiusCircleMarker&&r<this.options.minRadiusCircleMarker||this.options.maxRadiusCircleMarker&&r>this.options.maxRadiusCircleMarker)&&this._outerMarker.setLatLng(this._outerMarker._orgLatLng)}this._outerMarker.setLatLng(this._getNewDestinationOfOuterMarker())},_pxRadiusToMeter:function(t){var e=this._centerMarker.getLatLng(),r=this._map.project(e),i=L.point(r.x+t,r.y);return this._map.unproject(i).distanceTo(e)}}),Ge.ImageOverlay=Ge.extend({_shape:"ImageOverlay",initialize:function(t){this._layer=t,this._enabled=!1},toggleEdit:function(t){this.enabled()?this.disable():this.enable(t)},enabled:function(){return this._enabled},enable:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{draggable:!0,snappable:!0};L.Util.setOptions(this,t),this._map=this._layer._map,this._map&&(this.enabled()||this.disable(),this.enableLayerDrag(),this._enabled=!0,this._otherSnapLayers=L.PM.Edit.Rectangle.prototype._findCorners.apply(this),L.PM.Utils._fireEvent(this._layer,"pm:enable",{layer:this._layer,shape:this.getShape()}))},disable:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._layer;return!(t.pm._dragging||(this._map||(this._map=this._layer._map),this.disableLayerDrag(),this.enabled()||(this._layerEdited&&L.PM.Utils._fireEvent(t,"pm:update",{layer:t,shape:this.getShape()}),this._layerEdited=!1,L.PM.Utils._fireEvent(t,"pm:disable",{layer:t,shape:this.getShape()})),this._layer.off("contextmenu",this._removeMarker,this),t.pm._enabled=!1))},_fireEdit:function(){L.PM.Utils._fireEvent(this._layer,"pm:edit",{layer:this._layer,shape:this.getShape()}),this._layerEdited=!0}}),r(152),r(153);var Ye={calcMiddleLatLng:function(t,e,r){var i=t.project(e),n=t.project(r);return t.unproject(i._add(n)._divideBy(2))},findLayers:function(t){var e=[];return t.eachLayer((function(t){(t instanceof L.Polyline||t instanceof L.Marker||t instanceof L.Circle||t instanceof L.CircleMarker||t instanceof L.ImageOverlay)&&e.push(t)})),e=(e=(e=e.filter((function(t){return!!t.pm}))).filter((function(t){return!t._pmTempLayer}))).filter((function(t){return!L.PM.optIn&&!t.options.pmIgnore||L.PM.optIn&&!1===t.options.pmIgnore}))},circleToPolygon:function(t){for(var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:60,r=T(t.getLatLng(),t.getRadius(),e,0),i=[],n=0;n<r.length;n+=1){var a=[r[n].lat,r[n].lng];i.push(a)}return L.polygon(i,t.options)},disablePopup:function(t){t.getPopup()&&(t._tempPopupCopy=t.getPopup(),t.unbindPopup())},enablePopup:function(t){t._tempPopupCopy&&(t.bindPopup(t._tempPopupCopy),delete t._tempPopupCopy)},_fireEvent:function(t,e,r){var i=3<arguments.length&&void 0!==arguments[3]&&arguments[3];t.fire(e,r,i),this.getAllParentGroups(t).groups.forEach((function(t){t.fire(e,r,i)}))},getAllParentGroups:function(t){var e=[],r=[];return!t._pmLastGroupFetch||!t._pmLastGroupFetch.time||1e3<(new Date).getTime()-t._pmLastGroupFetch.time?(function t(i){for(var n in i._eventParents)if(-1===e.indexOf(n)){e.push(n);var a=i._eventParents[n];r.push(a),t(a)}}(t),t._pmLastGroupFetch={time:(new Date).getTime(),groups:r,groupIds:e},{groupIds:e,groups:r}):{groups:t._pmLastGroupFetch.groups,groupIds:t._pmLastGroupFetch.groupIds}},createGeodesicPolygon:T,getTranslation:B,findDeepCoordIndex:function(t,e){var r;t.some(function t(i){return function(n,a){var o=i.concat(a);return n.lat&&n.lat===e.lat&&n.lng===e.lng?(r=o,!0):Array.isArray(n)&&n.some(t(o))}}([]));var i={};return r&&(i={indexPath:r,index:r[r.length-1],parentPath:r.slice(0,r.length-1)}),i},_getIndexFromSegment:function(t,e){if(e&&2===e.length){var r=this.findDeepCoordIndex(t,e[0]),i=this.findDeepCoordIndex(t,e[1]),n=Math.max(r.index,i.index);return 0!==r.index&&0!==i.index||1===n||(n+=1),{indexA:r,indexB:i,newIndex:n,indexPath:r.indexPath,parentPath:r.parentPath}}return null}};L.PM=L.PM||{version:i.a,Map:w,Toolbar:G,Draw:U,Edit:Ge,Utils:Ye,activeLang:"en",optIn:!1,initialize:function(t){this.addInitHooks(t)},setOptIn:function(t){this.optIn=!!t},addInitHooks:function(){L.Map.addInitHook((function(){this.pm=void 0,L.PM.optIn?!1===this.options.pmIgnore&&(this.pm=new L.PM.Map(this)):this.options.pmIgnore||(this.pm=new L.PM.Map(this))})),L.LayerGroup.addInitHook((function(){this.pm=void 0,L.PM.optIn?!1===this.options.pmIgnore&&(this.pm=new L.PM.Edit.LayerGroup(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.LayerGroup(this))})),L.Marker.addInitHook((function(){this.pm=void 0,L.PM.optIn?!1===this.options.pmIgnore&&(this.pm=new L.PM.Edit.Marker(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.Marker(this))})),L.CircleMarker.addInitHook((function(){this.pm=void 0,L.PM.optIn?!1===this.options.pmIgnore&&(this.pm=new L.PM.Edit.CircleMarker(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.CircleMarker(this))})),L.Polyline.addInitHook((function(){this.pm=void 0,L.PM.optIn?!1===this.options.pmIgnore&&(this.pm=new L.PM.Edit.Line(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.Line(this))})),L.Polygon.addInitHook((function(){this.pm=void 0,L.PM.optIn?!1===this.options.pmIgnore&&(this.pm=new L.PM.Edit.Polygon(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.Polygon(this))})),L.Rectangle.addInitHook((function(){this.pm=void 0,L.PM.optIn?!1===this.options.pmIgnore&&(this.pm=new L.PM.Edit.Rectangle(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.Rectangle(this))})),L.Circle.addInitHook((function(){this.pm=void 0,L.PM.optIn?!1===this.options.pmIgnore&&(this.pm=new L.PM.Edit.Circle(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.Circle(this))})),L.ImageOverlay.addInitHook((function(){this.pm=void 0,L.PM.optIn?!1===this.options.pmIgnore&&(this.pm=new L.PM.Edit.ImageOverlay(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.ImageOverlay(this))}))},reInitLayer:function(t){var e=this;t instanceof L.LayerGroup?t.eachLayer((function(t){e.reInitLayer(t)})):t.pm||L.PM.optIn&&!1!==t.options.pmIgnore||t.options.pmIgnore||(t instanceof L.Map?t.pm=new L.PM.Map(t):t instanceof L.Marker?t.pm=new L.PM.Edit.Marker(t):t instanceof L.Circle?t.pm=new L.PM.Edit.Circle(t):t instanceof L.CircleMarker?t.pm=new L.PM.Edit.CircleMarker(t):t instanceof L.Rectangle?t.pm=new L.PM.Edit.Rectangle(t):t instanceof L.Polygon?t.pm=new L.PM.Edit.Polygon(t):t instanceof L.Polyline&&(t.pm=new L.PM.Edit.Line(t)))}},L.PM.initialize()}]);

// }

// {

// https://unpkg.com/leaflet-canvaslayer-field/dist/leaflet.canvaslayer.field.js
!function(t){var e={};function r(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=11)}([function(t,e,r){"use strict";var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(e,r,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;a(this,t),this.center=e,this.value=r,this.xSize=n,this.ySize=o}return n(t,[{key:"equals",value:function(t){return this.center.equals(t.center)&&this._equalValues(this.value,t.value)&&this.xSize===t.xSize&&this.ySize===t.ySize}},{key:"_equalValues",value:function(t,e){var r=t.constructor.name;return{Number:t===e,Vector:t.u===e.u&&t.v===e.v}[r]}},{key:"getBounds",value:function(){var t=this.xSize/2,e=this.ySize/2,r=this.center.lat,n=this.center.lng,a=L.latLng([r+e,n-t]),o=L.latLng([r-e,n+t]);return L.latLngBounds(L.latLng(o.lat,a.lng),L.latLng(a.lat,o.lng))}}]),t}();e.a=o},function(t,e,r){var n=r(3),a=n.getCoord,o=n.getCoords;function i(t,e,r){var n=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var a=0,o=e.length-1;a<e.length;o=a++){var i=e[a][0],l=e[a][1],s=e[o][0],u=e[o][1];if(t[1]*(i-s)+l*(s-t[0])+u*(t[0]-i)==0&&(i-t[0])*(s-t[0])<=0&&(l-t[1])*(u-t[1])<=0)return!r;l>t[1]!=u>t[1]&&t[0]<(s-i)*(t[1]-l)/(u-l)+i&&(n=!n)}return n}t.exports=function(t,e,r){if(!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var n=a(t),l=o(e),s=e.geometry?e.geometry.type:e.type,u=e.bbox;if(u&&!1===function(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}(n,u))return!1;"Polygon"===s&&(l=[l]);for(var f=0,c=!1;f<l.length&&!c;f++)if(i(n,l[f][0],r)){for(var h=!1,d=1;d<l[f].length&&!h;)i(n,l[f][d],!r)&&(h=!0),d++;h||(c=!0)}return c}},function(t,e,r){
    t.exports=function(){"use strict";for(var t=function(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=1),t<e?e:t>r?r:t},e={},r=0,n=["Boolean","Number","String","Function","Array","Date","RegExp","Undefined","Null"];r<n.length;r+=1){var a=n[r];e["[object "+a+"]"]=a.toLowerCase()}var o=function(t){return e[Object.prototype.toString.call(t)]||"object"},i=Math.PI,l={clip_rgb:function(e){e._clipped=!1,e._unclipped=e.slice(0);for(var r=0;r<=3;r++)r<3?((e[r]<0||e[r]>255)&&(e._clipped=!0),e[r]=t(e[r],0,255)):3===r&&(e[r]=t(e[r],0,1));return e},limit:t,type:o,unpack:function(t,e){return void 0===e&&(e=null),t.length>=3?Array.prototype.slice.call(t):"object"==o(t[0])&&e?e.split("").filter((function(e){return void 0!==t[0][e]})).map((function(e){return t[0][e]})):t[0]},last:function(t){if(t.length<2)return null;var e=t.length-1;return"string"==o(t[e])?t[e].toLowerCase():null},PI:i,TWOPI:2*i,PITHIRD:i/3,DEG2RAD:i/180,RAD2DEG:180/i},s={format:{},autodetect:[]},u=l.last,f=l.clip_rgb,c=l.type,h=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r=this;if("object"===c(t[0])&&t[0].constructor&&t[0].constructor===this.constructor)return t[0];var n=u(t),a=!1;if(!n){a=!0,s.sorted||(s.autodetect=s.autodetect.sort((function(t,e){return e.p-t.p})),s.sorted=!0);for(var o=0,i=s.autodetect;o<i.length;o+=1){var l=i[o];if(n=l.test.apply(l,t))break}}if(!s.format[n])throw new Error("unknown format: "+t);var h=s.format[n].apply(null,a?t:t.slice(0,-1));r._rgb=f(h),3===r._rgb.length&&r._rgb.push(1)};h.prototype.toString=function(){return"function"==c(this.hex)?this.hex():"["+this._rgb.join(",")+"]"};var d=h,p=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(p.Color,[null].concat(t)))};p.Color=d,p.version="2.1.1";var v=p,y=l.unpack,g=Math.max,b=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r=y(t,"rgb"),n=r[0],a=r[1],o=r[2],i=1-g(n/=255,g(a/=255,o/=255)),l=i<1?1/(1-i):0,s=(1-n-i)*l,u=(1-a-i)*l,f=(1-o-i)*l;return[s,u,f,i]},m=l.unpack,_=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r=(t=m(t,"cmyk"))[0],n=t[1],a=t[2],o=t[3],i=t.length>4?t[4]:1;return 1===o?[0,0,0,i]:[r>=1?0:255*(1-r)*(1-o),n>=1?0:255*(1-n)*(1-o),a>=1?0:255*(1-a)*(1-o),i]},w=l.unpack,L=l.type;d.prototype.cmyk=function(){return b(this._rgb)},v.cmyk=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(d,[null].concat(t,["cmyk"])))},s.format.cmyk=_,s.autodetect.push({p:2,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(t=w(t,"cmyk"),"array"===L(t)&&4===t.length)return"cmyk"}});var k=l.unpack,C=l.last,x=function(t){return Math.round(100*t)/100},M=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r=k(t,"hsla"),n=C(t)||"lsa";return r[0]=x(r[0]||0),r[1]=x(100*r[1])+"%",r[2]=x(100*r[2])+"%","hsla"===n||r.length>3&&r[3]<1?(r[3]=r.length>3?r[3]:1,n="hsla"):r.length=3,n+"("+r.join(",")+")"},F=l.unpack,A=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r=(t=F(t,"rgba"))[0],n=t[1],a=t[2];r/=255,n/=255,a/=255;var o,i,l=Math.min(r,n,a),s=Math.max(r,n,a),u=(s+l)/2;return s===l?(o=0,i=Number.NaN):o=u<.5?(s-l)/(s+l):(s-l)/(2-s-l),r==s?i=(n-a)/(s-l):n==s?i=2+(a-r)/(s-l):a==s&&(i=4+(r-n)/(s-l)),(i*=60)<0&&(i+=360),t.length>3&&void 0!==t[3]?[i,o,u,t[3]]:[i,o,u]},P=l.unpack,S=l.last,T=Math.round,I=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r=P(t,"rgba"),n=S(t)||"rgb";return"hsl"==n.substr(0,3)?M(A(r),n):(r[0]=T(r[0]),r[1]=T(r[1]),r[2]=T(r[2]),("rgba"===n||r.length>3&&r[3]<1)&&(r[3]=r.length>3?r[3]:1,n="rgba"),n+"("+r.slice(0,"rgb"===n?3:4).join(",")+")")},E=l.unpack,z=Math.round,B=function(){for(var t,e=[],r=arguments.length;r--;)e[r]=arguments[r];var n,a,o,i=(e=E(e,"hsl"))[0],l=e[1],s=e[2];if(0===l)n=a=o=255*s;else{var u=[0,0,0],f=[0,0,0],c=s<.5?s*(1+l):s+l-s*l,h=2*s-c,d=i/360;u[0]=d+1/3,u[1]=d,u[2]=d-1/3;for(var p=0;p<3;p++)u[p]<0&&(u[p]+=1),u[p]>1&&(u[p]-=1),6*u[p]<1?f[p]=h+6*(c-h)*u[p]:2*u[p]<1?f[p]=c:3*u[p]<2?f[p]=h+(c-h)*(2/3-u[p])*6:f[p]=h;n=(t=[z(255*f[0]),z(255*f[1]),z(255*f[2])])[0],a=t[1],o=t[2]}return e.length>3?[n,a,o,e[3]]:[n,a,o,1]},N=/^rgb\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*\)$/,O=/^rgba\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*,\s*([01]|[01]?\.\d+)\)$/,D=/^rgb\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,R=/^rgba\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,j=/^hsl\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,V=/^hsla\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,G=Math.round,q=function(t){var e;if(t=t.toLowerCase().trim(),s.format.named)try{return s.format.named(t)}catch(t){}if(e=t.match(N)){for(var r=e.slice(1,4),n=0;n<3;n++)r[n]=+r[n];return r[3]=1,r}if(e=t.match(O)){for(var a=e.slice(1,5),o=0;o<4;o++)a[o]=+a[o];return a}if(e=t.match(D)){for(var i=e.slice(1,4),l=0;l<3;l++)i[l]=G(2.55*i[l]);return i[3]=1,i}if(e=t.match(R)){for(var u=e.slice(1,5),f=0;f<3;f++)u[f]=G(2.55*u[f]);return u[3]=+u[3],u}if(e=t.match(j)){var c=e.slice(1,4);c[1]*=.01,c[2]*=.01;var h=B(c);return h[3]=1,h}if(e=t.match(V)){var d=e.slice(1,4);d[1]*=.01,d[2]*=.01;var p=B(d);return p[3]=+e[4],p}};q.test=function(t){return N.test(t)||O.test(t)||D.test(t)||R.test(t)||j.test(t)||V.test(t)};var U=q,H=l.type;d.prototype.css=function(t){return I(this._rgb,t)},v.css=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(d,[null].concat(t,["css"])))},s.format.css=U,s.autodetect.push({p:5,test:function(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];if(!e.length&&"string"===H(t)&&U.test(t))return"css"}});var Y=l.unpack;s.format.gl=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r=Y(t,"rgba");return r[0]*=255,r[1]*=255,r[2]*=255,r},v.gl=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(d,[null].concat(t,["gl"])))},d.prototype.gl=function(){var t=this._rgb;return[t[0]/255,t[1]/255,t[2]/255,t[3]]};var W=l.unpack,X=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r,n=W(t,"rgb"),a=n[0],o=n[1],i=n[2],l=Math.min(a,o,i),s=Math.max(a,o,i),u=s-l,f=100*u/255,c=l/(255-u)*100;return 0===u?r=Number.NaN:(a===s&&(r=(o-i)/u),o===s&&(r=2+(i-a)/u),i===s&&(r=4+(a-o)/u),(r*=60)<0&&(r+=360)),[r,f,c]},$=l.unpack,Z=Math.floor,J=function(){for(var t,e,r,n,a,o,i=[],l=arguments.length;l--;)i[l]=arguments[l];var s,u,f,c=(i=$(i,"hcg"))[0],h=i[1],d=i[2];d*=255;var p=255*h;if(0===h)s=u=f=d;else{360===c&&(c=0),c>360&&(c-=360),c<0&&(c+=360);var v=Z(c/=60),y=c-v,g=d*(1-h),b=g+p*(1-y),m=g+p*y,_=g+p;switch(v){case 0:s=(t=[_,m,g])[0],u=t[1],f=t[2];break;case 1:s=(e=[b,_,g])[0],u=e[1],f=e[2];break;case 2:s=(r=[g,_,m])[0],u=r[1],f=r[2];break;case 3:s=(n=[g,b,_])[0],u=n[1],f=n[2];break;case 4:s=(a=[m,g,_])[0],u=a[1],f=a[2];break;case 5:s=(o=[_,g,b])[0],u=o[1],f=o[2]}}return[s,u,f,i.length>3?i[3]:1]},K=l.unpack,Q=l.type;d.prototype.hcg=function(){return X(this._rgb)},v.hcg=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(d,[null].concat(t,["hcg"])))},s.format.hcg=J,s.autodetect.push({p:1,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(t=K(t,"hcg"),"array"===Q(t)&&3===t.length)return"hcg"}});var tt=l.unpack,et=l.last,rt=Math.round,nt=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r=tt(t,"rgba"),n=r[0],a=r[1],o=r[2],i=r[3],l=et(t)||"auto";void 0===i&&(i=1),"auto"===l&&(l=i<1?"rgba":"rgb");var s=(n=rt(n))<<16|(a=rt(a))<<8|(o=rt(o)),u="000000"+s.toString(16);u=u.substr(u.length-6);var f="0"+rt(255*i).toString(16);switch(f=f.substr(f.length-2),l.toLowerCase()){case"rgba":return"#"+u+f;case"argb":return"#"+f+u;default:return"#"+u}},at=/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,ot=/^#?([A-Fa-f0-9]{8}|[A-Fa-f0-9]{4})$/,it=function(t){if(t.match(at)){4!==t.length&&7!==t.length||(t=t.substr(1)),3===t.length&&(t=(t=t.split(""))[0]+t[0]+t[1]+t[1]+t[2]+t[2]);var e=parseInt(t,16);return[e>>16,e>>8&255,255&e,1]}if(t.match(ot)){5!==t.length&&9!==t.length||(t=t.substr(1)),4===t.length&&(t=(t=t.split(""))[0]+t[0]+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]);var r=parseInt(t,16);return[r>>24&255,r>>16&255,r>>8&255,Math.round((255&r)/255*100)/100]}throw new Error("unknown hex color: "+t)},lt=l.type;d.prototype.hex=function(t){return nt(this._rgb,t)},v.hex=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(d,[null].concat(t,["hex"])))},s.format.hex=it,s.autodetect.push({p:4,test:function(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];if(!e.length&&"string"===lt(t)&&[3,4,5,6,7,8,9].indexOf(t.length)>=0)return"hex"}});var st=l.unpack,ut=l.TWOPI,ft=Math.min,ct=Math.sqrt,ht=Math.acos,dt=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r,n=st(t,"rgb"),a=n[0],o=n[1],i=n[2],l=ft(a/=255,o/=255,i/=255),s=(a+o+i)/3,u=s>0?1-l/s:0;return 0===u?r=NaN:(r=(a-o+(a-i))/2,r/=ct((a-o)*(a-o)+(a-i)*(o-i)),r=ht(r),i>o&&(r=ut-r),r/=ut),[360*r,u,s]},pt=l.unpack,vt=l.limit,yt=l.TWOPI,gt=l.PITHIRD,bt=Math.cos,mt=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r,n,a,o=(t=pt(t,"hsi"))[0],i=t[1],l=t[2];return isNaN(o)&&(o=0),isNaN(i)&&(i=0),o>360&&(o-=360),o<0&&(o+=360),(o/=360)<1/3?n=1-((a=(1-i)/3)+(r=(1+i*bt(yt*o)/bt(gt-yt*o))/3)):o<2/3?a=1-((r=(1-i)/3)+(n=(1+i*bt(yt*(o-=1/3))/bt(gt-yt*o))/3)):r=1-((n=(1-i)/3)+(a=(1+i*bt(yt*(o-=2/3))/bt(gt-yt*o))/3)),[255*(r=vt(l*r*3)),255*(n=vt(l*n*3)),255*(a=vt(l*a*3)),t.length>3?t[3]:1]},_t=l.unpack,wt=l.type;d.prototype.hsi=function(){return dt(this._rgb)},v.hsi=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(d,[null].concat(t,["hsi"])))},s.format.hsi=mt,s.autodetect.push({p:2,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(t=_t(t,"hsi"),"array"===wt(t)&&3===t.length)return"hsi"}});var Lt=l.unpack,kt=l.type;d.prototype.hsl=function(){return A(this._rgb)},v.hsl=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(d,[null].concat(t,["hsl"])))},s.format.hsl=B,s.autodetect.push({p:2,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(t=Lt(t,"hsl"),"array"===kt(t)&&3===t.length)return"hsl"}});var Ct=l.unpack,xt=Math.min,Mt=Math.max,Ft=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r,n,a,o=(t=Ct(t,"rgb"))[0],i=t[1],l=t[2],s=xt(o,i,l),u=Mt(o,i,l),f=u-s;return a=u/255,0===u?(r=Number.NaN,n=0):(n=f/u,o===u&&(r=(i-l)/f),i===u&&(r=2+(l-o)/f),l===u&&(r=4+(o-i)/f),(r*=60)<0&&(r+=360)),[r,n,a]},At=l.unpack,Pt=Math.floor,St=function(){for(var t,e,r,n,a,o,i=[],l=arguments.length;l--;)i[l]=arguments[l];var s,u,f,c=(i=At(i,"hsv"))[0],h=i[1],d=i[2];if(d*=255,0===h)s=u=f=d;else{360===c&&(c=0),c>360&&(c-=360),c<0&&(c+=360);var p=Pt(c/=60),v=c-p,y=d*(1-h),g=d*(1-h*v),b=d*(1-h*(1-v));switch(p){case 0:s=(t=[d,b,y])[0],u=t[1],f=t[2];break;case 1:s=(e=[g,d,y])[0],u=e[1],f=e[2];break;case 2:s=(r=[y,d,b])[0],u=r[1],f=r[2];break;case 3:s=(n=[y,g,d])[0],u=n[1],f=n[2];break;case 4:s=(a=[b,y,d])[0],u=a[1],f=a[2];break;case 5:s=(o=[d,y,g])[0],u=o[1],f=o[2]}}return[s,u,f,i.length>3?i[3]:1]},Tt=l.unpack,It=l.type;d.prototype.hsv=function(){return Ft(this._rgb)},v.hsv=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(d,[null].concat(t,["hsv"])))},s.format.hsv=St,s.autodetect.push({p:2,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(t=Tt(t,"hsv"),"array"===It(t)&&3===t.length)return"hsv"}});var Et=18,zt=.95047,Bt=1,Nt=1.08883,Ot=.137931034,Dt=.206896552,Rt=.12841855,jt=.008856452,Vt=l.unpack,Gt=Math.pow,qt=function(t){return(t/=255)<=.04045?t/12.92:Gt((t+.055)/1.055,2.4)},Ut=function(t){return t>jt?Gt(t,1/3):t/Rt+Ot},Ht=function(t,e,r){return t=qt(t),e=qt(e),r=qt(r),[Ut((.4124564*t+.3575761*e+.1804375*r)/zt),Ut((.2126729*t+.7151522*e+.072175*r)/Bt),Ut((.0193339*t+.119192*e+.9503041*r)/Nt)]},Yt=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r=Vt(t,"rgb"),n=r[0],a=r[1],o=r[2],i=Ht(n,a,o),l=i[0],s=i[1],u=i[2],f=116*s-16;return[f<0?0:f,500*(l-s),200*(s-u)]},Wt=l.unpack,Xt=Math.pow,$t=function(t){return 255*(t<=.00304?12.92*t:1.055*Xt(t,1/2.4)-.055)},Zt=function(t){return t>Dt?t*t*t:Rt*(t-Ot)},Jt=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r,n,a,o=(t=Wt(t,"lab"))[0],i=t[1],l=t[2];return n=(o+16)/116,r=isNaN(i)?n:n+i/500,a=isNaN(l)?n:n-l/200,n=Bt*Zt(n),r=zt*Zt(r),a=Nt*Zt(a),[$t(3.2404542*r-1.5371385*n-.4985314*a),$t(-.969266*r+1.8760108*n+.041556*a),$t(.0556434*r-.2040259*n+1.0572252*a),t.length>3?t[3]:1]},Kt=l.unpack,Qt=l.type;d.prototype.lab=function(){return Yt(this._rgb)},v.lab=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(d,[null].concat(t,["lab"])))},s.format.lab=Jt,s.autodetect.push({p:2,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(t=Kt(t,"lab"),"array"===Qt(t)&&3===t.length)return"lab"}});var te=l.unpack,ee=l.RAD2DEG,re=Math.sqrt,ne=Math.atan2,ae=Math.round,oe=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r=te(t,"lab"),n=r[0],a=r[1],o=r[2],i=re(a*a+o*o),l=(ne(o,a)*ee+360)%360;return 0===ae(1e4*i)&&(l=Number.NaN),[n,i,l]},ie=l.unpack,le=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r=ie(t,"rgb"),n=r[0],a=r[1],o=r[2],i=Yt(n,a,o),l=i[0],s=i[1],u=i[2];return oe(l,s,u)},se=l.unpack,ue=l.DEG2RAD,fe=Math.sin,ce=Math.cos,he=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r=se(t,"lch"),n=r[0],a=r[1],o=r[2];return isNaN(o)&&(o=0),[n,ce(o*=ue)*a,fe(o)*a]},de=l.unpack,pe=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r=(t=de(t,"lch"))[0],n=t[1],a=t[2],o=he(r,n,a),i=o[0],l=o[1],s=o[2],u=Jt(i,l,s),f=u[0],c=u[1],h=u[2];return[f,c,h,t.length>3?t[3]:1]},ve=l.unpack,ye=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r=ve(t,"hcl").reverse();return pe.apply(void 0,r)},ge=l.unpack,be=l.type;d.prototype.lch=function(){return le(this._rgb)},d.prototype.hcl=function(){return le(this._rgb).reverse()},v.lch=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(d,[null].concat(t,["lch"])))},v.hcl=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(d,[null].concat(t,["hcl"])))},s.format.lch=pe,s.format.hcl=ye,["lch","hcl"].forEach((function(t){return s.autodetect.push({p:2,test:function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];if(e=ge(e,t),"array"===be(e)&&3===e.length)return t}})}));var me={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},_e=l.type;d.prototype.name=function(){for(var t=nt(this._rgb,"rgb"),e=0,r=Object.keys(me);e<r.length;e+=1){var n=r[e];if(me[n]===t)return n.toLowerCase()}return t},s.format.named=function(t){if(t=t.toLowerCase(),me[t])return it(me[t]);throw new Error("unknown color name: "+t)},s.autodetect.push({p:5,test:function(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];if(!e.length&&"string"===_e(t)&&me[t.toLowerCase()])return"named"}});var we=l.unpack,Le=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r=we(t,"rgb"),n=r[0],a=r[1],o=r[2];return(n<<16)+(a<<8)+o},ke=l.type,Ce=function(t){if("number"==ke(t)&&t>=0&&t<=16777215)return[t>>16,t>>8&255,255&t,1];throw new Error("unknown num color: "+t)},xe=l.type;d.prototype.num=function(){return Le(this._rgb)},v.num=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(d,[null].concat(t,["num"])))},s.format.num=Ce,s.autodetect.push({p:5,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(1===t.length&&"number"===xe(t[0])&&t[0]>=0&&t[0]<=16777215)return"num"}});var Me=l.unpack,Fe=l.type,Ae=Math.round;d.prototype.rgb=function(t){return void 0===t&&(t=!0),!1===t?this._rgb.slice(0,3):this._rgb.slice(0,3).map(Ae)},d.prototype.rgba=function(t){return void 0===t&&(t=!0),this._rgb.slice(0,4).map((function(e,r){return r<3?!1===t?e:Ae(e):e}))},v.rgb=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(d,[null].concat(t,["rgb"])))},s.format.rgb=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r=Me(t,"rgba");return void 0===r[3]&&(r[3]=1),r},s.autodetect.push({p:3,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(t=Me(t,"rgba"),"array"===Fe(t)&&(3===t.length||4===t.length&&"number"==Fe(t[3])&&t[3]>=0&&t[3]<=1))return"rgb"}});var Pe=Math.log,Se=function(t){var e,r,n,a=t/100;return a<66?(e=255,r=-155.25485562709179-.44596950469579133*(r=a-2)+104.49216199393888*Pe(r),n=a<20?0:.8274096064007395*(n=a-10)-254.76935184120902+115.67994401066147*Pe(n)):(e=351.97690566805693+.114206453784165*(e=a-55)-40.25366309332127*Pe(e),r=325.4494125711974+.07943456536662342*(r=a-50)-28.0852963507957*Pe(r),n=255),[e,r,n,1]},Te=l.unpack,Ie=Math.round,Ee=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];for(var r,n=Te(t,"rgb"),a=n[0],o=n[2],i=1e3,l=4e4,s=.4;l-i>s;){var u=Se(r=.5*(l+i));u[2]/u[0]>=o/a?l=r:i=r}return Ie(r)};d.prototype.temp=d.prototype.kelvin=d.prototype.temperature=function(){return Ee(this._rgb)},v.temp=v.kelvin=v.temperature=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(d,[null].concat(t,["temp"])))},s.format.temp=s.format.kelvin=s.format.temperature=Se;var ze=l.type;d.prototype.alpha=function(t,e){return void 0===e&&(e=!1),void 0!==t&&"number"===ze(t)?e?(this._rgb[3]=t,this):new d([this._rgb[0],this._rgb[1],this._rgb[2],t],"rgb"):this._rgb[3]},d.prototype.clipped=function(){return this._rgb._clipped||!1},d.prototype.darken=function(t){void 0===t&&(t=1);var e=this.lab();return e[0]-=Et*t,new d(e,"lab").alpha(this.alpha(),!0)},d.prototype.brighten=function(t){return void 0===t&&(t=1),this.darken(-t)},d.prototype.darker=d.prototype.darken,d.prototype.brighter=d.prototype.brighten,d.prototype.get=function(t){var e=t.split("."),r=e[0],n=e[1],a=this[r]();if(n){var o=r.indexOf(n);if(o>-1)return a[o];throw new Error("unknown channel "+n+" in mode "+r)}return a};var Be=l.type,Ne=Math.pow;d.prototype.luminance=function(t){if(void 0!==t&&"number"===Be(t)){if(0===t)return new d([0,0,0,this._rgb[3]],"rgb");if(1===t)return new d([255,255,255,this._rgb[3]],"rgb");var e=this.luminance(),r=20,n=function(e,a){var o=e.interpolate(a,.5,"rgb"),i=o.luminance();return Math.abs(t-i)<1e-7||!r--?o:i>t?n(e,o):n(o,a)},a=(e>t?n(new d([0,0,0]),this):n(this,new d([255,255,255]))).rgb();return new d(a.concat([this._rgb[3]]))}return Oe.apply(void 0,this._rgb.slice(0,3))};var Oe=function(t,e,r){return.2126*(t=De(t))+.7152*(e=De(e))+.0722*(r=De(r))},De=function(t){return(t/=255)<=.03928?t/12.92:Ne((t+.055)/1.055,2.4)},Re={},je=l.type,Ve=function(t,e,r){void 0===r&&(r=.5);for(var n=[],a=arguments.length-3;a-- >0;)n[a]=arguments[a+3];var o=n[0]||"lrgb";if(Re[o]||n.length||(o=Object.keys(Re)[0]),!Re[o])throw new Error("interpolation mode "+o+" is not defined");return"object"!==je(t)&&(t=new d(t)),"object"!==je(e)&&(e=new d(e)),Re[o](t,e,r).alpha(t.alpha()+r*(e.alpha()-t.alpha()))};d.prototype.mix=d.prototype.interpolate=function(t,e){void 0===e&&(e=.5);for(var r=[],n=arguments.length-2;n-- >0;)r[n]=arguments[n+2];return Ve.apply(void 0,[this,t,e].concat(r))},d.prototype.premultiply=function(t){void 0===t&&(t=!1);var e=this._rgb,r=e[3];return t?(this._rgb=[e[0]*r,e[1]*r,e[2]*r,r],this):new d([e[0]*r,e[1]*r,e[2]*r,r],"rgb")},d.prototype.saturate=function(t){void 0===t&&(t=1);var e=this.lch();return e[1]+=Et*t,e[1]<0&&(e[1]=0),new d(e,"lch").alpha(this.alpha(),!0)},d.prototype.desaturate=function(t){return void 0===t&&(t=1),this.saturate(-t)};var Ge=l.type;d.prototype.set=function(t,e,r){void 0===r&&(r=!1);var n=t.split("."),a=n[0],o=n[1],i=this[a]();if(o){var l=a.indexOf(o);if(l>-1){if("string"==Ge(e))switch(e.charAt(0)){case"+":case"-":i[l]+=+e;break;case"*":i[l]*=+e.substr(1);break;case"/":i[l]/=+e.substr(1);break;default:i[l]=+e}else{if("number"!==Ge(e))throw new Error("unsupported value for Color.set");i[l]=e}var s=new d(i,a);return r?(this._rgb=s._rgb,this):s}throw new Error("unknown channel "+o+" in mode "+a)}return i},Re.rgb=function(t,e,r){var n=t._rgb,a=e._rgb;return new d(n[0]+r*(a[0]-n[0]),n[1]+r*(a[1]-n[1]),n[2]+r*(a[2]-n[2]),"rgb")};var qe=Math.sqrt,Ue=Math.pow;Re.lrgb=function(t,e,r){var n=t._rgb,a=n[0],o=n[1],i=n[2],l=e._rgb,s=l[0],u=l[1],f=l[2];return new d(qe(Ue(a,2)*(1-r)+Ue(s,2)*r),qe(Ue(o,2)*(1-r)+Ue(u,2)*r),qe(Ue(i,2)*(1-r)+Ue(f,2)*r),"rgb")},Re.lab=function(t,e,r){var n=t.lab(),a=e.lab();return new d(n[0]+r*(a[0]-n[0]),n[1]+r*(a[1]-n[1]),n[2]+r*(a[2]-n[2]),"lab")};var He=function(t,e,r,n){var a,o,i,l,s,u,f,c,h,p,v,y;return"hsl"===n?(i=t.hsl(),l=e.hsl()):"hsv"===n?(i=t.hsv(),l=e.hsv()):"hcg"===n?(i=t.hcg(),l=e.hcg()):"hsi"===n?(i=t.hsi(),l=e.hsi()):"lch"!==n&&"hcl"!==n||(n="hcl",i=t.hcl(),l=e.hcl()),"h"===n.substr(0,1)&&(s=(a=i)[0],f=a[1],h=a[2],u=(o=l)[0],c=o[1],p=o[2]),isNaN(s)||isNaN(u)?isNaN(s)?isNaN(u)?y=Number.NaN:(y=u,1!=h&&0!=h||"hsv"==n||(v=c)):(y=s,1!=p&&0!=p||"hsv"==n||(v=f)):y=s+r*(u>s&&u-s>180?u-(s+360):u<s&&s-u>180?u+360-s:u-s),void 0===v&&(v=f+r*(c-f)),new d([y,v,h+r*(p-h)],n)},Ye=function(t,e,r){return He(t,e,r,"lch")};Re.lch=Ye,Re.hcl=Ye,Re.num=function(t,e,r){var n=t.num(),a=e.num();return new d(n+r*(a-n),"num")},Re.hcg=function(t,e,r){return He(t,e,r,"hcg")},Re.hsi=function(t,e,r){return He(t,e,r,"hsi")},Re.hsl=function(t,e,r){return He(t,e,r,"hsl")},Re.hsv=function(t,e,r){return He(t,e,r,"hsv")};var We=l.clip_rgb,Xe=Math.pow,$e=Math.sqrt,Ze=Math.PI,Je=Math.cos,Ke=Math.sin,Qe=Math.atan2,tr=function(t,e){for(var r=t.length,n=[0,0,0,0],a=0;a<t.length;a++){var o=t[a],i=e[a]/r,l=o._rgb;n[0]+=Xe(l[0],2)*i,n[1]+=Xe(l[1],2)*i,n[2]+=Xe(l[2],2)*i,n[3]+=l[3]*i}return n[0]=$e(n[0]),n[1]=$e(n[1]),n[2]=$e(n[2]),n[3]>.9999999&&(n[3]=1),new d(We(n))},er=l.type,rr=Math.pow,nr=function(t){var e="rgb",r=v("#ccc"),n=0,a=[0,1],o=[],i=[0,0],l=!1,s=[],u=!1,f=0,c=1,h=!1,d={},p=!0,y=1,g=function(t){if((t=t||["#fff","#000"])&&"string"===er(t)&&v.brewer&&v.brewer[t.toLowerCase()]&&(t=v.brewer[t.toLowerCase()]),"array"===er(t)){1===t.length&&(t=[t[0],t[0]]),t=t.slice(0);for(var e=0;e<t.length;e++)t[e]=v(t[e]);o.length=0;for(var r=0;r<t.length;r++)o.push(r/(t.length-1))}return w(),s=t},b=function(t){return t},m=function(t){return t},_=function(t,n){var a,u;if(null==n&&(n=!1),isNaN(t)||null===t)return r;u=n?t:l&&l.length>2?function(t){if(null!=l){for(var e=l.length-1,r=0;r<e&&t>=l[r];)r++;return r-1}return 0}(t)/(l.length-2):c!==f?(t-f)/(c-f):1,u=m(u),n||(u=b(u)),1!==y&&(u=rr(u,y)),u=i[0]+u*(1-i[0]-i[1]),u=Math.min(1,Math.max(0,u));var h=Math.floor(1e4*u);if(p&&d[h])a=d[h];else{if("array"===er(s))for(var g=0;g<o.length;g++){var _=o[g];if(u<=_){a=s[g];break}if(u>=_&&g===o.length-1){a=s[g];break}if(u>_&&u<o[g+1]){u=(u-_)/(o[g+1]-_),a=v.interpolate(s[g],s[g+1],u,e);break}}else"function"===er(s)&&(a=s(u));p&&(d[h]=a)}return a},w=function(){return d={}};g(t);var L=function(t){var e=v(_(t));return u&&e[u]?e[u]():e};return L.classes=function(t){if(null!=t){if("array"===er(t))l=t,a=[t[0],t[t.length-1]];else{var e=v.analyze(a);l=0===t?[e.min,e.max]:v.limits(e,"e",t)}return L}return l},L.domain=function(t){if(!arguments.length)return a;f=t[0],c=t[t.length-1],o=[];var e=s.length;if(t.length===e&&f!==c)for(var r=0,n=Array.from(t);r<n.length;r+=1){var i=n[r];o.push((i-f)/(c-f))}else{for(var l=0;l<e;l++)o.push(l/(e-1));if(t.length>2){var u=t.map((function(e,r){return r/(t.length-1)})),h=t.map((function(t){return(t-f)/(c-f)}));h.every((function(t,e){return u[e]===t}))||(m=function(t){if(t<=0||t>=1)return t;for(var e=0;t>=h[e+1];)e++;var r=(t-h[e])/(h[e+1]-h[e]);return u[e]+r*(u[e+1]-u[e])})}}return a=[f,c],L},L.mode=function(t){return arguments.length?(e=t,w(),L):e},L.range=function(t,e){return g(t),L},L.out=function(t){return u=t,L},L.spread=function(t){return arguments.length?(n=t,L):n},L.correctLightness=function(t){return null==t&&(t=!0),h=t,w(),b=h?function(t){for(var e=_(0,!0).lab()[0],r=_(1,!0).lab()[0],n=e>r,a=_(t,!0).lab()[0],o=e+(r-e)*t,i=a-o,l=0,s=1,u=20;Math.abs(i)>.01&&u-- >0;)n&&(i*=-1),i<0?(l=t,t+=.5*(s-t)):(s=t,t+=.5*(l-t)),a=_(t,!0).lab()[0],i=a-o;return t}:function(t){return t},L},L.padding=function(t){return null!=t?("number"===er(t)&&(t=[t,t]),i=t,L):i},L.colors=function(e,r){arguments.length<2&&(r="hex");var n=[];if(0===arguments.length)n=s.slice(0);else if(1===e)n=[L(.5)];else if(e>1){var o=a[0],i=a[1]-o;n=ar(0,e,!1).map((function(t){return L(o+t/(e-1)*i)}))}else{t=[];var u=[];if(l&&l.length>2)for(var f=1,c=l.length,h=1<=c;h?f<c:f>c;h?f++:f--)u.push(.5*(l[f-1]+l[f]));else u=a;n=u.map((function(t){return L(t)}))}return v[r]&&(n=n.map((function(t){return t[r]()}))),n},L.cache=function(t){return null!=t?(p=t,L):p},L.gamma=function(t){return null!=t?(y=t,L):y},L.nodata=function(t){return null!=t?(r=v(t),L):r},L};function ar(t,e,r){for(var n=[],a=t<e,o=r?a?e+1:e-1:e,i=t;a?i<o:i>o;a?i++:i--)n.push(i);return n}var or=function(t){var e,r,n,a,o,i,l;if(2===(t=t.map((function(t){return new d(t)}))).length)e=t.map((function(t){return t.lab()})),o=e[0],i=e[1],a=function(t){var e=[0,1,2].map((function(e){return o[e]+t*(i[e]-o[e])}));return new d(e,"lab")};else if(3===t.length)r=t.map((function(t){return t.lab()})),o=r[0],i=r[1],l=r[2],a=function(t){var e=[0,1,2].map((function(e){return(1-t)*(1-t)*o[e]+2*(1-t)*t*i[e]+t*t*l[e]}));return new d(e,"lab")};else if(4===t.length){var s;n=t.map((function(t){return t.lab()})),o=n[0],i=n[1],l=n[2],s=n[3],a=function(t){var e=[0,1,2].map((function(e){return(1-t)*(1-t)*(1-t)*o[e]+3*(1-t)*(1-t)*t*i[e]+3*(1-t)*t*t*l[e]+t*t*t*s[e]}));return new d(e,"lab")}}else if(5===t.length){var u=or(t.slice(0,3)),f=or(t.slice(2,5));a=function(t){return t<.5?u(2*t):f(2*(t-.5))}}return a},ir=function(t,e,r){if(!ir[r])throw new Error("unknown blend mode "+r);return ir[r](t,e)},lr=function(t){return function(e,r){var n=v(r).rgb(),a=v(e).rgb();return v.rgb(t(n,a))}},sr=function(t){return function(e,r){var n=[];return n[0]=t(e[0],r[0]),n[1]=t(e[1],r[1]),n[2]=t(e[2],r[2]),n}};ir.normal=lr(sr((function(t){return t}))),ir.multiply=lr(sr((function(t,e){return t*e/255}))),ir.screen=lr(sr((function(t,e){return 255*(1-(1-t/255)*(1-e/255))}))),ir.overlay=lr(sr((function(t,e){return e<128?2*t*e/255:255*(1-2*(1-t/255)*(1-e/255))}))),ir.darken=lr(sr((function(t,e){return t>e?e:t}))),ir.lighten=lr(sr((function(t,e){return t>e?t:e}))),ir.dodge=lr(sr((function(t,e){return 255===t||(t=e/255*255/(1-t/255))>255?255:t}))),ir.burn=lr(sr((function(t,e){return 255*(1-(1-e/255)/(t/255))})));for(var ur=ir,fr=l.type,cr=l.clip_rgb,hr=l.TWOPI,dr=Math.pow,pr=Math.sin,vr=Math.cos,yr=Math.floor,gr=Math.random,br=Math.log,mr=Math.pow,_r=Math.floor,wr=Math.abs,Lr=function(t,e){void 0===e&&(e=null);var r={min:Number.MAX_VALUE,max:-1*Number.MAX_VALUE,sum:0,values:[],count:0};return"object"===o(t)&&(t=Object.values(t)),t.forEach((function(t){e&&"object"===o(t)&&(t=t[e]),null==t||isNaN(t)||(r.values.push(t),r.sum+=t,t<r.min&&(r.min=t),t>r.max&&(r.max=t),r.count+=1)})),r.domain=[r.min,r.max],r.limits=function(t,e){return kr(r,t,e)},r},kr=function(t,e,r){void 0===e&&(e="equal"),void 0===r&&(r=7),"array"==o(t)&&(t=Lr(t));var n=t.min,a=t.max,i=t.values.sort((function(t,e){return t-e}));if(1===r)return[n,a];var l=[];if("c"===e.substr(0,1)&&(l.push(n),l.push(a)),"e"===e.substr(0,1)){l.push(n);for(var s=1;s<r;s++)l.push(n+s/r*(a-n));l.push(a)}else if("l"===e.substr(0,1)){if(n<=0)throw new Error("Logarithmic scales are only possible for values > 0");var u=Math.LOG10E*br(n),f=Math.LOG10E*br(a);l.push(n);for(var c=1;c<r;c++)l.push(mr(10,u+c/r*(f-u)));l.push(a)}else if("q"===e.substr(0,1)){l.push(n);for(var h=1;h<r;h++){var d=(i.length-1)*h/r,p=_r(d);if(p===d)l.push(i[p]);else{var v=d-p;l.push(i[p]*(1-v)+i[p+1]*v)}}l.push(a)}else if("k"===e.substr(0,1)){var y,g=i.length,b=new Array(g),m=new Array(r),_=!0,w=0,L=null;(L=[]).push(n);for(var k=1;k<r;k++)L.push(n+k/r*(a-n));for(L.push(a);_;){for(var C=0;C<r;C++)m[C]=0;for(var x=0;x<g;x++)for(var M=i[x],F=Number.MAX_VALUE,A=void 0,P=0;P<r;P++){var S=wr(L[P]-M);S<F&&(F=S,A=P),m[A]++,b[x]=A}for(var T=new Array(r),I=0;I<r;I++)T[I]=null;for(var E=0;E<g;E++)null===T[y=b[E]]?T[y]=i[E]:T[y]+=i[E];for(var z=0;z<r;z++)T[z]*=1/m[z];_=!1;for(var B=0;B<r;B++)if(T[B]!==L[B]){_=!0;break}L=T,++w>200&&(_=!1)}for(var N={},O=0;O<r;O++)N[O]=[];for(var D=0;D<g;D++)N[y=b[D]].push(i[D]);for(var R=[],j=0;j<r;j++)R.push(N[j][0]),R.push(N[j][N[j].length-1]);R=R.sort((function(t,e){return t-e})),l.push(R[0]);for(var V=1;V<R.length;V+=2){var G=R[V];isNaN(G)||-1!==l.indexOf(G)||l.push(G)}}return l},Cr={analyze:Lr,limits:kr},xr=Math.sqrt,Mr=Math.atan2,Fr=Math.abs,Ar=Math.cos,Pr=Math.PI,Sr={cool:function(){return nr([v.hsl(180,1,.9),v.hsl(250,.7,.4)])},hot:function(){return nr(["#000","#f00","#ff0","#fff"]).mode("rgb")}},Tr={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Ir=0,Er=Object.keys(Tr);Ir<Er.length;Ir+=1){var zr=Er[Ir];Tr[zr.toLowerCase()]=Tr[zr]}var Br=Tr;return v.average=function(t,e,r){void 0===e&&(e="lrgb"),void 0===r&&(r=null);var n=t.length;r||(r=Array.from(new Array(n)).map((function(){return 1})));var a=n/r.reduce((function(t,e){return t+e}));if(r.forEach((function(t,e){r[e]*=a})),t=t.map((function(t){return new d(t)})),"lrgb"===e)return tr(t,r);for(var o=t.shift(),i=o.get(e),l=[],s=0,u=0,f=0;f<i.length;f++)if(i[f]=(i[f]||0)*r[0],l.push(isNaN(i[f])?0:r[0]),"h"===e.charAt(f)&&!isNaN(i[f])){var c=i[f]/180*Ze;s+=Je(c)*r[0],u+=Ke(c)*r[0]}var h=o.alpha()*r[0];t.forEach((function(t,n){var a=t.get(e);h+=t.alpha()*r[n+1];for(var o=0;o<i.length;o++)if(!isNaN(a[o]))if(l[o]+=r[n+1],"h"===e.charAt(o)){var f=a[o]/180*Ze;s+=Je(f)*r[n+1],u+=Ke(f)*r[n+1]}else i[o]+=a[o]*r[n+1]}));for(var p=0;p<i.length;p++)if("h"===e.charAt(p)){for(var v=Qe(u/l[p],s/l[p])/Ze*180;v<0;)v+=360;for(;v>=360;)v-=360;i[p]=v}else i[p]=i[p]/l[p];return h/=n,new d(i,e).alpha(h>.99999?1:h,!0)},v.bezier=function(t){var e=or(t);return e.scale=function(){return nr(e)},e},v.blend=ur,v.cubehelix=function(t,e,r,n,a){void 0===t&&(t=300),void 0===e&&(e=-1.5),void 0===r&&(r=1),void 0===n&&(n=1),void 0===a&&(a=[0,1]);var o,i=0;"array"===fr(a)?o=a[1]-a[0]:(o=0,a=[a,a]);var l=function(l){var s=hr*((t+120)/360+e*l),u=dr(a[0]+o*l,n),f=(0!==i?r[0]+l*i:r)*u*(1-u)/2,c=vr(s),h=pr(s);return v(cr([255*(u+f*(-.14861*c+1.78277*h)),255*(u+f*(-.29227*c-.90649*h)),255*(u+f*(1.97294*c)),1]))};return l.start=function(e){return null==e?t:(t=e,l)},l.rotations=function(t){return null==t?e:(e=t,l)},l.gamma=function(t){return null==t?n:(n=t,l)},l.hue=function(t){return null==t?r:("array"===fr(r=t)?0==(i=r[1]-r[0])&&(r=r[1]):i=0,l)},l.lightness=function(t){return null==t?a:("array"===fr(t)?(a=t,o=t[1]-t[0]):(a=[t,t],o=0),l)},l.scale=function(){return v.scale(l)},l.hue(r),l},v.mix=v.interpolate=Ve,v.random=function(){for(var t="#",e=0;e<6;e++)t+="0123456789abcdef".charAt(yr(16*gr()));return new d(t,"hex")},v.scale=nr,v.analyze=Cr.analyze,v.contrast=function(t,e){t=new d(t),e=new d(e);var r=t.luminance(),n=e.luminance();return r>n?(r+.05)/(n+.05):(n+.05)/(r+.05)},v.deltaE=function(t,e,r,n){void 0===r&&(r=1),void 0===n&&(n=1),t=new d(t),e=new d(e);for(var a=Array.from(t.lab()),o=a[0],i=a[1],l=a[2],s=Array.from(e.lab()),u=s[0],f=s[1],c=s[2],h=xr(i*i+l*l),p=xr(f*f+c*c),v=o<16?.511:.040975*o/(1+.01765*o),y=.0638*h/(1+.0131*h)+.638,g=h<1e-6?0:180*Mr(l,i)/Pr;g<0;)g+=360;for(;g>=360;)g-=360;var b=g>=164&&g<=345?.56+Fr(.2*Ar(Pr*(g+168)/180)):.36+Fr(.4*Ar(Pr*(g+35)/180)),m=h*h*h*h,_=xr(m/(m+1900)),w=y*(_*b+1-_),L=h-p,k=i-f,C=l-c,x=(o-u)/(r*v),M=L/(n*y);return xr(x*x+M*M+(k*k+C*C-L*L)/(w*w))},v.distance=function(t,e,r){void 0===r&&(r="lab"),t=new d(t),e=new d(e);var n=t.get(r),a=e.get(r),o=0;for(var i in n){var l=(n[i]||0)-(a[i]||0);o+=l*l}return Math.sqrt(o)},v.limits=Cr.limits,v.valid=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];try{return new(Function.prototype.bind.apply(d,[null].concat(t))),!0}catch(t){return!1}},v.scales=Sr,v.colors=me,v.brewer=Br,v}()},function(t,e){function r(t){if(!t)throw new Error("obj is required");var e;if(t.length?e=t:t.coordinates?e=t.coordinates:t.geometry&&t.geometry.coordinates&&(e=t.geometry.coordinates),e)return n(e),e;throw new Error("No valid coordinates")}function n(t){if(t.length>1&&"number"==typeof t[0]&&"number"==typeof t[1])return!0;if(Array.isArray(t[0])&&t[0].length)return n(t[0]);throw new Error("coordinates must only contain numbers")}function a(t){if(!t)throw new Error("geojson is required");if(void 0!==t.geometry)return t.geometry;if(t.coordinates||t.geometries)return t;throw new Error("geojson must be a valid Feature or Geometry Object")}t.exports={geojsonType:function(t,e,r){if(!e||!r)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.type)},collectionOf:function(t,e,r){if(!t)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!t||"FeatureCollection"!==t.type)throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0;n<t.features.length;n++){var a=t.features[n];if(!a||"Feature"!==a.type||!a.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!a.geometry||a.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+a.geometry.type)}},featureOf:function(t,e,r){if(!t)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!t||"Feature"!==t.type||!t.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.geometry.type)},getCoord:function(t){if(!t)throw new Error("obj is required");var e=r(t);if(e.length>1&&"number"==typeof e[0]&&"number"==typeof e[1])return e;throw new Error("Coordinate is not a valid Point")},getCoords:r,containsNumber:n,getGeom:a,getGeomType:function(t){if(!t)throw new Error("geojson is required");var e=a(t);if(e)return e.type}}},function(t,e){L.CanvasLayer=L.Layer.extend({initialize:function(t){this._map=null,this._canvas=null,this._frame=null,this._delegate=null,L.setOptions(this,t)},delegate:function(t){return this._delegate=t,this},needRedraw:function(){return this._frame||(this._frame=L.Util.requestAnimFrame(this.drawLayer,this)),this},_onLayerDidResize:function(t){this._canvas.width=t.newSize.x,this._canvas.height=t.newSize.y},_onLayerDidMove:function(){var t=this._map.containerPointToLayerPoint([0,0]);L.DomUtil.setPosition(this._canvas,t),this.drawLayer()},getEvents:function(){var t={resize:this._onLayerDidResize,moveend:this._onLayerDidMove};return this._map.options.zoomAnimation&&L.Browser.any3d&&(t.zoomanim=this._animateZoom),t},onAdd:function(t){this._map=t,this._canvas=L.DomUtil.create("canvas","leaflet-layer"),this.tiles={};var e=this._map.getSize();this._canvas.width=e.x,this._canvas.height=e.y;var r=this._map.options.zoomAnimation&&L.Browser.any3d;L.DomUtil.addClass(this._canvas,"leaflet-zoom-"+(r?"animated":"hide")),(this.options.pane?t.getPanes()[this.options.pane]:t._panes.overlayPane).appendChild(this._canvas),t.on(this.getEvents(),this);var n=this._delegate||this;n.onLayerDidMount&&n.onLayerDidMount(),this.needRedraw()},onRemove:function(t){var e=this._delegate||this;e.onLayerWillUnmount&&e.onLayerWillUnmount(),(this.options.pane?t.getPanes()[this.options.pane]:t._panes.overlayPane).removeChild(this._canvas),t.off(this.getEvents(),this),this._canvas=null},addTo:function(t){return t.addLayer(this),this},LatLonToMercator:function(t){return{x:6378137*t.lng*Math.PI/180,y:6378137*Math.log(Math.tan((90+t.lat)*Math.PI/360))}},drawLayer:function(){var t=this._map.getSize(),e=this._map.getBounds(),r=this._map.getZoom(),n=this.LatLonToMercator(this._map.getCenter()),a=this.LatLonToMercator(this._map.containerPointToLatLng(this._map.getSize())),o=this._delegate||this;o.onDrawLayer&&o.onDrawLayer({layer:this,canvas:this._canvas,bounds:e,size:t,zoom:r,center:n,corner:a}),this._frame=null},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),r=this._map._latLngToNewLayerPoint(this._map.getBounds().getNorthWest(),t.zoom,t.center);L.DomUtil.setTransform(this._canvas,r,e)}}),L.canvasLayer=function(){return new L.CanvasLayer}},function(t,e){function r(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}L.CanvasLayer.SimpleLonLat=L.CanvasLayer.extend({options:{color:"gray",size:2},initialize:function(t,e){this.points=t,L.Util.setOptions(this,e)},onLayerDidMount:function(){},onLayerWillUnmount:function(){},setData:function(t){this.needRedraw()},onDrawLayer:function(t){var e=t.canvas.getContext("2d");e.clearRect(0,0,t.canvas.width,t.canvas.height),e.fillStyle=this.options.color;var r=!0,n=!1,a=void 0;try{for(var o,i=this.points[Symbol.iterator]();!(r=(o=i.next()).done);r=!0){var l=o.value,s=t.layer._map.latLngToContainerPoint(l);e.beginPath(),e.fillRect(s.x,s.y,this.options.size,this.options.size),e.fill(),e.closePath(),e.stroke()}}catch(t){n=!0,a=t}finally{try{!r&&i.return&&i.return()}finally{if(n)throw a}}},getBounds:function(){var t=this.points.map((function(t){return t.lng})),e=this.points.map((function(t){return t.lat})),n=Math.min.apply(Math,r(t)),a=Math.min.apply(Math,r(e)),o=Math.max.apply(Math,r(t)),i=Math.max.apply(Math,r(e)),l=L.latLng(a,n),s=L.latLng(i,o);return L.latLngBounds(l,s)}}),L.canvasLayer.simpleLonLat=function(t,e){return new L.CanvasLayer.SimpleLonLat(t,e)}},function(t,e){L.CanvasLayer.Field=L.CanvasLayer.extend({options:{mouseMoveCursor:{value:"pointer",noValue:"default"},opacity:1,onClick:null,onMouseMove:null,inFilter:null},initialize:function(t,e){L.Util.setOptions(this,e),this._visible=!0,t&&this.setData(t)},getEvents:function(){var t=L.CanvasLayer.prototype.getEvents.call(this);return t.zoomstart=this._hideCanvas.bind(this),t.zoomend=this._showCanvas.bind(this),t},onLayerDidMount:function(){this._enableIdentify(),this._ensureCanvasAlignment()},show:function(){this._visible=!0,this._showCanvas(),this._enableIdentify()},hide:function(){this._visible=!1,this._hideCanvas(),this._disableIdentify()},isVisible:function(){return this._visible},_showCanvas:function(){this._canvas&&this._visible&&(this._canvas.style.visibility="visible")},_hideCanvas:function(){this._canvas&&(this._canvas.style.visibility="hidden")},_enableIdentify:function(){this._map.on("click",this._onClick,this),this._map.on("mousemove",this._onMouseMove,this),this.options.onClick&&this.on("click",this.options.onClick,this),this.options.onMouseMove&&this.on("mousemove",this.options.onMouseMove,this)},_disableIdentify:function(){this._map.off("click",this._onClick,this),this._map.off("mousemove",this._onMouseMove,this),this.options.onClick&&this.off("click",this.options.onClick,this),this.options.onMouseMove&&this.off("mousemove",this.options.onMouseMove,this)},_ensureCanvasAlignment:function(){var t=this._map.containerPointToLayerPoint([0,0]);L.DomUtil.setPosition(this._canvas,t)},onLayerWillUnmount:function(){this._disableIdentify()},needRedraw:function(){this._map&&this._field&&L.CanvasLayer.prototype.needRedraw.call(this)},onDrawLayer:function(t){throw new TypeError("Must be overriden")},setData:function(t){this.options.inFilter&&t.setFilter(this.options.inFilter),this._field=t,this.needRedraw(),this.fire("load")},setFilter:function(t){this.options.inFilter=t,this._field&&this._field.setFilter(t),this.needRedraw()},setOpacity:function(t){return this.options.opacity=t,this._canvas&&this._updateOpacity(),this},getBounds:function(){var t=this._field.extent(),e=L.latLng(t[1],t[0]),r=L.latLng(t[3],t[2]);return L.latLngBounds(e,r)},_onClick:function(t){var e=this._queryValue(t);this.fire("click",e)},_onMouseMove:function(t){var e=this._queryValue(t);this._changeCursorOn(e),this.fire("mousemove",e)},_changeCursorOn:function(t){if(this.options.mouseMoveCursor){var e=this.options.mouseMoveCursor,r=e.value,n=e.noValue;this._map.getContainer().style.cursor=null!==t.value?r:n}},_updateOpacity:function(){L.DomUtil.setOpacity(this._canvas,this.options.opacity)},_queryValue:function(t){var e=this._field?this._field.valueAt(t.latlng.lng,t.latlng.lat):null;return{latlng:t.latlng,value:e}},_getDrawingContext:function(){var t=this._canvas.getContext("2d");return t.clearRect(0,0,this._canvas.width,this._canvas.height),t}})},function(t,e,r){"use strict";r.r(e);var n=r(0),a=r(2),o=r.n(a),i=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],n=!0,a=!1,o=void 0;try{for(var i,l=t[Symbol.iterator]();!(n=(i=l.next()).done)&&(r.push(i.value),!e||r.length!==e);n=!0);}catch(t){a=!0,o=t}finally{try{!n&&l.return&&l.return()}finally{if(a)throw o}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")};L.CanvasLayer.ScalarField=L.CanvasLayer.Field.extend({options:{type:"colormap",color:null,interpolate:!1,vectorSize:20,arrowDirection:"from"},initialize:function(t,e){L.CanvasLayer.Field.prototype.initialize.call(this,t,e),L.Util.setOptions(this,e)},_defaultColorScale:function(){return o.a.scale(["white","black"]).domain(this._field.range)},setColor:function(t){this.options.color=t,this.needRedraw()},onDrawLayer:function(t){this.isVisible()&&(this._updateOpacity(),this._getRendererMethod()())},_getRendererMethod:function(){switch(this.options.type){case"colormap":return this._drawImage.bind(this);case"vector":return this._drawArrows.bind(this);default:throw Error("Unkwown renderer type: "+this.options.type)}},_ensureColor:function(){null===this.options.color&&this.setColor(this._defaultColorScale())},_showCanvas:function(){L.CanvasLayer.Field.prototype._showCanvas.call(this),this.needRedraw()},_drawImage:function(){this._ensureColor();var t=this._getDrawingContext(),e=this._canvas.width,r=this._canvas.height,n=t.createImageData(e,r),a=n.data;this._prepareImageIn(a,e,r),t.putImageData(n,0,0)},_prepareImageIn:function(t,e,r){for(var n=this.options.interpolate?"interpolatedValueAt":"valueAt",a=0,o=0;o<r;o++)for(var l=0;l<e;l++){var s=this._map.containerPointToLatLng([l,o]),u=s.lng,f=s.lat,c=this._field[n](u,f);if(null!==c){var h=this._getColorFor(c),d=i(h,4),p=d[0],v=d[1],y=d[2],g=d[3];t[a]=p,t[a+1]=v,t[a+2]=y,t[a+3]=parseInt(255*g)}a+=4}},_drawArrows:function(){var t=this._pixelBounds(),e=(t.max.x-t.min.x)/this._field.nCols,r=Math.max(1,Math.floor(1.2*this.options.vectorSize/e)),a=this._getDrawingContext();a.strokeStyle=this.options.color;for(var o=this._map.getBounds(),l=0;l<this._field.height;l+=r)for(var s=0;s<this._field.width;s+=r){var u=this._field._lonLatAtIndexes(s,l),f=i(u,2),c=f[0],h=f[1],d=this._field.valueAt(c,h),p=L.latLng(h,c);if(null!==d&&o.contains(p)){var v=new n.a(p,d,this.cellXSize,this.cellYSize);this._drawArrow(v,a)}}},_pixelBounds:function(){var t=this.getBounds(),e=this._map.latLngToContainerPoint(t.getNorthWest()),r=this._map.latLngToContainerPoint(t.getSouthEast());return L.bounds(e,r)},_drawArrow:function(t,e){var r=this._map.latLngToContainerPoint(t.center),n=this.options.color;"function"==typeof n&&(e.strokeStyle=n(t.value));var a=this.options.vectorSize;e.save(),e.translate(r.x,r.y);var o=(90+t.value)*Math.PI/180;"towards"===this.options.arrowDirection&&(o+=Math.PI),e.rotate(o),e.beginPath(),e.moveTo(-a/2,0),e.lineTo(+a/2,0),e.moveTo(.25*a,.25*-a),e.lineTo(+a/2,0),e.lineTo(.25*a,.25*a),e.stroke(),e.restore()},_getColorFor:function(t){return this.options.color(t).rgba()}}),L.canvasLayer.scalarField=function(t,e){return new L.CanvasLayer.ScalarField(t,e)}},function(t,e){L.CanvasLayer.VectorFieldAnim=L.CanvasLayer.Field.extend({options:{paths:800,color:"white",width:1,fade:.96,duration:20,maxAge:200,velocityScale:2e-4},initialize:function(t,e){L.CanvasLayer.Field.prototype.initialize.call(this,t,e),L.Util.setOptions(this,e),this.timer=null},onLayerDidMount:function(){L.CanvasLayer.Field.prototype.onLayerDidMount.call(this),this._map.on("move resize",this._stopAnimation,this)},onLayerWillUnmount:function(){L.CanvasLayer.Field.prototype.onLayerWillUnmount.call(this),this._map.off("move resize",this._stopAnimation,this),this._stopAnimation()},_hideCanvas:function(){L.CanvasLayer.Field.prototype._hideCanvas.call(this),this._stopAnimation()},onDrawLayer:function(t){if(this._field&&this.isVisible()){this._updateOpacity();var e=this._getDrawingContext(),r=this._prepareParticlePaths();this.timer=d3.timer((function(){var a;r.forEach((function(t){t.age>n.options.maxAge&&(t.age=0,n._field.randomPosition(t));var e=n._field.valueAt(t.x,t.y);if(null===e)t.age=n.options.maxAge;else{var r=t.x+e.u*n.options.velocityScale,a=t.y+e.v*n.options.velocityScale;n._field.hasValueAt(r,a)?(t.xt=r,t.yt=a,t.m=e.magnitude()):t.age=n.options.maxAge}t.age+=1})),a=e.globalCompositeOperation,e.globalCompositeOperation="destination-in",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.globalCompositeOperation=a,e.fillStyle="rgba(0, 0, 0, "+n.options.fade+")",e.lineWidth=n.options.width,e.strokeStyle=n.options.color,r.forEach((function(r){n._drawParticle(t,e,r)}))}),this.options.duration);var n=this}},_drawParticle:function(t,e,r){var n=new L.latLng(r.y,r.x),a=new L.latLng(r.yt,r.xt);if(t.bounds.contains(n)&&r.age<=this.options.maxAge){var o=t.layer._map.latLngToContainerPoint(n),i=t.layer._map.latLngToContainerPoint(a);e.beginPath(),e.moveTo(o.x,o.y),e.lineTo(i.x,i.y),r.x=r.xt,r.y=r.yt;var l=this.options.color;"function"==typeof l&&(e.strokeStyle=l(r.m));var s=this.options.width;"function"==typeof s&&(e.lineWidth=s(r.m)),e.stroke()}},_prepareParticlePaths:function(){for(var t=[],e=0;e<this.options.paths;e++){var r=this._field.randomPosition();r.age=this._randomAge(),t.push(r)}return t},_randomAge:function(){return Math.floor(Math.random()*this.options.maxAge)},_stopAnimation:function(){this.timer&&this.timer.stop()}}),L.canvasLayer.vectorFieldAnim=function(t,e){return new L.CanvasLayer.VectorFieldAnim(t,e)}},function(t,e){var r=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],n=!0,a=!1,o=void 0;try{for(var i,l=t[Symbol.iterator]();!(n=(i=l.next()).done)&&(r.push(i.value),!e||r.length!==e);n=!0);}catch(t){a=!0,o=t}finally{try{!n&&l.return&&l.return()}finally{if(a)throw o}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")};L.Control.ColorBar=L.Control.extend({options:{position:"bottomleft",width:300,height:15,margin:15,background:"#fff",textColor:"black",steps:100,decimals:2,units:"uds",title:"Legend",labels:[],textLabels:[],labelFontSize:10,labelTextPosition:"middle"},initialize:function(t,e,r){this.color=t,this.range=e,L.Util.setOptions(this,r)},onAdd:function(t){this._map=t;var e=L.DomUtil.create("div","leaflet-control-colorBar leaflet-bar leaflet-control");return e.style.padding="10px",L.DomEvent.addListener(e,"click",L.DomEvent.stopPropagation).addListener(e,"click",L.DomEvent.preventDefault),e.style.backgroundColor=this.options.background,e.style.cursor="text",e.innerHTML=this.title()+this.palette(),e},title:function(){var t=document.createElement("div");return d3.select(t).append("span").style("color",this.options.textColor).style("display","block").style("margin-bottom","5px").attr("class","leaflet-control-colorBar-title").text(this.options.title),t.innerHTML},palette:function(){var t=document.createElement("div"),e=this._createSvgIn(t);return this._appendColorBarTo(e),this.options.labels&&this._appendLabelsTo(e),t.innerHTML},_createSvgIn:function(t){var e=this.options.labels?this.options.margin:0;return d3.select(t).append("svg").attr("width",this.options.width+2*this.options.margin).attr("height",this.options.height+e)},_appendColorBarTo:function(t){var e=this,r=this._getColorPerValue(),n=this.options.width/r.length,a=t.append("g").attr("id","colorBar-buckets").selectAll("rect").data(r).enter().append("rect");a.attr("x",(function(t,r){return r*n+e.options.margin})).attr("y",(function(){return 0})).attr("height",(function(){return e.options.height})).attr("width",(function(){return n})).attr("stroke-width",2).attr("stroke-linecap","butt").attr("stroke",(function(t){return t.color.hex()})).attr("fill",(function(t){return t.color.hex()})),a.append("title").text((function(t){return t.value.toFixed(e.options.decimals)+" "+e.options.units}))},_appendLabelsTo:function(t){var e=this,r=this._getPositionPerLabelValue();t.append("g").attr("id","colorBar-labels").selectAll("text").data(r).enter().append("text").attr("x",(function(t){return t.position+e.options.margin})).attr("y",this.options.height+this.options.margin).attr("font-size",this.options.labelFontSize+"px").attr("text-anchor",this.options.labelTextPosition).attr("fill",this.options.textColor).attr("class","leaflet-control-colorBar-label").text((function(t){return e.options.textLabels?t.label:""+t.value.toFixed(e.options.decimals)}))},_getColorPerValue:function(){var t=this,e=r(this.range,2),n=e[0],a=e[1],o=(a-n)/this.options.steps;return d3.range(n,a+o,o).map((function(e){return{value:e,color:t.color(e)}}))},_getPositionPerLabelValue:function(){var t=this,e=d3.scaleLinear().range([0,this.options.width]).domain(this.range);return this.options.labels.map((function(r,n){return{label:t.options.textLabels?t.options.textLabels[n]:"",value:r,position:e(r)}}))}}),L.control.colorBar=function(t,e,r){return new L.Control.ColorBar(t,e,r)}},function(t,e){L.Control.LayersPlayer=L.Control.extend({initialize:function(t,e,r){this.activePopup=null,this.canvasList=t,this.paneId=e,this.refreshTime=r.refreshTime?r.refreshTime:1e3,this.loop=!!r.loop&&r.loop,this.currentPlay=null,this.buttons={},r.cvLst=this.canvasList,L.Util.setOptions(this,r)},onAdd:function(t){return this.currentFrame=0,this._map=t,this.div=L.DomUtil.create("div","leaflet-control"),this.div.style.padding="10px",L.DomEvent.addListener(this.div,"click",L.DomEvent.stopPropagation).addListener(this.div,"click",L.DomEvent.preventDefault),this.div.style.backgroundColor=this.options.background,this.div.style.cursor="text",this._createLabels(this.div),this._createButtons(this.div),this.goTo(0),this.div},displayLayer:function(t){var e=L.Control.LayersPlayer.lastCreated,r=e._map.getPane(e.paneId);0!=(r=r.children).length&&[].concat(function(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}(Array(e.canvasList.length).keys())).forEach((function(n){var a=r[n+1],o=t==n+1;a.style.display=o?"block":"none",e.onClick&&o?e.canvasList[n][0].on("click",e.onClick):e.canvasList[n][0].off("click")}))},toggleLoop:function(){var t=L.Control.LayersPlayer.lastCreated;t.loop=!t.loop,t._setButtonActive(this,"toggleLoop",t.loop)},goTo:function(t){var e=L.Control.LayersPlayer.lastCreated;if(this.currentFrame=t,this.displayLayer(t+1),this.div.querySelector(".leaflet-control-layersPlayer-frameCounter").innerHTML=this._zeroPad(t+1,2)+"/"+this._zeroPad(this.canvasList.length,2),this.div.querySelector(".leaflet-control-layersPlayer-frameLabel").innerHTML=this.canvasList[t][1],e.onClick&&this.canvasList[e.currentFrame][0].on("click",e.onClick),this.activePopup){var r=this.activePopup._latlng,n=this.canvasList[e.currentFrame][0]._field.valueAt(r.lng,r.lat);this.canvasList[e.currentFrame][0].fireEvent("click",{latlng:r,frameChange:!0,value:n})}return this.div},goFirst:function(){L.Control.LayersPlayer.lastCreated.goTo(0)},goLast:function(){var t=L.Control.LayersPlayer.lastCreated,e=t.canvasList.length-1;t.goTo(e>=0?e:0)},goNext:function(){var t=L.Control.LayersPlayer.lastCreated,e=t.currentFrame+1;e<t.canvasList.length?t.goTo(e):t.loop?t.goTo(0):(t.goTo(t.canvasList.length-1),t.playStop())},goPrev:function(){var t=L.Control.LayersPlayer.lastCreated,e=t.currentFrame-1;e>=0?t.goTo(e):t.loop?t.goTo(t.canvasList.length-1):(t.goTo(0),t.playStop())},playBackward:function(){var t=L.Control.LayersPlayer.lastCreated;t.playStop(),t.currentPlay=setInterval(t.goPrev,t.refreshTime),t._setButtonActive(this,"playBackward",!0),t._setButtonActive(t.buttons.playForward,"playForward",!1)},playForward:function(){var t=L.Control.LayersPlayer.lastCreated;t.playStop(),t.currentPlay=setInterval(t.goNext,t.refreshTime),t._setButtonActive(this,"playForward",!0),t._setButtonActive(t.buttons.playBackward,"playBackward",!1)},playStop:function(){var t=L.Control.LayersPlayer.lastCreated;null!=t.currentPlay&&(clearInterval(t.currentPlay),t.currentPlay=null),t._setButtonActive(t.buttons.playForward,"playForward",!1),t._setButtonActive(t.buttons.playBackward,"playBackward",!1)},_addStyles:function(t,e){Object.keys(e).forEach((function(r){t.style[r]=e[r]}))},_createLabels:function(t){var e=this.canvasList.length,r=document.createElement("div");return d3.select(r).attr("class","leaflet-control-layersPlayer-title"),d3.select(r).append("span").style("color",this.options.textColor).style("text-color","#777777").style("display","block").style("margin-bottom","5px").style("width","35px").style("display","block").style("float","left").attr("class","leaflet-control-layersPlayer-frameCounter").text("00/"+this._zeroPad(e,2)),d3.select(r).append("span").style("color",this.options.textColor).style("display","block").style("margin-bottom","5px").style("width","125px").style("display","block").style("float","left").attr("class","leaflet-control-layersPlayer-frameLabel").text("Loading labels..."),t.innerHTML+=r.innerHTML,null},_createButtons:function(t){var e=L.DomUtil.create("div",null,t);e.style.width="auto",this.buttons.moveFirst=this._createMoveFirstButton(e),this.buttons.playBackward=this._createPlayBackwardsButton(e),this.buttons.previous=this._createPreviousButton(e),this.buttons.stop=this._createStopButton(e),this.buttons.next=this._createNextButton(e),this.buttons.playForward=this._createPlayForwardButton(e),this.buttons.moveLast=this._createMoveLastButton(e),this.buttons.toggleLoop=this._createToggleLoopButton(e)},_createButton:function(t,e,r,n){var a=null;try{a=this.options.buttons[e].cssClass}catch(t){a=null}var o=L.DomUtil.create("div",a,t),i=void 0;try{i=this.options.buttons[e].style}catch(t){i=void 0}i&&this._addStyles(o,i),a||i||this._addStyles(o,this._buttonsDefaultStyle);try{o.innerHTML=this.options.buttons[e].innerHTML||r.innerHTML}catch(t){o.innerHTML=r.innerHTML}try{o.setAttribute("title",this.options.buttons[e].title||r.title)}catch(t){o.setAttribute("title",r.title)}return L.DomEvent.addListener(o,"click",n),o},_createMoveFirstButton:function(t){return this._createButton(t,"moveFirst",{innerHTML:"|&#9665;",title:"First frame"},this.goFirst)},_createPlayBackwardsButton:function(t){return this._createButton(t,"playBackward",{innerHTML:"&#9668;",title:"Play backwards"},this.playBackward)},_createPreviousButton:function(t){return this._createButton(t,"prev",{innerHTML:"&#9665;",title:"Previous frame"},this.goPrev)},_createNextButton:function(t){return this._createButton(t,"next",{innerHTML:"&#9655;",title:"Next frame"},this.goNext)},_createPlayForwardButton:function(t){return this._createButton(t,"playForward",{innerHTML:"&#9658;",title:"Play Forward"},this.playForward)},_createStopButton:function(t){return this._createButton(t,"stop",{innerHTML:"&#9632;",title:"Stop"},this.playStop)},_createMoveLastButton:function(t){return this._createButton(t,"moveLast",{innerHTML:"&#9655;|",title:"Last frame"},this.goLast)},_createToggleLoopButton:function(t){return this._createButton(t,"toggleLoop",{innerHTML:"&#8734;",title:"Loop"},this.toggleLoop)},_setButtonActive:function(t,e,r){var n=void 0;try{n=this.options.buttons[e].cssClassRun}catch(t){n=void 0}n&&(r?L.DomUtil.addClass(t,n):L.DomUtil.removeClass(t,n))},_zeroPad:function(t,e){return String(t).padStart(e,"0")},_buttonsDefaultStyle:{float:"left",display:"block",width:"16px",backgroundColor:"#FFFFFF",padding:"2px",border:"1px solid #333333",cursor:"pointer",color:"#111111",textAlign:"center"}}),L.control.layersPlayer=function(t,e,r){var n=new L.Control.LayersPlayer(t,e,r);if(L.Control.LayersPlayer.lastCreated){var a=function t(e){for(;e.hasChildNodes();)t(e.firstChild);e.parentNode.removeChild(e)};!function(t){for(;t.hasChildNodes();)a(t.firstChild)}(L.Control.LayersPlayer.lastCreated.div),delete L.Control.LayersPlayer.lastCreated}return L.Control.LayersPlayer.lastCreated=n,L.Control.LayersPlayer.lastCreated}},function(t,e,r){"use strict";r.r(e);var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();var a=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.u=e,this.v=r}return n(t,[{key:"magnitude",value:function(){return Math.sqrt(this.u*this.u+this.v*this.v)}},{key:"directionTo",value:function(){var t=Math.atan2(this.u,this.v)*(180/Math.PI);return t<0&&(t+=360),t}},{key:"directionFrom",value:function(){return(this.directionTo()+180)%360}}]),t}(),o=r(0),i=r(1),l=r.n(i),s=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],n=!0,a=!1,o=void 0;try{for(var i,l=t[Symbol.iterator]();!(n=(i=l.next()).done)&&(r.push(i.value),!e||r.length!==e);n=!0);}catch(t){a=!0,o=t}finally{try{!n&&l.return&&l.return()}finally{if(a)throw o}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},u=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();var f=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.params=e,this.nCols=e.nCols,this.nRows=e.nRows,this.width=e.nCols,this.height=e.nRows,this.xllCorner=e.xllCorner,this.yllCorner=e.yllCorner,this.xurCorner=e.xllCorner+e.nCols*e.cellXSize,this.yurCorner=e.yllCorner+e.nRows*e.cellYSize,this.cellXSize=e.cellXSize,this.cellYSize=e.cellYSize,this.grid=null,this.isContinuous=this.xurCorner-this.xllCorner>=360,this.longitudeNeedsToBeWrapped=this.xurCorner>180,this._inFilter=null,this._spatialMask=null}return u(t,[{key:"_buildGrid",value:function(){throw new TypeError("Must be overriden")}},{key:"_updateRange",value:function(){this.range=this._calculateRange()}},{key:"numCells",value:function(){return this.nRows*this.nCols}},{key:"getCells",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=[],r=0;r<this.nRows;r+=t)for(var n=0;n<this.nCols;n+=t){var a=this._lonLatAtIndexes(n,r),i=s(a,2),l=i[0],u=i[1],f=L.latLng(u,l),c=this._valueAtIndexes(n,r),h=new o.a(f,c,this.cellXSize,this.cellYSize);e.push(h)}return e}},{key:"setFilter",value:function(t){this._inFilter=t,this._updateRange()}},{key:"setSpatialMask",value:function(t){this._spatialMask=t}},{key:"extent",value:function(){var t=this._getWrappedLongitudes(),e=s(t,2),r=e[0],n=e[1];return[r,this.yllCorner,n,this.yurCorner]}},{key:"_getWrappedLongitudes",value:function(){var t=this.xllCorner,e=this.xurCorner;return this.longitudeNeedsToBeWrapped&&(this.isContinuous?(t=-180,e=180):(e=this.xurCorner-360,t=this.xllCorner-360)),[t,e]}},{key:"contains",value:function(t,e){return this._spatialMask?this._pointInMask(t,e):this._pointInExtent(t,e)}},{key:"_pointInExtent",value:function(t,e){var r=this._getWrappedLongitudes(),n=s(r,2),a=n[0],o=n[1],i=t>=a&&t<=o,l=e>=this.yllCorner&&e<=this.yurCorner;return i&&l}},{key:"_pointInMask",value:function(t,e){var r={type:"Feature",geometry:{type:"Point",coordinates:[t,e]},properties:{}},n=this._spatialMask;return l()(r,n)}},{key:"notContains",value:function(t,e){return!this.contains(t,e)}},{key:"interpolatedValueAt",value:function(t,e){if(this.notContains(t,e))return null;var r=this._getDecimalIndexes(t,e),n=s(r,2),a=n[0],o=n[1];return this.interpolatedValueAtIndexes(a,o)}},{key:"interpolatedValueAtIndexes",value:function(t,e){var r=this._getFourSurroundingIndexes(t,e),n=s(r,4),a=n[0],o=n[1],i=n[2],l=n[3],u=this._getFourSurroundingValues(a,o,i,l);if(u){var f=s(u,4),c=f[0],h=f[1],d=f[2],p=f[3];return this._doInterpolation(t-a,e-i,c,h,d,p)}return null}},{key:"_getDecimalIndexes",value:function(t,e){return this.longitudeNeedsToBeWrapped&&t<this.xllCorner&&(t+=360),[(t-this.xllCorner)/this.cellXSize,(this.yurCorner-e)/this.cellYSize]}},{key:"_getFourSurroundingIndexes",value:function(t,e){var r=Math.floor(t),n=r+1;this.isContinuous&&n>=this.nCols&&(n=0),n=this._clampColumnIndex(n);var a=this._clampRowIndex(Math.floor(e));return[r,n,a,this._clampRowIndex(a+1)]}},{key:"_getFourSurroundingValues",value:function(t,e,r,n){var a;if(a=this.grid[r]){var o=a[t],i=a[e];if(this._isValid(o)&&this._isValid(i)&&(a=this.grid[n])){var l=a[t],s=a[e];if(this._isValid(l)&&this._isValid(s))return[o,i,l,s]}}return null}},{key:"valueAt",value:function(t,e){if(this.notContains(t,e))return null;var r=this._getDecimalIndexes(t,e),n=s(r,2),a=n[0],o=n[1],i=Math.floor(a),l=Math.floor(o),u=this._clampColumnIndex(i),f=this._clampRowIndex(l),c=this._valueAtIndexes(u,f);return this._inFilter&&!this._inFilter(c)?null:c}},{key:"hasValueAt",value:function(t,e){var r=this.valueAt(t,e),n=null!==r,a=!0;return this._inFilter&&(a=this._inFilter(r)),n&&a}},{key:"notHasValueAt",value:function(t,e){return!this.hasValueAt(t,e)}},{key:"randomPosition",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Math.random()*this.nCols|0,r=Math.random()*this.nRows|0;return t.x=this._longitudeAtX(e),t.y=this._latitudeAtY(r),t}},{key:"_valueAtIndexes",value:function(t,e){return this.grid[e][t]}},{key:"_lonLatAtIndexes",value:function(t,e){return[this._longitudeAtX(t),this._latitudeAtY(e)]}},{key:"_longitudeAtX",value:function(t){var e=this.cellXSize/2,r=this.xllCorner+e+t*this.cellXSize;return this.longitudeNeedsToBeWrapped&&(r=r>180?r-360:r),r}},{key:"_latitudeAtY",value:function(t){var e=this.cellYSize/2;return this.yurCorner-e-t*this.cellYSize}},{key:"_doInterpolation",value:function(t,e,r,n,a,o){throw new TypeError("Must be overriden")}},{key:"_clampColumnIndex",value:function(t){var e=t;t<0&&(e=0);var r=this.nCols-1;return t>r&&(e=r),e}},{key:"_clampRowIndex",value:function(t){var e=t;t<0&&(e=0);var r=this.nRows-1;return t>r&&(e=r),e}},{key:"_isValid",value:function(t){return null!=t}}]),t}(),c=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],n=!0,a=!1,o=void 0;try{for(var i,l=t[Symbol.iterator]();!(n=(i=l.next()).done)&&(r.push(i.value),!e||r.length!==e);n=!0);}catch(t){a=!0,o=t}finally{try{!n&&l.return&&l.return()}finally{if(a)throw o}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},h=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();function d(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}var p=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.zs=t.zs,r.grid=r._buildGrid(),r._updateRange(),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),h(e,null,[{key:"fromASCIIGrid",value:function(t){for(var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=t.split("\n"),a=e._parseASCIIGridHeader(n.slice(0,6)),o=[],i=6;i<n.length;i++){var l=n[i].trim();if(""===l)break;var s=l.split(" ");s.forEach((function(t){var e=parseFloat(t),n=e!==a.noDataValue?e*r:null;o.push(n)}))}var u=a;return u.zs=o,new e(u)}},{key:"_parseASCIIGridHeader",value:function(t){try{var e=t.map((function(t){var e=t.split(" ").filter((function(t){return""!=t}));return function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}({},e[0].trim().toUpperCase(),parseFloat(e[1].trim()))})),r="XLLCORNER"in e[2],n=e[4].CELLSIZE;return{nCols:parseInt(e[0].NCOLS),nRows:parseInt(e[1].NROWS),xllCorner:r?e[2].XLLCORNER:e[2].XLLCENTER-n/2,yllCorner:r?e[3].YLLCORNER:e[3].YLLCENTER-n/2,cellXSize:n,cellYSize:n,noDataValue:e[5].NODATA_VALUE}}catch(t){throw new Error("Not a valid ASCIIGrid Header: "+t)}}},{key:"fromGeoTIFF",value:async function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=[r],a=await GeoTIFF.fromArrayBuffer(t),o=await a.getImage(),i=await o.readRasters(),l=o.getTiePoints()[0],s=o.getFileDirectory(),u=c(s.ModelPixelScale,2),f=u[0],h=u[1];void 0!==n&&0!==n.length||(n=[].concat(d(Array(i.length).keys())));return n.map((function(t){var r=i[t];if(s.GDAL_NODATA){var n=parseFloat(s.GDAL_NODATA);r=Array.from(r).map((function(t){return t===n?null:t}))}return new e({nCols:o.getWidth(),nRows:o.getHeight(),xllCorner:l.x,yllCorner:l.y-o.getHeight()*h,cellXSize:f,cellYSize:h,zs:r})}))[0]}},{key:"multipleFromGeoTIFF",value:function(t,e){}}]),h(e,[{key:"_buildGrid",value:function(){return this._arrayTo2d(this.zs,this.nRows,this.nCols)}},{key:"_arrayTo2d",value:function(t,e,r){for(var n=[],a=0,o=0;o<e;o++){for(var i=[],l=0;l<r;l++,a++){var s=t[a];i[l]=this._isValid(s)?s:null}n[o]=i}return n}},{key:"_newDataArrays",value:function(t){t.zs=[]}},{key:"_pushValueToArrays",value:function(t,e){t.zs.push(e)}},{key:"_makeNewFrom",value:function(t){return new e(t)}},{key:"_calculateRange",value:function(){var t=this.zs;return this._inFilter&&(t=t.filter(this._inFilter)),[d3.min(t),d3.max(t)]}},{key:"_doInterpolation",value:function(t,e,r,n,a,o){var i=1-t,l=1-e;return r*i*l+n*t*l+a*i*e+o*t*e}}]),e}(f),v=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],n=!0,a=!1,o=void 0;try{for(var i,l=t[Symbol.iterator]();!(n=(i=l.next()).done)&&(r.push(i.value),!e||r.length!==e);n=!0);}catch(t){a=!0,o=t}finally{try{!n&&l.return&&l.return()}finally{if(a)throw o}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},y=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();var g=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.us=t.us,r.vs=t.vs,r.grid=r._buildGrid(),r.range=r._calculateRange(),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),y(e,null,[{key:"fromASCIIGrids",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=p.fromASCIIGrid(t,n),o=p.fromASCIIGrid(r,n),i=e._paramsFromScalarFields(a,o);return new e(i)}},{key:"fromGeoTIFFs",value:function(t,r){var n=p.fromGeoTIFF(t),a=p.fromGeoTIFF(r),o=e._paramsFromScalarFields(n,a);return new e(o)}},{key:"fromMultibandGeoTIFF",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,1],n=p.multipleFromGeoTIFF(t,r),a=v(n,2),o=a[0],i=a[1],l=e._paramsFromScalarFields(o,i);return new e(l)}},{key:"_paramsFromScalarFields",value:function(t,e){return{nCols:t.nCols,nRows:t.nRows,xllCorner:t.xllCorner,yllCorner:t.yllCorner,cellXSize:t.cellXSize,cellYSize:t.cellYSize,us:t.zs,vs:e.zs}}}]),y(e,[{key:"getScalarField",value:function(t){var e=this._getFunctionFor(t),r={nCols:this.params.nCols,nRows:this.params.nRows,xllCorner:this.params.xllCorner,yllCorner:this.params.yllCorner,cellXSize:this.params.cellXSize,cellYSize:this.params.cellYSize,zs:this._applyOnField(e)};return new p(r)}},{key:"_getFunctionFor",value:function(t){return function(e,r){return new a(e,r)[t]()}}},{key:"_applyOnField",value:function(t){for(var e=[],r=this.numCells(),n=0;n<r;n++){var a=this.us[n],o=this.vs[n];this._isValid(a)&&this._isValid(o)?e.push(t(a,o)):e.push(null)}return e}},{key:"_buildGrid",value:function(){return this._arraysTo2d(this.us,this.vs,this.nRows,this.nCols)}},{key:"_arraysTo2d",value:function(t,e,r,n){for(var o=[],i=0,l=0;l<r;l++){for(var s=[],u=0;u<n;u++,i++){var f=t[i],c=e[i],h=this._isValid(f)&&this._isValid(c);s[u]=h?new a(f,c):null}o[l]=s}return o}},{key:"_newDataArrays",value:function(t){t.us=[],t.vs=[]}},{key:"_pushValueToArrays",value:function(t,e){t.us.push(e.u),t.vs.push(e.v)}},{key:"_makeNewFrom",value:function(t){return new e(t)}},{key:"_calculateRange",value:function(){var t=this.getCells().map((function(t){return t.value})).filter((function(t){return null!==t}));this._inFilter&&(t=t.filter(this._inFilter));var e=t.map((function(t){return t.magnitude()}));return[d3.min(e),d3.max(e)]}},{key:"_doInterpolation",value:function(t,e,r,n,o,i){var l=1-t,s=1-e,u=l*s,f=t*s,c=l*e,h=t*e,d=r.u*u+n.u*f+o.u*c+i.u*h,p=r.v*u+n.v*f+o.v*c+i.v*h;return new a(d,p)}},{key:"_isValid",value:function(t){return null!=t}}]),e}(f);window.L.Vector=a,window.L.Cell=o.a,window.L.Field=f,window.L.ScalarField=p,window.L.VectorField=g,r(4),r(5),r(6),r(7),r(8),r(9),r(10)}]);
//# sourceMappingURL=leaflet.canvaslayer.field.js.map
// }
